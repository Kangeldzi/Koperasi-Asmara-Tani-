<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Input Link QR Code Hybrid | Koperasi Asmara Tani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js"></script>
    <style>
        :root {
            --primary: #1a5f23;
            --primary-light: #2e7d32;
            --primary-dark: #0d4014;
            --secondary: #ff9800;
            --accent-blue: #2196f3;
            --accent-purple: #9c27b0;
            --danger: #f44336;
            --warning: #ffc107;
            --success: #4caf50;
            --info: #2196f3;
            
            --bg-light: #f5f6fa;
            --card-bg: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-muted: #888888;
            --border-color: #eeeeee;
            
            --shadow-light: 0 10px 30px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 15px 35px rgba(0, 0, 0, 0.1);
            --shadow-dark: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0d4014 0%, #1a5f23 50%, #2e7d32 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* ===== ADMIN HEADER RESPONSIVE ===== */
        .admin-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 15px;
            background: white;
            margin-bottom: 20px;
            box-shadow: var(--shadow-medium);
            gap: 15px;
        }

        @media (min-width: 768px) {
            .admin-header {
                flex-direction: row;
                justify-content: space-between;
                padding: 20px 30px;
            }
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: center;
        }

        @media (min-width: 768px) {
            .admin-info {
                text-align: left;
            }
        }

        .admin-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .admin-details h2 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        @media (min-width: 768px) {
            .admin-details h2 {
                font-size: 1.4rem;
            }
        }

        .admin-details p {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            padding: 10px 15px;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .nav-btn {
                padding: 10px 20px;
            }
        }

        .nav-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .nav-btn.dashboard {
            background: var(--accent-blue);
        }

        .nav-btn.dashboard:hover {
            background: #1976D2;
        }

        /* ===== CONTAINER RESPONSIVE ===== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            padding: 0 10px;
        }

        .page-header h1 {
            font-size: 1.6rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        @media (min-width: 768px) {
            .page-header h1 {
                font-size: 2rem;
            }
        }

        .page-header p {
            font-size: 0.95rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }

        @media (min-width: 768px) {
            .page-header p {
                font-size: 1.1rem;
            }
        }

        /* ===== ADMIN MAIN CONTENT ===== */
        .admin-main {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow-medium);
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .admin-main {
                padding: 30px;
            }
        }

        .content-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(26, 95, 35, 0.1);
            gap: 15px;
            text-align: center;
        }

        @media (min-width: 768px) {
            .content-header {
                flex-direction: row;
                justify-content: space-between;
                text-align: left;
            }
        }

        .content-header h2 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
        }

        @media (min-width: 768px) {
            .content-header h2 {
                font-size: 1.5rem;
            }
        }

        .admin-badge {
            background: var(--warning);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        /* ===== STATS CARDS (Seperti Administrator System) ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-light);
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: rgba(26, 95, 35, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* ===== FORM INPUT ===== */
        .form-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        @media (min-width: 768px) {
            .form-section {
                padding: 25px;
            }
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 95, 35, 0.1);
        }

        .form-hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 12px 0;
        }

        .form-checkbox input {
            width: 18px;
            height: 18px;
        }

        .form-checkbox label {
            font-weight: 500;
            font-size: 0.95rem;
        }

        /* ===== URL INPUT - PERBAIKAN UTAMA ===== */
        .url-input-wrapper {
            margin-bottom: 20px;
        }

        .url-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 8px;
        }

        @media (min-width: 576px) {
            .url-input-group {
                flex-direction: row;
            }
        }

        .url-prefix {
            padding: 12px 15px;
            background: #f5f5f5;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            min-width: 120px;
            text-align: center;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .url-input-field {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .url-example {
            font-size: 0.75rem;
            color: var(--text-muted);
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid var(--accent-blue);
        }

        /* GitHub Detection Section */
        .github-detection-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid var(--border-color);
        }

        .detection-result {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 8px;
            border-left: 4px solid var(--success);
            animation: fadeIn 0.5s ease;
        }

        .detection-result.error {
            background: #ffebee;
            border-left: 4px solid var(--danger);
        }

        .detection-result.warning {
            background: #fff8e1;
            border-left: 4px solid var(--warning);
        }

        .detection-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .detection-url {
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--primary);
            word-break: break-all;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
/* ===== GITHUB DETECTION UI ===== */
.github-detection-section {
    margin-top: 20px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 12px;
    border: 2px solid var(--border-color);
}

.detection-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
}

.detection-header h4 {
    margin: 0;
    color: var(--primary);
    font-size: 1rem;
}

.detection-result {
    display: none;
    margin-top: 15px;
    padding: 15px;
    border-radius: 10px;
    animation: fadeIn 0.3s ease;
}

.detection-result.success {
    background: #e8f5e9;
    border-left: 4px solid var(--success);
    border: 1px solid rgba(76, 175, 80, 0.2);
}

.detection-result.warning {
    background: #fff8e1;
    border-left: 4px solid var(--warning);
    border: 1px solid rgba(255, 193, 7, 0.2);
}

.detection-result.error {
    background: #ffebee;
    border-left: 4px solid var(--danger);
    border: 1px solid rgba(244, 67, 54, 0.2);
}

.detection-result.info {
    background: #e3f2fd;
    border-left: 4px solid var(--info);
    border: 1px solid rgba(33, 150, 243, 0.2);
}

.detection-message {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    font-weight: 500;
}

.detection-message i {
    font-size: 1.2rem;
}

.detection-urls {
    display: none;
    margin-top: 15px;
    max-height: 200px;
    overflow-y: auto;
    padding-right: 10px;
}

.detection-url-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: white;
    border-radius: 8px;
    margin-bottom: 8px;
    border: 1px solid var(--border-color);
    cursor: pointer;
    transition: all 0.2s ease;
}

.detection-url-item:hover {
    background: #f5f5f5;
    transform: translateX(3px);
}

.detection-url-item input[type="radio"] {
    width: 18px;
    height: 18px;
    accent-color: var(--primary);
    cursor: pointer;
}

.detection-url-item label {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}

.url-text {
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 0.85rem;
    color: var(--text-primary);
    word-break: break-all;
    flex: 1;
}

.url-score {
    font-size: 0.75rem;
    color: var(--success);
    background: rgba(76, 175, 80, 0.1);
    padding: 3px 8px;
    border-radius: 12px;
    font-weight: 600;
    margin-left: 10px;
}

.detection-stats {
    display: flex;
    gap: 15px;
    margin-top: 15px;
    font-size: 0.85rem;
    flex-wrap: wrap;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 10px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 6px;
}

.stat-value {
    font-weight: 600;
    color: var(--primary);
}

/* Loading state */
.detection-loading {
    display: none;
    align-items: center;
    gap: 10px;
    padding: 15px;
    background: white;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    margin-top: 15px;
}

.detection-loading.active {
    display: flex;
}

.detection-progress {
    flex: 1;
    height: 6px;
    background: #e0e0e0;
    border-radius: 3px;
    overflow: hidden;
}

.detection-progress-bar {
    height: 100%;
    background: var(--primary);
    border-radius: 3px;
    width: 0%;
    transition: width 0.3s ease;
}
        /* ===== URL PREVIEW ===== */
        .url-preview-card {
            background: #f0f7f0;
            border: 2px solid var(--primary-light);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }

        @media (min-width: 768px) {
            .url-preview-card {
                padding: 20px;
            }
        }

        .url-preview-card.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .url-preview-label {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .url-display {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            color: var(--text-primary);
            word-break: break-all;
            margin-bottom: 12px;
            overflow-x: auto;
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .url-display {
                font-size: 0.9rem;
                padding: 15px;
            }
        }

        /* ===== BUTTONS ===== */
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }

        @media (min-width: 576px) {
            .button-group {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 150px;
        }

        @media (min-width: 576px) {
            .btn {
                min-width: 180px;
            }
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(26, 95, 35, 0.2);
        }

        .btn-secondary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-secondary:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #388E3C;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: rgba(26, 95, 35, 0.1);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #f57c00;
        }

        .copy-url-btn {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            width: 100%;
            justify-content: center;
        }

        @media (min-width: 576px) {
            .copy-url-btn {
                width: auto;
            }
        }

        .copy-url-btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        /* ===== QR PREVIEW SECTION ===== */
        .qr-preview-section {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(26, 95, 35, 0.05) 0%, rgba(46, 125, 50, 0.03) 100%);
            border-radius: 12px;
            border: 2px solid rgba(26, 95, 35, 0.1);
            display: none;
        }

        @media (min-width: 768px) {
            .qr-preview-section {
                padding: 25px;
            }
        }

        .qr-preview-section.active {
            display: block;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .qr-preview-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        @media (min-width: 768px) {
            .qr-preview-grid {
                grid-template-columns: 250px 1fr;
                gap: 25px;
            }
        }

        .qr-container {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid var(--border-color);
        }

        #qrcodePreview {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            min-height: 200px;
            align-items: center;
        }

        @media (min-width: 768px) {
            #qrcodePreview {
                min-height: 250px;
            }
        }

        .qr-info {
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid var(--border-color);
        }

        @media (min-width: 768px) {
            .qr-info {
                padding: 25px;
            }
        }

        .qr-info h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .qr-info-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .qr-info-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .qr-info-value {
            color: var(--text-secondary);
            word-break: break-all;
            font-size: 0.85rem;
        }

        @media (min-width: 768px) {
            .qr-info-value {
                font-size: 0.9rem;
            }
        }

        /* ===== LINKS TABLE (RESPONSIVE) ===== */
        .links-table-section {
            margin-top: 30px;
        }

        .table-responsive {
            overflow-x: auto;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            margin-top: 15px;
            -webkit-overflow-scrolling: touch;
        }

        .links-table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            background: white;
        }

        .links-table th {
            background: var(--primary);
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .links-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            vertical-align: middle;
        }

        .links-table tr:hover {
            background: #f9f9f9;
        }

        .link-status {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-active {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-inactive {
            background: #ffebee;
            color: #f44336;
        }

        .table-actions {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .table-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .table-btn.edit {
            background: var(--warning);
            color: white;
        }

        .table-btn.delete {
            background: var(--danger);
            color: white;
        }

        .table-btn.view {
            background: var(--accent-blue);
            color: white;
        }

        .table-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 15px;
            left: 15px;
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-dark);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            max-width: 400px;
            margin: 0 auto;
        }

        @media (min-width: 576px) {
            .toast {
                left: auto;
                right: 20px;
                margin: 0;
            }
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.info {
            background: var(--info);
        }

        .toast.warning {
            background: var(--warning);
        }

        /* ===== CURRENT DATE ===== */
        .current-date {
            font-size: 0.85rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .current-date {
                justify-content: flex-end;
            }
        }

        /* ===== LOADING SPINNER ===== */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #e0e0e0;
        }

        .empty-state p {
            margin-bottom: 10px;
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <!-- ADMIN HEADER RESPONSIVE -->
    <div class="admin-header">
        <div class="admin-info">
            <div class="admin-avatar">
                <i class="fas fa-user-shield"></i>
            </div>
            <div class="admin-details">
                <h2 id="adminName">Administrator System</h2>
                <p id="adminEmail">Loading...</p>
                <p style="font-size: 0.75rem; color: var(--primary);">
                    <i class="fas fa-shield-alt"></i> Admin QR Code Manager
                </p>
            </div>
        </div>
        <div class="admin-nav">
            <a href="dashboard-admin.html" class="nav-btn dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="logout.html" class="nav-btn" style="background: var(--danger);">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </div>

    <div class="container">
        <!-- PAGE HEADER -->
        <div class="page-header">
            <h1>
                <i class="fas fa-qrcode"></i>
                Input Link QR Code Hybrid
                <span style="font-size: 0.85rem; background: white; color: var(--primary); padding: 6px 15px; border-radius: 20px;">
                    <i class="fas fa-lock"></i> Admin
                </span>
            </h1>
            <p>
                Kelola link yang akan muncul di QR Code Hybrid Tabungan Digital
            </p>
        </div>

        <!-- STATS CARDS (Seperti Administrator System) -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-link"></i>
                </div>
                <div class="stat-value" id="totalLinks">0</div>
                <div class="stat-label">Total Link</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(33, 150, 243, 0.1); color: var(--accent-blue);">
                    <i class="fas fa-qrcode"></i>
                </div>
                <div class="stat-value" id="activeQRs">0</div>
                <div class="stat-label">QR Code Aktif</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(255, 152, 0, 0.1); color: var(--warning);">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-value" id="featuredLinks">0</div>
                <div class="stat-label">Link Unggulan</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(76, 175, 80, 0.1); color: var(--success);">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="stat-value" id="firebaseLinks">0</div>
                <div class="stat-label">Firebase</div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="admin-main">
            <div class="content-header">
                <h2>
                    <i class="fas fa-plus-circle"></i>
                    Tambah Link Baru
                    <span class="admin-badge">Admin Only</span>
                </h2>
                <div class="current-date">
                    <i class="fas fa-calendar"></i>
                    <span id="currentDate"></span>
                </div>
            </div>

            <!-- FORM INPUT -->
            <div class="form-section">
                <form id="linkForm">
                    <div class="form-grid">
                        <!-- Kolom 1 -->
                        <div>
                            <div class="form-group">
                                <label class="form-label" for="linkTitle">
                                    <i class="fas fa-heading"></i>
                                    Judul Link *
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="linkTitle" 
                                       placeholder="Contoh: Profil Anggota El Di, Promo Spesial"
                                       maxlength="60"
                                       required>
                                <div class="form-hint">
                                    <i class="fas fa-info-circle"></i>
                                    Nama yang akan muncul di Tabungan Digital
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="linkType">
                                    <i class="fas fa-globe"></i>
                                    Tipe Link *
                                </label>
                                <select class="form-control" id="linkType" required>
                                    <option value="">Pilih Tipe Link</option>
                                    <option value="external" selected>üåê Website Eksternal</option>
                                    <option value="github">üíª GitHub Pages</option>
                                    <option value="whatsapp">üì± WhatsApp</option>
                                    <option value="youtube">üì∫ YouTube</option>
                                    <option value="pdf">üìÑ PDF/Dokumen</option>
                                    <option value="other">üîó Lainnya</option>
                                </select>
                                <div class="form-hint">
                                    Pilih tipe link untuk format URL yang sesuai
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="linkCategory">
                                    <i class="fas fa-tags"></i>
                                    Kategori *
                                </label>
                                <select class="form-control" id="linkCategory" required>
                                    <option value="">Pilih Kategori</option>
                                    <option value="anggota">üë§ Profil Anggota</option>
                                    <option value="promotion">üéØ Promo & Penawaran</option>
                                    <option value="information">‚ÑπÔ∏è Informasi Koperasi</option>
                                    <option value="document">üìÑ Dokumen</option>
                                    <option value="social">üì± Media Sosial</option>
                                    <option value="service">üîß Layanan</option>
                                </select>
                            </div>
                        </div>

                        <!-- Kolom 2 -->
                        <div>
                            <!-- ===== URL INPUT - PERBAIKAN UTAMA ===== -->
                            <div class="form-group url-input-wrapper">
                                <label class="form-label">
                                    <i class="fas fa-link"></i>
                                    URL Target *
                                </label>
                                
                                <!-- URL Input Dinamis -->
                                <div id="urlInputContainer">
                                    <!-- Default: External URL -->
                                    <div class="url-input-group" id="externalUrlGroup">
                                        <div class="url-prefix">
                                            <i class="fas fa-external-link-alt"></i>
                                        </div>
                                        <div class="url-input-field">
                                            <input type="url" 
                                                   class="form-control" 
                                                   id="targetUrl"
                                                   placeholder="https://contoh.com/path"
                                                   required>
                                            <div class="url-example">
                                                Contoh: https://koperasi-asmara-tani.com/profil-anggota
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- GitHub Detection Section -->
                            
<div id="githubDetectionSection" class="github-detection-section" style="display: none;">
    <div class="detection-header">
        <h4><i class="fab fa-github"></i> Deteksi Otomatis GitHub Pages</h4>
        <span class="admin-badge" style="background: var(--accent-purple);">AI Detection</span>
    </div>
    
    <div class="form-group">
        <label class="form-label">
            <i class="fas fa-code-branch"></i>
            URL Repository GitHub
        </label>
        <input type="url" 
               class="form-control" 
               id="githubRepoUrl"
               placeholder="https://github.com/username/repository/blob/main/file.html"
               value="https://github.com/Kangeldzi/Koperasi-Asmara-Tani-/blob/main/eldi-sugianto.html">
        <div class="form-hint">
            <i class="fas fa-lightbulb"></i>
            Tempel URL lengkap dari repository GitHub Anda
        </div>
    </div>
    
    <div class="form-group">
        <button type="button" 
                class="btn btn-warning"
                id="autoDetectBtn"
                style="width: 100%;">
            <i class="fas fa-satellite-dish"></i> Auto-Deteksi GitHub Pages
        </button>
    </div>
    
    <!-- Loading Indicator -->
    <div id="detectionLoading" class="detection-loading">
        <i class="fas fa-spinner fa-spin"></i>
        <div style="flex: 1;">
            <div style="font-size: 0.9rem; font-weight: 500; margin-bottom: 5px;">
                Mendeteksi struktur GitHub Pages...
            </div>
            <div class="detection-progress">
                <div class="detection-progress-bar" id="detectionProgressBar"></div>
            </div>
        </div>
    </div>
    
    <!-- Hasil Deteksi -->
    <div id="detectionResult" class="detection-result">
        <div class="detection-message" id="detectionMessage">
            <i class="fas fa-info-circle"></i>
            <span id="detectionMessageText">Hasil deteksi akan muncul di sini...</span>
        </div>
        
        <!-- Daftar URL yang ditemukan -->
        <div id="detectionUrls" class="detection-urls">
            <!-- URL list akan diisi oleh JavaScript -->
        </div>
        
        <div class="detection-stats">
            <div class="stat-item">
                <i class="fas fa-clock"></i>
                <span>Status: <span class="stat-value" id="detectionStatus">Menunggu</span></span>
            </div>
            <div class="stat-item">
                <i class="fas fa-link"></i>
                <span>URL Valid: <span class="stat-value" id="detectionCount">0</span></span>
            </div>
            <div class="stat-item">
                <i class="fas fa-bolt"></i>
                <span>Waktu: <span class="stat-value" id="detectionTime">0s</span></span>
            </div>
        </div>
        
        <button type="button" 
                class="btn btn-success"
                id="useDetectedUrlBtn"
                style="margin-top: 15px; width: 100%;">
            <i class="fas fa-check"></i> Gunakan URL Terpilih
           </button>
        </div>
      </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="linkDescription">
                                    <i class="fas fa-align-left"></i>
                                    Deskripsi Link
                                </label>
                                <textarea class="form-control" 
                                          id="linkDescription" 
                                          rows="2"
                                          placeholder="Jelaskan tujuan link ini..."
                                          maxlength="150"></textarea>
                                <div class="form-hint">
                                    Deskripsi singkat untuk membantu anggota
                                </div>
                            </div>

                            <div class="form-checkbox">
                                <input type="checkbox" id="isFeatured">
                                <label for="isFeatured">
                                    <i class="fas fa-star" style="color: var(--warning);"></i>
                                    Tandai sebagai Link Unggulan
                                </label>
                            </div>

                            <div class="form-checkbox">
                                <input type="checkbox" id="isActive" checked>
                                <label for="isActive">
                                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                                    Aktifkan link ini
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- URL PREVIEW -->
                    <div id="urlPreviewCard" class="url-preview-card">
                        <div class="url-preview-label">
                            <i class="fas fa-external-link-alt"></i>
                            URL QR Code Hybrid:
                        </div>
                        <div id="generatedUrl" class="url-display">
                            URL akan muncul di sini...
                        </div>
                        <button type="button" class="copy-url-btn" id="copyUrlBtn">
                            <i class="fas fa-copy"></i>
                            Salin URL
                        </button>
                    </div>

                    <!-- BUTTONS -->
                    <div class="button-group">
                        <button type="button" class="btn btn-outline" id="previewBtn">
                            <i class="fas fa-eye"></i>
                            Preview QR
                        </button>
                        <button type="submit" class="btn btn-primary" id="saveBtn">
                            <i class="fas fa-save"></i>
                            Simpan & Generate
                        </button>
                        <button type="button" class="btn btn-danger" id="resetBtn">
                            <i class="fas fa-redo"></i>
                            Reset Form
                        </button>
                    </div>
                </form>
            </div>

            <!-- QR PREVIEW SECTION -->
            <div class="qr-preview-section" id="qrPreviewSection">
                <h3 style="color: var(--primary); margin-bottom: 15px; font-size: 1.2rem;">
                    <i class="fas fa-qrcode"></i>
                    Preview QR Code Hybrid
                </h3>
                
                <div class="qr-preview-grid">
                    <div class="qr-container">
                        <div id="qrcodePreview">
                            <div style="text-align: center; color: var(--text-muted); padding: 20px;">
                                <i class="fas fa-spinner fa-spin fa-2x"></i>
                                <p style="margin-top: 15px; font-size: 0.9rem;">Membuat QR Code...</p>
                            </div>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 10px;">
                            <i class="fas fa-info-circle"></i>
                            QR Code ini akan otomatis muncul di Tabungan Digital
                        </p>
                    </div>
                    
                    <div class="qr-info">
                        <h4>
                            <i class="fas fa-info-circle"></i>
                            Informasi Link
                        </h4>
                        <div class="qr-info-item">
                            <div class="qr-info-label">
                                <i class="fas fa-heading"></i>
                                Judul:
                            </div>
                            <div class="qr-info-value" id="previewTitle">-</div>
                        </div>
                        <div class="qr-info-item">
                            <div class="qr-info-label">
                                <i class="fas fa-link"></i>
                                URL Tujuan:
                            </div>
                            <div class="qr-info-value" id="previewUrl">-</div>
                        </div>
                        <div class="qr-info-item">
                            <div class="qr-info-label">
                                <i class="fas fa-qrcode"></i>
                                QR Code URL:
                            </div>
                            <div class="qr-info-value" id="previewQrUrl">-</div>
                        </div>
                        <div class="qr-info-item">
                            <div class="qr-info-label">
                                <i class="fas fa-calendar"></i>
                                Waktu:
                            </div>
                            <div class="qr-info-value" id="previewTime">-</div>
                        </div>
                    </div>
                </div>

                <div class="button-group" style="margin-top: 25px;">
                    <button type="button" class="btn btn-outline" id="editPreviewBtn">
                        <i class="fas fa-edit"></i>
                        Edit Kembali
                    </button>
                    <button type="button" class="btn btn-secondary" id="testLinkBtn">
                        <i class="fas fa-external-link-alt"></i>
                        Test Link
                    </button>
                    <button type="button" class="btn btn-success" id="saveToFirebaseBtn">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Simpan ke Firebase
                    </button>
                </div>
            </div>

            <!-- LINKS TABLE -->
            <div class="links-table-section">
                <h3 style="color: var(--primary); margin-bottom: 15px; font-size: 1.2rem;">
                    <i class="fas fa-list"></i>
                    Daftar Link Tersimpan
                </h3>
                
                <div class="table-responsive">
                    <table class="links-table">
                        <thead>
                            <tr>
                                <th>Judul</th>
                                <th>Tipe</th>
                                <th>URL Target</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="linksTableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 30px; color: var(--text-muted);">
                                    <i class="fas fa-database" style="font-size: 2rem; margin-bottom: 10px; display: block; opacity: 0.5;"></i>
                                    Belum ada link yang tersimpan
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div class="toast" id="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toastMessage">Pesan notifikasi</span>
    </div>

    <script>
        // ===== GITHUB PAGES DETECTOR =====
        
class GitHubPagesDetector {
    constructor() {
        this.cache = {};
        this.testUrls = [];
        this.detectionResults = {};
        this.startTime = null;
    }

    /**
     * Deteksi struktur GitHub Pages dari URL repository
     */
    async detectGitHubPages(githubRepoUrl) {
        console.log('üîç [GitHubPagesDetector] Memulai deteksi untuk:', githubRepoUrl);
        this.startTime = Date.now();
        
        // Cache check
        if (this.cache[githubRepoUrl]) {
            console.log('‚úÖ Menggunakan hasil cache');
            return this.cache[githubRepoUrl];
        }
        
        // Parse repository info
        const repoInfo = this.parseGitHubRepoUrl(githubRepoUrl);
        if (!repoInfo) {
            console.log('‚ùå URL repository tidak valid');
            return null;
        }
        
        console.log('üì¶ Informasi repository:', repoInfo);
        
        // Generate kemungkinan URL GitHub Pages
        this.testUrls = this.generatePossibleUrls(repoInfo);
        console.log('üîç URL yang akan di-test:', this.testUrls);
        
        // Update progress UI
        this.updateProgressUI(0, this.testUrls.length);
        
        // Test semua URL
        const validUrls = await this.testAllUrls();
        
        // Update stats
        const detectionTime = ((Date.now() - this.startTime) / 1000).toFixed(1);
        document.getElementById('detectionTime').textContent = `${detectionTime}s`;
        document.getElementById('detectionCount').textContent = validUrls.length;
        
        if (validUrls.length > 0) {
            // Pilih URL terbaik
            const bestUrl = this.selectBestUrl(validUrls);
            console.log('‚úÖ URL terpilih:', bestUrl);
            
            // Simpan ke cache
            this.cache[githubRepoUrl] = {
                url: bestUrl,
                status: 'found',
                alternatives: validUrls,
                repoInfo: repoInfo,
                detectionTime: detectionTime
            };
            
            return this.cache[githubRepoUrl];
        } else {
            console.log('‚ùå Tidak ada URL GitHub Pages yang valid');
            
            // Buat URL default berdasarkan konvensi GitHub Pages
            const defaultUrl = this.createDefaultUrl(repoInfo);
            console.log('‚ö†Ô∏è Menggunakan URL default:', defaultUrl);
            
            this.cache[githubRepoUrl] = {
                url: defaultUrl,
                status: 'default',
                alternatives: [],
                repoInfo: repoInfo,
                detectionTime: detectionTime,
                warning: 'GitHub Pages mungkin belum diaktifkan'
            };
            
            return this.cache[githubRepoUrl];
        }
    }

    /**
     * Parse URL repository GitHub
     */
    parseGitHubRepoUrl(url) {
        const cleanUrl = url.trim();
        
        // Pattern untuk berbagai format GitHub URL
        const patterns = [
            /github\.com\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)/,
            /github\.com\/([^\/]+)\/([^\/]+)\/tree\/([^\/]+)\/(.+)/,
            /github\.com\/([^\/]+)\/([^\/]+)\/(.+)/,
            /github\.com\/([^\/]+)\/([^\/]+)/
        ];
        
        for (const pattern of patterns) {
            const match = cleanUrl.match(pattern);
            if (match) {
                const username = match[1];
                let repository = match[2];
                let branch = match[3] || 'main';
                let path = match[4] || '';
                
                // Normalisasi nama repository
                if (repository.endsWith('-')) {
                    repository = repository.slice(0, -1);
                }
                
                // Jika ada path, ekstrak nama file
                let filename = '';
                if (path) {
                    const pathParts = path.split('/');
                    filename = pathParts[pathParts.length - 1];
                    
                    // Hapus nama file dari path
                    pathParts.pop();
                    path = pathParts.join('/');
                }
                
                return {
                    username,
                    repository,
                    branch,
                    path,
                    filename,
                    originalUrl: cleanUrl
                };
            }
        }
        
        return null;
    }

    /**
     * Generate semua kemungkinan URL GitHub Pages
     */
    generatePossibleUrls(repoInfo) {
        const urls = [];
        const { username, repository, path, filename } = repoInfo;
        
        // Base URL GitHub Pages
        const baseUrl = `https://${username}.github.io/${repository}`;
        
        // 1. File spesifik dari URL
        if (filename) {
            urls.push(`${baseUrl}/${filename}`);
            if (path) urls.push(`${baseUrl}/${path}/${filename}`);
            if (filename !== 'index.html') {
                const folderPath = path ? `${path}/${filename.replace('.html', '')}` : filename.replace('.html', '');
                urls.push(`${baseUrl}/${folderPath}/index.html`);
            }
        }
        
        // 2. index.html di berbagai lokasi
        urls.push(`${baseUrl}/index.html`);
        urls.push(`${baseUrl}/main/index.html`);
        urls.push(`${baseUrl}/master/index.html`);
        if (path) urls.push(`${baseUrl}/${path}/index.html`);
        
        // 3. Nama file umum
        const commonFiles = ['index.html', 'home.html', 'main.html', 'default.html', 
                           'eldi-sugianto.html', 'profile.html', 'anggota.html'];
        
        commonFiles.forEach(file => {
            urls.push(`${baseUrl}/${file}`);
            if (path) urls.push(`${baseUrl}/${path}/${file}`);
        });
        
        // 4. URL tanpa file (akses folder)
        urls.push(baseUrl);
        if (path) urls.push(`${baseUrl}/${path}`);
        
        // Hapus duplikat
        return [...new Set(urls.filter(url => url && url.includes('.github.io')))];
    }

    /**
     * Test semua URL
     */
    async testAllUrls() {
        const validUrls = [];
        const totalUrls = this.testUrls.length;
        
        for (let i = 0; i < totalUrls; i++) {
            const url = this.testUrls[i];
            
            // Update progress
            this.updateProgressUI(i + 1, totalUrls);
            console.log(`üîç Testing (${i + 1}/${totalUrls}): ${url}`);
            
            try {
                const isAccessible = await this.testUrl(url);
                
                if (isAccessible) {
                    console.log(`‚úÖ Accessible: ${url}`);
                    validUrls.push({
                        url,
                        score: this.calculateUrlScore(url),
                        responseTime: isAccessible.responseTime || 0
                    });
                }
            } catch (error) {
                console.log(`‚ö†Ô∏è Error testing ${url}:`, error.message);
            }
            
            // Delay untuk hindari rate limiting
            await new Promise(resolve => setTimeout(resolve, 50));
        }
        
        // Urutkan berdasarkan score tertinggi
        return validUrls.sort((a, b) => b.score - a.score);
    }

    /**
     * Test akses URL
     */
    async testUrl(url) {
        return new Promise((resolve) => {
            const startTime = Date.now();
            
            fetch(url, {
                method: 'HEAD',
                mode: 'no-cors',
                cache: 'no-cache',
                headers: {
                    'Accept': 'text/html',
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                }
            })
            .then(() => {
                resolve({
                    accessible: true,
                    responseTime: Date.now() - startTime,
                    method: 'HEAD'
                });
            })
            .catch(() => {
                // Fallback: Coba dengan Image
                const img = new Image();
                img.onload = () => {
                    resolve({
                        accessible: true,
                        responseTime: Date.now() - startTime,
                        method: 'Image'
                    });
                };
                img.onerror = () => resolve(false);
                img.src = url + '?t=' + Date.now();
                
                setTimeout(() => resolve(false), 2000);
            });
        });
    }

    /**
     * Hitung score untuk URL
     */
    calculateUrlScore(url) {
        let score = 0;
        
        // Prioritas tinggi: index.html di root atau tanpa file
        if (url.endsWith('/index.html') || url.endsWith('.github.io/') || !url.includes('.html')) {
            score += 10;
        }
        
        // Prioritas: mengandung 'index'
        if (url.includes('index')) {
            score += 5;
        }
        
        // Prioritas: nama file spesifik (eldi-sugianto.html)
        if (url.includes('eldi-sugianto')) {
            score += 8;
        }
        
        // Prioritas: URL pendek lebih baik
        const pathLength = new URL(url).pathname.length;
        score += Math.max(0, 20 - pathLength);
        
        return score;
    }

    /**
     * Pilih URL terbaik
     */
    selectBestUrl(validUrls) {
        if (validUrls.length === 0) return null;
        return validUrls[0].url;
    }

    /**
     * Buat URL default
     */
    createDefaultUrl(repoInfo) {
        const { username, repository, filename } = repoInfo;
        if (filename) {
            return `https://${username}.github.io/${repository}/${filename}`;
        } else {
            return `https://${username}.github.io/${repository}/`;
        }
    }

    /**
     * Update progress UI
     */
    updateProgressUI(current, total) {
        const progressBar = document.getElementById('detectionProgressBar');
        if (progressBar) {
            const percentage = (current / total) * 100;
            progressBar.style.width = `${percentage}%`;
        }
    }

    /**
     * Setup UI untuk deteksi
     */
    setupDetectionUI() {
        console.log('üîß Setup GitHub Pages Detection UI');
        
        // Setup tombol deteksi
        const detectBtn = document.getElementById('autoDetectBtn');
        if (detectBtn) {
            detectBtn.addEventListener('click', async () => {
                await this.runDetection();
            });
        }
        
        // Setup tombol gunakan URL
        const useUrlBtn = document.getElementById('useDetectedUrlBtn');
        if (useUrlBtn) {
            useUrlBtn.addEventListener('click', () => {
                this.applyDetectedUrl();
            });
        }
    }

    /**
     * Update detection UI
     */
    updateDetectionUI(status, message, urls = []) {
        const resultDiv = document.getElementById('detectionResult');
        const messageText = document.getElementById('detectionMessageText');
        const statusEl = document.getElementById('detectionStatus');
        const urlsDiv = document.getElementById('detectionUrls');
        const loadingDiv = document.getElementById('detectionLoading');
        
        if (!resultDiv || !messageText) return;
        
        // Hide loading
        if (loadingDiv) loadingDiv.classList.remove('active');
        
        // Show result
        resultDiv.style.display = 'block';
        resultDiv.className = 'detection-result';
        
        // Set status text
        statusEl.textContent = this.getStatusText(status);
        
        // Set message and styling
        switch (status) {
            case 'success':
                resultDiv.classList.add('success');
                messageText.innerHTML = `<strong>${message}</strong>`;
                break;
            case 'warning':
                resultDiv.classList.add('warning');
                messageText.innerHTML = `<strong>${message}</strong>`;
                break;
            case 'error':
                resultDiv.classList.add('error');
                messageText.innerHTML = `<strong>${message}</strong>`;
                break;
            default:
                messageText.innerHTML = message;
        }
        
        // Tampilkan daftar URL jika ada
        if (urlsDiv && urls.length > 0) {
            urlsDiv.innerHTML = urls.map((url, index) => `
                <div class="detection-url-item">
                    <input type="radio" name="selectedUrl" value="${url.url}" 
                           id="url_${index}" ${index === 0 ? 'checked' : ''}>
                    <label for="url_${index}">
                        <span class="url-text">${url.url}</span>
                        <span class="url-score">Score: ${url.score}</span>
                    </label>
                </div>
            `).join('');
            urlsDiv.style.display = 'block';
        } else {
            urlsDiv.style.display = 'none';
        }
    }

    /**
     * Get status text
     */
    getStatusText(status) {
        const statusMap = {
            'success': 'Berhasil',
            'warning': 'Peringatan',
            'error': 'Error',
            'info': 'Informasi'
        };
        return statusMap[status] || 'Unknown';
    }

    /**
     * Jalankan proses deteksi
     */
    async runDetection() {
        const githubRepoUrl = document.getElementById('githubRepoUrl').value.trim();
        
        if (!githubRepoUrl || !githubRepoUrl.includes('github.com')) {
            this.updateDetectionUI('error', 'Masukkan URL repository GitHub yang valid');
            return;
        }
        
        // Tampilkan loading
        const btn = document.getElementById('autoDetectBtn');
        const loadingDiv = document.getElementById('detectionLoading');
        const originalText = btn.innerHTML;
        
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mendeteksi...';
        btn.disabled = true;
        
        if (loadingDiv) loadingDiv.classList.add('active');
        
        // Reset UI
        this.updateDetectionUI('info', 'Memulai deteksi struktur GitHub Pages...');
        document.getElementById('detectionCount').textContent = '0';
        document.getElementById('detectionTime').textContent = '0s';
        
        try {
            const result = await this.detectGitHubPages(githubRepoUrl);
            
            if (result && result.url) {
                if (result.status === 'found') {
                    this.updateDetectionUI(
                        'success',
                        `üéâ Ditemukan ${result.alternatives.length} URL GitHub Pages yang valid!`,
                        result.alternatives
                    );
                    
                    // Auto-apply URL terbaik
                    document.getElementById('targetUrl').value = result.url;
                    
                    // Update preview
                    if (window.adminSystem) {
                        window.adminSystem.updateUrlPreview();
                    }
                    
                } else if (result.status === 'default') {
                    this.updateDetectionUI(
                        'warning',
                        '‚ö†Ô∏è GitHub Pages mungkin belum aktif. Menggunakan URL default.',
                        []
                    );
                    
                    document.getElementById('targetUrl').value = result.url;
                    
                    if (window.adminSystem) {
                        window.adminSystem.updateUrlPreview();
                    }
                }
            } else {
                this.updateDetectionUI('error', '‚ùå Tidak dapat mendeteksi GitHub Pages');
            }
        } catch (error) {
            console.error('‚ùå Detection error:', error);
            this.updateDetectionUI('error', `‚ùå Error: ${error.message}`);
        } finally {
            // Restore button
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }

    /**
     * Terapkan URL yang terdeteksi
     */
    applyDetectedUrl() {
        const selectedUrl = document.querySelector('input[name="selectedUrl"]:checked');
        
        if (selectedUrl) {
            const url = selectedUrl.value;
            document.getElementById('targetUrl').value = url;
            
            if (window.adminSystem) {
                window.adminSystem.updateUrlPreview();
            }
            
            this.updateDetectionUI('success', '‚úÖ URL berhasil diterapkan!');
        } else {
            this.updateDetectionUI('warning', '‚ö†Ô∏è Pilih URL terlebih dahulu');
        }
    }
}

        // ===== ADMIN QR CODE HYBRID SYSTEM - FIXED VERSION =====
        class AdminQRCodeSystem {
            constructor() {
                this.adminData = this.getAdminData();
                this.links = this.loadLinks();
                this.editingLinkId = null;
                this.currentQRUrl = '';
                this.qrCodeInstance = null;
                this.vercelBaseUrl = 'https://qr-code-hybrid.vercel.app/';
                this.githubPagesDetector = new GitHubPagesDetector();
    
                this.init();
             }

            init() {
                this.setupAdminUI();
                this.setupEventListeners();
                this.renderLinksTable();
                this.updateDate();
                this.updateStats();
                
                console.log('‚úÖ Admin QR Code System initialized');
                this.showToast('Sistem Admin QR Code Hybrid siap!', 'info');
            }

            setupAdminUI() {
                // Set admin name and email
                document.getElementById('adminName').textContent = 
                    this.adminData.name || 'Administrator';
                document.getElementById('adminEmail').textContent = 
                    this.adminData.email || 'admin@koperasi.com';
                
                // Setup link type switcher
                document.getElementById('linkType').addEventListener('change', (e) => {
                    this.handleLinkTypeChange(e.target.value);
                });
                
                // Set default URL input
                this.setupDefaultUrlInput();
            }

            setupDefaultUrlInput() {
                // Default input untuk external URL
                const container = document.getElementById('urlInputContainer');
                container.innerHTML = this.getUrlInputTemplate('external');
            }

            getUrlInputTemplate(type) {
                if (type === 'github') {
                    return `
                        <div class="url-input-group" id="githubUrlGroup">
                            <div class="url-prefix">
                                <i class="fab fa-github"></i>
                            </div>
                            <div class="url-input-field">
                                <input type="url" 
                                       class="form-control" 
                                       id="targetUrl"
                                       placeholder="https://username.github.io/repository/file.html"
                                       required>
                                <div class="url-example">
                                    Contoh: https://kangeldzi.github.io/operasi-asmara-tani/eldi-sugianto.html
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                const templates = {
                    'external': `
                        <div class="url-input-group" id="externalUrlGroup">
                            <div class="url-prefix">
                                <i class="fas fa-external-link-alt"></i>
                            </div>
                            <div class="url-input-field">
                                <input type="url" 
                                       class="form-control" 
                                       id="targetUrl"
                                       placeholder="https://contoh.com/path"
                                       required>
                                <div class="url-example">
                                    Contoh: https://koperasi-asmara-tani.com/profil-anggota
                                </div>
                            </div>
                        </div>
                    `,
                    'whatsapp': `
                        <div class="url-input-group" id="whatsappUrlGroup">
                            <div class="url-prefix">
                                https://wa.me/
                            </div>
                            <div class="url-input-field">
                                <input type="text" 
                                       class="form-control" 
                                       id="targetUrl"
                                       placeholder="6285218483129"
                                       pattern="[0-9]*"
                                       required>
                                <div class="url-example">
                                    Contoh: 6285218483129 (tanpa + atau spasi)
                                </div>
                            </div>
                        </div>
                    `,
                    'youtube': `
                        <div class="url-input-group" id="youtubeUrlGroup">
                            <div class="url-prefix">
                                https://youtu.be/
                            </div>
                            <div class="url-input-field">
                                <input type="text" 
                                       class="form-control" 
                                       id="targetUrl"
                                       placeholder="dQw4w9WgXcQ"
                                       required>
                                <div class="url-example">
                                    Contoh: dQw4w9WgXcQ (ID video YouTube)
                                </div>
                            </div>
                        </div>
                    `,
                    'pdf': `
                        <div class="url-input-group" id="pdfUrlGroup">
                            <div class="url-prefix">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="url-input-field">
                                <input type="url" 
                                       class="form-control" 
                                       id="targetUrl"
                                       placeholder="https://contoh.com/dokumen.pdf"
                                       required>
                                <div class="url-example">
                                    Contoh: https://koperasi-asmara-tani.com/dokumen/anggaran-dasar.pdf
                                </div>
                            </div>
                        </div>
                    `,
                    'other': `
                        <div class="url-input-group" id="otherUrlGroup">
                            <div class="url-prefix">
                                <i class="fas fa-link"></i>
                            </div>
                            <div class="url-input-field">
                                <input type="url" 
                                       class="form-control" 
                                       id="targetUrl"
                                       placeholder="https://contoh.com"
                                       required>
                                <div class="url-example">
                                    Masukkan URL lengkap dengan http:// atau https://
                                </div>
                            </div>
                        </div>
                    `
                };

                return templates[type] || templates['external'];
            }

            handleLinkTypeChange(type) {
    const container = document.getElementById('urlInputContainer');
    const githubSection = document.getElementById('githubDetectionSection');
    
    if (type === 'github') {
        // Tampilkan input GitHub dengan fitur deteksi
        container.innerHTML = this.getUrlInputTemplate(type);
        githubSection.style.display = 'block';
        
        // Setup detector UI
        setTimeout(() => {
            if (window.githubPagesDetector) {
                window.githubPagesDetector.setupDetectionUI();
            }
        }, 100);
        
        // Auto-fill contoh URL
        document.getElementById('githubRepoUrl').value = 
            'https://github.com/Kangeldzi/Koperasi-Asmara-Tani-/blob/main/eldi-sugianto.html';
    } else {
        container.innerHTML = this.getUrlInputTemplate(type);
        githubSection.style.display = 'none';
    }
    
    this.updateUrlPreview();
}

            getAdminData() {
                try {
                    const admin = localStorage.getItem('koperasi_admin') || 
                                 localStorage.getItem('koperasi_current_user');
                    
                    if (admin) {
                        const data = JSON.parse(admin);
                        return {
                            name: data.name || 'Admin Koperasi',
                            email: data.email || 'admin@koperasi.com',
                            role: 'admin'
                        };
                    }
                    
                    return {
                        name: 'Administrator',
                        email: 'admin@koperasi.com',
                        role: 'admin'
                    };
                    
                } catch (error) {
                    return {
                        name: 'Admin Koperasi',
                        email: 'admin@koperasi.com',
                        role: 'admin'
                    };
                }
            }

            setupEventListeners() {
                // Form submission
                document.getElementById('linkForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.previewQRCode();
                });

                // Preview button
                document.getElementById('previewBtn').addEventListener('click', () => {
                    this.previewQRCode();
                });

                // Reset button
                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.resetForm();
                });

                // Edit preview button
                document.getElementById('editPreviewBtn').addEventListener('click', () => {
                    this.showForm();
                });

                // Test link button - UPDATED WITH DEBUG
                document.getElementById('testLinkBtn').addEventListener('click', () => {
                    this.testCurrentLink();
                });

                // Save to Firebase button
                document.getElementById('saveToFirebaseBtn').addEventListener('click', () => {
                    this.saveLinkToFirebase();
                });

                // Copy URL button
                document.getElementById('copyUrlBtn').addEventListener('click', () => {
                    this.copyUrlToClipboard();
                });

                // Listen to URL input changes
                document.addEventListener('input', (e) => {
                    if (e.target.id === 'targetUrl' || e.target.id === 'linkTitle') {
                        this.updateUrlPreview();
                    }
                });
            }

            updateUrlPreview() {
                const urlInput = document.getElementById('targetUrl');
                const titleInput = document.getElementById('linkTitle').value.trim();
                
                if (urlInput && urlInput.value.trim() && titleInput) {
                    const targetUrl = this.formatTargetUrl(urlInput.value.trim());
                    
                    if (targetUrl && this.isValidUrl(targetUrl)) {
                        const qrUrl = this.generateQRHybridUrl(targetUrl);
                        
                        document.getElementById('generatedUrl').textContent = qrUrl;
                        document.getElementById('urlPreviewCard').classList.add('active');
                        this.currentQRUrl = qrUrl;
                        return;
                    }
                }
                
                document.getElementById('urlPreviewCard').classList.remove('active');
                this.currentQRUrl = '';
            }

            formatTargetUrl(inputUrl) {
                const type = document.getElementById('linkType').value;
                
                if (type === 'whatsapp') {
                    // Format WhatsApp URL
                    const number = inputUrl.replace(/\D/g, '');
                    return `https://wa.me/${number}`;
                } else if (type === 'youtube') {
                    // Format YouTube URL
                    const videoId = inputUrl.replace(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/, '$2');
                    return `https://youtu.be/${videoId}`;
                } else {
                    // Untuk tipe lain, return URL as-is
                    return inputUrl;
                }
            }

            // ===== FIXED: PERBAIKAN DOUBLE ENCODING =====
            generateQRHybridUrl(targetUrl) {
                // PERBAIKAN: Tidak perlu encode manual, biarkan URLSearchParams handle encoding
                const title = document.getElementById('linkTitle').value.trim() || 'Link Custom';
                const type = document.getElementById('linkType').value;
                const category = document.getElementById('linkCategory').value;
                
                console.log('üîó Generating QR Code URL:');
                console.log('  Target URL:', targetUrl);
                console.log('  Title:', title);
                console.log('  Type:', type);
                
                const params = new URLSearchParams({
                    // Metadata admin
                    admin_id: this.adminData.email || 'admin',
                    admin_name: this.adminData.name || 'Admin',
                    
                    // Data link - BIARKAN URLSearchParams YANG ENCODE
                    redirect: targetUrl,
                    link_title: title,
                    link_type: type,
                    link_category: category,
                    
                    // Target untuk Tabungan Digital
                    target: 'tabungan_digital',
                    feature: 'admin_generated_link',
                    
                    // Timestamp
                    timestamp: Date.now(),
                    version: 'admin_v2.0_fixed'
                });

                const finalUrl = `${this.vercelBaseUrl}redirect?${params.toString()}`;
                console.log('  Final QR URL:', finalUrl);
                
                // Debug: Periksa encoding
                const testParams = new URLSearchParams(finalUrl.split('?')[1]);
                const redirectParam = testParams.get('redirect');
                console.log('  Redirect param value:', redirectParam);
                console.log('  Decoded redirect:', decodeURIComponent(redirectParam || ''));
                
                return finalUrl;
            }

            // ===== NEW: DECODE FUNCTION FOR DEBUGGING =====
            decodeQRUrl(qrUrl) {
                try {
                    const url = new URL(qrUrl);
                    const params = new URLSearchParams(url.search);
                    const redirect = params.get('redirect');
                    
                    console.log('üîç Decoding QR URL:');
                    console.log('  - Original redirect param:', redirect);
                    
                    // Coba decode
                    let decoded = redirect || '';
                    try {
                        decoded = decodeURIComponent(decoded);
                        console.log('  - Decoded once:', decoded);
                        
                        // Coba decode lagi jika masih ada encoding
                        if (decoded.includes('%')) {
                            const twiceDecoded = decodeURIComponent(decoded);
                            if (twiceDecoded !== decoded) {
                                decoded = twiceDecoded;
                                console.log('  - Decoded twice:', decoded);
                            }
                        }
                    } catch (e) {
                        console.log('  - Cannot decode:', e.message);
                    }
                    
                    console.log('  - Final decoded URL:', decoded);
                    return decoded;
                } catch (error) {
                    console.error('‚ùå Error decoding URL:', error);
                    return '';
                }
            }

            // ===== IMPROVED: TEST LINK WITH DEBUGGING =====
            async testCurrentLink() {
                if (!this.currentQRUrl) {
                    this.showToast('Generate QR Code terlebih dahulu', 'error');
                    return;
                }

                console.log('üß™ Testing QR Code URL:');
                console.log('QR URL:', this.currentQRUrl);
                
                // Debug informasi
                const decodedUrl = this.decodeQRUrl(this.currentQRUrl);
                console.log('Decoded redirect URL:', decodedUrl);
                
                if (decodedUrl) {
                    // Test aksesibilitas URL tujuan
                    const isAccessible = await this.testUrlAccessibility(decodedUrl);
                    
                    if (isAccessible) {
                        console.log('‚úÖ Target URL is accessible');
                        this.showToast('URL tujuan dapat diakses, membuka QR Code...', 'success');
                        
                        // Buka QR Code URL
                        window.open(this.currentQRUrl, '_blank');
                    } else {
                        console.log('‚ùå Target URL is NOT accessible');
                        
                        // Tawarkan pilihan
                        const userChoice = confirm(
                            'URL tujuan tidak dapat diakses langsung.\n' +
                            `Target: ${decodedUrl}\n\n` +
                            'Apakah Anda ingin:\n' +
                            '‚Ä¢ Buka QR Code tetap (OK)\n' +
                            '‚Ä¢ Buka URL tujuan langsung (Cancel)'
                        );
                        
                        if (userChoice) {
                            // Buka QR Code
                            window.open(this.currentQRUrl, '_blank');
                            this.showToast('Membuka QR Code...', 'info');
                        } else {
                            // Buka URL tujuan langsung
                            window.open(decodedUrl, '_blank');
                            this.showToast('Membuka URL tujuan langsung...', 'info');
                        }
                    }
                } else {
                    // Jika tidak bisa decode, buka langsung
                    window.open(this.currentQRUrl, '_blank');
                    this.showToast('Membuka QR Code di tab baru...', 'info');
                }
            }

            async testUrlAccessibility(url) {
                return new Promise((resolve) => {
                    console.log('üîç Testing URL accessibility:', url);
                    
                    // Coba dengan fetch (HEAD request)
                    fetch(url, { 
                        method: 'HEAD',
                        mode: 'no-cors',
                        cache: 'no-cache'
                    })
                    .then(() => {
                        console.log('‚úÖ URL accessible (HEAD request)');
                        resolve(true);
                    })
                    .catch((error) => {
                        console.log('‚ö†Ô∏è HEAD request failed:', error.message);
                        
                        // Coba dengan Image sebagai fallback
                        const img = new Image();
                        img.onload = () => {
                            console.log('‚úÖ URL accessible (Image load)');
                            resolve(true);
                        };
                        img.onerror = () => {
                            console.log('‚ùå URL not accessible');
                            resolve(false);
                        };
                        img.src = url + '?t=' + Date.now();
                        
                        // Timeout
                        setTimeout(() => {
                            console.log('‚è±Ô∏è URL test timeout');
                            resolve(false);
                        }, 3000);
                    });
                });
            }

            async previewQRCode() {
                const title = document.getElementById('linkTitle').value.trim();
                const type = document.getElementById('linkType').value;
                const category = document.getElementById('linkCategory').value;
                const urlInput = document.getElementById('targetUrl');
                
                // Validasi
                if (!title) {
                    this.showToast('Judul link harus diisi', 'error');
                    return;
                }

                if (!type) {
                    this.showToast('Pilih tipe link', 'error');
                    return;
                }

                if (!category) {
                    this.showToast('Pilih kategori link', 'error');
                    return;
                }

                if (!urlInput || !urlInput.value.trim()) {
                    this.showToast('URL target harus diisi', 'error');
                    return;
                }

                // Format dan validasi URL
                const targetUrl = this.formatTargetUrl(urlInput.value.trim());
                
                if (!this.isValidUrl(targetUrl)) {
                    this.showToast('URL tidak valid. Pastikan format benar!', 'error');
                    return;
                }

                // Generate QR Code URL - DENGAN FIXED ENCODING
                const qrUrl = this.generateQRHybridUrl(targetUrl);
                this.currentQRUrl = qrUrl;

                // Update preview section
                document.getElementById('previewTitle').textContent = title;
                document.getElementById('previewUrl').textContent = targetUrl;
                document.getElementById('previewQrUrl').textContent = qrUrl;
                document.getElementById('previewTime').textContent = new Date().toLocaleString('id-ID');
                
                // Generate QR Code
                this.generateQRPreview(qrUrl);

                // Show preview section
                document.getElementById('qrPreviewSection').classList.add('active');
                document.getElementById('qrPreviewSection').scrollIntoView({ behavior: 'smooth' });
                
                this.showToast('QR Code Hybrid berhasil digenerate!', 'success');
            }

            isValidUrl(url) {
                try {
                    new URL(url);
                    return true;
                } catch (e) {
                    return false;
                }
            }

            generateQRPreview(url) {
                const container = document.getElementById('qrcodePreview');
                container.innerHTML = '';

                if (this.qrCodeInstance) {
                    this.qrCodeInstance.clear();
                }

                try {
                    this.qrCodeInstance = new QRCode(container, {
                        text: url,
                        width: 200,
                        height: 200,
                        colorDark: "#1a5f23",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.Q
                    });
                } catch (error) {
                    container.innerHTML = `
                        <div style="color: var(--danger); text-align: center; padding: 20px;">
                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                            <p style="margin-top: 10px; font-size: 0.9rem;">Gagal membuat QR Code</p>
                        </div>
                    `;
                }
            }

            async saveLinkToFirebase() {
                if (!this.currentQRUrl) {
                    this.showToast('Generate QR Code terlebih dahulu', 'error');
                    return;
                }

                try {
                    const linkData = this.collectLinkData();
                    
                    // Simpan ke Firebase
                    if (window.KoperasiDB && window.KoperasiDB.db) {
                        const db = window.KoperasiDB.db;
                        
                        await db.collection('admin_qr_links').add({
                            ...linkData,
                            admin_email: this.adminData.email,
                            created_at: new Date().toISOString(),
                            status: 'active'
                        });
                        
                        this.showToast('Link berhasil disimpan ke Firebase!', 'success');
                        this.updateStats();
                    } else {
                        this.showToast('Firebase tidak tersedia', 'warning');
                    }
                    
                } catch (error) {
                    console.error('Error saving to Firebase:', error);
                    this.showToast('Gagal menyimpan ke Firebase', 'error');
                }
            }

            collectLinkData() {
                const title = document.getElementById('linkTitle').value.trim();
                const type = document.getElementById('linkType').value;
                const category = document.getElementById('linkCategory').value;
                const description = document.getElementById('linkDescription').value.trim();
                const isFeatured = document.getElementById('isFeatured').checked;
                const isActive = document.getElementById('isActive').checked;
                const urlInput = document.getElementById('targetUrl');
                
                // Get target URL
                const targetUrl = urlInput ? this.formatTargetUrl(urlInput.value.trim()) : '';

                const linkData = {
                    id: `admin_link_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    title,
                    type,
                    category,
                    description,
                    target_url: targetUrl,
                    qr_url: this.currentQRUrl,
                    is_featured: isFeatured,
                    is_active: isActive,
                    created_by: this.adminData.email,
                    created_by_name: this.adminData.name,
                    created_at: new Date().toISOString()
                };

                // Save to local storage
                this.links.unshift(linkData);
                localStorage.setItem('admin_qr_links', JSON.stringify(this.links));
                
                // Save for Tabungan Digital
                this.saveLinkForTabunganDigital(linkData);
                
                // Update UI
                this.renderLinksTable();
                this.updateStats();
                this.showToast('Link berhasil disimpan!', 'success');
                this.resetForm();
                
                return linkData;
            }

            saveLinkForTabunganDigital(linkData) {
                try {
                    // Load existing links for Tabungan Digital
                    const existingLinks = JSON.parse(localStorage.getItem('qr_hybrid_links_tabungan') || '[]');
                    
                    // Add new link
                    existingLinks.unshift({
                        id: linkData.id,
                        title: linkData.title,
                        qr_url: linkData.qr_url,
                        category: linkData.category,
                        is_featured: linkData.is_featured,
                        created_at: linkData.created_at
                    });
                    
                    // Keep only last 20 links
                    if (existingLinks.length > 20) {
                        existingLinks.length = 20;
                    }
                    
                    // Save for Tabungan Digital
                    localStorage.setItem('qr_hybrid_links_tabungan', JSON.stringify(existingLinks));
                    
                    console.log('‚úÖ Link saved for Tabungan Digital:', linkData.title);
                    
                } catch (error) {
                    console.error('Error saving for Tabungan Digital:', error);
                }
            }

            loadLinks() {
                try {
                    const links = localStorage.getItem('admin_qr_links');
                    return links ? JSON.parse(links) : [];
                } catch (error) {
                    return [];
                }
            }

            renderLinksTable() {
                const tbody = document.getElementById('linksTableBody');
                
                if (this.links.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 30px; color: var(--text-muted);">
                                <i class="fas fa-database" style="font-size: 2rem; margin-bottom: 10px; display: block; opacity: 0.5;"></i>
                                Belum ada link yang tersimpan
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = this.links.slice(0, 10).map(link => `
                    <tr>
                        <td>
                            <strong style="font-size: 0.9rem;">${link.title}</strong>
                            ${link.is_featured ? '<br><small style="color: var(--warning); font-size: 0.75rem;"><i class="fas fa-star"></i> Unggulan</small>' : ''}
                            ${link.description ? `<br><small style="color: var(--text-muted); font-size: 0.8rem;">${link.description.substring(0, 40)}${link.description.length > 40 ? '...' : ''}</small>` : ''}
                        </td>
                        <td>
                            <div style="font-size: 0.85rem;">
                                ${this.getLinkTypeIcon(link.type)} ${this.getLinkTypeLabel(link.type)}
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 0.8rem; color: var(--text-secondary); max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                                ${link.target_url.substring(0, 40)}${link.target_url.length > 40 ? '...' : ''}
                            </div>
                        </td>
                        <td>
                            <span class="link-status ${link.is_active ? 'status-active' : 'status-inactive'}">
                                ${link.is_active ? 'Aktif' : 'Nonaktif'}
                            </span>
                        </td>
                        <td>
                            <div class="table-actions">
                                <button class="table-btn view" onclick="adminSystem.viewLink('${link.id}')" title="Lihat QR">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="table-btn edit" onclick="adminSystem.editLink('${link.id}')" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="table-btn delete" onclick="adminSystem.deleteLink('${link.id}')" title="Hapus">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            getLinkTypeIcon(type) {
                const icons = {
                    'github': 'fab fa-github',
                    'external': 'fas fa-external-link-alt',
                    'whatsapp': 'fab fa-whatsapp',
                    'youtube': 'fab fa-youtube',
                    'pdf': 'fas fa-file-pdf',
                    'other': 'fas fa-link'
                };
                return `<i class="${icons[type] || 'fas fa-link'}"></i>`;
            }

            getLinkTypeLabel(type) {
                const labels = {
                    'github': 'GitHub',
                    'external': 'Website',
                    'whatsapp': 'WhatsApp',
                    'youtube': 'YouTube',
                    'pdf': 'PDF',
                    'other': 'Lainnya'
                };
                return labels[type] || 'Lainnya';
            }

            viewLink(linkId) {
                const link = this.links.find(l => l.id === linkId);
                if (!link) return;

                // Tampilkan detail link di preview
                document.getElementById('previewTitle').textContent = link.title;
                document.getElementById('previewUrl').textContent = link.target_url;
                document.getElementById('previewQrUrl').textContent = link.qr_url;
                document.getElementById('previewTime').textContent = new Date(link.created_at).toLocaleString('id-ID');
                
                // Set current QR URL
                this.currentQRUrl = link.qr_url;
                
                // Generate QR Code
                this.generateQRPreview(link.qr_url);
                
                // Show preview section
                document.getElementById('qrPreviewSection').classList.add('active');
                document.getElementById('qrPreviewSection').scrollIntoView({ behavior: 'smooth' });
                
                this.showToast(`Melihat link: "${link.title}"`, 'info');
            }

            editLink(linkId) {
                const link = this.links.find(l => l.id === linkId);
                if (!link) return;

                this.editingLinkId = linkId;
                
                // Fill form dengan data link
                document.getElementById('linkTitle').value = link.title;
                document.getElementById('linkType').value = link.type;
                document.getElementById('linkCategory').value = link.category;
                document.getElementById('linkDescription').value = link.description || '';
                document.getElementById('isFeatured').checked = link.is_featured || false;
                document.getElementById('isActive').checked = link.is_active !== false;
                
                // Handle type-specific fields
                this.handleLinkTypeChange(link.type);
                
                // Set URL input value
                setTimeout(() => {
                    const urlInput = document.getElementById('targetUrl');
                    if (urlInput) {
                        urlInput.value = link.target_url;
                    }
                }, 100);
                
                // Update button text
                document.getElementById('saveBtn').innerHTML = '<i class="fas fa-save"></i> Update Link';
                
                // Update preview URL
                setTimeout(() => this.updateUrlPreview(), 150);
                
                // Scroll to form
                document.querySelector('form').scrollIntoView({ behavior: 'smooth' });
                
                this.showToast(`Mengedit link: "${link.title}"`, 'info');
            }

            deleteLink(linkId) {
                if (!confirm('Apakah Anda yakin ingin menghapus link ini?')) return;

                const linkIndex = this.links.findIndex(l => l.id === linkId);
                if (linkIndex !== -1) {
                    const linkTitle = this.links[linkIndex].title;
                    this.links.splice(linkIndex, 1);
                    
                    // Update localStorage
                    localStorage.setItem('admin_qr_links', JSON.stringify(this.links));
                    
                    // Juga hapus dari Tabungan Digital
                    this.removeFromTabunganDigital(linkId);
                    
                    this.renderLinksTable();
                    this.updateStats();
                    this.showToast(`Link "${linkTitle}" berhasil dihapus`, 'success');
                }
            }

            removeFromTabunganDigital(linkId) {
                try {
                    const existingLinks = JSON.parse(localStorage.getItem('qr_hybrid_links_tabungan') || '[]');
                    const updatedLinks = existingLinks.filter(link => link.id !== linkId);
                    localStorage.setItem('qr_hybrid_links_tabungan', JSON.stringify(updatedLinks));
                } catch (error) {
                    console.error('Error removing from Tabungan Digital:', error);
                }
            }

            copyUrlToClipboard() {
                if (!this.currentQRUrl) {
                    this.showToast('Tidak ada URL untuk disalin', 'error');
                    return;
                }

                navigator.clipboard.writeText(this.currentQRUrl).then(() => {
                    this.showToast('URL berhasil disalin ke clipboard', 'success');
                }).catch(err => {
                    console.error('Error copying URL:', err);
                    this.showToast('Gagal menyalin URL', 'error');
                });
            }

            resetForm() {
                document.getElementById('linkForm').reset();
                document.getElementById('urlPreviewCard').classList.remove('active');
                document.getElementById('qrPreviewSection').classList.remove('active');
                document.getElementById('saveBtn').innerHTML = '<i class="fas fa-save"></i> Simpan & Generate QR';
                this.editingLinkId = null;
                this.currentQRUrl = '';
                
                // Reset GitHub section
                document.getElementById('githubDetectionSection').style.display = 'none';
                document.getElementById('detectionResult').style.display = 'none';
                
                // Reset ke default input
                this.setupDefaultUrlInput();
                
                this.showToast('Form telah direset', 'info');
            }

            showForm() {
                document.getElementById('qrPreviewSection').classList.remove('active');
                document.querySelector('form').scrollIntoView({ behavior: 'smooth' });
            }

            updateDate() {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                document.getElementById('currentDate').textContent = 
                    now.toLocaleDateString('id-ID', options);
            }

            updateStats() {
                // Total links
                document.getElementById('totalLinks').textContent = this.links.length;
                
                // Active QR codes
                const activeLinks = this.links.filter(link => link.is_active !== false);
                document.getElementById('activeQRs').textContent = activeLinks.length;
                
                // Featured links
                const featuredLinks = this.links.filter(link => link.is_featured);
                document.getElementById('featuredLinks').textContent = featuredLinks.length;
                
                // Links in Firebase (dummy value - in real app, fetch from Firebase)
                const firebaseLinks = this.links.filter(link => link.qr_url.includes('firebase') || link.type === 'github');
                document.getElementById('firebaseLinks').textContent = firebaseLinks.length;
            }

            showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                const toastMsg = document.getElementById('toastMessage');
                
                toast.className = `toast ${type} show`;
                toastMsg.textContent = message;
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // ===== INISIALISASI =====
        let adminSystem;
        let githubPagesDetector;
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Cek jika user adalah admin
                const currentUser = JSON.parse(localStorage.getItem('koperasi_current_user') || 'null');
                const isAdmin = currentUser && (
                    currentUser.role === 'admin' || 
                    currentUser.email === 'admin@koperasi.com' ||
                    currentUser.email === 'koperasi@gmail.com' ||
                    (currentUser.email && currentUser.email.includes('admin'))
                );

                if (!isAdmin) {
                    alert('‚ö†Ô∏è Akses ditolak! Halaman ini hanya untuk Admin.');
                    window.location.href = 'tabungan-digital.html';
                    return;
                }

                // Initialize systems
        adminSystem = new AdminQRCodeSystem();
        githubPagesDetector = new GitHubPagesDetector(); // ‚Üê BARU DITAMBAH
        
        // Make available globally
        window.adminSystem = adminSystem;
        window.githubPagesDetector = githubPagesDetector; // ‚Üê BARU DITAMBAH
                
                console.log('‚úÖ Admin QR Code System Application Ready');
                console.log('‚úÖ GitHub Pages Detector Ready'); // ‚Üê Optional: tambah log ini
                
            } catch (error) {
                console.error('‚ùå Error initializing admin system:', error);
                
                // Fallback error handling
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: white; z-index: 10000; display: flex; flex-direction: column;
                    align-items: center; justify-content: center; padding: 20px; text-align: center;
                `;
                errorDiv.innerHTML = `
                    <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #f44336; margin-bottom: 20px;"></i>
                    <h2 style="color: #333; margin-bottom: 15px;">Terjadi Kesalahan</h2>
                    <p style="color: #666; margin-bottom: 25px;">Gagal memuat sistem admin</p>
                    <button onclick="window.location.href='dashboard-admin.html'" style="
                        background: #1a5f23; color: white; border: none; padding: 12px 24px;
                        border-radius: 8px; font-size: 16px; cursor: pointer; margin: 10px;
                    ">
                        <i class="fas fa-arrow-left"></i> Kembali ke Dashboard
                    </button>
                `;
                document.body.innerHTML = '';
                document.body.appendChild(errorDiv);
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Laporan SHU - Koperasi Asmara Tani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* ===== VARIABEL DESAIN MOBILE FIRST ===== */
        :root {
            /* Warna utama */
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary: #ff9800;
            --accent: #00bcd4;
            --info: #2196f3;
            --success: #4caf50;
            --warning: #ffc107;
            --danger: #f44336;
            
            /* Neutral colors */
            --dark: #121212;
            --light: #ffffff;
            --gray: #757575;
            --gray-light: #e0e0e0;
            --gray-lighter: #f5f5f5;
            
            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            
            /* Spacing */
            --space-xs: 8px;
            --space-sm: 12px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            
            /* Border radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }
        
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 14px;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f8f9fa;
            color: var(--dark);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ===== LOADING OVERLAY ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--gray-lighter);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--space-md);
        }
        
        .loading-text {
            color: var(--primary);
            font-weight: 600;
        }
        
        /* ===== CONTAINER MOBILE OPTIMIZED ===== */
        .mobile-container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            overflow-x: hidden;
        }
        
        /* ===== HEADER SECTION ===== */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: var(--space-lg) var(--space-md);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-md);
        }
        
        .header-title {
            flex: 1;
        }
        
        .header-title h1 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 4px;
            line-height: 1.3;
        }
        
        .header-title p {
            font-size: 0.85rem;
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .back-button {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }
        
        /* ===== FILTER SECTION - MOBILE FRIENDLY ===== */
        .filter-section {
            background: white;
            margin: var(--space-md);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
        }
        
        .filter-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }
        
        .filter-title i {
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .filter-title h2 {
            font-size: 1.1rem;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .filter-grid {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
            margin-bottom: var(--space-sm);
        }
        
        .filter-group {
            flex: 1;
            min-width: calc(50% - 8px);
        }
        
        .filter-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray);
            margin-bottom: 6px;
        }
        
        .filter-select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            background: white;
            color: var(--dark);
            transition: all 0.2s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232e7d32' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }
        
        .filter-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }
        
        /* ===== STATS SECTION - MOBILE OPTIMIZED ===== */
        .stats-section {
            padding: 0 var(--space-md) var(--space-md);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--primary-light));
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }
        
        .stat-title {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 500;
            line-height: 1.4;
        }
        
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: rgba(46, 125, 50, 0.1);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 4px;
            line-height: 1.2;
        }
        
        .stat-detail {
            font-size: 0.8rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 6px;
        }
        
        /* ===== TABLE SECTION - MOBILE OPTIMIZED ===== */
        .table-section {
            padding: 0 var(--space-md) var(--space-md);
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding: 0 var(--space-sm);
        }
        
        .table-header h2 {
            font-size: 1.1rem;
            color: var(--primary-dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .table-actions {
            display: flex;
            gap: var(--space-sm);
        }
        
        /* ===== TABEL UTAMA - DESAIN MOBILE FIRST ===== */
        .responsive-table {
            width: 100%;
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0;
        }
        
        .mobile-table {
            width: 100%;
            min-width: 320px;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .mobile-table thead {
            display: none;
        }
        
        .mobile-table tbody tr {
            display: block;
            border-bottom: 1px solid var(--gray-lighter);
            padding: var(--space-md);
            transition: background-color 0.2s ease;
        }
        
        .mobile-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .mobile-table tbody tr:hover {
            background-color: rgba(46, 125, 50, 0.02);
        }
        
        .mobile-table td {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border: none;
            position: relative;
        }
        
        .mobile-table td::before {
            content: attr(data-label);
            font-weight: 600;
            color: var(--gray);
            font-size: 0.85rem;
            min-width: 100px;
            padding-right: var(--space-sm);
        }
        
        .mobile-table td .cell-content {
            flex: 1;
            text-align: right;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* ===== CARD VIEW UNTUK TABEL - ALTERNATIF MOBILE ===== */
        .card-view {
            display: none;
        }
        
        .shu-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary);
            animation: fadeIn 0.3s ease;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-md);
        }
        
        .card-title {
            flex: 1;
        }
        
        .card-title h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 4px;
        }
        
        .card-badge {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(46, 125, 50, 0.1);
            color: var(--primary);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: var(--space-sm);
        }
        
        .card-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .card-item {
            display: flex;
            flex-direction: column;
        }
        
        .card-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 4px;
        }
        
        .card-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .card-actions {
            display: flex;
            gap: var(--space-sm);
            justify-content: flex-end;
            padding-top: var(--space-md);
            border-top: 1px solid var(--gray-lighter);
        }
        
        /* ===== BUTTONS - MOBILE FRIENDLY ===== */
        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            min-height: 44px;
            min-width: 44px;
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.2);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            box-shadow: 0 6px 16px rgba(46, 125, 50, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #ffb74d);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 0.85rem;
            min-height: 36px;
            min-width: 36px;
        }
        
        .btn-icon {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ===== BADGES ===== */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            line-height: 1;
        }
        
        .badge-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #e6a700;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .badge-info {
            background-color: rgba(33, 150, 243, 0.1);
            color: var(--info);
            border: 1px solid rgba(33, 150, 243, 0.2);
        }
        
        /* ===== ACTION BUTTONS ===== */
        .action-buttons {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 12px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-sm);
            background: white;
            color: var(--gray);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            background: var(--gray-lighter);
            color: var(--primary);
            border-color: var(--primary-light);
        }
        
        /* ===== FOOTER ===== */
        .footer {
            background: white;
            padding: var(--space-lg) var(--space-md);
            text-align: center;
            color: var(--gray);
            font-size: 0.85rem;
            border-top: 1px solid var(--gray-lighter);
            margin-top: var(--space-xl);
        }
        
        /* ===== UTILITY CLASSES ===== */
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .text-primary {
            color: var(--primary);
        }
        
        .text-success {
            color: var(--success);
        }
        
        .fw-bold {
            font-weight: 700;
        }
        
        .d-flex {
            display: flex;
        }
        
        .align-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .mb-1 { margin-bottom: var(--space-xs); }
        .mb-2 { margin-bottom: var(--space-sm); }
        .mb-3 { margin-bottom: var(--space-md); }
        .mb-4 { margin-bottom: var(--space-lg); }
        .mb-5 { margin-bottom: var(--space-xl); }
        
        .mt-1 { margin-top: var(--space-xs); }
        .mt-2 { margin-top: var(--space-sm); }
        .mt-3 { margin-top: var(--space-md); }
        .mt-4 { margin-top: var(--space-lg); }
        .mt-5 { margin-top: var(--space-xl); }
        
        /* ===== MEDIA QUERIES ===== */
        @media screen and (min-width: 768px) {
            html {
                font-size: 15px;
            }
            
            .mobile-container {
                max-width: 720px;
                padding: 0 var(--space-md);
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .filter-row {
                flex-wrap: nowrap;
            }
            
            .filter-group {
                min-width: auto;
            }
            
            .mobile-table thead {
                display: table-header-group;
            }
            
            .mobile-table thead th {
                background: rgba(46, 125, 50, 0.05);
                color: var(--primary-dark);
                font-weight: 600;
                padding: 14px 16px;
                text-align: left;
                font-size: 0.9rem;
                border-bottom: 2px solid var(--primary-light);
            }
            
            .mobile-table tbody tr {
                display: table-row;
                padding: 0;
            }
            
            .mobile-table td {
                display: table-cell;
                padding: 14px 16px;
                border-bottom: 1px solid var(--gray-lighter);
                text-align: left;
            }
            
            .mobile-table td::before {
                display: none;
            }
            
            .mobile-table td .cell-content {
                text-align: left;
            }
            
            .card-view {
                display: none;
            }
        }
        
        @media screen and (min-width: 992px) {
            .mobile-container {
                max-width: 960px;
            }
            
            .header {
                padding: var(--space-xl) var(--space-lg);
            }
            
            .header-title h1 {
                font-size: 1.5rem;
            }
            
            .stats-section,
            .table-section {
                padding: 0 var(--space-lg) var(--space-lg);
            }
            
            .filter-section {
                margin: var(--space-lg);
                padding: var(--space-xl);
            }
        }
        
        @media screen and (max-width: 767px) and (orientation: landscape) {
            .mobile-table tbody tr {
                padding: var(--space-sm);
            }
            
            .stat-card {
                padding: var(--space-md);
            }
            
            .filter-section {
                margin: var(--space-sm);
                padding: var(--space-md);
            }
        }
        
        @media screen and (max-width: 360px) {
            html {
                font-size: 13px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }
            
            .stat-card {
                padding: var(--space-md);
            }
            
            .mobile-table td {
                flex-direction: column;
                align-items: flex-start;
                padding: 8px 0;
            }
            
            .mobile-table td::before {
                margin-bottom: 4px;
                min-width: auto;
            }
            
            .mobile-table td .cell-content {
                text-align: left;
                width: 100%;
            }
            
            .table-container {
                display: none;
            }
            
            .card-view {
                display: block;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        /* Loading state */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--gray-lighter);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <!-- LOADING OVERLAY -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Memuat data SHU...</div>
    </div>
    
    <!-- MOBILE CONTAINER -->
    <div class="mobile-container">
        
        <!-- HEADER -->
        <header class="header">
            <div class="header-content">
                <button class="back-button" onclick="goBackToDashboard()" aria-label="Kembali">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="header-title">
                    <h1>Laporan SHU</h1>
                    <p>Sisa Hasil Usaha - Koperasi Asmara Tani</p>
                </div>
            </div>
        </header>
        
        <!-- FILTER SECTION -->
        <section class="filter-section">
            <div class="filter-title">
                <i class="fas fa-filter"></i>
                <h2>Filter Laporan</h2>
            </div>
            
            <div class="filter-grid">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Tahun</label>
                        <select class="filter-select" id="tahunSHU">
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Periode</label>
                        <select class="filter-select" id="periodeSHU">
                            <option value="tahunan">Tahunan</option>
                            <option value="semester1">Semester 1</option>
                            <option value="semester2">Semester 2</option>
                            <option value="triwulan1">Triwulan 1</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Status</label>
                        <select class="filter-select" id="statusSHU">
                            <option value="all">Semua Status</option>
                            <option value="dibagikan">Sudah Dibagikan</option>
                            <option value="dialokasikan">Dialokasikan</option>
                            <option value="disetorkan">Disetorkan</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button class="btn btn-primary" id="applyFilterBtn" style="flex: 1;">
                        <i class="fas fa-sync-alt"></i>
                        <span>Terapkan Filter</span>
                    </button>
                    <button class="btn btn-outline btn-icon" id="resetFilterBtn" title="Reset Filter">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
            </div>
        </section>
        
        <!-- STATS SECTION -->
        <section class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Total SHU Tahun Ini</div>
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalSHUDisplay">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-arrow-up text-success"></i>
                        <span id="growthPercent">0%</span> pertumbuhan
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">SHU Dibagikan</div>
                        <div class="stat-icon">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="shuAnggotaDisplay">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-users"></i>
                        <span id="jumlahAnggotaSHU">0</span> anggota
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Dana Cadangan</div>
                        <div class="stat-icon">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="danaCadanganDisplay">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-percentage"></i>
                        40% dari total SHU
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Rata-rata/Anggota</div>
                        <div class="stat-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="rataRataSHU">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-chart-line"></i>
                        Berdasarkan simpanan
                    </div>
                </div>
            </div>
        </section>
        
        <!-- TABLE SECTION -->
        <section class="table-section">
            <div class="table-header">
                <h2>
                    <i class="fas fa-chart-pie"></i>
                    Distribusi SHU
                </h2>
                <div class="table-actions">
                    <button class="btn btn-outline btn-sm" id="exportBtn" title="Export">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="btn btn-outline btn-sm" id="printBtn" title="Print">
                        <i class="fas fa-print"></i>
                    </button>
                </div>
            </div>
            
            <!-- TABLE CONTAINER (untuk tablet/desktop) -->
            <div class="table-container">
                <table class="mobile-table">
                    <thead>
                        <tr>
                            <th>Jenis Alokasi</th>
                            <th>Persentase</th>
                            <th>Jumlah</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="shuTableBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- CARD VIEW (untuk mobile kecil) -->
            <div class="card-view" id="shuCardView">
                <!-- Data akan diisi oleh JavaScript -->
            </div>
        </section>
        
        <!-- DAFTAR PENERIMA SHU SECTION -->
        <section class="table-section">
            <div class="table-header">
                <h2>
                    <i class="fas fa-users"></i>
                    Daftar Penerima SHU per Anggota
                </h2>
                <div class="table-actions">
                    <button class="btn btn-outline btn-sm" id="exportPenerimaBtn" title="Export Data Penerima">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
            
            <!-- STATS PENERIMA -->
            <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr); margin-bottom: var(--space-lg);">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Total Anggota</div>
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalAnggotaPenerima">0</div>
                    <div class="stat-detail">
                        <i class="fas fa-check-circle text-success"></i>
                        Semua menerima SHU
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Rata-rata/Anggota</div>
                        <div class="stat-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="avgPerAnggota">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-coins"></i>
                        Berdasarkan simpanan
                    </div>
                </div>
            </div>
            
            <!-- CARD VIEW UNTUK PENERIMA -->
            <div class="card-view" id="penerimaCardView">
                <!-- Data akan diisi oleh JavaScript -->
            </div>
        </section>
        
        <!-- ACTION BUTTONS -->
        <section class="table-section">
            <div class="action-buttons">
                <button class="action-btn" id="refreshDataBtn">
                    <i class="fas fa-sync-alt"></i>
                    <span>Refresh Data</span>
                </button>
                <button class="action-btn" id="exportExcelBtn">
                    <i class="fas fa-file-excel"></i>
                    <span>Export Excel</span>
                </button>
                <button class="action-btn" id="exportPdfBtn">
                    <i class="fas fa-file-pdf"></i>
                    <span>Export PDF</span>
                </button>
                <button class="action-btn" id="viewChartBtn">
                    <i class="fas fa-chart-bar"></i>
                    <span>Lihat Chart</span>
                </button>
            </div>
        </section>
        
        <!-- FOOTER -->
        <footer class="footer">
            <p>Â© <span id="currentYear"></span> Koperasi Asmara Tani</p>
            <p>Laporan SHU - Dicetak dari Sistem Administrasi</p>
        </footer>
    </div>
    
    <script>
        // ===== KONFIGURASI =====
        let shuData = [];
        let penerimaData = [];
        let currentFilter = {
            tahun: '2024',
            periode: 'tahunan',
            status: 'all'
        };
        let chartInstance = null;
        let chartType = 'pie';
        let isLoading = false;
        let filterTimeout = null;

        // ===== FUNGSI UTAMA =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Mobile SHU Report Initializing...');
            
            initializeApp();
            setupEventListeners();
            loadData();
            
            console.log('âœ… Mobile SHU Report Ready');
        });

        // ===== INITIALIZE APP =====
        function initializeApp() {
            // Update tahun footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Set default filter ke tahun berjalan
            const currentYear = new Date().getFullYear().toString();
            document.getElementById('tahunSHU').value = currentYear;
            currentFilter.tahun = currentYear;
            
            // Show initial loading
            showLoading(true);
        }

        // ===== LOAD DATA =====
        async function loadData() {
            if (isLoading) return;
            
            isLoading = true;
            showLoading(true);
            
            try {
                console.log('ðŸ“¥ Loading SHU data...');
                
                // 1. Coba load data dari Dashboard terlebih dahulu
                const success = await loadDataFromDashboard();
                
                if (!success) {
                    console.log('âš ï¸ Using fallback data');
                    generateFallbackData();
                }
                
                // 2. Update statistik
                updateStatistics();
                
                // 3. Tampilkan data
                applyFilter();
                
                // 4. Setup integrasi dua arah
                setupBidirectionalIntegration();
                
                console.log('âœ… Data loaded successfully');
                showMessage('Data SHU berhasil dimuat', 'success');
                
            } catch (error) {
                console.error('âŒ Error loading data:', error);
                showMessage('Gagal memuat data SHU', 'error');
                generateFallbackData();
            } finally {
                isLoading = false;
                showLoading(false);
            }
        }

        // ===== LOAD DATA FROM DASHBOARD =====
        async function loadDataFromDashboard() {
            return new Promise((resolve) => {
                try {
                    // 1. Ambil data dari localStorage
                    const anggotaData = JSON.parse(localStorage.getItem('koperasi_anggota') || '[]');
                    const simpananData = JSON.parse(localStorage.getItem('simpananData') || '[]');
                    
                    console.log('ðŸ“Š Dashboard data:', {
                        anggota: anggotaData.length,
                        simpanan: simpananData.length
                    });
                    
                    // 2. Validasi data
                    if (!Array.isArray(anggotaData) || !Array.isArray(simpananData)) {
                        console.warn('âš ï¸ Invalid data format from dashboard');
                        resolve(false);
                        return;
                    }
                    
                    if (anggotaData.length === 0 || simpananData.length === 0) {
                        console.warn('âš ï¸ Empty data from dashboard');
                        resolve(false);
                        return;
                    }
                    
                    // 3. Hitung total simpanan
                    const totalSimpanan = simpananData.reduce((sum, s) => {
                        return sum + (parseInt(s.nominal) || 0);
                    }, 0);
                    
                    // 4. Hitung SHU (20% dari total simpanan)
                    const totalSHU = Math.round(totalSimpanan * 0.2);
                    
                    // 5. Generate distribusi SHU
                    shuData = generateSHUDistribution(totalSHU);
                    
                    // 6. Generate data penerima
                    penerimaData = generatePenerimaData(anggotaData, simpananData, totalSHU);
                    
                    // 7. Simpan data untuk sinkronisasi
                    saveSHUDataToDashboard(totalSHU);
                    
                    console.log('âœ… Dashboard data loaded:', {
                        totalSHU: totalSHU,
                        distribusi: shuData.length,
                        penerima: penerimaData.length
                    });
                    
                    resolve(true);
                    
                } catch (error) {
                    console.error('âŒ Error loading from dashboard:', error);
                    resolve(false);
                }
            });
        }

        // ===== GENERATE SHU DISTRIBUTION =====
        function generateSHUDistribution(totalSHU) {
            const distribusi = [
                {
                    id: 'SHU-001',
                    jenis: 'Dana Cadangan',
                    persentase: 40,
                    jumlah: Math.round(totalSHU * 0.4),
                    deskripsi: 'Dana untuk pengembangan koperasi',
                    status: 'Disetorkan',
                    sumber: 'Simpanan Anggota',
                    tanggal: new Date().getFullYear() + '-12-31',
                    bukti: 'SHU-CAD-' + new Date().getFullYear() + '-001',
                    color: '#2e7d32'
                },
                {
                    id: 'SHU-002',
                    jenis: 'Dana Anggota',
                    persentase: 25,
                    jumlah: Math.round(totalSHU * 0.25),
                    deskripsi: 'Dibagikan kepada anggota sesuai simpanan',
                    status: 'Dibagikan',
                    sumber: 'Simpanan Anggota',
                    tanggal: new Date().getFullYear() + '-12-31',
                    bukti: 'SHU-ANG-' + new Date().getFullYear() + '-001',
                    color: '#2196f3'
                },
                {
                    id: 'SHU-003',
                    jenis: 'Dana Pengurus',
                    persentase: 10,
                    jumlah: Math.round(totalSHU * 0.1),
                    deskripsi: 'Honorarium pengurus koperasi',
                    status: 'Dibayarkan',
                    sumber: 'Simpanan Anggota',
                    tanggal: new Date().getFullYear() + '-12-31',
                    bukti: 'SHU-PEN-' + new Date().getFullYear() + '-001',
                    color: '#ff9800'
                },
                {
                    id: 'SHU-004',
                    jenis: 'Dana Karyawan',
                    persentase: 5,
                    jumlah: Math.round(totalSHU * 0.05),
                    deskripsi: 'Bonus untuk karyawan',
                    status: 'Dibayarkan',
                    sumber: 'Simpanan Anggota',
                    tanggal: new Date().getFullYear() + '-12-31',
                    bukti: 'SHU-KAR-' + new Date().getFullYear() + '-001',
                    color: '#9c27b0'
                },
                {
                    id: 'SHU-005',
                    jenis: 'Dana Pendidikan',
                    persentase: 5,
                    jumlah: Math.round(totalSHU * 0.05),
                    deskripsi: 'Program pendidikan anggota',
                    status: 'Dialokasikan',
                    sumber: 'Simpanan Anggota',
                    tanggal: new Date().getFullYear() + '-12-31',
                    bukti: 'SHU-PDK-' + new Date().getFullYear() + '-001',
                    color: '#00bcd4'
                },
                {
                    id: 'SHU-006',
                    jenis: 'Dana Sosial',
                    persentase: 5,
                    jumlah: Math.round(totalSHU * 0.05),
                    deskripsi: 'Kegiatan sosial kemasyarakatan',
                    status: 'Dialokasikan',
                    sumber: 'Simpanan Anggota',
                    tanggal: new Date().getFullYear() + '-12-31',
                    bukti: 'SHU-SOS-' + new Date().getFullYear() + '-001',
                    color: '#ff5722'
                },
                {
                    id: 'SHU-007',
                    jenis: 'Dana Pembangunan',
                    persentase: 10,
                    jumlah: Math.round(totalSHU * 0.1),
                    deskripsi: 'Pengembangan sarana prasarana',
                    status: 'Dialokasikan',
                    sumber: 'Simpanan Anggota',
                    tanggal: new Date().getFullYear() + '-12-31',
                    bukti: 'SHU-BNG-' + new Date().getFullYear() + '-001',
                    color: '#795548'
                }
            ];
            
            return distribusi;
        }

        // ===== GENERATE PENERIMA DATA =====
        function generatePenerimaData(anggotaData, simpananData, totalSHU) {
            // Hitung total simpanan per anggota
            const simpananPerAnggota = {};
            anggotaData.forEach(anggota => {
                const totalSimpanan = simpananData
                    .filter(s => s.idAnggota === anggota.id)
                    .reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
                
                simpananPerAnggota[anggota.id] = totalSimpanan;
            });
            
            // Hitung total semua simpanan
            const totalSemuaSimpanan = Object.values(simpananPerAnggota)
                .reduce((sum, val) => sum + val, 0);
            
            // Hitung SHU untuk anggota (25% dari total SHU)
            const totalSHUAnggota = Math.round(totalSHU * 0.25);
            
            // Generate data penerima
            const penerima = anggotaData
                .filter(anggota => simpananPerAnggota[anggota.id] > 0)
                .map(anggota => {
                    const simpananAnggota = simpananPerAnggota[anggota.id] || 0;
                    const persentase = totalSemuaSimpanan > 0 
                        ? (simpananAnggota / totalSemuaSimpanan * 100) 
                        : 0;
                    const shuDiterima = Math.round(totalSHUAnggota * (persentase / 100));
                    
                    return {
                        id: anggota.id,
                        nama: anggota.nama || 'Anggota ' + anggota.id,
                        noAnggota: anggota.nia || anggota.id,
                        simpananPokok: anggota.simpananPokok || 0,
                        simpananWajib: anggota.simpananWajib || 0,
                        simpananSukarela: anggota.simpananSukarela || 0,
                        totalSimpanan: simpananAnggota,
                        shuDiterima: shuDiterima,
                        persentase: persentase.toFixed(2),
                        tanggalTerima: new Date().getFullYear() + '-12-15',
                        status: shuDiterima > 0 ? 'Diterima' : 'Belum Diterima',
                        bukti: 'SHU-' + (anggota.nia || anggota.id) + '-' + new Date().getFullYear()
                    };
                });
            
            return penerima;
        }

        // ===== FALLBACK DATA =====
        function generateFallbackData() {
            console.log('ðŸ“ Generating fallback data...');
            
            const totalSHU = 125450000;
            
            shuData = generateSHUDistribution(totalSHU);
            
            // Sample penerima data
            penerimaData = [
                {
                    id: 'P001',
                    nama: 'Budi Santoso',
                    noAnggota: 'AGT-001',
                    simpananPokok: 500000,
                    simpananWajib: 1200000,
                    simpananSukarela: 800000,
                    totalSimpanan: 2500000,
                    shuDiterima: 843750,
                    persentase: '3.20',
                    tanggalTerima: '2024-12-15',
                    status: 'Diterima',
                    bukti: 'SHU-AGT-001-2024'
                },
                {
                    id: 'P002',
                    nama: 'Siti Rahayu',
                    noAnggota: 'AGT-002',
                    simpananPokok: 500000,
                    simpananWajib: 1800000,
                    simpananSukarela: 1200000,
                    totalSimpanan: 3500000,
                    shuDiterima: 1181250,
                    persentase: '4.50',
                    tanggalTerima: '2024-12-15',
                    status: 'Diterima',
                    bukti: 'SHU-AGT-002-2024'
                },
                {
                    id: 'P003',
                    nama: 'Ahmad Wijaya',
                    noAnggota: 'AGT-003',
                    simpananPokok: 500000,
                    simpananWajib: 2000000,
                    simpananSukarela: 1500000,
                    totalSimpanan: 4000000,
                    shuDiterima: 1350000,
                    persentase: '5.14',
                    tanggalTerima: '2024-12-15',
                    status: 'Diterima',
                    bukti: 'SHU-AGT-003-2024'
                }
            ];
        }

        // ===== UPDATE STATISTICS =====
        function updateStatistics() {
            const totalSHU = shuData.reduce((sum, item) => sum + (item.jumlah || 0), 0);
            const shuAnggota = shuData.find(item => item.jenis === 'Dana Anggota')?.jumlah || 0;
            const danaCadangan = shuData.find(item => item.jenis === 'Dana Cadangan')?.jumlah || 0;
            const rataRata = penerimaData.length > 0 
                ? Math.round(shuAnggota / penerimaData.length) 
                : 0;
            
            // Update displays
            document.getElementById('totalSHUDisplay').textContent = formatCurrency(totalSHU);
            document.getElementById('shuAnggotaDisplay').textContent = formatCurrency(shuAnggota);
            document.getElementById('danaCadanganDisplay').textContent = formatCurrency(danaCadangan);
            document.getElementById('rataRataSHU').textContent = formatCurrency(rataRata);
            document.getElementById('jumlahAnggotaSHU').textContent = penerimaData.length;
            
            // Update growth percentage (simulated)
            const growth = calculateGrowthPercentage();
            document.getElementById('growthPercent').textContent = growth + '%';
            
            // Update penerima stats
            document.getElementById('totalAnggotaPenerima').textContent = penerimaData.length;
            document.getElementById('avgPerAnggota').textContent = formatCurrency(rataRata);
        }

        // ===== CALCULATE GROWTH =====
        function calculateGrowthPercentage() {
            // Simulate growth based on year
            const yearMultipliers = {
                '2024': 15.5,
                '2023': 12.8,
                '2022': 10.2,
                '2021': 8.5
            };
            
            return yearMultipliers[currentFilter.tahun] || 10.0;
        }

        // ===== APPLY FILTER =====
        function applyFilter() {
            // Clear previous timeout
            if (filterTimeout) {
                clearTimeout(filterTimeout);
            }
            
            // Get filter values
            const tahun = document.getElementById('tahunSHU').value;
            const periode = document.getElementById('periodeSHU').value;
            const status = document.getElementById('statusSHU').value;
            
            currentFilter = { tahun, periode, status };
            
            // Debounce filter application
            filterTimeout = setTimeout(() => {
                showLoading(true);
                
                try {
                    // Filter data berdasarkan status
                    let filteredData = [...shuData];
                    
                    if (status !== 'all') {
                        filteredData = filteredData.filter(item => 
                            item.status.toLowerCase().includes(status.toLowerCase())
                        );
                    }
                    
                    // Apply year multiplier
                    const multiplier = getYearMultiplier(tahun);
                    
                    // Display filtered data
                    displaySHUData(filteredData, multiplier);
                    
                    // Show notification
                    showMessage(`Filter diterapkan: ${tahun}, ${periode}`, 'info');
                    
                } catch (error) {
                    console.error('âŒ Filter error:', error);
                    showMessage('Gagal menerapkan filter', 'error');
                } finally {
                    showLoading(false);
                }
            }, 300);
        }

        // ===== YEAR MULTIPLIER =====
        function getYearMultiplier(tahun) {
            const multipliers = {
                '2024': 1.0,
                '2023': 0.85,
                '2022': 0.72,
                '2021': 0.65
            };
            
            return multipliers[tahun] || 1.0;
        }

        // ===== DISPLAY DATA =====
        function displaySHUData(data, multiplier = 1) {
            const tableBody = document.getElementById('shuTableBody');
            const cardView = document.getElementById('shuCardView');
            
            // Clear existing content
            tableBody.innerHTML = '';
            cardView.innerHTML = '';
            
            if (data.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            <i class="fas fa-inbox" style="font-size: 3rem; color: var(--gray-light); margin-bottom: 16px;"></i>
                            <p style="color: var(--gray);">Tidak ada data yang sesuai dengan filter</p>
                        </td>
                    </tr>
                `;
                
                cardView.innerHTML = `
                    <div class="shu-card" style="text-align: center;">
                        <i class="fas fa-inbox" style="font-size: 3rem; color: var(--gray-light); margin-bottom: 16px;"></i>
                        <p style="color: var(--gray);">Tidak ada data yang sesuai dengan filter</p>
                    </div>
                `;
                return;
            }
            
            // Build table rows
            data.forEach((item, index) => {
                const adjustedAmount = Math.round(item.jumlah * multiplier);
                
                // Create table row
                const row = document.createElement('tr');
                row.innerHTML = createTableRowHTML(item, adjustedAmount);
                tableBody.appendChild(row);
                
                // Create card view
                const card = document.createElement('div');
                card.className = 'shu-card';
                card.innerHTML = createCardHTML(item, adjustedAmount);
                cardView.appendChild(card);
            });
            
            // Display penerima data
            displayPenerimaData();
        }

        function createTableRowHTML(item, amount) {
            const badgeClass = getBadgeClass(item.status);
            const badgeIcon = getBadgeIcon(item.status);
            
            return `
                <td data-label="Jenis">
                    <div style="font-weight: 600; color: var(--primary-dark);">${item.jenis}</div>
                    <div style="font-size: 0.85rem; color: var(--gray);">${item.deskripsi}</div>
                </td>
                <td data-label="Persentase">
                    <div style="font-weight: 700; color: var(--primary);">${item.persentase}%</div>
                    <div style="width: 60px; height: 4px; background: var(--gray-light); border-radius: 2px; margin-top: 4px;">
                        <div style="width: ${item.persentase}%; height: 100%; background: var(--primary); border-radius: 2px;"></div>
                    </div>
                </td>
                <td data-label="Jumlah">
                    <div style="font-weight: 700; color: var(--dark);">${formatCurrency(amount)}</div>
                </td>
                <td data-label="Status">
                    <span class="badge ${badgeClass}">
                        <i class="fas ${badgeIcon}"></i>
                        ${item.status}
                    </span>
                </td>
                <td data-label="Aksi">
                    <button class="action-btn btn-sm" onclick="showSHUDetail('${item.id}')" title="Detail">
                        <i class="fas fa-eye"></i>
                    </button>
                </td>
            `;
        }

        function createCardHTML(item, amount) {
            const badgeClass = getBadgeClass(item.status);
            
            return `
                <div class="card-header">
                    <div class="card-title">
                        <h3>${item.jenis}</h3>
                        <span class="card-badge">${item.persentase}%</span>
                    </div>
                    <span class="badge ${badgeClass}">
                        ${item.status}
                    </span>
                </div>
                
                <div class="card-content">
                    <div class="card-item">
                        <div class="card-label">Jumlah</div>
                        <div class="card-value">${formatCurrency(amount)}</div>
                    </div>
                    <div class="card-item">
                        <div class="card-label">Sumber</div>
                        <div class="card-value">${item.sumber}</div>
                    </div>
                    <div class="card-item">
                        <div class="card-label">Tanggal</div>
                        <div class="card-value">${item.tanggal}</div>
                    </div>
                    <div class="card-item">
                        <div class="card-label">No. Bukti</div>
                        <div class="card-value">${item.bukti}</div>
                    </div>
                </div>
                
                <div class="card-actions">
                    <button class="action-btn" onclick="showSHUDetail('${item.id}')">
                        <i class="fas fa-eye"></i>
                        <span>Detail</span>
                    </button>
                    <button class="action-btn" onclick="printSHUItem('${item.id}')">
                        <i class="fas fa-print"></i>
                        <span>Cetak</span>
                    </button>
                </div>
            `;
        }

        // ===== DISPLAY PENERIMA DATA =====
        function displayPenerimaData() {
            const cardView = document.getElementById('penerimaCardView');
            cardView.innerHTML = '';
            
            if (penerimaData.length === 0) {
                cardView.innerHTML = `
                    <div class="shu-card" style="text-align: center;">
                        <i class="fas fa-users" style="font-size: 3rem; color: var(--gray-light); margin-bottom: 16px;"></i>
                        <p style="color: var(--gray);">Belum ada data penerima SHU</p>
                        <p style="color: var(--gray); font-size: 0.9rem;">Data akan muncul setelah ada simpanan dari anggota</p>
                    </div>
                `;
                return;
            }
            
            penerimaData.forEach((anggota, index) => {
                const card = document.createElement('div');
                card.className = 'shu-card';
                card.style.borderLeftColor = index % 2 === 0 ? '#2e7d32' : '#2196f3';
                
                card.innerHTML = createPenerimaCardHTML(anggota);
                cardView.appendChild(card);
            });
        }

        function createPenerimaCardHTML(anggota) {
            const badgeClass = anggota.status === 'Diterima' ? 'badge-success' : 'badge-warning';
            const badgeIcon = anggota.status === 'Diterima' ? 'fa-check-circle' : 'fa-clock';
            
            return `
                <div class="card-header">
                    <div class="card-title">
                        <h3>${anggota.nama}</h3>
                        <span class="card-badge">No: ${anggota.noAnggota}</span>
                    </div>
                    <span class="badge ${badgeClass}">
                        <i class="fas ${badgeIcon}"></i>
                        ${anggota.status}
                    </span>
                </div>
                
                <div class="card-content">
                    <div class="card-item">
                        <div class="card-label">Total Simpanan</div>
                        <div class="card-value">${formatCurrency(anggota.totalSimpanan)}</div>
                    </div>
                    <div class="card-item">
                        <div class="card-label">SHU Diterima</div>
                        <div class="card-value text-success fw-bold">${formatCurrency(anggota.shuDiterima)}</div>
                    </div>
                    <div class="card-item">
                        <div class="card-label">Persentase</div>
                        <div class="card-value">${anggota.persentase}%</div>
                    </div>
                    <div class="card-item">
                        <div class="card-label">Tanggal</div>
                        <div class="card-value">${anggota.tanggalTerima}</div>
                    </div>
                </div>
                
                <div style="background: var(--gray-lighter); border-radius: var(--radius-sm); padding: var(--space-sm); margin-bottom: var(--space-md);">
                    <div style="display: flex; justify-content: space-between; font-size: 0.85rem;">
                        <span>Pokok: ${formatCurrency(anggota.simpananPokok)}</span>
                        <span>Wajib: ${formatCurrency(anggota.simpananWajib)}</span>
                        <span>Sukarela: ${formatCurrency(anggota.simpananSukarela)}</span>
                    </div>
                </div>
                
                <div class="card-actions">
                    <button class="action-btn" onclick="showPenerimaDetail('${anggota.id}')">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Detail Pembagian</span>
                    </button>
                    <button class="action-btn" onclick="printKwitansiSHU('${anggota.id}')">
                        <i class="fas fa-receipt"></i>
                        <span>Kwitansi</span>
                    </button>
                </div>
            `;
        }

        // ===== BADGE HELPERS =====
        function getBadgeClass(status) {
            switch(status.toLowerCase()) {
                case 'disetorkan': return 'badge-success';
                case 'dibagikan': return 'badge-warning';
                case 'dibayarkan': return 'badge-info';
                case 'dialokasikan': return 'badge-info';
                default: return 'badge-info';
            }
        }

        function getBadgeIcon(status) {
            switch(status.toLowerCase()) {
                case 'disetorkan': return 'fa-check-circle';
                case 'dibagikan': return 'fa-share-alt';
                case 'dibayarkan': return 'fa-money-bill-wave';
                case 'dialokasikan': return 'fa-clock';
                default: return 'fa-info-circle';
            }
        }

        // ===== DETAIL FUNCTIONS =====
        function showSHUDetail(itemId) {
            const item = shuData.find(d => d.id === itemId);
            if (!item) return;
            
            const modalHTML = createSHUDetailModal(item);
            showModal(modalHTML);
        }

        function createSHUDetailModal(item) {
            return `
                <div style="background: white; border-radius: var(--radius-lg); padding: var(--space-lg); max-width: 500px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
                        <h3 style="color: var(--primary-dark); font-size: 1.2rem;">Detail SHU</h3>
                        <button class="back-button" onclick="closeModal()" style="background: var(--gray-lighter); color: var(--gray);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md); margin-bottom: var(--space-lg);">
                        <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">Jenis Alokasi</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: var(--primary-dark);">${item.jenis}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-md); margin-bottom: var(--space-lg);">
                        <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">Persentase</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--primary);">${item.persentase}%</div>
                        </div>
                        <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">Jumlah</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--primary-dark);">${formatCurrency(item.jumlah)}</div>
                        </div>
                        <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">Status</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--primary);">${item.status}</div>
                        </div>
                        <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">Tanggal</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--primary-dark);">${item.tanggal}</div>
                        </div>
                    </div>
                    
                    <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-md); margin-bottom: var(--space-lg);">
                        <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 8px;">Deskripsi</div>
                        <div style="color: var(--dark); line-height: 1.6;">${item.deskripsi}</div>
                    </div>
                    
                    <div style="display: flex; gap: var(--space-sm);">
                        <button class="btn btn-primary" style="flex: 1;" onclick="printSHUItem('${item.id}')">
                            <i class="fas fa-print"></i>
                            Cetak Detail
                        </button>
                        <button class="btn btn-outline" onclick="closeModal()">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
        }

        function showPenerimaDetail(anggotaId) {
            const anggota = penerimaData.find(a => a.id === anggotaId);
            if (!anggota) return;
            
            const modalHTML = createPenerimaDetailModal(anggota);
            showModal(modalHTML);
        }

        function createPenerimaDetailModal(anggota) {
            return `
                <div style="background: white; border-radius: var(--radius-lg); padding: var(--space-lg); max-width: 500px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
                        <h3 style="color: var(--primary-dark); font-size: 1.2rem;">Detail Penerima SHU</h3>
                        <button class="back-button" onclick="closeModal()" style="background: var(--gray-lighter); color: var(--gray);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md); margin-bottom: var(--space-lg);">
                        <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">Nama Anggota</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: var(--primary-dark);">${anggota.nama}</div>
                        <div style="font-size: 0.9rem; color: var(--gray); margin-top: 4px;">No. Anggota: ${anggota.noAnggota}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-md); margin-bottom: var(--space-lg);">
                        <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">Total Simpanan</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--primary-dark);">${formatCurrency(anggota.totalSimpanan)}</div>
                        </div>
                        <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">SHU Diterima</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--success);">${formatCurrency(anggota.shuDiterima)}</div>
                        </div>
                        <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">Persentase</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--primary);">${anggota.persentase}%</div>
                        </div>
                        <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 4px;">Tanggal Terima</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--primary-dark);">${anggota.tanggalTerima}</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <h4 style="color: var(--primary-dark); margin-bottom: var(--space-sm);">Rincian Simpanan</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-sm);">
                            <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-sm); text-align: center;">
                                <div style="font-size: 0.8rem; color: var(--gray);">Simpanan Pokok</div>
                                <div style="font-weight: 600; color: var(--primary-dark);">${formatCurrency(anggota.simpananPokok)}</div>
                            </div>
                            <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-sm); text-align: center;">
                                <div style="font-size: 0.8rem; color: var(--gray);">Simpanan Wajib</div>
                                <div style="font-weight: 600; color: var(--primary-dark);">${formatCurrency(anggota.simpananWajib)}</div>
                            </div>
                            <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-sm); text-align: center;">
                                <div style="font-size: 0.8rem; color: var(--gray);">Simpanan Sukarela</div>
                                <div style="font-weight: 600; color: var(--primary-dark);">${formatCurrency(anggota.simpananSukarela)}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: var(--space-sm);">
                        <button class="btn btn-primary" style="flex: 1;" onclick="printKwitansiSHU('${anggota.id}')">
                            <i class="fas fa-receipt"></i>
                            Cetak Kwitansi
                        </button>
                        <button class="btn btn-outline" onclick="closeModal()">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
        }

        // ===== MODAL FUNCTIONS =====
        function showModal(content) {
            const overlay = document.createElement('div');
            overlay.id = 'modalOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                padding: var(--space-md);
                animation: fadeIn 0.3s ease;
            `;
            
            overlay.innerHTML = content;
            document.body.appendChild(overlay);
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const overlay = document.getElementById('modalOverlay');
            if (overlay) {
                overlay.remove();
            }
            document.body.style.overflow = '';
        }

        // ===== CHART FUNCTIONS =====
        function showChart() {
            const totalSHU = shuData.reduce((sum, item) => sum + (item.jumlah || 0), 0);
            
            const chartHTML = `
                <div style="background: white; border-radius: var(--radius-lg); padding: var(--space-lg); width: 95%; max-width: 500px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
                        <h3 style="color: var(--primary-dark); font-size: 1.2rem;">
                            <i class="fas fa-chart-pie"></i> Visualisasi Distribusi SHU
                        </h3>
                        <button class="back-button" onclick="closeChart()" style="background: var(--gray-lighter); color: var(--gray);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <div style="display: flex; gap: var(--space-sm); margin-bottom: var(--space-md);">
                            <button class="btn btn-sm ${chartType === 'pie' ? 'btn-primary' : 'btn-outline'}" 
                                    onclick="changeChartType('pie')">
                                <i class="fas fa-chart-pie"></i> Pie
                            </button>
                            <button class="btn btn-sm ${chartType === 'bar' ? 'btn-primary' : 'btn-outline'}" 
                                    onclick="changeChartType('bar')">
                                <i class="fas fa-chart-bar"></i> Bar
                            </button>
                            <button class="btn btn-sm ${chartType === 'doughnut' ? 'btn-primary' : 'btn-outline'}" 
                                    onclick="changeChartType('doughnut')">
                                <i class="fas fa-chart-pie"></i> Donat
                            </button>
                        </div>
                        
                        <div style="position: relative; height: 300px;">
                            <canvas id="shuChartCanvas"></canvas>
                        </div>
                        
                        <div style="text-align: center; margin-top: var(--space-md); color: var(--gray); font-size: 0.9rem;">
                            Total SHU: <strong>${formatCurrency(totalSHU)}</strong>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-sm);">
                        ${shuData.map(item => `
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--gray-lighter); border-radius: var(--radius-sm);">
                                <div style="width: 12px; height: 12px; border-radius: 2px; background: ${item.color || '#2e7d32'}"></div>
                                <div style="font-size: 0.85rem; flex: 1;">${item.jenis}</div>
                                <div style="font-weight: 600; font-size: 0.85rem;">${item.persentase}%</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            showModal(chartHTML);
            
            setTimeout(() => {
                renderChart(chartType);
            }, 100);
        }

        function renderChart(type) {
            chartType = type;
            
            const ctx = document.getElementById('shuChartCanvas').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            const labels = shuData.map(item => item.jenis);
            const data = shuData.map(item => item.jumlah);
            const colors = shuData.map(item => item.color || '#2e7d32');
            
            chartInstance = new Chart(ctx, {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: 'white',
                        borderWidth: 2,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const persentase = shuData[context.dataIndex]?.persentase || 0;
                                    return `${label}: ${formatCurrency(value)} (${persentase}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function changeChartType(type) {
            renderChart(type);
            
            // Update button states
            document.querySelectorAll('#modalOverlay .btn').forEach(btn => {
                btn.className = btn.className.replace('btn-primary', 'btn-outline');
            });
            
            const activeBtn = document.querySelector(`#modalOverlay button[onclick="changeChartType('${type}')"]`);
            if (activeBtn) {
                activeBtn.className = activeBtn.className.replace('btn-outline', 'btn-primary');
            }
        }

        function closeChart() {
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            closeModal();
        }

        // ===== PRINT FUNCTIONS =====
        function printSHUItem(itemId) {
            const item = shuData.find(d => d.id === itemId);
            if (!item) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(createPrintContent(item));
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }

        function printKwitansiSHU(anggotaId) {
            const anggota = penerimaData.find(a => a.id === anggotaId);
            if (!anggota) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(createKwitansiContent(anggota));
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }

        function printReport() {
            const tahun = currentFilter.tahun;
            const totalSHU = shuData.reduce((sum, item) => sum + (item.jumlah || 0), 0);
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(createReportContent(tahun, totalSHU));
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }

        // ===== EXPORT FUNCTIONS =====
        function exportToExcel() {
            try {
                const exportData = shuData.map(item => ({
                    'Jenis Alokasi': item.jenis,
                    'Persentase (%)': item.persentase,
                    'Jumlah (Rp)': item.jumlah,
                    'Deskripsi': item.deskripsi,
                    'Status': item.status,
                    'Sumber Dana': item.sumber,
                    'Tanggal': item.tanggal,
                    'No. Bukti': item.bukti
                }));
                
                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Laporan SHU');
                
                XLSX.writeFile(wb, `Laporan_SHU_${currentFilter.tahun}.xlsx`);
                
                showMessage('Laporan berhasil diexport ke Excel!', 'success');
                
            } catch (error) {
                console.error('Export error:', error);
                showMessage('Gagal mengekspor data!', 'error');
            }
        }

        function exportPenerimaToExcel() {
            try {
                const exportData = penerimaData.map(anggota => ({
                    'No. Anggota': anggota.noAnggota,
                    'Nama Anggota': anggota.nama,
                    'Simpanan Pokok': anggota.simpananPokok,
                    'Simpanan Wajib': anggota.simpananWajib,
                    'Simpanan Sukarela': anggota.simpananSukarela,
                    'Total Simpanan': anggota.totalSimpanan,
                    'SHU Diterima': anggota.shuDiterima,
                    'Persentase (%)': anggota.persentase,
                    'Tanggal Terima': anggota.tanggalTerima,
                    'Status': anggota.status,
                    'No. Bukti': anggota.bukti
                }));
                
                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Penerima SHU');
                
                XLSX.writeFile(wb, `Penerima_SHU_${currentFilter.tahun}.xlsx`);
                
                showMessage('Data penerima berhasil diexport ke Excel!', 'success');
                
            } catch (error) {
                console.error('Export error:', error);
                showMessage('Gagal mengekspor data penerima!', 'error');
            }
        }

        // ===== INTEGRATION FUNCTIONS =====
        function saveSHUDataToDashboard(totalSHU) {
            try {
                const dashboardSHUData = {
                    total: totalSHU,
                    dibagikan: shuData.find(item => item.jenis === 'Dana Anggota')?.jumlah || 0,
                    cadangan: shuData.find(item => item.jenis === 'Dana Cadangan')?.jumlah || 0,
                    anggota: penerimaData.length,
                    pertumbuhan: calculateGrowthPercentage(),
                    distribusi: shuData,
                    penerima: penerimaData,
                    tahun: new Date().getFullYear(),
                    tanggalHitung: new Date().toISOString()
                };
                
                localStorage.setItem('shuData', JSON.stringify(dashboardSHUData));
                
                console.log('âœ… SHU data saved to dashboard');
                
            } catch (error) {
                console.error('âŒ Error saving SHU data to dashboard:', error);
            }
        }

        function setupBidirectionalIntegration() {
            // Listen for storage changes
            window.addEventListener('storage', function(e) {
                if (e.key === 'simpananData' || e.key === 'koperasi_anggota' || e.key === 'anggotaData') {
                    console.log('ðŸ”„ Dashboard data updated, reloading SHU...');
                    
                    setTimeout(() => {
                        loadData();
                        showMessage('Data diperbarui dari dashboard', 'info');
                    }, 1000);
                }
            });
            
            // Periodic sync (every 30 seconds)
            setInterval(() => {
                if (!isLoading) {
                    console.log('â° Periodic sync...');
                    loadDataFromDashboard();
                }
            }, 30000);
        }

        // ===== UTILITY FUNCTIONS =====
        function formatCurrency(amount) {
            if (isNaN(amount) || amount === null || amount === undefined) {
                return 'Rp 0';
            }
            return 'Rp ' + parseInt(amount).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function terbilang(angka) {
            // Fungsi sederhana untuk terbilang
            const bilangan = ['', 'satu', 'dua', 'tiga', 'empat', 'lima', 'enam', 'tujuh', 'delapan', 'sembilan', 'sepuluh', 'sebelas'];
            
            angka = parseInt(angka);
            if (angka < 12) {
                return bilangan[angka];
            } else if (angka < 20) {
                return terbilang(angka - 10) + ' belas';
            } else if (angka < 100) {
                return terbilang(Math.floor(angka / 10)) + ' puluh ' + terbilang(angka % 10);
            } else if (angka < 200) {
                return 'seratus ' + terbilang(angka - 100);
            } else if (angka < 1000) {
                return terbilang(Math.floor(angka / 100)) + ' ratus ' + terbilang(angka % 100);
            } else if (angka < 2000) {
                return 'seribu ' + terbilang(angka - 1000);
            } else if (angka < 1000000) {
                return terbilang(Math.floor(angka / 1000)) + ' ribu ' + terbilang(angka % 1000);
            } else if (angka < 1000000000) {
                return terbilang(Math.floor(angka / 1000000)) + ' juta ' + terbilang(angka % 1000000);
            }
            
            return 'jumlah besar';
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = show ? 'flex' : 'none';
                overlay.style.opacity = show ? '1' : '0';
            }
        }

        function showMessage(message, type = 'info') {
            // Remove existing message
            const existingMsg = document.getElementById('flashMessage');
            if (existingMsg) existingMsg.remove();
            
            // Create message element
            const msg = document.createElement('div');
            msg.id = 'flashMessage';
            msg.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#2196f3'};
                color: white;
                padding: 12px 20px;
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-lg);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                display: flex;
                align-items: center;
                gap: 10px;
                max-width: 300px;
            `;
            
            msg.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(msg);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (msg.parentNode) {
                    msg.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (msg.parentNode) msg.parentNode.removeChild(msg);
                    }, 300);
                }
            }, 3000);
        }

        function goBackToDashboard() {
            window.location.href = 'dashboard-admin.html';
        }

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            // Filter button
            document.getElementById('applyFilterBtn').addEventListener('click', applyFilter);
            
            // Reset filter button
            document.getElementById('resetFilterBtn').addEventListener('click', function() {
                document.getElementById('tahunSHU').value = new Date().getFullYear().toString();
                document.getElementById('periodeSHU').value = 'tahunan';
                document.getElementById('statusSHU').value = 'all';
                applyFilter();
                showMessage('Filter direset ke default', 'info');
            });
            
            // Export buttons
            document.getElementById('exportBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportPenerimaBtn').addEventListener('click', exportPenerimaToExcel);
            document.getElementById('printBtn').addEventListener('click', printReport);
            
            // Refresh data
            document.getElementById('refreshDataBtn').addEventListener('click', function() {
                loadData();
            });
            
            // View chart
            document.getElementById('viewChartBtn').addEventListener('click', showChart);
            
            // Export PDF (placeholder)
            document.getElementById('exportPdfBtn').addEventListener('click', function() {
                showMessage('Fitur export PDF akan segera tersedia', 'info');
            });
            
            // Auto-apply filter on select change
            document.getElementById('tahunSHU').addEventListener('change', applyFilter);
            document.getElementById('periodeSHU').addEventListener('change', applyFilter);
            document.getElementById('statusSHU').addEventListener('change', applyFilter);
            
            // Touch events for mobile
            document.querySelectorAll('.action-btn, .btn').forEach(btn => {
                btn.addEventListener('touchstart', function() {
                    this.style.transform = 'translateY(1px)';
                });
                
                btn.addEventListener('touchend', function() {
                    this.style.transform = '';
                });
            });
        }

        // ===== PRINT CONTENT GENERATORS =====
        function createPrintContent(item) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Detail SHU - ${item.jenis}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #2e7d32; padding-bottom: 20px; }
                        h1 { color: #2e7d32; font-size: 24px; }
                        .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
                        .info-item { background: #f5f5f5; padding: 15px; border-radius: 8px; }
                        .footer { margin-top: 30px; text-align: center; color: #666; font-size: 12px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>KOPERASI ASMARA TANI</h1>
                        <h2>Detail Distribusi SHU</h2>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Jenis Alokasi</strong><br>
                            ${item.jenis}
                        </div>
                        <div class="info-item">
                            <strong>Jumlah</strong><br>
                            ${formatCurrency(item.jumlah)}
                        </div>
                        <div class="info-item">
                            <strong>Persentase</strong><br>
                            ${item.persentase}%
                        </div>
                        <div class="info-item">
                            <strong>Status</strong><br>
                            ${item.status}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <strong>Deskripsi:</strong>
                        <p>${item.deskripsi}</p>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <strong>Informasi Tambahan:</strong>
                        <p>No. Bukti: ${item.bukti}</p>
                        <p>Tanggal: ${item.tanggal}</p>
                        <p>Sumber: ${item.sumber}</p>
                    </div>
                    
                    <div class="footer">
                        <p>Dicetak dari Sistem Laporan SHU - Koperasi Asmara Tani</p>
                        <p>Tanggal cetak: ${new Date().toLocaleDateString('id-ID')}</p>
                    </div>
                </body>
                </html>
            `;
        }

        function createKwitansiContent(anggota) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Kwitansi SHU - ${anggota.nama}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #2e7d32; padding-bottom: 20px; }
                        h1 { color: #2e7d32; font-size: 24px; }
                        h2 { color: #333; font-size: 20px; margin-bottom: 5px; }
                        .content { margin: 30px 0; }
                        .info-item { margin-bottom: 10px; }
                        .info-label { font-weight: bold; color: #666; width: 200px; display: inline-block; }
                        .amount { font-size: 28px; font-weight: bold; color: #2e7d32; text-align: center; margin: 30px 0; }
                        .signature { margin-top: 50px; display: flex; justify-content: space-between; }
                        .signature-box { width: 300px; text-align: center; }
                        .signature-line { border-top: 1px solid #000; width: 200px; margin: 0 auto; padding-top: 10px; }
                        .footer { margin-top: 30px; text-align: center; color: #666; font-size: 12px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>KOPERASI ASMARA TANI</h1>
                        <h2>BUKTI PENERIMAAN SHU</h2>
                        <p>Tahun Anggaran ${new Date().getFullYear()}</p>
                    </div>
                    
                    <div class="content">
                        <div class="info-item">
                            <span class="info-label">No. Kwitansi:</span> ${anggota.bukti}
                        </div>
                        <div class="info-item">
                            <span class="info-label">Tanggal:</span> ${anggota.tanggalTerima}
                        </div>
                        <div class="info-item">
                            <span class="info-label">Nama Anggota:</span> ${anggota.nama}
                        </div>
                        <div class="info-item">
                            <span class="info-label">No. Anggota:</span> ${anggota.noAnggota}
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total Simpanan:</span> ${formatCurrency(anggota.totalSimpanan)}
                        </div>
                        <div class="info-item">
                            <span class="info-label">Persentase SHU:</span> ${anggota.persentase}%
                        </div>
                        
                        <div class="amount">
                            Jumlah SHU yang diterima:<br>
                            ${formatCurrency(anggota.shuDiterima)}
                        </div>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <p>Terbilang: <em>${terbilang(anggota.shuDiterima)} rupiah</em></p>
                        </div>
                    </div>
                    
                    <div class="signature">
                        <div class="signature-box">
                            <p>Penerima,</p>
                            <div class="signature-line"></div>
                            <p><strong>${anggota.nama}</strong></p>
                        </div>
                        <div class="signature-box">
                            <p>Bendahara Koperasi,</p>
                            <div class="signature-line"></div>
                            <p><strong>Koperasi Asmara Tani</strong></p>
                        </div>
                    </div>
                    
                    <div class="footer">
                        <p>Kwitansi ini sebagai bukti sah penerimaan Sisa Hasil Usaha</p>
                        <p>Dicetak dari Sistem Laporan SHU - ${new Date().toLocaleDateString('id-ID')}</p>
                    </div>
                </body>
                </html>
            `;
        }

        function createReportContent(tahun, totalSHU) {
            let tableRows = '';
            shuData.forEach((item, index) => {
                tableRows += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.jenis}</td>
                        <td>${item.persentase}%</td>
                        <td>${formatCurrency(item.jumlah)}</td>
                        <td>${item.status}</td>
                    </tr>
                `;
            });
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Laporan SHU ${tahun}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        h1 { color: #2e7d32; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th { background: #2e7d32; color: white; padding: 12px; text-align: left; }
                        td { padding: 10px; border-bottom: 1px solid #ddd; }
                        .footer { margin-top: 30px; text-align: center; color: #666; font-size: 12px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>KOPERASI ASMARA TANI</h1>
                        <h2>LAPORAN SISA HASIL USAHA (SHU)</h2>
                        <p>Tahun ${tahun} | Total SHU: ${formatCurrency(totalSHU)}</p>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Jenis Alokasi</th>
                                <th>Persentase</th>
                                <th>Jumlah</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p>Dicetak dari Sistem Laporan SHU</p>
                        <p>Tanggal cetak: ${new Date().toLocaleDateString('id-ID')}</p>
                    </div>
                </body>
                </html>
            `;
        }

        // ===== SWIPE SUPPORT =====
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', function(e) {
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const diffX = touchStartX - touchEndX;
            const diffY = touchStartY - touchEndY;
            
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                if (diffX > 0) {
                    // Swipe left
                    console.log('Swiped left');
                } else {
                    // Swipe right - back to dashboard
                    goBackToDashboard();
                }
            }
        });

        // ===== DEBUG FUNCTIONS =====
        window.debugSHULaporan = function() {
            console.log('=== DEBUG LAPORAN SHU ===');
            console.log('SHU Data:', shuData);
            console.log('Penerima Data:', penerimaData);
            console.log('Current Filter:', currentFilter);
            console.log('Dashboard Data:', JSON.parse(localStorage.getItem('shuData') || '{}'));
            console.log('=== END DEBUG ===');
        };

    </script>
</body>
</html>

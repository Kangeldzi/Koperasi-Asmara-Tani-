<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Laporan SHU - Koperasi Asmara Tani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* ===== VARIABEL DESAIN MOBILE FIRST ===== */
        :root {
            /* Warna utama */
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary: #ff9800;
            --accent: #00bcd4;
            --info: #2196f3;
            --success: #4caf50;
            --warning: #ffc107;
            --danger: #f44336;
            
            /* Neutral colors */
            --dark: #121212;
            --light: #ffffff;
            --gray: #757575;
            --gray-light: #e0e0e0;
            --gray-lighter: #f5f5f5;
            
            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            
            /* Spacing */
            --space-xs: 8px;
            --space-sm: 12px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            
            /* Border radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }
        
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 14px;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f8f9fa;
            color: var(--dark);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ===== CONTAINER MOBILE OPTIMIZED ===== */
        .mobile-container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            overflow-x: hidden;
        }
        
        /* ===== HEADER SECTION ===== */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: var(--space-lg) var(--space-md);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-md);
        }
        
        .header-title {
            flex: 1;
        }
        
        .header-title h1 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 4px;
            line-height: 1.3;
        }
        
        .header-title p {
            font-size: 0.85rem;
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .back-button {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }
        
        /* ===== FILTER SECTION - MOBILE FRIENDLY ===== */
        .filter-section {
            background: white;
            margin: var(--space-md);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
        }
        
        .filter-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }
        
        .filter-title i {
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .filter-title h2 {
            font-size: 1.1rem;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .filter-grid {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
            margin-bottom: var(--space-sm);
        }
        
        .filter-group {
            flex: 1;
            min-width: calc(50% - 8px);
        }
        
        .filter-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray);
            margin-bottom: 6px;
        }
        
        .filter-select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            background: white;
            color: var(--dark);
            transition: all 0.2s ease;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }
        
        .filter-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }
        
        /* ===== STATS SECTION - MOBILE OPTIMIZED ===== */
        .stats-section {
            padding: 0 var(--space-md) var(--space-md);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--primary-light));
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }
        
        .stat-title {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 500;
            line-height: 1.4;
        }
        
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: rgba(46, 125, 50, 0.1);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 4px;
            line-height: 1.2;
        }
        
        .stat-detail {
            font-size: 0.8rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 6px;
        }
        
        /* ===== TABLE SECTION - MOBILE OPTIMIZED ===== */
        .table-section {
            padding: 0 var(--space-md) var(--space-md);
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding: 0 var(--space-sm);
        }
        
        .table-header h2 {
            font-size: 1.1rem;
            color: var(--primary-dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .table-actions {
            display: flex;
            gap: var(--space-sm);
        }
        
        /* ===== TABEL UTAMA - DESAIN MOBILE FIRST ===== */
        .responsive-table {
            width: 100%;
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0;
        }
        
        .mobile-table {
            width: 100%;
            min-width: 320px;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .mobile-table thead {
            display: none; /* Sembunyikan header di mobile */
        }
        
        .mobile-table tbody tr {
            display: block;
            border-bottom: 1px solid var(--gray-lighter);
            padding: var(--space-md);
            transition: background-color 0.2s ease;
        }
        
        .mobile-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .mobile-table tbody tr:hover {
            background-color: rgba(46, 125, 50, 0.02);
        }
        
        .mobile-table td {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border: none;
            position: relative;
        }
        
        .mobile-table td::before {
            content: attr(data-label);
            font-weight: 600;
            color: var(--gray);
            font-size: 0.85rem;
            min-width: 100px;
            padding-right: var(--space-sm);
        }
        
        .mobile-table td .cell-content {
            flex: 1;
            text-align: right;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* ===== CARD VIEW UNTUK TABEL - ALTERNATIF MOBILE ===== */
        .card-view {
            display: none; /* Akan diaktifkan di media query mobile */
        }
        
        .shu-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-md);
        }
        
        .card-title {
            flex: 1;
        }
        
        .card-title h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 4px;
        }
        
        .card-badge {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(46, 125, 50, 0.1);
            color: var(--primary);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: var(--space-sm);
        }
        
        .card-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .card-item {
            display: flex;
            flex-direction: column;
        }
        
        .card-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 4px;
        }
        
        .card-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .card-actions {
            display: flex;
            gap: var(--space-sm);
            justify-content: flex-end;
            padding-top: var(--space-md);
            border-top: 1px solid var(--gray-lighter);
        }
        
        /* ===== BUTTONS - MOBILE FRIENDLY ===== */
        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            min-height: 44px; /* Touch-friendly */
            min-width: 44px; /* Touch-friendly */
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.2);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            box-shadow: 0 6px 16px rgba(46, 125, 50, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #ffb74d);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 0.85rem;
            min-height: 36px;
            min-width: 36px;
        }
        
        .btn-icon {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ===== BADGES ===== */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            line-height: 1;
        }
        
        .badge-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #e6a700;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .badge-info {
            background-color: rgba(33, 150, 243, 0.1);
            color: var(--info);
            border: 1px solid rgba(33, 150, 243, 0.2);
        }
        
        /* ===== ACTION BUTTONS ===== */
        .action-buttons {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 12px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-sm);
            background: white;
            color: var(--gray);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            background: var(--gray-lighter);
            color: var(--primary);
            border-color: var(--primary-light);
        }
        
        /* ===== FOOTER ===== */
        .footer {
            background: white;
            padding: var(--space-lg) var(--space-md);
            text-align: center;
            color: var(--gray);
            font-size: 0.85rem;
            border-top: 1px solid var(--gray-lighter);
            margin-top: var(--space-xl);
        }
        
        /* ===== UTILITY CLASSES ===== */
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .text-primary {
            color: var(--primary);
        }
        
        .text-success {
            color: var(--success);
        }
        
        .fw-bold {
            font-weight: 700;
        }
        
        .d-flex {
            display: flex;
        }
        
        .align-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .mb-1 { margin-bottom: var(--space-xs); }
        .mb-2 { margin-bottom: var(--space-sm); }
        .mb-3 { margin-bottom: var(--space-md); }
        .mb-4 { margin-bottom: var(--space-lg); }
        .mb-5 { margin-bottom: var(--space-xl); }
        
        .mt-1 { margin-top: var(--space-xs); }
        .mt-2 { margin-top: var(--space-sm); }
        .mt-3 { margin-top: var(--space-md); }
        .mt-4 { margin-top: var(--space-lg); }
        .mt-5 { margin-top: var(--space-xl); }
        
        /* ===== MEDIA QUERIES ===== */
        
        /* Tablet (768px ke atas) */
        @media screen and (min-width: 768px) {
            html {
                font-size: 15px;
            }
            
            .mobile-container {
                max-width: 720px;
                padding: 0 var(--space-md);
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .filter-row {
                flex-wrap: nowrap;
            }
            
            .filter-group {
                min-width: auto;
            }
            
            /* Tampilkan tabel biasa di tablet */
            .mobile-table thead {
                display: table-header-group;
            }
            
            .mobile-table thead th {
                background: rgba(46, 125, 50, 0.05);
                color: var(--primary-dark);
                font-weight: 600;
                padding: 14px 16px;
                text-align: left;
                font-size: 0.9rem;
                border-bottom: 2px solid var(--primary-light);
            }
            
            .mobile-table tbody tr {
                display: table-row;
                padding: 0;
            }
            
            .mobile-table td {
                display: table-cell;
                padding: 14px 16px;
                border-bottom: 1px solid var(--gray-lighter);
                text-align: left;
            }
            
            .mobile-table td::before {
                display: none;
            }
            
            .mobile-table td .cell-content {
                text-align: left;
            }
            
            /* Sembunyikan card view di tablet */
            .card-view {
                display: none;
            }
        }
        
        /* Desktop (992px ke atas) */
        @media screen and (min-width: 992px) {
            .mobile-container {
                max-width: 960px;
            }
            
            .header {
                padding: var(--space-xl) var(--space-lg);
            }
            
            .header-title h1 {
                font-size: 1.5rem;
            }
            
            .stats-section,
            .table-section {
                padding: 0 var(--space-lg) var(--space-lg);
            }
            
            .filter-section {
                margin: var(--space-lg);
                padding: var(--space-xl);
            }
        }
        
        /* Mobile Landscape */
        @media screen and (max-width: 767px) and (orientation: landscape) {
            .mobile-table tbody tr {
                padding: var(--space-sm);
            }
            
            .stat-card {
                padding: var(--space-md);
            }
            
            .filter-section {
                margin: var(--space-sm);
                padding: var(--space-md);
            }
        }
        
        /* Small Mobile (360px ke bawah) */
        @media screen and (max-width: 360px) {
            html {
                font-size: 13px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }
            
            .stat-card {
                padding: var(--space-md);
            }
            
            .mobile-table td {
                flex-direction: column;
                align-items: flex-start;
                padding: 8px 0;
            }
            
            .mobile-table td::before {
                margin-bottom: 4px;
                min-width: auto;
            }
            
            .mobile-table td .cell-content {
                text-align: left;
                width: 100%;
            }
            
            /* Aktifkan card view di mobile kecil */
            .table-container {
                display: none;
            }
            
            .card-view {
                display: block;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        /* Loading state */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--gray-lighter);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <!-- MOBILE CONTAINER -->
    <div class="mobile-container">
        
        <!-- HEADER -->
        <header class="header">
            <div class="header-content">
                <button class="back-button" onclick="window.history.back()" aria-label="Kembali">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="header-title">
                    <h1>Laporan SHU</h1>
                    <p>Sisa Hasil Usaha - Koperasi Asmara Tani</p>
                </div>
                <button class="back-button" onclick="refreshData()" title="Refresh Data" style="background: rgba(255,255,255,0.25);">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </header>
        
        <!-- FILTER SECTION -->
        <section class="filter-section">
            <div class="filter-title">
                <i class="fas fa-filter"></i>
                <h2>Filter Laporan</h2>
            </div>
            
            <div class="filter-grid">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Tahun</label>
                        <select class="filter-select" id="tahunSHU">
                            <option value="2025">2025</option>
                            <option value="2026" selected>2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Periode</label>
                        <select class="filter-select" id="periodeSHU">
                            <option value="tahunan">Tahunan</option>
                            <option value="semester1">Semester 1</option>
                            <option value="semester2">Semester 2</option>
                            <option value="triwulan1">Triwulan 1</option>
                            <option value="triwulan2">Triwulan 2</option>
                            <option value="triwulan3">Triwulan 3</option>
                            <option value="triwulan4">Triwulan 4</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Status</label>
                        <select class="filter-select" id="statusSHU">
                            <option value="all">Semua Status</option>
                            <option value="dibagikan">Sudah Dibagikan</option>
                            <option value="dialokasikan">Dialokasikan</option>
                            <option value="disetorkan">Disetorkan</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button class="btn btn-primary" id="applyFilterBtn" style="flex: 1;">
                        <i class="fas fa-sync-alt"></i>
                        <span>Terapkan Filter</span>
                    </button>
                    <button class="btn btn-outline btn-icon" id="resetFilterBtn" title="Reset Filter">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
            </div>
        </section>
        
        <!-- STATS SECTION -->
        <section class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Total SHU Tahun Ini</div>
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalSHUDisplay">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-arrow-up text-success"></i>
                        <span id="growthPercent">0%</span> dari tahun lalu
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">SHU Dibagikan ke Anggota</div>
                        <div class="stat-icon">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="shuAnggotaDisplay">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-users"></i>
                        <span id="jumlahAnggotaSHU">0</span> anggota aktif
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Dana Cadangan</div>
                        <div class="stat-icon">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="danaCadanganDisplay">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-percentage"></i>
                        20% dari total SHU
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Rata-rata per Anggota</div>
                        <div class="stat-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="rataRataSHU">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-chart-line"></i>
                        Berdasarkan simpanan
                    </div>
                </div>
            </div>
        </section>
        
        <!-- TABLE SECTION - DISTRIBUSI SHU -->
        <section class="table-section">
            <div class="table-header">
                <h2>
                    <i class="fas fa-chart-pie"></i>
                    Distribusi SHU
                </h2>
                <div class="table-actions">
                    <button class="btn btn-outline btn-sm" id="exportBtn" title="Export Excel">
                        <i class="fas fa-file-excel"></i>
                    </button>
                    <button class="btn btn-outline btn-sm" id="printBtn" title="Print">
                        <i class="fas fa-print"></i>
                    </button>
                </div>
            </div>
            
            <!-- TABLE CONTAINER -->
            <div class="table-container">
                <table class="mobile-table">
                    <thead>
                        <tr>
                            <th>Jenis Alokasi</th>
                            <th>Persentase</th>
                            <th>Jumlah</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="shuTableBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- CARD VIEW (untuk mobile kecil) -->
            <div class="card-view" id="shuCardView">
                <!-- Data akan diisi oleh JavaScript -->
            </div>
        </section>
        
        <!-- DAFTAR PENERIMA SHU SECTION -->
        <section class="table-section">
            <div class="table-header">
                <h2>
                    <i class="fas fa-users"></i>
                    Daftar Penerima SHU per Anggota
                </h2>
                <div class="table-actions">
                    <button class="btn btn-outline btn-sm" id="exportPenerimaBtn" title="Export Excel">
                        <i class="fas fa-file-excel"></i>
                    </button>
                </div>
            </div>
            
            <!-- STATS PENERIMA -->
            <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr); margin-bottom: var(--space-lg);">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Total Anggota Aktif</div>
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalAnggotaPenerima">0</div>
                    <div class="stat-detail">
                        <i class="fas fa-check-circle text-success"></i>
                        Menerima SHU
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Total Simpanan</div>
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalSimpananSemua">Rp 0</div>
                    <div class="stat-detail">
                        <i class="fas fa-calculator"></i>
                        Dasar perhitungan SHU
                    </div>
                </div>
            </div>
            
            <!-- CARD VIEW UNTUK PENERIMA -->
            <div class="card-view" id="penerimaCardView">
                <!-- Data akan diisi oleh JavaScript -->
            </div>
        </section>
        
        <!-- ACTION BUTTONS -->
        <section class="table-section">
            <div class="action-buttons">
                <button class="action-btn" id="refreshDataBtn">
                    <i class="fas fa-sync-alt"></i>
                    <span>Refresh Data</span>
                </button>
                <button class="action-btn" id="exportExcelBtn">
                    <i class="fas fa-file-excel"></i>
                    <span>Export Excel</span>
                </button>
                <button class="action-btn" id="exportPdfBtn">
                    <i class="fas fa-file-pdf"></i>
                    <span>Export PDF</span>
                </button>
                <button class="action-btn" id="viewChartBtn">
                    <i class="fas fa-chart-bar"></i>
                    <span>Lihat Chart</span>
                </button>
                <button class="action-btn" id="syncDashboardBtn">
                    <i class="fas fa-database"></i>
                    <span>Sinkron Dashboard</span>
                </button>
            </div>
        </section>
        
        <!-- FOOTER -->
        <footer class="footer">
            <p>Â© 2026 Koperasi Asmara Tani</p>
            <p>Data diambil dari Dashboard Admin & Akun Anggota</p>
            <p id="lastSyncInfo" style="font-size: 0.75rem; color: var(--gray-light); margin-top: 5px;">Terakhir sinkron: -</p>
        </footer>
    </div>
    
    <script>
        // ===== DATA UTAMA =====
        let anggotaData = [];
        let pinjamanData = [];
        let transaksiData = [];
        let shuData = [];
        let penerimaData = [];
        
        let currentFilter = {
            tahun: '2026',
            periode: 'tahunan',
            status: 'all'
        };
        
        let chartInstance = null;
        let chartType = 'pie';

        // ===== KONSTANTA SHU =====
        const SHU_CONFIG = {
            // Persentase distribusi SHU berdasarkan AD/ART
            distribusi: {
                'Dana Cadangan': 20,
                'Dana Anggota': 60,
                'Dana Pengurus': 10,
                'Dana Pendidikan': 5,
                'Dana Sosial': 5
            },
            // Tingkat pertumbuhan per tahun (simulasi)
            growthRate: {
                '2025': 8.5,
                '2026': 12.3,
                '2027': 15.7,
                '2028': 18.2
            }
        };

        // ===== INITIALIZE APP =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸ“± SHU Report - Mengambil data dari Dashboard...');
            
            // Update tombol back
            document.querySelector('.back-button').onclick = function() {
                if (window.history.length > 1) {
                    window.history.back();
                } else {
                    window.location.href = 'dashboard-admin.html';
                }
            };
            
            // Load data dari localStorage (dashboard & akun anggota)
            loadDataFromLocalStorage();
            
            // Hitung SHU berdasarkan data real
            calculateSHU();
            
            // Setup event listeners
            setupEventListeners();
            
            // Tampilkan data
            displayData();
            displayPenerimaData();
            
            updateLastSyncTime();
            
            console.log('âœ… SHU Report siap dengan', anggotaData.length, 'anggota');
        });

        // ===== LOAD DATA REAL DARI LOCALSTORAGE =====
        function loadDataFromLocalStorage() {
            try {
                // 1. Ambil data anggota dari berbagai sumber
                const possibleSources = [
                    { key: 'koperasi_anggota', type: 'array' },
                    { key: 'koperasi_users', type: 'object' },
                    { key: 'dashboardData', type: 'object' },
                    { key: 'koperasi_current_user', type: 'object' },
                    { key: 'registered_users', type: 'array' }
                ];
                
                let allMembers = [];
                
                possibleSources.forEach(source => {
                    try {
                        const data = localStorage.getItem(source.key);
                        if (data) {
                            const parsed = JSON.parse(data);
                            
                            if (source.type === 'array' && Array.isArray(parsed)) {
                                allMembers = [...allMembers, ...parsed];
                            } else if (source.type === 'object' && typeof parsed === 'object') {
                                // Jika object, ambil nilai-nilainya
                                Object.values(parsed).forEach(value => {
                                    if (value && typeof value === 'object' && (value.nama || value.email)) {
                                        allMembers.push(value);
                                    }
                                });
                            }
                        }
                    } catch (e) {
                        console.log(`Error parsing ${source.key}:`, e);
                    }
                });
                
                // Hapus duplikat berdasarkan email
                const uniqueMembers = [];
                const seen = new Set();
                
                allMembers.forEach(member => {
                    const email = member.email || member.id || '';
                    if (email && !seen.has(email)) {
                        seen.add(email);
                        uniqueMembers.push(member);
                    }
                });
                
                // Filter hanya anggota dengan data valid
                anggotaData = uniqueMembers.filter(m => m.nama || m.email).map((m, index) => ({
                    id: m.nia || m.id || `AGT-${String(index + 1).padStart(3, '0')}`,
                    nia: m.nia || `#01-2026-${String(index + 1).padStart(3, '0')}`,
                    nama: m.nama || m.name || `Anggota ${index + 1}`,
                    email: m.email || `anggota${index + 1}@koperasi.com`,
                    posisi: m.posisi || m.role || 'Anggota Biasa',
                    status: m.status || m.status_aktif || 'Aktif',
                    
                    // Data simpanan (ambil dari berbagai field)
                    simpananPokok: parseFloat(m.simpananPokok || m.simpanan_pokok || 200000) || 200000,
                    simpananWajib: parseFloat(m.simpananWajib || m.simpanan_wajib || (index + 1) * 20000) || (index + 1) * 20000,
                    simpananSukarela: parseFloat(m.simpananSukarela || m.simpanan_sukarela || index * 100000) || index * 100000,
                    
                    // Data pinjaman
                    totalPinjaman: parseFloat(m.totalPinjaman || m.total_pinjaman || 0) || 0,
                    
                    // Metadata
                    tanggalBergabung: m.tanggalBergabung || m.tanggal_bergabung || m.created_at || '2020-01-01'
                }));
                
                // Hitung total simpanan
                anggotaData = anggotaData.map(a => ({
                    ...a,
                    totalSimpanan: a.simpananPokok + a.simpananWajib + a.simpananSukarela
                }));
                
                // Filter hanya anggota aktif
                anggotaData = anggotaData.filter(a => 
                    a.status === 'Aktif' || a.status === 'aktif' || !a.status
                );
                
                console.log(`âœ… Berhasil memuat ${anggotaData.length} anggota dari localStorage`);
                
            } catch (error) {
                console.error('âŒ Error loading data:', error);
                // Data dummy jika tidak ada data real
                generateDummyData();
            }
        }

        // ===== GENERATE DUMMY DATA (FALLBACK) =====
        function generateDummyData() {
            console.log('ðŸ“ Generating dummy data...');
            
            const names = ['Budi Santoso', 'Siti Rahayu', 'Agus Wijaya', 'Dewi Lestari', 
                          'Hendra Gunawan', 'Rina Marlina', 'Eko Prasetyo', 'Maya Sari'];
            
            anggotaData = names.map((name, index) => ({
                id: `AGT-${String(index + 1).padStart(3, '0')}`,
                nia: `#01-2026-${String(index + 1).padStart(3, '0')}`,
                nama: name,
                email: `anggota${index + 1}@koperasi.com`,
                posisi: index < 2 ? 'Pengurus' : 'Anggota Biasa',
                status: 'Aktif',
                simpananPokok: 200000,
                simpananWajib: 20000 * (index + 1),
                simpananSukarela: 100000 * index,
                totalPinjaman: index % 2 === 0 ? 1000000 * (index + 1) : 0,
                tanggalBergabung: `2020-${String(index + 1).padStart(2, '0')}-01`
            }));
            
            anggotaData = anggotaData.map(a => ({
                ...a,
                totalSimpanan: a.simpananPokok + a.simpananWajib + a.simpananSukarela
            }));
        }

        // ===== HITUNG SHU BERDASARKAN DATA REAL =====
        function calculateSHU() {
            const tahun = parseInt(currentFilter.tahun);
            const growthMultiplier = 1 + (SHU_CONFIG.growthRate[currentFilter.tahun] || 12.3) / 100;
            
            // Hitung total simpanan semua anggota
            const totalSimpananSemua = anggotaData.reduce((sum, a) => sum + a.totalSimpanan, 0);
            
            // Hitung total SHU (simulasi berdasarkan total simpanan)
            // Asumsi: SHU = 10% dari total simpanan + faktor pertumbuhan
            const baseSHU = totalSimpananSemua * 0.1; // 10% dari total simpanan
            const totalSHU = Math.round(baseSHU * growthMultiplier);
            
            // Distribusi SHU berdasarkan persentase
            shuData = Object.entries(SHU_CONFIG.distribusi).map(([jenis, persentase], index) => {
                const jumlah = Math.round(totalSHU * persentase / 100);
                let status = 'Dialokasikan';
                
                if (jenis === 'Dana Anggota') status = 'Dibagikan';
                else if (jenis === 'Dana Cadangan') status = 'Disetorkan';
                else if (jenis === 'Dana Pengurus') status = 'Dibayarkan';
                
                return {
                    id: `SHU-${String(index + 1).padStart(3, '0')}`,
                    jenis: jenis,
                    persentase: persentase,
                    jumlah: jumlah,
                    deskripsi: getDeskripsiSHU(jenis),
                    status: status,
                    sumber: 'SHU Tahun Berjalan',
                    tanggal: `${tahun}-12-31`,
                    bukti: `SHU-${jenis.substring(0,3)}-${tahun}`,
                    color: getColorForJenis(jenis)
                };
            });
            
            // Hitung SHU per anggota (proporsional berdasarkan simpanan)
            penerimaData = anggotaData.filter(a => a.status === 'Aktif').map((anggota, index) => {
                const proporsi = anggota.totalSimpanan / totalSimpananSemua;
                const shuAnggota = shuData.find(d => d.jenis === 'Dana Anggota')?.jumlah || 0;
                const shuDiterima = Math.round(shuAnggota * proporsi);
                
                return {
                    id: anggota.id || `P-${String(index + 1).padStart(3, '0')}`,
                    nia: anggota.nia,
                    nama: anggota.nama,
                    noAnggota: anggota.id || anggota.nia || `AGT-${String(index + 1).padStart(3, '0')}`,
                    simpananPokok: anggota.simpananPokok,
                    simpananWajib: anggota.simpananWajib,
                    simpananSukarela: anggota.simpananSukarela,
                    totalSimpanan: anggota.totalSimpanan,
                    shuDiterima: shuDiterima,
                    persentase: parseFloat((proporsi * 100).toFixed(2)),
                    tanggalTerima: `${tahun}-12-20`,
                    status: 'Diterima',
                    bukti: `SHU-${anggota.id || index + 1}-${tahun}`
                };
            });
            
            // Update stats
            updateStats(totalSHU, totalSimpananSemua);
        }

        function getDeskripsiSHU(jenis) {
            const deskripsi = {
                'Dana Cadangan': 'Dana cadangan untuk pengembangan koperasi dan antisipasi risiko',
                'Dana Anggota': 'Dibagikan kepada anggota sesuai proporsi simpanan masing-masing',
                'Dana Pengurus': 'Honorarium dan insentif untuk pengurus koperasi',
                'Dana Pendidikan': 'Program pendidikan dan pelatihan untuk anggota',
                'Dana Sosial': 'Kegiatan sosial dan bantuan kemasyarakatan'
            };
            return deskripsi[jenis] || 'Alokasi SHU sesuai AD/ART';
        }

        function getColorForJenis(jenis) {
            const colors = {
                'Dana Cadangan': '#2e7d32',
                'Dana Anggota': '#2196f3',
                'Dana Pengurus': '#ff9800',
                'Dana Pendidikan': '#00bcd4',
                'Dana Sosial': '#ff5722'
            };
            return colors[jenis] || '#2e7d32';
        }

        // ===== UPDATE STATISTICS =====
        function updateStats(totalSHU, totalSimpananSemua) {
            const shuAnggota = shuData.find(d => d.jenis === 'Dana Anggota')?.jumlah || 0;
            const danaCadangan = shuData.find(d => d.jenis === 'Dana Cadangan')?.jumlah || 0;
            const jumlahAnggota = penerimaData.length;
            const rataRata = jumlahAnggota > 0 ? Math.round(shuAnggota / jumlahAnggota) : 0;
            
            document.getElementById('totalSHUDisplay').textContent = formatCurrency(totalSHU);
            document.getElementById('shuAnggotaDisplay').textContent = formatCurrency(shuAnggota);
            document.getElementById('danaCadanganDisplay').textContent = formatCurrency(danaCadangan);
            document.getElementById('rataRataSHU').textContent = formatCurrency(rataRata);
            document.getElementById('jumlahAnggotaSHU').textContent = jumlahAnggota;
            document.getElementById('totalAnggotaPenerima').textContent = jumlahAnggota;
            document.getElementById('totalSimpananSemua').textContent = formatCurrency(totalSimpananSemua);
            document.getElementById('growthPercent').textContent = SHU_CONFIG.growthRate[currentFilter.tahun] + '%';
        }

        // ===== APPLY FILTER =====
        function applyFilter() {
            const tahun = document.getElementById('tahunSHU').value;
            const periode = document.getElementById('periodeSHU').value;
            const status = document.getElementById('statusSHU').value;
            
            currentFilter = { tahun, periode, status };
            
            // Hitung ulang SHU dengan tahun baru
            calculateSHU();
            
            // Filter data SHU berdasarkan status
            let filteredSHU = [...shuData];
            if (status !== 'all') {
                filteredSHU = filteredSHU.filter(item => 
                    item.status.toLowerCase().includes(status.toLowerCase())
                );
            }
            
            // Filter penerima berdasarkan periode (simulasi)
            let filteredPenerima = [...penerimaData];
            if (periode !== 'tahunan') {
                // Simulasi: semester/triwulan hanya menampilkan proporsi tertentu
                const multiplier = periode.includes('semester') ? 0.5 : 0.25;
                filteredPenerima = filteredPenerima.map(p => ({
                    ...p,
                    shuDiterima: Math.round(p.shuDiterima * multiplier)
                }));
            }
            
            // Tampilkan data
            displayData(filteredSHU);
            displayPenerimaData(filteredPenerima);
            
            showMessage(`Filter diterapkan: Tahun ${tahun}, ${periode}`, 'info');
        }

        // ===== DISPLAY DATA =====
        function displayData(data) {
            const tableBody = document.getElementById('shuTableBody');
            const cardView = document.getElementById('shuCardView');
            
            tableBody.innerHTML = '';
            cardView.innerHTML = '';
            
            if (!data || data.length === 0) {
                const emptyMessage = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            <i class="fas fa-inbox" style="font-size: 3rem; color: var(--gray-light); margin-bottom: 16px;"></i>
                            <p style="color: var(--gray);">Tidak ada data yang sesuai dengan filter</p>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML = emptyMessage;
                cardView.innerHTML = emptyMessage;
                return;
            }
            
            data.forEach((item) => {
                let badgeClass = 'badge-info';
                let badgeIcon = 'fa-info-circle';
                
                if (item.status === 'Disetorkan') {
                    badgeClass = 'badge-success';
                    badgeIcon = 'fa-check-circle';
                } else if (item.status === 'Dibagikan') {
                    badgeClass = 'badge-warning';
                    badgeIcon = 'fa-share-alt';
                } else if (item.status === 'Dibayarkan') {
                    badgeClass = 'badge-info';
                    badgeIcon = 'fa-money-bill-wave';
                } else if (item.status === 'Dialokasikan') {
                    badgeClass = 'badge-info';
                    badgeIcon = 'fa-clock';
                }
                
                // Table row
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td data-label="Jenis">
                        <div style="font-weight: 600; color: var(--primary-dark);">${item.jenis}</div>
                        <div style="font-size: 0.85rem; color: var(--gray);">${item.deskripsi}</div>
                    </td>
                    <td data-label="Persentase">
                        <div style="font-weight: 700; color: var(--primary);">${item.persentase}%</div>
                        <div style="width: 60px; height: 4px; background: var(--gray-light); border-radius: 2px; margin-top: 4px;">
                            <div style="width: ${item.persentase}%; height: 100%; background: var(--primary); border-radius: 2px;"></div>
                        </div>
                    </td>
                    <td data-label="Jumlah">
                        <div style="font-weight: 700; color: var(--dark);">${formatCurrency(item.jumlah)}</div>
                    </td>
                    <td data-label="Status">
                        <span class="badge ${badgeClass}">
                            <i class="fas ${badgeIcon}"></i>
                            ${item.status}
                        </span>
                    </td>
                    <td data-label="Aksi">
                        <button class="action-btn btn-sm" onclick="showDetail('${item.id}')" title="Detail">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
                
                // Card view
                const card = document.createElement('div');
                card.className = 'shu-card';
                card.style.borderLeftColor = item.color;
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">
                            <h3>${item.jenis}</h3>
                            <span class="card-badge">${item.persentase}%</span>
                        </div>
                        <span class="badge ${badgeClass}">
                            ${item.status}
                        </span>
                    </div>
                    
                    <div class="card-content">
                        <div class="card-item">
                            <div class="card-label">Jumlah</div>
                            <div class="card-value">${formatCurrency(item.jumlah)}</div>
                        </div>
                        <div class="card-item">
                            <div class="card-label">Sumber</div>
                            <div class="card-value">${item.sumber}</div>
                        </div>
                        <div class="card-item">
                            <div class="card-label">Tanggal</div>
                            <div class="card-value">${item.tanggal}</div>
                        </div>
                        <div class="card-item">
                            <div class="card-label">No. Bukti</div>
                            <div class="card-value">${item.bukti}</div>
                        </div>
                    </div>
                    
                    <div class="card-actions">
                        <button class="action-btn" onclick="showDetail('${item.id}')">
                            <i class="fas fa-eye"></i>
                            <span>Detail</span>
                        </button>
                        <button class="action-btn" onclick="printItem('${item.id}')">
                            <i class="fas fa-print"></i>
                            <span>Cetak</span>
                        </button>
                    </div>
                `;
                cardView.appendChild(card);
            });
        }

        function displayPenerimaData(data = penerimaData) {
            const cardView = document.getElementById('penerimaCardView');
            cardView.innerHTML = '';
            
            if (!data || data.length === 0) {
                cardView.innerHTML = `
                    <div class="shu-card" style="text-align: center;">
                        <i class="fas fa-users" style="font-size: 3rem; color: var(--gray-light); margin-bottom: 16px;"></i>
                        <p style="color: var(--gray);">Belum ada data penerima SHU</p>
                    </div>
                `;
                return;
            }
            
            // Urutkan berdasarkan SHU diterima (terbesar)
            const sortedData = [...data].sort((a, b) => b.shuDiterima - a.shuDiterima);
            
            sortedData.forEach((anggota) => {
                const card = document.createElement('div');
                card.className = 'shu-card';
                card.style.borderLeftColor = anggota.shuDiterima > 1000000 ? '#2e7d32' : '#2196f3';
                
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">
                            <h3>${anggota.nama}</h3>
                            <span class="card-badge">${anggota.noAnggota}</span>
                        </div>
                        <span class="badge badge-success">
                            <i class="fas fa-check-circle"></i>
                            ${anggota.status}
                        </span>
                    </div>
                    
                    <div class="card-content">
                        <div class="card-item">
                            <div class="card-label">Total Simpanan</div>
                            <div class="card-value">${formatCurrency(anggota.totalSimpanan)}</div>
                        </div>
                        <div class="card-item">
                            <div class="card-label">SHU Diterima</div>
                            <div class="card-value text-success fw-bold">${formatCurrency(anggota.shuDiterima)}</div>
                        </div>
                        <div class="card-item">
                            <div class="card-label">Persentase</div>
                            <div class="card-value">${anggota.persentase}%</div>
                        </div>
                        <div class="card-item">
                            <div class="card-label">Tanggal</div>
                            <div class="card-value">${anggota.tanggalTerima}</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--gray-lighter); border-radius: var(--radius-sm); padding: var(--space-sm); margin-bottom: var(--space-md);">
                        <div style="display: flex; justify-content: space-between; font-size: 0.85rem;">
                            <span>Pokok: ${formatCurrency(anggota.simpananPokok)}</span>
                            <span>Wajib: ${formatCurrency(anggota.simpananWajib)}</span>
                            <span>Sukarela: ${formatCurrency(anggota.simpananSukarela)}</span>
                        </div>
                    </div>
                    
                    <div class="card-actions">
                        <button class="action-btn" onclick="showDetailPenerima('${anggota.id}')">
                            <i class="fas fa-file-invoice-dollar"></i>
                            <span>Detail</span>
                        </button>
                        <button class="action-btn" onclick="printKwitansi('${anggota.id}')">
                            <i class="fas fa-receipt"></i>
                            <span>Kwitansi</span>
                        </button>
                    </div>
                `;
                
                cardView.appendChild(card);
            });
        }

        // ===== SHOW DETAIL =====
        window.showDetail = function(itemId) {
            const item = shuData.find(d => d.id === itemId);
            if (!item) return;
            
            const detailHTML = `
                <div style="background: white; border-radius: var(--radius-lg); padding: var(--space-lg); max-width: 500px; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
                        <h3 style="color: var(--primary-dark); font-size: 1.2rem;">Detail Distribusi SHU</h3>
                        <button class="back-button" onclick="closeDetail()" style="background: var(--gray-lighter); color: var(--gray);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border-radius: var(--radius-md); padding: var(--space-lg); margin-bottom: var(--space-lg);">
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 4px;">${item.jenis}</div>
                        <div style="font-size: 1.8rem; font-weight: 700; margin-bottom: 8px;">${formatCurrency(item.jumlah)}</div>
                        <div style="display: flex; gap: var(--space-md);">
                            <div style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; font-size: 0.85rem;">
                                <i class="fas fa-percentage"></i> ${item.persentase}%
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; font-size: 0.85rem;">
                                <i class="fas fa-calendar"></i> ${item.tanggal}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-md); margin-bottom: var(--space-lg);">
                        <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.85rem; color: var(--gray); margin-bottom: 4px;">Status</div>
                            <div style="font-weight: 600; color: var(--primary);">${item.status}</div>
                        </div>
                        <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.85rem; color: var(--gray); margin-bottom: 4px;">Sumber Dana</div>
                            <div style="font-weight: 600; color: var(--dark);">${item.sumber}</div>
                        </div>
                        <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.85rem; color: var(--gray); margin-bottom: 4px;">No. Bukti</div>
                            <div style="font-weight: 600; color: var(--dark);">${item.bukti}</div>
                        </div>
                        <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.85rem; color: var(--gray); margin-bottom: 4px;">Periode</div>
                            <div style="font-weight: 600; color: var(--dark);">Tahun ${currentFilter.tahun}</div>
                        </div>
                    </div>
                    
                    <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-lg); margin-bottom: var(--space-lg);">
                        <div style="font-size: 0.9rem; font-weight: 600; color: var(--primary-dark); margin-bottom: 8px;">Deskripsi</div>
                        <div style="color: var(--dark); line-height: 1.6;">${item.deskripsi}</div>
                    </div>
                    
                    <div style="display: flex; gap: var(--space-sm);">
                        <button class="btn btn-primary" style="flex: 1;" onclick="printItem('${item.id}')">
                            <i class="fas fa-print"></i>
                            Cetak Detail
                        </button>
                        <button class="btn btn-outline" onclick="closeDetail()">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            showModal(detailHTML);
        };

        window.showDetailPenerima = function(id) {
            const anggota = penerimaData.find(a => a.id === id);
            if (!anggota) return;
            
            const detailHTML = `
                <div style="background: white; border-radius: var(--radius-lg); padding: var(--space-lg); max-width: 500px; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
                        <h3 style="color: var(--primary-dark); font-size: 1.2rem;">Detail Penerima SHU</h3>
                        <button class="back-button" onclick="closeDetail()" style="background: var(--gray-lighter); color: var(--gray);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border-radius: var(--radius-md); padding: var(--space-lg); margin-bottom: var(--space-lg);">
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 4px;">${anggota.nama}</div>
                        <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 4px;">${formatCurrency(anggota.shuDiterima)}</div>
                        <div style="display: flex; gap: var(--space-md);">
                            <div style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; font-size: 0.85rem;">
                                <i class="fas fa-id-card"></i> ${anggota.noAnggota}
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; font-size: 0.85rem;">
                                <i class="fas fa-percentage"></i> ${anggota.persentase}%
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-md); margin-bottom: var(--space-lg);">
                        <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.85rem; color: var(--gray); margin-bottom: 4px;">Total Simpanan</div>
                            <div style="font-weight: 700; color: var(--primary-dark);">${formatCurrency(anggota.totalSimpanan)}</div>
                        </div>
                        <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.85rem; color: var(--gray); margin-bottom: 4px;">SHU Diterima</div>
                            <div style="font-weight: 700; color: var(--success);">${formatCurrency(anggota.shuDiterima)}</div>
                        </div>
                        <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.85rem; color: var(--gray); margin-bottom: 4px;">Tanggal Terima</div>
                            <div style="font-weight: 600; color: var(--dark);">${anggota.tanggalTerima}</div>
                        </div>
                        <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md);">
                            <div style="font-size: 0.85rem; color: var(--gray); margin-bottom: 4px;">Status</div>
                            <span class="badge badge-success">${anggota.status}</span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <h4 style="color: var(--primary-dark); margin-bottom: var(--space-sm);">Rincian Simpanan</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-sm);">
                            <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-sm); text-align: center;">
                                <div style="font-size: 0.8rem; color: var(--gray);">Pokok</div>
                                <div style="font-weight: 600; color: var(--primary-dark);">${formatCurrency(anggota.simpananPokok)}</div>
                            </div>
                            <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-sm); text-align: center;">
                                <div style="font-size: 0.8rem; color: var(--gray);">Wajib</div>
                                <div style="font-weight: 600; color: var(--primary-dark);">${formatCurrency(anggota.simpananWajib)}</div>
                            </div>
                            <div style="background: white; border: 1px solid var(--gray-light); border-radius: var(--radius-md); padding: var(--space-sm); text-align: center;">
                                <div style="font-size: 0.8rem; color: var(--gray);">Sukarela</div>
                                <div style="font-weight: 600; color: var(--primary-dark);">${formatCurrency(anggota.simpananSukarela)}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: var(--gray-lighter); border-radius: var(--radius-md); padding: var(--space-md); margin-bottom: var(--space-lg);">
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                            <span>No. Bukti:</span>
                            <span style="font-weight: 600; color: var(--primary-dark);">${anggota.bukti}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-top: 8px;">
                            <span>Periode SHU:</span>
                            <span style="font-weight: 600; color: var(--primary-dark);">Tahun ${currentFilter.tahun}</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: var(--space-sm);">
                        <button class="btn btn-primary" style="flex: 1;" onclick="printKwitansi('${anggota.id}')">
                            <i class="fas fa-receipt"></i>
                            Cetak Kwitansi
                        </button>
                        <button class="btn btn-outline" onclick="closeDetail()">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            showModal(detailHTML);
        };

        function showModal(content) {
            const overlay = document.createElement('div');
            overlay.id = 'detailOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                padding: var(--space-md);
                animation: fadeIn 0.3s ease;
            `;
            overlay.innerHTML = content;
            document.body.appendChild(overlay);
            document.body.style.overflow = 'hidden';
        }

        window.closeDetail = function() {
            const overlay = document.getElementById('detailOverlay');
            if (overlay) {
                overlay.remove();
                document.body.style.overflow = '';
            }
        };

        // ===== PRINT FUNCTIONS =====
        window.printItem = function(itemId) {
            const item = shuData.find(d => d.id === itemId);
            if (!item) return;
            
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Detail SHU - ${item.jenis}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 30px; max-width: 800px; margin: 0 auto; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #2e7d32; padding-bottom: 20px; }
                        h1 { color: #2e7d32; font-size: 24px; margin-bottom: 5px; }
                        .amount-box { background: linear-gradient(135deg, #2e7d32, #4caf50); color: white; padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        td { padding: 8px; border-bottom: 1px solid #ddd; }
                        .label { font-weight: bold; color: #666; width: 200px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>KOPERASI ASMARA TANI</h1>
                        <h2>Detail Distribusi SHU</h2>
                        <p>Tahun ${currentFilter.tahun}</p>
                    </div>
                    
                    <div class="amount-box">
                        <div style="font-size: 16px; margin-bottom: 10px;">${item.jenis}</div>
                        <div style="font-size: 32px; font-weight: bold;">${formatCurrency(item.jumlah)}</div>
                    </div>
                    
                    <table>
                        <tr><td class="label">Status</td><td>${item.status}</td></tr>
                        <tr><td class="label">Persentase</td><td>${item.persentase}%</td></tr>
                        <tr><td class="label">Sumber Dana</td><td>${item.sumber}</td></tr>
                        <tr><td class="label">No. Bukti</td><td>${item.bukti}</td></tr>
                        <tr><td class="label">Tanggal</td><td>${item.tanggal}</td></tr>
                    </table>
                    
                    <div style="margin-top: 20px;">
                        <h3 style="color: #2e7d32;">Deskripsi</h3>
                        <p>${item.deskripsi}</p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px; color: #666; font-size: 12px;">
                        Dicetak dari Sistem Laporan SHU - ${new Date().toLocaleDateString('id-ID')}
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => printWindow.print(), 500);
        };

        window.printKwitansi = function(id) {
            const anggota = penerimaData.find(a => a.id === id);
            if (!anggota) return;
            
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Kwitansi SHU - ${anggota.nama}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; background: #f9f9f9; }
                        .kwitansi { background: white; border: 2px solid #2e7d32; border-radius: 15px; padding: 30px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px dashed #2e7d32; padding-bottom: 20px; }
                        .header h1 { color: #2e7d32; font-size: 28px; margin: 0; }
                        .amount-box { background: linear-gradient(135deg, #2e7d32, #4caf50); color: white; padding: 25px; border-radius: 10px; text-align: center; margin: 30px 0; }
                        .amount-box .value { font-size: 36px; font-weight: bold; }
                        .signature { margin-top: 50px; display: flex; justify-content: space-between; }
                    </style>
                </head>
                <body>
                    <div class="kwitansi">
                        <div class="header">
                            <h1>KOPERASI ASMARA TANI</h1>
                            <h2>BUKTI PENERIMAAN SHU</h2>
                            <p>Tahun Anggaran ${currentFilter.tahun}</p>
                        </div>
                        
                        <table style="width:100%; margin:20px 0;">
                            <tr><td><strong>Nama Anggota</strong></td><td>: ${anggota.nama}</td></tr>
                            <tr><td><strong>No. Anggota</strong></td><td>: ${anggota.noAnggota}</td></tr>
                            <tr><td><strong>Tanggal</strong></td><td>: ${anggota.tanggalTerima}</td></tr>
                            <tr><td><strong>Total Simpanan</strong></td><td>: ${formatCurrency(anggota.totalSimpanan)}</td></tr>
                        </table>
                        
                        <div class="amount-box">
                            <div style="font-size: 16px; margin-bottom: 10px;">Jumlah SHU yang Diterima</div>
                            <div class="value">${formatCurrency(anggota.shuDiterima)}</div>
                        </div>
                        
                        <div class="signature">
                            <div style="text-align:center;">
                                <p>Penerima,</p>
                                <div style="border-top:1px solid #000; width:200px; margin:10px auto; padding-top:10px;">
                                    <strong>${anggota.nama}</strong>
                                </div>
                            </div>
                            <div style="text-align:center;">
                                <p>Bendahara Koperasi,</p>
                                <div style="border-top:1px solid #000; width:200px; margin:10px auto; padding-top:10px;">
                                    <strong>Koperasi Asmara Tani</strong>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align:center; margin-top:30px; color:#666; font-size:12px;">
                            Kwitansi ini sebagai bukti sah penerimaan SHU
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => printWindow.print(), 500);
        };

        // ===== CHART FUNCTIONS =====
        window.showChartModal = function() {
            const chartHTML = `
                <div style="background: white; border-radius: var(--radius-lg); padding: var(--space-lg); width: 95%; max-width: 500px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
                        <h3 style="color: var(--primary-dark);">Visualisasi Distribusi SHU ${currentFilter.tahun}</h3>
                        <button class="back-button" onclick="closeChartModal()">Ã—</button>
                    </div>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <div style="display: flex; gap: var(--space-sm); margin-bottom: var(--space-md);">
                            <button class="btn btn-sm ${chartType === 'pie' ? 'btn-primary' : 'btn-outline'}" 
                                    onclick="changeChartType('pie')">Pie</button>
                            <button class="btn btn-sm ${chartType === 'bar' ? 'btn-primary' : 'btn-outline'}" 
                                    onclick="changeChartType('bar')">Bar</button>
                        </div>
                        
                        <div style="position: relative; height: 300px;">
                            <canvas id="shuChartCanvas"></canvas>
                        </div>
                    </div>
                </div>
            `;
            
            const overlay = document.createElement('div');
            overlay.id = 'chartOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                padding: var(--space-md);
            `;
            overlay.innerHTML = chartHTML;
            document.body.appendChild(overlay);
            document.body.style.overflow = 'hidden';
            
            setTimeout(() => renderChart(chartType), 100);
        };

        function renderChart(type) {
            const ctx = document.getElementById('shuChartCanvas')?.getContext('2d');
            if (!ctx) return;
            
            if (chartInstance) chartInstance.destroy();
            
            chartInstance = new Chart(ctx, {
                type: type,
                data: {
                    labels: shuData.map(item => item.jenis),
                    datasets: [{
                        data: shuData.map(item => item.jumlah),
                        backgroundColor: shuData.map(item => item.color),
                        borderColor: 'white',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const value = context.raw;
                                    const percentage = shuData[context.dataIndex].persentase;
                                    return `${context.label}: ${formatCurrency(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        window.changeChartType = function(type) {
            chartType = type;
            renderChart(type);
        };

        window.closeChartModal = function() {
            const overlay = document.getElementById('chartOverlay');
            if (overlay) {
                overlay.remove();
                document.body.style.overflow = '';
                if (chartInstance) {
                    chartInstance.destroy();
                    chartInstance = null;
                }
            }
        };

        // ===== EXPORT FUNCTIONS =====
        function exportToExcel() {
            try {
                const exportData = shuData.map(item => ({
                    'Jenis Alokasi': item.jenis,
                    'Persentase (%)': item.persentase,
                    'Jumlah (Rp)': item.jumlah,
                    'Deskripsi': item.deskripsi,
                    'Status': item.status,
                    'Tanggal': item.tanggal
                }));
                
                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Distribusi SHU');
                
                XLSX.writeFile(wb, `Distribusi_SHU_${currentFilter.tahun}.xlsx`);
                showMessage('Data berhasil diexport', 'success');
            } catch (error) {
                showMessage('Gagal export data', 'error');
            }
        }

        function exportPenerimaToExcel() {
            try {
                const exportData = penerimaData.map(a => ({
                    'No. Anggota': a.noAnggota,
                    'Nama Anggota': a.nama,
                    'Total Simpanan': a.totalSimpanan,
                    'SHU Diterima': a.shuDiterima,
                    'Persentase (%)': a.persentase,
                    'Tanggal Terima': a.tanggalTerima
                }));
                
                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Penerima SHU');
                
                XLSX.writeFile(wb, `Penerima_SHU_${currentFilter.tahun}.xlsx`);
                showMessage('Data penerima berhasil diexport', 'success');
            } catch (error) {
                showMessage('Gagal export data', 'error');
            }
        }

        function printReport() {
            window.print();
        }

        // ===== UTILITY FUNCTIONS =====
        function formatCurrency(amount) {
            return 'Rp ' + Math.round(amount || 0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function showMessage(message, type = 'info') {
            const msg = document.createElement('div');
            msg.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4caf50' : '#f44336'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 3000;
                animation: slideIn 0.3s ease;
            `;
            msg.textContent = message;
            document.body.appendChild(msg);
            
            setTimeout(() => {
                msg.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => msg.remove(), 300);
            }, 3000);
        }

        function updateLastSyncTime() {
            const now = new Date();
            document.getElementById('lastSyncInfo').textContent = 
                `Terakhir sinkron: ${now.toLocaleDateString('id-ID')} ${now.toLocaleTimeString('id-ID')}`;
        }

        window.refreshData = function() {
            loadDataFromLocalStorage();
            calculateSHU();
            applyFilter();
            showMessage('Data diperbarui dari Dashboard', 'success');
        };

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            document.getElementById('applyFilterBtn').addEventListener('click', applyFilter);
            document.getElementById('resetFilterBtn').addEventListener('click', () => {
                document.getElementById('tahunSHU').value = '2026';
                document.getElementById('periodeSHU').value = 'tahunan';
                document.getElementById('statusSHU').value = 'all';
                applyFilter();
            });
            
            document.getElementById('exportBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportPenerimaBtn').addEventListener('click', exportPenerimaToExcel);
            document.getElementById('printBtn').addEventListener('click', printReport);
            document.getElementById('exportPdfBtn').addEventListener('click', () => showMessage('Fitur PDF akan segera hadir', 'info'));
            document.getElementById('refreshDataBtn').addEventListener('click', refreshData);
            document.getElementById('viewChartBtn').addEventListener('click', showChartModal);
            document.getElementById('syncDashboardBtn').addEventListener('click', refreshData);
            
            ['tahunSHU', 'periodeSHU', 'statusSHU'].forEach(id => {
                document.getElementById(id).addEventListener('change', applyFilter);
            });
        }
    </script>
</body>
</html>

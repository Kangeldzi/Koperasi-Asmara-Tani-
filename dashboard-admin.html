<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Koperasi Asmara Tani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* SEMUA CSS DARI SEBELUMNYA (TIDAK DIUBAH) */
        :root {
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary: #ff9800;
            --accent: #ff5722;
            --light: #f5f5f5;
            --dark: #333;
            --gray: #757575;
            --gray-light: #e0e0e0;
            --danger: #f44336;
            --warning: #ffc107;
            --success: #4caf50;
            --info: #2196f3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Container Utama */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: linear-gradient(to bottom, var(--primary-dark), var(--primary));
            color: white;
            transition: all 0.3s ease;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-header img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-header h1 {
            font-size: 1.4rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .sidebar-header .tagline {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }
        
        .sidebar-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            display: none;
            transition: transform 0.3s ease;
        }
        
        .sidebar-close:hover {
            transform: scale(1.2);
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .sidebar-menu ul {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 8px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .sidebar-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--secondary);
            padding-left: 30px;
        }
        
        .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: var(--secondary);
            font-weight: 600;
        }
        
        .sidebar-menu i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }
        
        /* Top Navigation */
        .top-nav {
            background: white;
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 999;
        }
        
        .nav-left {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .nav-buttons {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
            transition: transform 0.3s ease;
            display: none;
        }
        
        .menu-toggle:hover {
            transform: scale(1.1);
        }
        
        .current-time {
            font-size: 0.95rem;
            color: var(--primary-dark);
            font-weight: 600;
            background: var(--light);
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .current-time i {
            color: var(--primary);
        }
        
        .home-btn, .dashboard-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .home-btn:hover, .dashboard-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            background: var(--light);
            border-radius: 25px;
            padding: 10px 20px;
            width: 320px;
            transition: all 0.3s ease;
        }
        
        .search-bar:focus-within {
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
            transform: translateY(-2px);
        }
        
        .search-bar input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            margin-left: 12px;
            font-size: 0.95rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 15px;
            border-radius: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .user-info:hover {
            background: var(--light);
            transform: translateY(-2px);
        }
        
        .user-info img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }
        
        .user-details h4 {
            font-size: 0.95rem;
            margin-bottom: 2px;
        }
        
        .user-details p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Content Area */
        .content {
            padding: 30px;
            flex: 1;
            background: #f8f9fa;
        }
        
        .page-title {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-title h1 {
            font-size: 2rem;
            color: var(--primary-dark);
            position: relative;
            padding-bottom: 12px;
        }
        
        .page-title h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        /* PERBAIKAN GAP TOMBOL DI PAGE TITLE */
        .page-title > div {
            display: flex !important;
            gap: 12px !important;
            flex-wrap: wrap !important;
            align-items: center !important;
        }
        
        .page-title .btn {
            margin: 2px 3px !important;
        }
        
        /* Dashboard Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-info h3 {
            font-size: 0.95rem;
            color: var(--gray);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-info p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        
        .stat-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
        }
        
        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        .bg-primary { background: linear-gradient(135deg, var(--primary), var(--primary-light)); }
        .bg-secondary { background: linear-gradient(135deg, var(--secondary), #ffb74d); }
        .bg-accent { background: linear-gradient(135deg, var(--accent), #ff8a65); }
        .bg-info { background: linear-gradient(135deg, var(--info), #64b5f6); }
        .bg-success { background: linear-gradient(135deg, var(--success), #81c784); }
        .bg-warning { background: linear-gradient(135deg, var(--warning), #ffd54f); }
        
        /* Chart and Table Sections */
        .dashboard-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .chart-container, .table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .chart-container:before, .table-container:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .chart-container:hover, .table-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .section-header h2 {
            font-size: 1.3rem;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .chart-wrapper {
            height: 280px;
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px 18px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }
        
        th {
            background-color: rgba(46, 125, 50, 0.05);
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        tr {
            transition: background-color 0.3s ease;
        }
        
        tr:hover {
            background-color: rgba(46, 125, 50, 0.03);
        }
        
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .badge:hover {
            transform: scale(1.05);
        }
        
        .badge-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #e6a700;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .badge-danger {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }
        
        .badge-overdue {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }
        
        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover:before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-sm {
            padding: 10px 15px !important;
            margin: 2px 3px;
            font-size: 0.85rem;
        }
        
        /* Recent Activity */
        .activity-list {
            list-style: none;
        }
        
        .activity-item {
            display: flex;
            padding: 18px 0;
            border-bottom: 1px solid var(--gray-light);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            background-color: rgba(46, 125, 50, 0.03);
            border-radius: 10px;
            padding-left: 15px;
            padding-right: 15px;
            transform: translateX(5px);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover .activity-icon {
            transform: scale(1.1);
        }
        
        .activity-content h4 {
            font-size: 0.95rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .activity-content p {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: var(--gray);
            margin-left: auto;
            white-space: nowrap;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .required {
            color: var(--danger);
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--gray-light);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }
        
        /* Footer */
        .footer {
            background: white;
            padding: 20px 30px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
            margin-top: 30px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.03);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            color: white;
        }
        
        .modal-header h3 {
            color: white;
            font-size: 1.4rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            transition: transform 0.3s ease;
        }
        
        .modal-close:hover {
            transform: scale(1.2);
        }
        
        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 25px;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }
        
        .tab:hover {
            background-color: rgba(46, 125, 50, 0.05);
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
            background: rgba(46, 125, 50, 0.05);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Admin Profile Section */
        .admin-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .admin-profile img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }
        
        .admin-details h4 {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .admin-details p {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 3px;
        }
        
        .admin-details .admin-role {
            font-size: 10px;
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Bank Logo */
        .bank-logo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            background: var(--light);
            border-radius: 5px;
            font-size: 0.8rem;
        }
        
        .bank-logo i {
            color: var(--primary);
        }
        
        /* Modal Konfirmasi */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .confirm-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
            overflow: hidden;
        }
        
        .confirm-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            background: linear-gradient(90deg, var(--warning), #ffb74d);
            color: white;
        }
        
        .confirm-body {
            padding: 25px;
            text-align: center;
        }
        
        .confirm-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Print Card */
        .print-card {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 3000;
            padding: 20px;
        }
        
        @media print {
            .print-card {
                display: block;
            }
            .no-print {
                display: none;
            }
        }
        
        /* ===== STYLE UNTUK TABEL KELOLA ANGGOTA ===== */
        .table-responsive {
            overflow-x: auto;
        }
        
        .anggota-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .anggota-table th {
            background: rgba(46, 125, 50, 0.05);
            padding: 12px 15px;
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 0.85rem;
        }
        
        .anggota-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-light);
            font-size: 0.85rem;
        }
        
        /* WhatsApp Link */
        .whatsapp-link {
            color: #25D366 !important;
            text-decoration: none !important;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }
        
        .whatsapp-link:hover {
            color: #128C7E !important;
            text-decoration: underline !important;
        }
        
        .saldo-display {
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        /* Password Container dengan Ikon Mata */
        .password-container {
            position: relative;
            width: 100%;
        }
        
        .password-container .form-control {
            padding-right: 40px;
        }
        
        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
        }
        
        .toggle-password:hover {
            color: var(--primary);
        }
        
        /* Alert Styles */
        .alert {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }
        
        .alert-success {
            background: #e8f5e8;
            color: var(--success);
            border: 1px solid #c8e6c9;
        }
        
        .alert-error {
            background: #ffebee;
            color: var(--danger);
            border: 1px solid #ffcdd2;
        }
        
        /* Detail Section */
        .anggota-detail-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .anggota-detail-section h4 {
            margin-bottom: 10px;
            color: var(--primary-dark);
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .detail-item {
            margin-bottom: 10px;
        }
        
        .detail-label {
            font-weight: 600;
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 4px;
        }
        
        .detail-value {
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        /* Sync Status */
        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 10px;
        }
        
        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Responsive Design - Tablet */
        @media (max-width: 1200px) {
            .sidebar {
                width: 250px;
            }
            
            .main-content {
                margin-left: 250px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 20px;
            }
            
            .dashboard-row {
                gap: 20px;
            }
        }
        
        /* Responsive Design - Small Tablet */
        @media (max-width: 992px) {
            .dashboard-row {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .sidebar-close {
                display: block;
            }
            
            .search-bar {
                width: 250px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 18px;
            }
            
            .content {
                padding: 25px;
            }
        }
        
        /* Responsive Design - Mobile Landscape & Small Tablet */
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                margin-bottom: 25px;
            }
            
            .search-bar {
                width: 200px;
            }
            
            .nav-right {
                gap: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .section-header .btn {
                align-self: flex-end;
            }
            
            .chart-wrapper {
                height: 220px;
            }
            
            .card {
                padding: 20px;
            }
            
            .chart-container, .table-container {
                padding: 20px;
            }
            
            .page-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .page-title h1 {
                font-size: 1.8rem;
            }
            
            .stat-info p {
                font-size: 1.8rem;
            }
            
            .stat-icon {
                width: 70px;
                height: 70px;
                font-size: 1.8rem;
            }
        }
        
        /* Responsive Design - Mobile Portrait */
        @media (max-width: 576px) {
            .stats-cards {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .search-bar {
                display: none;
            }
            
            .top-nav {
                padding: 15px 20px;
            }
            
            .content {
                padding: 15px;
            }
            
            .card {
                padding: 18px;
                border-radius: 12px;
            }
            
            .chart-container, .table-container {
                padding: 18px;
                border-radius: 12px;
            }
            
            .chart-wrapper {
                height: 200px;
            }
            
            .user-details {
                display: none;
            }
            
            .page-title h1 {
                font-size: 1.6rem;
            }
            
            .section-header h2 {
                font-size: 1.2rem;
            }
            
            .stat-info p {
                font-size: 1.6rem;
            }
            
            .stat-icon {
                width: 60px;
                height: 60px;
                font-size: 1.6rem;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            .btn-sm {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 12px 14px;
                font-size: 0.85rem;
            }
            
            .admin-profile {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }
            
            .admin-profile img {
                width: 70px;
                height: 70px;
            }
            
            .nav-buttons {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .home-btn, .dashboard-btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .current-time {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
        
        /* Responsive Design - Small Mobile */
        @media (max-width: 400px) {
            .content {
                padding: 12px;
            }
            
            .top-nav {
                padding: 12px 15px;
            }
            
            .card {
                padding: 15px;
                border-radius: 10px;
            }
            
            .chart-container, .table-container {
                padding: 15px;
                border-radius: 10px;
            }
            
            .page-title h1 {
                font-size: 1.4rem;
            }
            
            .section-header h2 {
                font-size: 1.1rem;
            }
            
            .stat-info p {
                font-size: 1.4rem;
            }
            
            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }
            
            .btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }
            
            th, td {
                padding: 10px 12px;
                font-size: 0.8rem;
            }
            
            .home-btn, .dashboard-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            .menu-toggle {
                font-size: 1.3rem;
            }
            
            .user-info img {
                width: 40px;
                height: 40px;
            }
        }
        
        /* Responsive Design - Extra Small Mobile */
        @media (max-width: 360px) {
            .content {
                padding: 10px;
            }
            
            .top-nav {
                padding: 10px 12px;
            }
            
            .card {
                padding: 12px;
            }
            
            .chart-container, .table-container {
                padding: 12px;
            }
            
            .page-title h1 {
                font-size: 1.3rem;
            }
            
            .stat-info p {
                font-size: 1.3rem;
            }
            
            .stat-icon {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            
            .nav-buttons {
                gap: 8px;
            }
            
            .home-btn, .dashboard-btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .current-time {
                font-size: 0.75rem;
                padding: 5px 10px;
            }
        }
        
        /* CSS untuk Notification */
        .sync-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 12px 20px;
            background: #4285F4;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        }
        
        .sync-notification.success {
            background: #34A853;
        }
        
        .sync-notification.error {
            background: #EA4335;
        }
        
        .sync-notification.warning {
            background: #FBBC05;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Logo Koperasi Asmara Tani">
                <h1>Koperasi Asmara Tani</h1>
                <div class="tagline">#koperasijenius</div>
                <button class="sidebar-close" id="sidebarClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <ul>
                    <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-home"></i> <span>Dashboard Utama</span></a></li>
                    <li><a href="#" data-tab="anggota"><i class="fas fa-users"></i> <span>Data Anggota</span></a></li>
                    <!-- MENU KELOLA ANGGOTA DI SIDEBAR -->
                    <li><a href="#kelola-anggota.html" data-tab="kelola-anggota"><i class="fas fa-users-cog"></i> <span>Kelola Anggota</span></a></li>
                    <!-- MENU TABUNGAN DIGITAL DI SIDEBAR -->
                    <li><a href="tabungan-digital.html"><i class="fas fa-book"></i> <span>Tabungan Digital</span></a></li>
                    <li><a href="#" data-tab="simpanan"><i class="fas fa-hand-holding-usd"></i> <span>Simpanan Anggota</span></a></li>
                    <li><a href="#" data-tab="pinjaman"><i class="fas fa-file-invoice-dollar"></i> <span>Pinjaman & Angsuran</span></a></li>
                    <li><a href="#" data-tab="laporan"><i class="fas fa-chart-line"></i> <span>Laporan Keuangan</span></a></li>
                    <li><a href="#" data-tab="unit-usaha"><i class="fas fa-shopping-cart"></i> <span>Unit Usaha</span></a></li>
                    <li><a href="#" data-tab="shu"><i class="fas fa-calculator"></i> <span>Laporan SHU</span></a></li>
                    <!-- LINK CALL ALERT LANGSUNG -->
                    <li><a href="call-alert.html" target="_blank"><i class="fas fa-bell"></i> <span>Call Alert</span></a></li>
                    <li><a href="#" data-tab="pengaturan"><i class="fas fa-cog"></i> <span>Pengaturan Sistem</span></a></li>
                    <li><a href="https://koperasi-asmara-tani.vercel.app/"><i class="fas fa-sign-out-alt"></i> <span>Keluar</span></a></li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navigation -->
            <div class="top-nav">
                <div class="nav-left">
                    <div class="nav-buttons">
                        <button class="menu-toggle" id="menuToggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <!-- TOMBOL BERANDA -->
                        <button class="home-btn" id="homeBtn" onclick="window.location.href='index.html'">
                            <i class="fas fa-home"></i>
                            <span>Beranda</span>
                        </button>
                        <!-- TOMBOL DASHBOARD -->
                        <button class="dashboard-btn" id="dashboardBtn" onclick="window.location.href='dashboard-admin.html'">
                            <i class="fas fa-chart-line"></i>
                            <span>Dashboard</span>
                        </button>
                    </div>
                    <div class="current-time" id="currentTime">
                        <i class="fas fa-clock"></i>
                        <span>Mengambil waktu...</span>
                    </div>
                </div>
                <div class="nav-right">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Cari data..." id="globalSearch">
                    </div>
                    <div class="user-info">
                        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Admin">
                        <div class="user-details">
                            <h4 id="topNavUsername">Admin Koperasi</h4>
                            <p id="topNavRole">Super Administrator</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Tab -->
                <div class="tab-content active" id="dashboard">
                    <div class="page-title">
                        <h1>Dashboard Utama</h1>
                        <div>
                            <!-- TOMBOL EXPORT DAN IMPORT EXCEL -->
                            <button class="btn btn-outline btn-sm" id="exportExcelBtn"><i class="fas fa-file-excel"></i> Export Excel</button>
                            <button class="btn btn-outline btn-sm" id="importExcelBtn"><i class="fas fa-file-import"></i> Import Excel</button>
                            <button class="btn btn-primary btn-sm" id="syncNowBtn"><i class="fas fa-sync-alt"></i> Sync Now</button>
                            <button class="btn btn-primary btn-sm" id="forceSyncBtn"><i class="fas fa-bolt"></i> Force Sync</button>
                        </div>
                    </div>

                    <!-- Admin Profile Section -->
                    <div class="admin-profile" id="adminProfileSection">
                        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Admin">
                        <div class="admin-details">
                            <h4 id="adminUsername">Admin Koperasi</h4>
                            <p id="adminEmail">admin@koperasiasmaratani.id</p>
                            <p id="adminRole">Super Administrator</p>
                            <p class="admin-role">No. Rekening: <span id="adminRekening" class="bank-logo"><i class="fas fa-university"></i> 4098-01-019526-53-3 (BRI)</span></p>
                            <p id="lastSyncTime" style="font-size: 10px; color: #666; margin-top: 3px;">Terakhir sync: -</p>
                        </div>
                    
                        <div>
                            <!-- LINK LANGSUNG KE CALL ALERT -->
                            <button class="btn btn-primary" onclick="window.location.href='call-alert.html'">
                                <i class="fas fa-bell"></i> Call Alert
                            </button>
                            <!-- LINK LANGSUNG KE TABUNGAN DIGITAL -->
                            <button class="btn btn-outline" onclick="window.location.href='tabungan-digital.html'">
                                <i class="fas fa-wallet"></i> Tabungan Digital
                            </button>
                        </div>
                    </div>

                    <!-- Stat Cards -->
                    <div class="stats-cards">
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Anggota</h3>
                                <p id="totalAnggota">0</p>
                            </div>
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Simpanan</h3>
                                <p id="totalSimpanan">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-secondary">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Pinjaman Aktif</h3>
                                <p id="totalPinjaman">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-accent">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total SHU</h3>
                                <p id="totalSHU">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-info">
                                <i class="fas fa-calculator"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Kas</h3>
                                <p id="totalKas">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-success">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Tables Row -->
                    <div class="dashboard-row">
                        <!-- Chart Section -->
                        <div class="chart-container">
                            <div class="section-header">
                                <h2>Grafik Perkembangan Keuangan</h2>
                                <div>
                                    <button class="btn btn-outline btn-sm" id="refreshChart"><i class="fas fa-sync-alt"></i> Refresh</button>
                                    <button class="btn btn-outline btn-sm" id="yearlyChart">Tahunan</button>
                                    <button class="btn btn-primary btn-sm" id="monthlyChart">Bulanan</button>
                                </div>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="financeChart"></canvas>
                            </div>
                        </div>
                        <!-- Recent Activity -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Notifikasi Terbaru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaNotif">Lihat Semua</button>
                            </div>
                            <ul class="activity-list" id="activityList">
                                <!-- Data akan diisi secara dinamis -->
                            </ul>
                        </div>
                    </div>

                    <!-- Tables Row -->
                    <div class="dashboard-row">
                        <!-- Pinjaman Terbaru -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Pinjaman Terbaru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaPinjaman">Lihat Semua</button>
                            </div>
                            <table id="pinjamanTable">
                                <thead>
                                    <tr>
                                        <th>Nama Anggota</th>
                                        <th>Tanggal</th>
                                        <th>Jumlah</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Anggota Baru -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Anggota Baru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaAnggota">Lihat Semua</button>
                            </div>
                            <table id="anggotaTable">
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>Tanggal Bergabung</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Data Anggota Tab -->
                <div class="tab-content" id="anggota">
                    <div class="page-title">
                        <h1>Data Anggota</h1>
                        <div>
                            <button class="btn btn-primary" id="addMemberBtn"><i class="fas fa-plus"></i> Tambah Anggota</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Daftar Anggota Koperasi</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari anggota..." id="searchAnggota">
                            </div>
                        </div>
                        <table id="anggotaFullTable">
                            <thead>
                                <tr>
                                    <th>ID Anggota</th>
                                    <th>Nama</th>
                                    <th>NIK</th>
                                    <th>Jenis Kelamin</th>
                                    <th>Alamat</th>
                                    <th>No. HP</th>
                                    <th>Tanggal Bergabung</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ===== TAB KELOLA ANGGOTA TERINTEGRASI ===== -->
                <div class="tab-content" id="kelola-anggota">
                    <div class="page-title">
                        <h1>Kelola Anggota Koperasi</h1>
                        <button class="btn btn-primary" id="tambahAnggotaBtnTab">
                            <i class="fas fa-user-plus"></i> Tambah Anggota
                        </button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Daftar Anggota</h2>
                            <div class="search-box" style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="searchAnggotaTab" class="form-control" style="width: 300px; padding: 10px 15px;" placeholder="Cari anggota...">
                                <button class="btn btn-outline btn-sm" id="searchAnggotaBtnTab">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Alert Messages -->
                        <div class="alert alert-success" id="successAlert" style="display: none;"></div>
                        <div class="alert alert-error" id="errorAlert" style="display: none;"></div>
                        
                        <div class="table-responsive">
                            <table class="anggota-table" id="kelolaAnggotaTable">
                                <thead>
                                    <tr>
                                        <th>NIA</th>
                                        <th>Nama Lengkap</th>
                                        <th>Email</th>
                                        <th>WhatsApp</th>
                                        <th>Password</th>
                                        <th>Posisi</th>
                                        <th>Status</th>
                                        <th>Saldo</th>
                                        <th>Tanggal Bergabung</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="kelolaAnggotaTableBody">
                                    <!-- Data akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Simpanan Anggota Tab -->
                <div class="tab-content" id="simpanan">
                    <div class="page-title">
                        <h1>Simpanan Anggota</h1>
                        <button class="btn btn-primary" id="addSimpananBtn"><i class="fas fa-plus"></i> Tambah Simpanan</button>
                    </div>

                    <div class="tabs">
                        <div class="tab active" data-simpanan-tab="pokok">Simpanan Pokok</div>
                        <div class="tab" data-simpanan-tab="wajib">Simpanan Wajib</div>
                        <div class="tab" data-simpanan-tab="sukarela">Simpanan Sukarela</div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2 id="simpananTitle">Daftar Simpanan Pokok</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari simpanan..." id="searchSimpanan">
                            </div>
                        </div>
                        <table id="simpananTable">
                            <thead>
                                <tr>
                                    <th>ID Anggota</th>
                                    <th>Nama</th>
                                    <th>Jenis Simpanan</th>
                                    <th>Tanggal Setor</th>
                                    <th>Nominal</th>
                                    <th>Total Akumulasi</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pinjaman & Angsuran Tab -->
                <div class="tab-content" id="pinjaman">
                    <div class="page-title">
                        <h1>Pinjaman & Angsuran</h1>
                        <button class="btn btn-primary" id="addPinjamanBtn"><i class="fas fa-plus"></i> Tambah Pinjaman</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Daftar Pinjaman</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari pinjaman..." id="searchPinjaman">
                            </div>
                        </div>
                        <table id="pinjamanFullTable">
                            <thead>
                                <tr>
                                    <th>ID Pinjaman</th>
                                    <th>Nama Anggota</th>
                                    <th>Jumlah Pinjaman</th>
                                    <th>Tanggal Pinjam</th>
                                    <th>Jangka Waktu</th>
                                    <th>Bunga</th>
                                    <th>Sisa Hutang</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan Keuangan Tab -->
                <div class="tab-content" id="laporan">
                    <div class="page-title">
                        <h1>Laporan Keuangan</h1>
                        <button class="btn btn-primary" id="cetakLaporanBtn"><i class="fas fa-print"></i> Cetak Laporan</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Laporan Neraca</h2>
                        </div>
                        <table id="neracaTable">
                            <thead>
                                <tr>
                                    <th>Keterangan</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Unit Usaha Tab -->
                <div class="tab-content" id="unit-usaha">
                    <div class="page-title">
                        <h1>Unit Usaha / Toko Koperasi</h1>
                        <button class="btn btn-primary" id="addBarangBtn"><i class="fas fa-plus"></i> Tambah Barang</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Data Stok Barang</h2>
                        </div>
                        <table id="barangTable">
                            <thead>
                                <tr>
                                    <th>Kode Barang</th>
                                    <th>Nama Barang</th>
                                    <th>Stok</th>
                                    <th>Harga Beli</th>
                                    <th>Harga Jual</th>
                                    <th>Laba</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan SHU Tab -->
                <div class="tab-content" id="shu">
                    <div class="page-title">
                        <h1>Laporan SHU (Sisa Hasil Usaha)</h1>
                        <button class="btn btn-primary" id="cetakSHUBtn"><i class="fas fa-print"></i> Cetak Laporan</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Pembagian SHU Tahun <span id="currentYear"></span></h2>
                        </div>
                        <table id="shuTable">
                            <thead>
                                <tr>
                                    <th>Keterangan</th>
                                    <th>Persentase</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pengaturan Tab -->
                <div class="tab-content" id="pengaturan">
                    <div class="page-title">
                        <h1>Pengaturan Sistem & User</h1>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Data Admin</h2>
                        </div>
                        <form id="adminForm">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" class="form-control" value="admin_koperasi">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" class="form-control" value="admin@koperasiasmaratani.id">
                            </div>
                            <div class="form-group">
                                <label for="role">Role</label>
                                <select id="role" class="form-control">
                                    <option value="admin">Admin</option>
                                    <option value="pengurus">Pengurus</option>
                                    <option value="bendahara">Bendahara</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="foto">Ganti Foto Profil</label>
                                <input type="file" id="foto" class="form-control" accept="image/*">
                            </div>
                            <div class="form-group">
                                <label for="norek">No Rekening Admin</label>
                                <input type="text" id="norek" class="form-control" placeholder="Masukkan nomor rekening" value="1234-5678-9012-3456">
                            </div>
                            <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="footer">
                <p>&copy; <span id="currentYearFooter"></span> Koperasi Asmara Tani  Dashboard Admin</p>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Anggota (untuk tab Data Anggota) -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="memberModalTitle">Tambah Anggota Baru</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="memberForm">
                    <input type="hidden" id="memberId">
                    <div class="form-group">
                        <label for="posisi">Posisi <span class="required">*</span></label>
                        <select id="posisi" class="form-control" required>
                            <option value="">Pilih Posisi</option>
                            <option value="Admin">Admin</option>
                            <option value="Pengurus">Pengurus</option>
                            <option value="Anggota">Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="nama">Nama Lengkap <span class="required">*</span></label>
                        <input type="text" id="nama" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="alamat">Alamat Lengkap <span class="required">*</span></label>
                        <textarea id="alamat" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="jenisKelamin">Jenis Kelamin <span class="required">*</span></label>
                        <select id="jenisKelamin" class="form-control" required>
                            <option value="">Pilih Jenis Kelamin</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="agama">Agama <span class="required">*</span></label>
                        <select id="agama" class="form-control" required>
                            <option value="">Pilih Agama</option>
                            <option value="Islam">Islam</option>
                            <option value="Kristen">Kristen</option>
                            <option value="Hindu">Hindu</option>
                            <option value="Budha">Budha</option>
                            <option value="Konghucu">Konghucu</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="status">Status <span class="required">*</span></label>
                        <select id="status" class="form-control" required>
                            <option value="">Pilih Status</option>
                            <option value="Menikah">Menikah</option>
                            <option value="Belum Menikah">Belum Menikah</option>
                            <option value="Duda">Duda</option>
                            <option value="Janda">Janda</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="email">Alamat Email <span class="required">*</span></label>
                        <input type="email" id="emailMember" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="whatsapp">No WhatsApp <span class="required">*</span></label>
                        <input type="text" id="whatsapp" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="nik">No NIK KTP <span class="required">*</span></label>
                        <input type="text" id="nik" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="foto">Upload Foto Anda <span class="required">*</span></label>
                        <input type="file" id="fotoMember" class="form-control" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="buktiTransfer">Upload Bukti Transfer (Opsional)</label>
                        <input type="file" id="buktiTransfer" class="form-control" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label>Tanggal Daftar</label>
                        <input type="text" id="tanggalDaftar" class="form-control" readonly>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelMemberBtn">Batal</button>
                <button class="btn btn-primary" id="saveMemberBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- ===== MODAL KELOLA ANGGOTA (INTEGRASI) ===== -->
    <div class="modal" id="anggotaModalKelola">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="modalTitleKelola">Detail Anggota</h3>
                <button class="modal-close" id="closeModalKelola">&times;</button>
            </div>
            <div class="modal-body">
                <form id="anggotaFormKelola">
                    <input type="hidden" id="editEmailKelola">
                    
                    <div class="anggota-detail-section">
                        <h4>Data Personal</h4>
                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaNIA">NIA *</label>
                                    <input type="text" id="anggotaNIA" class="form-control" required>
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaNama">Nama Lengkap *</label>
                                    <input type="text" id="anggotaNama" class="form-control" required>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaEmail">Email *</label>
                                    <input type="email" id="anggotaEmail" class="form-control" required>
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaPassword">Password *</label>
                                    <div class="password-container">
                                        <input type="password" id="anggotaPassword" class="form-control" required>
                                        <button type="button" class="toggle-password" id="modalTogglePasswordKelola">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaWhatsApp">WhatsApp</label>
                                    <input type="text" id="anggotaWhatsApp" class="form-control">
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaNIK">NIK KTP</label>
                                    <input type="text" id="anggotaNIK" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaJenisKelamin">Jenis Kelamin</label>
                                    <select id="anggotaJenisKelamin" class="form-control">
                                        <option value="">Pilih</option>
                                        <option value="Laki-laki">Laki-laki</option>
                                        <option value="Perempuan">Perempuan</option>
                                    </select>
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaKeterangan">Keterangan</label>
                                    <input type="text" id="anggotaKeterangan" class="form-control" placeholder="Keterangan tambahan...">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="anggota-detail-section">
                        <h4>Data Tambahan</h4>
                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaPosisi">Posisi</label>
                                    <input type="text" id="anggotaPosisi" class="form-control">
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaStatus">Status Aktif *</label>
                                    <select id="anggotaStatus" class="form-control" required>
                                        <option value="aktif">Aktif</option>
                                        <option value="tidak aktif">Tidak Aktif</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <div class="form-group">
                                <label for="anggotaAlamat">Alamat Lengkap</label>
                                <textarea id="anggotaAlamat" class="form-control" rows="3"></textarea>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaAgama">Agama</label>
                                    <input type="text" id="anggotaAgama" class="form-control">
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="anggotaSaldo">Saldo</label>
                                    <input type="number" id="anggotaSaldo" class="form-control" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelBtnKelola">Tutup</button>
                <button class="btn btn-primary" id="saveAnggotaBtnKelola">Simpan Perubahan</button>
            </div>
        </div>
    </div>

    <!-- Modal Detail Anggota (untuk Kelola Anggota) -->
    <div class="modal" id="detailAnggotaModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Detail Anggota</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="detailAnggotaContent">
                <!-- Detail anggota akan dimuat di sini -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="document.getElementById('detailAnggotaModal').style.display='none'">Tutup</button>
                <button class="btn btn-primary" id="editDetailBtn">Edit</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Simpanan -->
    <div class="modal" id="addSimpananModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="simpananModalTitle">Tambah Simpanan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="simpananForm">
                    <input type="hidden" id="simpananId">
                    <div class="form-group">
                        <label for="idAnggotaSimpanan">ID Anggota <span class="required">*</span></label>
                        <select id="idAnggotaSimpanan" class="form-control" required>
                            <option value="">Pilih Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jenisSimpanan">Jenis Simpanan <span class="required">*</span></label>
                        <select id="jenisSimpanan" class="form-control" required>
                            <option value="">Pilih Jenis</option>
                            <option value="Pokok">Pokok</option>
                            <option value="Wajib">Wajib</option>
                            <option value="Sukarela">Sukarela</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tanggalSimpanan">Tanggal Setor <span class="required">*</span></label>
                        <input type="date" id="tanggalSimpanan" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="nominalSimpanan">Nominal <span class="required">*</span></label>
                        <input type="number" id="nominalSimpanan" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelSimpananBtn">Batal</button>
                <button class="btn btn-primary" id="saveSimpananBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Pinjaman -->
    <div class="modal" id="addPinjamanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pinjamanModalTitle">Tambah Pinjaman</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="pinjamanForm">
                    <input type="hidden" id="pinjamanId">
                    <div class="form-group">
                        <label for="idAnggotaPinjaman">ID Anggota <span class="required">*</span></label>
                        <select id="idAnggotaPinjaman" class="form-control" required>
                            <option value="">Pilih Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jumlahPinjaman">Jumlah Pinjaman <span class="required">*</span></label>
                        <input type="number" id="jumlahPinjaman" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="tanggalPinjaman">Tanggal Pinjam <span class="required">*</span></label>
                        <input type="date" id="tanggalPinjaman" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="jangkaWaktu">Jangka Waktu <span class="required">*</span></label>
                        <select id="jangkaWaktu" class="form-control" required>
                            <option value="">Pilih Jangka Waktu</option>
                            <option value="6 Bulan">6 Bulan</option>
                            <option value="12 Bulan">12 Bulan</option>
                            <option value="24 Bulan">24 Bulan</option>
                            <option value="36 Bulan">36 Bulan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bungaPinjaman">Bunga (%) <span class="required">*</span></label>
                        <input type="number" id="bungaPinjaman" class="form-control" step="0.1" value="1.5" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelPinjamanBtn">Batal</button>
                <button class="btn btn-primary" id="savePinjamanBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Barang -->
    <div class="modal" id="addBarangModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="barangModalTitle">Tambah Barang</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="barangForm">
                    <input type="hidden" id="barangId">
                    <div class="form-group">
                        <label for="namaBarang">Nama Barang <span class="required">*</span></label>
                        <input type="text" id="namaBarang" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="stokBarang">Stok <span class="required">*</span></label>
                        <input type="number" id="stokBarang" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hargaBeli">Harga Beli <span class="required">*</span></label>
                        <input type="number" id="hargaBeli" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hargaJual">Harga Jual <span class="required">*</span></label>
                        <input type="number" id="hargaJual" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelBarangBtn">Batal</button>
                <button class="btn btn-primary" id="saveBarangBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Konfirmasi Hapus -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <div class="confirm-header">
                <h3>Konfirmasi Hapus</h3>
            </div>
            <div class="confirm-body">
                <p id="confirmMessage">Apakah Anda yakin ingin menghapus data ini?</p>
            </div>
            <div class="confirm-footer">
                <button class="btn btn-outline" id="cancelDeleteBtn">Batal</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Modal Import Excel -->
    <div class="modal" id="importExcelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Data dari Excel</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="excelFile">Pilih File Excel</label>
                    <input type="file" id="excelFile" class="form-control" accept=".xlsx, .xls">
                </div>
                <div class="form-group">
                    <label for="importType">Jenis Data</label>
                    <select id="importType" class="form-control">
                        <option value="anggota">Data Anggota</option>
                        <option value="simpanan">Data Simpanan</option>
                        <option value="pinjaman">Data Pinjaman</option>
                        <option value="barang">Data Barang</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelImportBtn">Batal</button>
                <button class="btn btn-primary" id="confirmImportBtn">Import</button>
            </div>
        </div>
    </div>

    <!-- Preview Print Modal -->
    <div class="modal" id="printPreviewModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Preview Cetak Laporan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="printPreviewContent">
                <!-- Preview cetak akan diisi di sini -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="document.getElementById('printPreviewModal').style.display='none'">Tutup</button>
                <button class="btn btn-primary" onclick="printLaporan()"><i class="fas fa-print"></i> Cetak</button>
            </div>
        </div>
    </div>

    <script>
    // ===== KONFIGURASI UTAMA =====
    const CONFIG = {
        GOOGLE_SHEETS: {
            apiKey: localStorage.getItem('google_api_key') || '',
            spreadsheetId: localStorage.getItem('google_sheets_id') || '',
            baseUrl: 'https://sheets.googleapis.com/v4/spreadsheets'
        },
        SYNC_INTERVAL: 30000, // 30 detik
        REAL_TIME_INTERVAL: 5000, // 5 detik untuk real-time sync
        TAB_SHEET_MAPPING: {
            'anggota': 'Anggota',
            'simpanan': 'Simpanan',
            'pinjaman': 'Pinjaman',
            'barang': 'Barang',
            'transaksi': 'Transaksi',
            'shu': 'SHU'
        }
    };

    // ===== VARIABEL GLOBAL =====
    let anggotaData = [];
    let simpananData = [];
    let pinjamanData = [];
    let barangData = [];
    let transaksiData = [];
    let shuData = [];
    let anggotaDataKelola = [];
    let currentEditingId = null;
    let currentEditingType = null;
    let financeChart = null;
    let kelolaAnggotaSystem = null;

    // ===== INISIALISASI KOMPLIT SISTEM =====
    function initializeCompleteSystem() {
        console.log('=== SYSTEM INITIALIZATION STARTED ===');
        
        // 1. Setup real-time clock
        setupRealTimeFull();
        
        // 2. Load data
        loadLocalStorageData();
        
        // 3. Setup charts
        setupFinanceChart();
        
        // 4. Initialize Kelola Anggota System
        initializeKelolaAnggotaSystem();
        
        // 5. Setup sidebar navigation
        setupSidebarNavigationFull();
        
        // 6. Setup all button functionality
        activateAllButtons();
        
        // 7. Setup modal controls
        setupModalControls();
        
        // 8. Setup member detail modals
        setupMemberDetailModals();
        
        // 9. Load initial data
        loadInitialData();
        
        // 10. Setup auto refresh
        setupAutoRefresh();
        
        // 11. Update UI
        updateDashboardStats();
        updateFinancialDataInRealTime();
        
        console.log('=== SYSTEM INITIALIZATION COMPLETED ===');
        showNotification('Sistem berhasil dimuat!', 'success');
    }

    // ===== FUNGSI REAL-TIME LENGKAP =====
    function setupRealTimeFull() {
        console.log('Setting up real-time clock...');
        
        function updateTimeFull() {
            const now = new Date();
            
            // Nama hari dalam bahasa Indonesia
            const hariIndo = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            
            // Nama bulan dalam bahasa Indonesia
            const bulanIndo = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Okttober', 'November', 'Desember'
            ];
            
            // Ambil komponen waktu
            const hari = hariIndo[now.getDay()];
            const tanggal = now.getDate();
            const bulan = bulanIndo[now.getMonth()];
            const tahun = now.getFullYear();
            
            // Format waktu dengan leading zero
            const jam = now.getHours().toString().padStart(2, '0');
            const menit = now.getMinutes().toString().padStart(2, '0');
            const detik = now.getSeconds().toString().padStart(2, '0');
            
            // Format lengkap untuk header
            const timeStringHeader = `${hari}, ${tanggal} ${bulan} ${tahun} | ${jam}:${menit}:${detik} WIB`;
            
            // Format untuk form
            const timeStringForm = `${hari}, ${tanggal} ${bulan} ${tahun} - ${jam}:${menit}:${detik} WIB`;
            
            // Update semua elemen waktu
            const timeElements = document.querySelectorAll('#currentTime, .current-time');
            timeElements.forEach(el => {
                if (el.id === 'currentTime') {
                    el.innerHTML = `<i class="fas fa-clock"></i> ${timeStringHeader}`;
                }
            });
            
            // Update form jika ada
            const tanggalDaftarInput = document.getElementById('tanggalDaftar');
            if (tanggalDaftarInput) {
                tanggalDaftarInput.value = timeStringForm;
            }
            
            // Update juga di admin profile
            const lastSyncElement = document.getElementById('lastSyncTime');
            if (lastSyncElement) {
                lastSyncElement.textContent = `Terakhir update: ${jam}:${menit}:${detik}`;
            }
        }
        
        // Update langsung dan set interval
        updateTimeFull();
        setInterval(updateTimeFull, 1000);
        
        console.log(' Real-time clock aktif');
    }

    function loadLocalStorageData() {
        console.log('Loading data from localStorage...');
        
        try {
            anggotaData = JSON.parse(localStorage.getItem('koperasi_anggota')) || JSON.parse(localStorage.getItem('anggotaData')) || [];
            simpananData = JSON.parse(localStorage.getItem('simpananData')) || [];
            pinjamanData = JSON.parse(localStorage.getItem('pinjamanData')) || [];
            barangData = JSON.parse(localStorage.getItem('barangData')) || [];
            transaksiData = JSON.parse(localStorage.getItem('transaksiData')) || [];
            shuData = JSON.parse(localStorage.getItem('shuData')) || [];
            
            // Load data untuk sistem kelola anggota
            anggotaDataKelola = JSON.parse(localStorage.getItem('anggotaDataKelola')) || [];
            
            console.log('Data loaded:', {
                anggota: anggotaData.length,
                simpanan: simpananData.length,
                pinjaman: pinjamanData.length,
                barang: barangData.length
            });
        } catch (error) {
            console.error('Error loading localStorage data:', error);
        }
    }

    // ===== SISTEM KELOLA ANGGOTA TERINTEGRASI =====
    function initializeKelolaAnggotaSystem() {
        kelolaAnggotaSystem = new KelolaAnggotaSystem();
        window.kelolaAnggotaSystem = kelolaAnggotaSystem;
    }

    class KelolaAnggotaSystem {
        constructor() {
            this.anggotaData = JSON.parse(localStorage.getItem('anggotaDataKelola')) || [];
            this.init();
        }
        
        init() {
            this.setupEventListeners();
            this.loadAnggotaTable();
            console.log(' Sistem Kelola Anggota diinisialisasi');
        }
        
        setupEventListeners() {
            // Tombol Tambah Anggota di tab
            document.getElementById('tambahAnggotaBtnTab')?.addEventListener('click', () => {
                this.openTambahAnggotaModal();
            });
            
            // Tombol Search
            document.getElementById('searchAnggotaBtnTab')?.addEventListener('click', () => {
                this.searchAnggota();
            });
            
            document.getElementById('searchAnggotaTab')?.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') this.searchAnggota();
            });
            
            // Tombol Save di modal
            document.getElementById('saveAnggotaBtnKelola')?.addEventListener('click', () => {
                this.saveAnggotaData();
            });
            
            // Tombol Cancel di modal
            document.getElementById('cancelBtnKelola')?.addEventListener('click', () => {
                document.getElementById('anggotaModalKelola').style.display = 'none';
            });
            
            // Tombol Close modal
            document.getElementById('closeModalKelola')?.addEventListener('click', () => {
                document.getElementById('anggotaModalKelola').style.display = 'none';
            });
            
            // Toggle password
            document.getElementById('modalTogglePasswordKelola')?.addEventListener('click', function() {
                const passwordInput = document.getElementById('anggotaPassword');
                const eyeIcon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    eyeIcon.className = 'fas fa-eye-slash';
                } else {
                    passwordInput.type = 'password';
                    eyeIcon.className = 'fas fa-eye';
                }
            });
        }
        
        openTambahAnggotaModal() {
            document.getElementById('modalTitleKelola').textContent = 'Tambah Anggota Baru';
            document.getElementById('editEmailKelola').value = '';
            document.getElementById('anggotaFormKelola').reset();
            document.getElementById('anggotaStatus').value = 'aktif';
            document.getElementById('anggotaSaldo').value = '0';
            
            document.getElementById('anggotaPassword').setAttribute('type', 'password');
            document.getElementById('modalTogglePasswordKelola').innerHTML = '<i class="fas fa-eye"></i>';
            
            document.getElementById('anggotaFormKelola').querySelectorAll('input, select, textarea').forEach(element => {
                element.disabled = false;
            });
            document.getElementById('saveAnggotaBtnKelola').style.display = 'block';
            document.getElementById('cancelBtnKelola').textContent = 'Batal';
            
            document.getElementById('anggotaModalKelola').style.display = 'flex';
        }
        
        loadAnggotaTable() {
            const tableBody = document.getElementById('kelolaAnggotaTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            // Load data dari localStorage
            const allAnggotaData = [...this.anggotaData, ...loadAnggotaFromLoginRegister()];
            
            if (allAnggotaData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 20px; color: #666;">
                            <i class="fas fa-info-circle"></i> Belum ada data anggota
                        </td>
                    </tr>
                `;
                return;
            }
            
            allAnggotaData.forEach(anggota => {
                const row = document.createElement('tr');
                
                const whatsapp = anggota.nowhatsapp || anggota.whatsapp || '';
                const whatsappDisplay = whatsapp && whatsapp !== '-' 
                    ? `<a href="https://wa.me/${whatsapp}" target="_blank" class="whatsapp-link">
                        <i class="fab fa-whatsapp"></i> ${whatsapp}
                      </a>`
                    : '-';
                
                const password = anggota.password || '';
                const passwordId = `password-${anggota.nia || anggota.id || Math.random()}`;
                const passwordDisplay = `
                    <div class="password-container" style="display: inline-flex; align-items: center; gap: 5px;">
                        <input type="password" id="${passwordId}" value="${password}" readonly 
                               style="border: none; background: transparent; width: 100px; font-family: monospace;" class="password-display">
                        <button type="button" class="toggle-password" onclick="togglePasswordVisibility('${passwordId}')" 
                                style="background: none; border: none; cursor: pointer;">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                `;
                
                const statusClass = anggota.status_aktif === 'aktif' ? 'badge-success' : 'badge-danger';
                const statusText = anggota.status_aktif === 'aktif' ? 'Aktif' : 'Tidak Aktif';
                
                row.innerHTML = `
                    <td>${anggota.nia || '-'}</td>
                    <td>${anggota.namalengkap || anggota.nama || '-'}</td>
                    <td>${anggota.alamatemail || anggota.email || '-'}</td>
                    <td>${whatsappDisplay}</td>
                    <td>${passwordDisplay}</td>
                    <td>${anggota.posisi || '-'}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td class="saldo-display">
                        Rp ${(anggota.saldo || 0).toLocaleString('id-ID')}
                    </td>
                    <td>${anggota.tanggalbergabung || anggota.tanggal_bergabung || '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm view-anggota-kelola" data-email="${anggota.alamatemail || anggota.email}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm edit-anggota-kelola" data-email="${anggota.alamatemail || anggota.email}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline btn-sm delete-anggota-kelola" data-email="${anggota.alamatemail || anggota.email}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            this.attachActionListeners();
        }
        
        attachActionListeners() {
            document.querySelectorAll('.view-anggota-kelola').forEach(button => {
                button.addEventListener('click', (e) => {
                    const email = e.currentTarget.getAttribute('data-email');
                    this.viewAnggotaDetail(email);
                });
            });
            
            document.querySelectorAll('.edit-anggota-kelola').forEach(button => {
                button.addEventListener('click', (e) => {
                    const email = e.currentTarget.getAttribute('data-email');
                    this.editAnggota(email);
                });
            });
            
            document.querySelectorAll('.delete-anggota-kelola').forEach(button => {
                button.addEventListener('click', (e) => {
                    const email = e.currentTarget.getAttribute('data-email');
                    this.deleteAnggota(email);
                });
            });
        }
        
        viewAnggotaDetail(email) {
            const allAnggotaData = [...this.anggotaData, ...loadAnggotaFromLoginRegister()];
            const anggota = allAnggotaData.find(a => (a.alamatemail || a.email) === email);
            if (!anggota) return;
            
            const detailHTML = `
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <img src="${anggota.uploadfoto || 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg'}" 
                             alt="Foto" style="width: 120px; height: 120px; border-radius: 10px; object-fit: cover;">
                    </div>
                    <div style="flex: 1;">
                        <h4 style="margin-bottom: 10px; color: var(--primary-dark);">${anggota.namalengkap || anggota.nama}</h4>
                        <p style="color: var(--gray); margin-bottom: 5px;">${anggota.posisi}</p>
                        <p style="color: var(--gray); margin-bottom: 5px;">${anggota.alamatemail || anggota.email}</p>
                        <p style="color: var(--gray); margin-bottom: 5px;">${anggota.nowhatsapp || anggota.whatsapp}</p>
                    </div>
                </div>
                
                <div class="detail-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div>
                        <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">NIA</p>
                        <p>${anggota.nia || '-'}</p>
                    </div>
                    <div>
                        <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">NIK KTP</p>
                        <p>${anggota.nikktp || anggota.nik || '-'}</p>
                    </div>
                    <div>
                        <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">Jenis Kelamin</p>
                        <p>${anggota.jenis_kelamin || '-'}</p>
                    </div>
                    <div>
                        <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">Agama</p>
                        <p>${anggota.agama || '-'}</p>
                    </div>
                    <div>
                        <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">Status Aktif</p>
                        <span class="badge ${anggota.status_aktif === 'aktif' ? 'badge-success' : 'badge-danger'}">
                            ${anggota.status_aktif || 'aktif'}
                        </span>
                    </div>
                    <div>
                        <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">Password</p>
                        <div class="password-container" style="display: inline-flex; align-items: center; gap: 5px;">
                            <input type="password" value="${anggota.password || ''}" readonly 
                                   style="border: none; background: transparent; width: 150px; font-family: monospace;">
                            <button type="button" class="toggle-password" onclick="this.previousElementSibling.type = this.previousElementSibling.type === 'password' ? 'text' : 'password'; this.innerHTML = this.previousElementSibling.type === 'password' ? '<i class=\"fas fa-eye\"></i>' : '<i class=\"fas fa-eye-slash\"></i>'" 
                                    style="background: none; border: none; cursor: pointer;">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">Alamat</p>
                    <p>${anggota.alamatlengkap || anggota.alamat || '-'}</p>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h5 style="margin-bottom: 10px; color: var(--primary-dark);">Informasi Keuangan</h5>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                        <div>
                            <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px; font-size: 12px;">Total Simpanan</p>
                            <p style="color: var(--success); font-weight: 600;">Rp ${(anggota.totalSimpanan || 0).toLocaleString('id-ID')}</p>
                        </div>
                        <div>
                            <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px; font-size: 12px;">Total Pinjaman</p>
                            <p style="color: var(--danger); font-weight: 600;">Rp ${(anggota.totalPinjaman || 0).toLocaleString('id-ID')}</p>
                        </div>
                        <div>
                            <p style="font-weight: 600; color: var(--gray); margin-bottom: 5px; font-size: 12px;">Saldo</p>
                            <p style="color: var(--primary); font-weight: 600;">Rp ${(anggota.saldo || 0).toLocaleString('id-ID')}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('detailAnggotaContent').innerHTML = detailHTML;
            
            const editBtn = document.getElementById('editDetailBtn');
            if (editBtn) {
                editBtn.onclick = () => {
                    this.editAnggota(email);
                    document.getElementById('detailAnggotaModal').style.display = 'none';
                };
            }
            
            document.getElementById('detailAnggotaModal').style.display = 'flex';
        }
        
        editAnggota(email) {
            const allAnggotaData = [...this.anggotaData, ...loadAnggotaFromLoginRegister()];
            const anggota = allAnggotaData.find(a => (a.alamatemail || a.email) === email);
            if (!anggota) return;
            
            document.getElementById('modalTitleKelola').textContent = 'Edit Data Anggota';
            document.getElementById('editEmailKelola').value = email;
            document.getElementById('anggotaNIA').value = anggota.nia || '';
            document.getElementById('anggotaNama').value = anggota.namalengkap || anggota.nama || '';
            document.getElementById('anggotaEmail').value = anggota.alamatemail || anggota.email || '';
            document.getElementById('anggotaPassword').value = anggota.password || '';
            document.getElementById('anggotaWhatsApp').value = anggota.nowhatsapp || anggota.whatsapp || '';
            document.getElementById('anggotaNIK').value = anggota.nikktp || anggota.nik || '';
            document.getElementById('anggotaJenisKelamin').value = anggota.jenis_kelamin || '';
            document.getElementById('anggotaKeterangan').value = anggota.keterangan || '';
            document.getElementById('anggotaPosisi').value = anggota.posisi || '';
            document.getElementById('anggotaStatus').value = anggota.status_aktif || 'aktif';
            document.getElementById('anggotaAlamat').value = anggota.alamatlengkap || anggota.alamat || '';
            document.getElementById('anggotaAgama').value = anggota.agama || '';
            document.getElementById('anggotaSaldo').value = anggota.saldo || 0;
            
            document.getElementById('anggotaPassword').setAttribute('type', 'password');
            document.getElementById('modalTogglePasswordKelola').innerHTML = '<i class="fas fa-eye"></i>';
            
            document.getElementById('anggotaFormKelola').querySelectorAll('input, select, textarea').forEach(element => {
                element.disabled = false;
            });
            document.getElementById('saveAnggotaBtnKelola').style.display = 'block';
            document.getElementById('cancelBtnKelola').textContent = 'Batal';
            
            document.getElementById('anggotaModalKelola').style.display = 'flex';
        }
        
        deleteAnggota(email) {
            if (confirm('Apakah Anda yakin ingin menghapus anggota ini?')) {
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
                const updatedUsers = registeredUsers.filter(user => user.email !== email);
                localStorage.setItem('registeredUsers', JSON.stringify(updatedUsers));
                
                this.anggotaData = this.anggotaData.filter(a => (a.alamatemail || a.email) !== email);
                anggotaDataKelola = this.anggotaData;
                
                localStorage.setItem('anggotaDataKelola', JSON.stringify(this.anggotaData));
                
                this.loadAnggotaTable();
                this.showAlert('success', 'Anggota berhasil dihapus!');
            }
        }
        
        searchAnggota() {
            const searchTerm = document.getElementById('searchAnggotaTab').value.toLowerCase();
            const rows = document.querySelectorAll('#kelolaAnggotaTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        showAlert(type, message) {
            const successAlert = document.getElementById('successAlert');
            const errorAlert = document.getElementById('errorAlert');
            
            if (type === 'success') {
                successAlert.textContent = message;
                successAlert.style.display = 'block';
                errorAlert.style.display = 'none';
                setTimeout(() => { successAlert.style.display = 'none'; }, 4000);
            } else {
                errorAlert.textContent = message;
                errorAlert.style.display = 'block';
                successAlert.style.display = 'none';
                setTimeout(() => { errorAlert.style.display = 'none'; }, 4000);
            }
        }
        
        refreshData() {
            this.anggotaData = JSON.parse(localStorage.getItem('anggotaDataKelola')) || [];
            this.loadAnggotaTable();
        }
        
        saveAnggotaData() {
            const anggotaNIA = document.getElementById('anggotaNIA').value;
            const anggotaNama = document.getElementById('anggotaNama').value;
            const anggotaEmail = document.getElementById('anggotaEmail').value;
            const anggotaPassword = document.getElementById('anggotaPassword').value;
            const anggotaWhatsApp = document.getElementById('anggotaWhatsApp').value;
            const anggotaNIK = document.getElementById('anggotaNIK').value;
            const anggotaJenisKelamin = document.getElementById('anggotaJenisKelamin').value;
            const anggotaKeterangan = document.getElementById('anggotaKeterangan').value;
            const anggotaPosisi = document.getElementById('anggotaPosisi').value;
            const anggotaStatus = document.getElementById('anggotaStatus').value;
            const anggotaAlamat = document.getElementById('anggotaAlamat').value;
            const anggotaAgama = document.getElementById('anggotaAgama').value;
            const anggotaSaldo = document.getElementById('anggotaSaldo').value;
            const editEmail = document.getElementById('editEmailKelola').value;

            if (!anggotaNIA || !anggotaNama || !anggotaEmail || !anggotaPassword) {
                this.showAlert('error', 'Field dengan tanda * harus diisi!');
                return;
            }

            const anggotaDataBaru = {
                nia: anggotaNIA,
                namalengkap: anggotaNama,
                alamatemail: anggotaEmail,
                password: anggotaPassword,
                nowhatsapp: anggotaWhatsApp,
                nikktp: anggotaNIK,
                jenis_kelamin: anggotaJenisKelamin,
                keterangan: anggotaKeterangan,
                posisi: anggotaPosisi,
                status_aktif: anggotaStatus,
                alamatlengkap: anggotaAlamat,
                agama: anggotaAgama,
                saldo: parseFloat(anggotaSaldo) || 0,
                tanggalbergabung: new Date().toLocaleDateString('id-ID')
            };

            if (editEmail) {
                const index = this.anggotaData.findIndex(a => (a.alamatemail || a.email) === editEmail);
                if (index !== -1) {
                    this.anggotaData[index] = { ...this.anggotaData[index], ...anggotaDataBaru };
                }
            } else {
                this.anggotaData.push(anggotaDataBaru);
            }

            localStorage.setItem('anggotaDataKelola', JSON.stringify(this.anggotaData));
            this.loadAnggotaTable();
            this.showAlert('success', editEmail ? 'Anggota berhasil diperbarui!' : 'Anggota berhasil ditambahkan!');
            document.getElementById('anggotaModalKelola').style.display = 'none';
        }
    }

    function togglePasswordVisibility(passwordId) {
        const passwordInput = document.getElementById(passwordId);
        const eyeIcon = passwordInput.nextElementSibling.querySelector('i');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            eyeIcon.className = 'fas fa-eye-slash';
        } else {
            passwordInput.type = 'password';
            eyeIcon.className = 'fas fa-eye';
        }
    }

    function loadAnggotaFromLoginRegister() {
        try {
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
            const anggotaFromRegister = registeredUsers.map(user => ({
                nia: user.id || 'REG-' + Math.floor(1000 + Math.random() * 9000),
                namalengkap: user.fullName || user.name || 'Anggota Baru',
                alamatemail: user.email || '',
                password: user.password || '',
                nowhatsapp: user.phone || user.whatsapp || '-',
                nikktp: user.nik || '-',
                jenis_kelamin: user.gender || '',
                keterangan: 'Registrasi melalui login-register.html',
                posisi: 'Anggota',
                status_aktif: 'aktif',
                alamatlengkap: user.address || '',
                agama: user.religion || '',
                saldo: 0,
                tanggalbergabung: user.registrationDate || new Date().toLocaleDateString('id-ID'),
                uploadfoto: user.photo || ''
            }));
            
            return anggotaFromRegister;
        } catch (error) {
            console.error('Error loading data from login-register:', error);
            return [];
        }
    }

    function loadDataFromLoginRegister() {
        const registeredUsers = loadAnggotaFromLoginRegister();
        if (registeredUsers.length > 0) {
            const existingData = JSON.parse(localStorage.getItem('anggotaDataKelola')) || [];
            const allEmails = new Set(existingData.map(a => a.alamatemail || a.email));
            
            registeredUsers.forEach(user => {
                if (!allEmails.has(user.alamatemail)) {
                    existingData.push(user);
                }
            });
            
            localStorage.setItem('anggotaDataKelola', JSON.stringify(existingData));
            
            if (document.getElementById('kelola-anggota').classList.contains('active') && kelolaAnggotaSystem) {
                kelolaAnggotaSystem.refreshData();
            }
        }
    }

    // ===== SETUP SIDEBAR NAVIGATION LENGKAP =====
    function setupSidebarNavigationFull() {
        console.log('Setting up complete sidebar navigation...');
        
        // 1. Tab Navigation
        document.querySelectorAll('.sidebar-menu a[data-tab]').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all
                document.querySelectorAll('.sidebar-menu a').forEach(i => {
                    i.classList.remove('active');
                });
                
                // Add active to clicked
                this.classList.add('active');
                
                // Show corresponding tab
                const tabId = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                const targetTab = document.getElementById(tabId);
                if (targetTab) {
                    targetTab.classList.add('active');
                    showNotification(`Membuka tab: ${targetTab.querySelector('h1').textContent}`, 'info');
                }
                
                // Close sidebar on mobile
                if (window.innerWidth <= 992) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            });
        });
        
        // 2. External Links
        const externalLinks = [
            { selector: 'a[href="tabungan-digital.html"]', newTab: true },
            { selector: 'a[href="call-alert.html"]', newTab: true },
            { selector: 'a[href^="https://"]', newTab: true }
        ];
        
        externalLinks.forEach(linkConfig => {
            document.querySelectorAll(linkConfig.selector).forEach(link => {
                link.addEventListener('click', function(e) {
                    if (linkConfig.newTab) {
                        e.preventDefault();
                        window.open(this.href, '_blank');
                    }
                });
            });
        });
        
        // 3. Menu Toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebarClose');
        
        if (menuToggle) {
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
        }
        
        if (sidebarClose) {
            sidebarClose.addEventListener('click', () => {
                sidebar.classList.remove('active');
            });
        }
        
        console.log(' Sidebar navigation setup completed');
    }

    // ===== PERBAIKAN 1: AKTIVASI SEMUA TOMBOL MENU DAN TOMBOL AKSI =====
    function activateAllButtons() {
        console.log('Mengaktifkan semua tombol...');
        
        // 1. Tombol Dashboard Utama
        activateDashboardButtons();
        
        // 2. Tombol Data Anggota
        activateAnggotaButtons();
        
        // 3. Tombol Kelola Anggota
        activateKelolaAnggotaButtons();
        
        // 4. Tombol Simpanan
        activateSimpananButtons();
        
        // 5. Tombol Pinjaman
        activatePinjamanButtons();
        
        // 6. Tombol Laporan
        activateLaporanButtons();
        
        // 7. Tombol Unit Usaha
        activateUnitUsahaButtons();
        
        // 8. Tombol SHU
        activateSHUButtons();
        
        // 9. Tombol Pengaturan
        activatePengaturanButtons();
        
        console.log(' Semua tombol telah diaktifkan');
    }

    // ===== FUNGSI PENGATIF TOMBOL PER MODUL =====
    function activateDashboardButtons() {
        // Export Excel
        const exportBtn = document.getElementById('exportExcelBtn');
        if (exportBtn) {
            exportBtn.addEventListener('click', exportToExcel);
        }
        
        // Import Excel
        const importBtn = document.getElementById('importExcelBtn');
        if (importBtn) {
            importBtn.addEventListener('click', () => {
                document.getElementById('importExcelModal').style.display = 'flex';
            });
        }
        
        // Sync Now
        const syncNowBtn = document.getElementById('syncNowBtn');
        if (syncNowBtn) {
            syncNowBtn.addEventListener('click', () => {
                syncDataBetweenSystems();
                showNotification('Sinkronisasi data berhasil!', 'success');
            });
        }
        
        // Force Sync
        const forceSyncBtn = document.getElementById('forceSyncBtn');
        if (forceSyncBtn) {
            forceSyncBtn.addEventListener('click', () => {
                forceSyncAllData();
                showNotification('Force sync berhasil dilakukan!', 'success');
            });
        }
        
        // Refresh Chart
        const refreshChart = document.getElementById('refreshChart');
        if (refreshChart) {
            refreshChart.addEventListener('click', refreshChartData);
        }
        
        // Chart Type Buttons
        const yearlyChart = document.getElementById('yearlyChart');
        const monthlyChart = document.getElementById('monthlyChart');
        
        if (yearlyChart) yearlyChart.addEventListener('click', () => switchChartType('yearly'));
        if (monthlyChart) monthlyChart.addEventListener('click', () => switchChartType('monthly'));
        
        // Lihat Semua Buttons
        const lihatSemuaNotif = document.getElementById('lihatSemuaNotif');
        const lihatSemuaPinjaman = document.getElementById('lihatSemuaPinjaman');
        const lihatSemuaAnggota = document.getElementById('lihatSemuaAnggota');
        
        if (lihatSemuaNotif) {
            lihatSemuaNotif.addEventListener('click', () => {
                document.querySelector('[data-tab="laporan"]').click();
            });
        }
        
        if (lihatSemuaPinjaman) {
            lihatSemuaPinjaman.addEventListener('click', () => {
                document.querySelector('[data-tab="pinjaman"]').click();
            });
        }
        
        if (lihatSemuaAnggota) {
            lihatSemuaAnggota.addEventListener('click', () => {
                document.querySelector('[data-tab="anggota"]').click();
            });
        }
        
        // Home & Dashboard Buttons
        const homeBtn = document.getElementById('homeBtn');
        const dashboardBtn = document.getElementById('dashboardBtn');
        
        if (homeBtn) {
            homeBtn.addEventListener('click', () => {
                window.location.href = 'index.html';
            });
        }
        
        if (dashboardBtn) {
            dashboardBtn.addEventListener('click', () => {
                window.location.href = 'dashboard-admin.html';
            });
        }
        
        console.log(' Dashboard buttons activated');
    }

    function activateAnggotaButtons() {
        // Tambah Anggota Button
        const addMemberBtn = document.getElementById('addMemberBtn');
        if (addMemberBtn) {
            addMemberBtn.addEventListener('click', () => {
                document.getElementById('memberModalTitle').textContent = 'Tambah Anggota Baru';
                document.getElementById('memberId').value = '';
                document.getElementById('memberForm').reset();
                document.getElementById('addMemberModal').style.display = 'flex';
            });
        }
        
        // Save Member Button
        const saveMemberBtn = document.getElementById('saveMemberBtn');
        if (saveMemberBtn) {
            saveMemberBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                await saveMemberData();
                document.getElementById('addMemberModal').style.display = 'none';
            });
        }
        
        // Cancel Member Button
        const cancelMemberBtn = document.getElementById('cancelMemberBtn');
        if (cancelMemberBtn) {
            cancelMemberBtn.addEventListener('click', () => {
                document.getElementById('addMemberModal').style.display = 'none';
            });
        }
        
        console.log(' Anggota buttons activated');
    }

    function activateKelolaAnggotaButtons() {
        // Setup sudah dilakukan di KelolaAnggotaSystem
        console.log(' Kelola anggota buttons activated via system');
    }

    function activateSimpananButtons() {
        // Tambah Simpanan Button
        const addSimpananBtn = document.getElementById('addSimpananBtn');
        if (addSimpananBtn) {
            addSimpananBtn.addEventListener('click', () => {
                document.getElementById('simpananModalTitle').textContent = 'Tambah Simpanan';
                document.getElementById('simpananId').value = '';
                document.getElementById('simpananForm').reset();
                populateAnggotaDropdowns();
                document.getElementById('addSimpananModal').style.display = 'flex';
            });
        }
        
        // Save Simpanan Button
        const saveSimpananBtn = document.getElementById('saveSimpananBtn');
        if (saveSimpananBtn) {
            saveSimpananBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                await saveSimpananData();
                document.getElementById('addSimpananModal').style.display = 'none';
            });
        }
        
        // Cancel Simpanan Button
        const cancelSimpananBtn = document.getElementById('cancelSimpananBtn');
        if (cancelSimpananBtn) {
            cancelSimpananBtn.addEventListener('click', () => {
                document.getElementById('addSimpananModal').style.display = 'none';
            });
        }
        
        // Simpanan Tabs
        document.querySelectorAll('[data-simpanan-tab]').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabType = this.getAttribute('data-simpanan-tab');
                
                // Update active tab
                document.querySelectorAll('[data-simpanan-tab]').forEach(t => {
                    t.classList.remove('active');
                });
                this.classList.add('active');
                
                // Update title
                let title = 'Daftar Simpanan ';
                switch(tabType) {
                    case 'pokok': title += 'Pokok'; break;
                    case 'wajib': title += 'Wajib'; break;
                    case 'sukarela': title += 'Sukarela'; break;
                }
                document.getElementById('simpananTitle').textContent = title;
                
                // Refresh table
                refreshSimpananTable();
            });
        });
        
        console.log(' Simpanan buttons activated');
    }

    function activatePinjamanButtons() {
        // Tambah Pinjaman Button
        const addPinjamanBtn = document.getElementById('addPinjamanBtn');
        if (addPinjamanBtn) {
            addPinjamanBtn.addEventListener('click', () => {
                document.getElementById('pinjamanModalTitle').textContent = 'Tambah Pinjaman';
                document.getElementById('pinjamanId').value = '';
                document.getElementById('pinjamanForm').reset();
                populateAnggotaDropdowns();
                document.getElementById('addPinjamanModal').style.display = 'flex';
            });
        }
        
        // Save Pinjaman Button
        const savePinjamanBtn = document.getElementById('savePinjamanBtn');
        if (savePinjamanBtn) {
            savePinjamanBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                await savePinjamanData();
                document.getElementById('addPinjamanModal').style.display = 'none';
            });
        }
        
        // Cancel Pinjaman Button
        const cancelPinjamanBtn = document.getElementById('cancelPinjamanBtn');
        if (cancelPinjamanBtn) {
            cancelPinjamanBtn.addEventListener('click', () => {
                document.getElementById('addPinjamanModal').style.display = 'none';
            });
        }
        
        console.log(' Pinjaman buttons activated');
    }

    function activateLaporanButtons() {
        // Cetak Laporan Button
        const cetakLaporanBtn = document.getElementById('cetakLaporanBtn');
        if (cetakLaporanBtn) {
            cetakLaporanBtn.addEventListener('click', () => {
                showPrintPreview('laporan');
            });
        }
        
        console.log(' Laporan buttons activated');
    }

    function activateUnitUsahaButtons() {
        // Tambah Barang Button
        const addBarangBtn = document.getElementById('addBarangBtn');
        if (addBarangBtn) {
            addBarangBtn.addEventListener('click', () => {
                document.getElementById('barangModalTitle').textContent = 'Tambah Barang';
                document.getElementById('barangId').value = '';
                document.getElementById('barangForm').reset();
                document.getElementById('addBarangModal').style.display = 'flex';
            });
        }
        
        // Save Barang Button
        const saveBarangBtn = document.getElementById('saveBarangBtn');
        if (saveBarangBtn) {
            saveBarangBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                await saveBarangData();
                document.getElementById('addBarangModal').style.display = 'none';
            });
        }
        
        // Cancel Barang Button
        const cancelBarangBtn = document.getElementById('cancelBarangBtn');
        if (cancelBarangBtn) {
            cancelBarangBtn.addEventListener('click', () => {
                document.getElementById('addBarangModal').style.display = 'none';
            });
        }
        
        console.log(' Unit usaha buttons activated');
    }

    function activateSHUButtons() {
        // Cetak SHU Button
        const cetakSHUBtn = document.getElementById('cetakSHUBtn');
        if (cetakSHUBtn) {
            cetakSHUBtn.addEventListener('click', () => {
                showPrintPreview('shu');
            });
        }
        
        console.log(' SHU buttons activated');
    }

    function activatePengaturanButtons() {
        // Admin Form Submit
        const adminForm = document.getElementById('adminForm');
        if (adminForm) {
            adminForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveAdminSettings();
            });
        }
        
        console.log(' Pengaturan buttons activated');
    }

    // ===== FUNGSI MODAL CONTROL =====
    function setupModalControls() {
        console.log('Setting up modal controls...');
        
        // Close buttons untuk semua modal
        document.querySelectorAll('.modal-close, .btn-outline[id*="cancel"], .btn-outline[onclick*="none"]').forEach(btn => {
            btn.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        // Close modal when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        });
        
        // Import Excel Modal Controls
        const cancelImportBtn = document.getElementById('cancelImportBtn');
        const confirmImportBtn = document.getElementById('confirmImportBtn');
        
        if (cancelImportBtn) {
            cancelImportBtn.addEventListener('click', () => {
                document.getElementById('importExcelModal').style.display = 'none';
            });
        }
        
        if (confirmImportBtn) {
            confirmImportBtn.addEventListener('click', () => {
                importExcelData();
            });
        }
        
        // Confirm Delete Modal Controls
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        
        if (cancelDeleteBtn) {
            cancelDeleteBtn.addEventListener('click', () => {
                document.getElementById('confirmModal').style.display = 'none';
            });
        }
        
        if (confirmDeleteBtn) {
            confirmDeleteBtn.addEventListener('click', async () => {
                await confirmDeleteData();
                document.getElementById('confirmModal').style.display = 'none';
            });
        }
        
        // Print Preview Modal Controls
        const printPreviewModal = document.getElementById('printPreviewModal');
        if (printPreviewModal) {
            const printPreviewClose = printPreviewModal.querySelector('.modal-close');
            if (printPreviewClose) {
                printPreviewClose.addEventListener('click', () => {
                    printPreviewModal.style.display = 'none';
                });
            }
        }
        
        console.log(' Modal controls setup completed');
    }

    // ===== PERBAIKAN 3: MODAL POP-UP DATA ANGGOTA LENGKAP =====
    function setupMemberDetailModals() {
        console.log('Setting up member detail modals...');
        
        // Setup untuk modal detail anggota (Kelola Anggota tab)
        document.addEventListener('click', function(e) {
            // Handle view anggota buttons
            if (e.target.closest('.view-anggota-kelola')) {
                const button = e.target.closest('.view-anggota-kelola');
                const email = button.getAttribute('data-email');
                
                if (email && kelolaAnggotaSystem) {
                    kelolaAnggotaSystem.viewAnggotaDetail(email);
                }
            }
            
            // Handle edit anggota buttons
            if (e.target.closest('.edit-anggota-kelola')) {
                const button = e.target.closest('.edit-anggota-kelola');
                const email = button.getAttribute('data-email');
                
                if (email && kelolaAnggotaSystem) {
                    kelolaAnggotaSystem.editAnggota(email);
                }
            }
            
            // Handle delete anggota buttons
            if (e.target.closest('.delete-anggota-kelola')) {
                const button = e.target.closest('.delete-anggota-kelola');
                const email = button.getAttribute('data-email');
                
                if (email && kelolaAnggotaSystem) {
                    kelolaAnggotaSystem.deleteAnggota(email);
                }
            }
            
            // Handle edit member buttons (Data Anggota tab)
            if (e.target.closest('.edit-member')) {
                const button = e.target.closest('.edit-member');
                const memberId = button.getAttribute('data-id');
                
                if (memberId) {
                    editMember(memberId);
                }
            }
            
            // Handle delete member buttons (Data Anggota tab)
            if (e.target.closest('.delete-member')) {
                const button = e.target.closest('.delete-member');
                const memberId = button.getAttribute('data-id');
                
                if (memberId) {
                    showDeleteConfirm(memberId, 'anggota');
                }
            }
        });
        
        console.log(' Member detail modals setup completed');
    }

    // ===== FUNGSI SAVE DATA =====
    async function saveMemberData() {
        const posisi = document.getElementById('posisi').value;
        const nama = document.getElementById('nama').value;
        const alamat = document.getElementById('alamat').value;
        const jenisKelamin = document.getElementById('jenisKelamin').value;
        const agama = document.getElementById('agama').value;
        const status = document.getElementById('status').value;
        const email = document.getElementById('emailMember').value;
        const whatsapp = document.getElementById('whatsapp').value;
        const nik = document.getElementById('nik').value;
        const tanggalDaftar = document.getElementById('tanggalDaftar').value;
        
        if (!posisi || !nama || !alamat || !jenisKelamin || !agama || !status || !email || !whatsapp || !nik) {
            showNotification('Harap lengkapi semua field yang wajib!', 'error');
            return;
        }
        
        const memberId = document.getElementById('memberId').value;
        
        if (memberId) {
            // EDIT anggota
            const index = anggotaData.findIndex(member => member.id === memberId);
            if (index !== -1) {
                anggotaData[index] = {
                    ...anggotaData[index],
                    posisi: posisi,
                    nama: nama,
                    alamat: alamat,
                    jenisKelamin: jenisKelamin,
                    agama: agama,
                    status: status,
                    email: email,
                    whatsapp: whatsapp,
                    nik: nik,
                    lastUpdated: new Date().toISOString()
                };
            }
        } else {
            // TAMBAH anggota baru
            const idAnggota = 'AGT-' + (anggotaData.length + 1).toString().padStart(3, '0');
            
            const newMember = {
                id: idAnggota,
                posisi: posisi,
                nama: nama,
                alamat: alamat,
                jenisKelamin: jenisKelamin,
                agama: agama,
                status: status,
                email: email,
                whatsapp: whatsapp,
                nik: nik,
                tanggalDaftar: tanggalDaftar,
                statusAktif: 'Aktif',
                foto: '',
                buktiTransfer: '',
                totalSimpanan: 0,
                totalPinjaman: 0,
                saldo: 0,
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            anggotaData.push(newMember);
        }
        
        // Simpan ke localStorage
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
        
        // Update dashboard
        updateDashboardStats();
        updateFinancialDataInRealTime();
        refreshAnggotaTable();
        populateAnggotaDropdowns();
        
        // Refresh sistem kelola anggota
        if (kelolaAnggotaSystem) {
            kelolaAnggotaSystem.refreshData();
        }
        
        showNotification('Data anggota berhasil disimpan!', 'success');
    }

    async function saveSimpananData() {
        const idAnggota = document.getElementById('idAnggotaSimpanan').value;
        const jenisSimpanan = document.getElementById('jenisSimpanan').value;
        const tanggalSimpanan = document.getElementById('tanggalSimpanan').value;
        const nominalSimpanan = parseInt(document.getElementById('nominalSimpanan').value) || 0;
        
        if (!idAnggota || !jenisSimpanan || !tanggalSimpanan || nominalSimpanan <= 0) {
            showNotification('Harap lengkapi semua field dengan benar!', 'error');
            return;
        }
        
        // Find member
        const member = anggotaData.find(m => m.id === idAnggota);
        if (!member) {
            showNotification('Anggota tidak ditemukan!', 'error');
            return;
        }
        
        // Create simpanan record
        const simpananId = 'SPN-' + (simpananData.length + 1).toString().padStart(3, '0');
        const newSimpanan = {
            id: simpananId,
            idAnggota: idAnggota,
            nama: member.nama,
            jenisSimpanan: jenisSimpanan,
            tanggalSetor: tanggalSimpanan,
            nominal: nominalSimpanan,
            createdAt: new Date().toISOString()
        };
        
        simpananData.push(newSimpanan);
        localStorage.setItem('simpananData', JSON.stringify(simpananData));
        
        // Update real-time financial data
        updateFinancialDataInRealTime();
        
        // Update chart
        refreshChartData();
        
        showNotification(`Simpanan ${jenisSimpanan} sebesar Rp ${nominalSimpanan.toLocaleString('id-ID')} berhasil disimpan!`, 'success');
        
        // Refresh tables
        refreshSimpananTable();
    }

    async function savePinjamanData() {
        const idAnggota = document.getElementById('idAnggotaPinjaman').value;
        const jumlahPinjaman = parseInt(document.getElementById('jumlahPinjaman').value) || 0;
        const tanggalPinjaman = document.getElementById('tanggalPinjaman').value;
        const jangkaWaktu = document.getElementById('jangkaWaktu').value;
        const bungaPinjaman = parseFloat(document.getElementById('bungaPinjaman').value) || 0;
        
        if (!idAnggota || jumlahPinjaman <= 0 || !tanggalPinjaman || !jangkaWaktu || bungaPinjaman <= 0) {
            showNotification('Harap lengkapi semua field dengan benar!', 'error');
            return;
        }
        
        // Find member
        const member = anggotaData.find(m => m.id === idAnggota);
        if (!member) {
            showNotification('Anggota tidak ditemukan!', 'error');
            return;
        }
        
        // Create pinjaman record
        const pinjamanId = 'PNH-' + (pinjamanData.length + 1).toString().padStart(3, '0');
        const newPinjaman = {
            id: pinjamanId,
            idAnggota: idAnggota,
            namaAnggota: member.nama,
            jumlahPinjaman: jumlahPinjaman,
            tanggalPinjam: tanggalPinjaman,
            jangkaWaktu: jangkaWaktu,
            bunga: bungaPinjaman,
            sisaHutang: jumlahPinjaman,
            status: 'Aktif',
            createdAt: new Date().toISOString()
        };
        
        pinjamanData.push(newPinjaman);
        localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
        
        // Update real-time financial data
        updateFinancialDataInRealTime();
        
        showNotification(`Pinjaman sebesar Rp ${jumlahPinjaman.toLocaleString('id-ID')} berhasil disimpan!`, 'success');
        
        // Refresh tables
        refreshPinjamanTable();
    }

    async function saveBarangData() {
        const namaBarang = document.getElementById('namaBarang').value;
        const stokBarang = parseInt(document.getElementById('stokBarang').value) || 0;
        const hargaBeli = parseInt(document.getElementById('hargaBeli').value) || 0;
        const hargaJual = parseInt(document.getElementById('hargaJual').value) || 0;
        
        if (!namaBarang || stokBarang <= 0 || hargaBeli <= 0 || hargaJual <= 0) {
            showNotification('Harap lengkapi semua field dengan benar!', 'error');
            return;
        }
        
        const laba = hargaJual - hargaBeli;
        
        // Create barang record
        const barangId = 'BRG-' + (barangData.length + 1).toString().padStart(3, '0');
        const newBarang = {
            id: barangId,
            namaBarang: namaBarang,
            stok: stokBarang,
            hargaBeli: hargaBeli,
            hargaJual: hargaJual,
            laba: laba,
            createdAt: new Date().toISOString()
        };
        
        barangData.push(newBarang);
        localStorage.setItem('barangData', JSON.stringify(barangData));
        
        showNotification(`Barang "${namaBarang}" berhasil ditambahkan!`, 'success');
        
        // Refresh tables
        refreshBarangTable();
    }

    function saveAdminSettings() {
        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const role = document.getElementById('role').value;
        const norek = document.getElementById('norek').value;
        
        // Update UI
        document.getElementById('topNavUsername').textContent = username;
        document.getElementById('topNavRole').textContent = role;
        document.getElementById('adminUsername').textContent = username;
        document.getElementById('adminEmail').textContent = email;
        document.getElementById('adminRole').textContent = role;
        document.getElementById('adminRekening').textContent = norek;
        
        showNotification('Pengaturan admin berhasil disimpan!', 'success');
    }

    // ===== FUNGSI REFRESH DATA =====
    function refreshAnggotaTable() {
        const tableBody = document.querySelector('#anggotaFullTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        anggotaData.forEach(member => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${member.id}</td>
                <td>${member.nama}</td>
                <td>${member.nik}</td>
                <td>${member.jenisKelamin}</td>
                <td>${member.alamat}</td>
                <td>${member.whatsapp}</td>
                <td>${member.tanggalDaftar}</td>
                <td><span class="badge badge-success">${member.statusAktif}</span></td>
                <td>
                    <button class="btn btn-outline btn-sm edit-member" data-id="${member.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-member" data-id="${member.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners
        document.querySelectorAll('.edit-member').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                editMember(memberId);
            });
        });
        
        document.querySelectorAll('.delete-member').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                showDeleteConfirm(memberId, 'anggota');
            });
        });
    }

    function refreshSimpananTable() {
        const tableBody = document.querySelector('#simpananTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        // Filter berdasarkan tab aktif
        const activeTab = document.querySelector('.tabs .tab.active');
        const tabType = activeTab ? activeTab.getAttribute('data-simpanan-tab') : 'pokok';
        
        const filteredData = simpananData.filter(s => 
            s.jenisSimpanan.toLowerCase().includes(tabType.toLowerCase())
        );
        
        filteredData.forEach(simpanan => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${simpanan.idAnggota}</td>
                <td>${simpanan.nama}</td>
                <td>${simpanan.jenisSimpanan}</td>
                <td>${simpanan.tanggalSetor}</td>
                <td>Rp ${simpanan.nominal.toLocaleString('id-ID')}</td>
                <td>Rp ${calculateTotalSimpanan(simpanan.idAnggota, simpanan.jenisSimpanan).toLocaleString('id-ID')}</td>
                <td>
                    <button class="btn btn-outline btn-sm edit-simpanan" data-id="${simpanan.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-simpanan" data-id="${simpanan.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners
        document.querySelectorAll('.edit-simpanan').forEach(btn => {
            btn.addEventListener('click', function() {
                const simpananId = this.getAttribute('data-id');
                editSimpanan(simpananId);
            });
        });
        
        document.querySelectorAll('.delete-simpanan').forEach(btn => {
            btn.addEventListener('click', function() {
                const simpananId = this.getAttribute('data-id');
                showDeleteConfirm(simpananId, 'simpanan');
            });
        });
    }

    function editSimpanan(simpananId) {
        const simpanan = simpananData.find(s => s.id === simpananId);
        if (!simpanan) return;
        
        document.getElementById('simpananModalTitle').textContent = 'Edit Simpanan';
        document.getElementById('simpananId').value = simpanan.id;
        document.getElementById('idAnggotaSimpanan').value = simpanan.idAnggota;
        document.getElementById('jenisSimpanan').value = simpanan.jenisSimpanan;
        document.getElementById('tanggalSimpanan').value = simpanan.tanggalSetor;
        document.getElementById('nominalSimpanan').value = simpanan.nominal;
        
        populateAnggotaDropdowns();
        document.getElementById('addSimpananModal').style.display = 'flex';
    }

    function refreshPinjamanTable() {
        const tableBody = document.querySelector('#pinjamanFullTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        pinjamanData.forEach(pinjaman => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${pinjaman.id}</td>
                <td>${pinjaman.namaAnggota}</td>
                <td>Rp ${pinjaman.jumlahPinjaman.toLocaleString('id-ID')}</td>
                <td>${pinjaman.tanggalPinjam}</td>
                <td>${pinjaman.jangkaWaktu}</td>
                <td>${pinjaman.bunga}%</td>
                <td>Rp ${pinjaman.sisaHutang.toLocaleString('id-ID')}</td>
                <td><span class="badge badge-success">${pinjaman.status}</span></td>
                <td>
                    <button class="btn btn-outline btn-sm edit-pinjaman" data-id="${pinjaman.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-pinjaman" data-id="${pinjaman.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners
        document.querySelectorAll('.edit-pinjaman').forEach(btn => {
            btn.addEventListener('click', function() {
                const pinjamanId = this.getAttribute('data-id');
                editPinjaman(pinjamanId);
            });
        });
        
        document.querySelectorAll('.delete-pinjaman').forEach(btn => {
            btn.addEventListener('click', function() {
                const pinjamanId = this.getAttribute('data-id');
                showDeleteConfirm(pinjamanId, 'pinjaman');
            });
        });
    }

    function editPinjaman(pinjamanId) {
        const pinjaman = pinjamanData.find(p => p.id === pinjamanId);
        if (!pinjaman) return;
        
        document.getElementById('pinjamanModalTitle').textContent = 'Edit Pinjaman';
        document.getElementById('pinjamanId').value = pinjaman.id;
        document.getElementById('idAnggotaPinjaman').value = pinjaman.idAnggota;
        document.getElementById('jumlahPinjaman').value = pinjaman.jumlahPinjaman;
        document.getElementById('tanggalPinjaman').value = pinjaman.tanggalPinjam;
        document.getElementById('jangkaWaktu').value = pinjaman.jangkaWaktu;
        document.getElementById('bungaPinjaman').value = pinjaman.bunga;
        
        populateAnggotaDropdowns();
        document.getElementById('addPinjamanModal').style.display = 'flex';
    }

    function refreshBarangTable() {
        const tableBody = document.querySelector('#barangTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        barangData.forEach(barang => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${barang.id}</td>
                <td>${barang.namaBarang}</td>
                <td>${barang.stok}</td>
                <td>Rp ${barang.hargaBeli.toLocaleString('id-ID')}</td>
                <td>Rp ${barang.hargaJual.toLocaleString('id-ID')}</td>
                <td>Rp ${barang.laba.toLocaleString('id-ID')}</td>
                <td>
                    <button class="btn btn-outline btn-sm edit-barang" data-id="${barang.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-barang" data-id="${barang.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    function calculateTotalSimpanan(idAnggota, jenisSimpanan) {
        return simpananData
            .filter(s => s.idAnggota === idAnggota && s.jenisSimpanan === jenisSimpanan)
            .reduce((sum, s) => sum + s.nominal, 0);
    }

    function populateAnggotaDropdowns() {
        const dropdowns = [
            document.getElementById('idAnggotaSimpanan'),
            document.getElementById('idAnggotaPinjaman')
        ];
        
        dropdowns.forEach(dropdown => {
            if (!dropdown) return;
            
            dropdown.innerHTML = '<option value="">Pilih Anggota</option>';
            anggotaData.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.id} - ${member.nama}`;
                dropdown.appendChild(option);
            });
        });
    }

    // ===== FUNGSI UPDATE DASHBOARD =====
    function updateDashboardStats() {
        document.getElementById('totalAnggota').textContent = anggotaData.length || '0';
        
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        document.getElementById('totalSimpanan').textContent = totalSimpanan > 0 ? formatRupiah(totalSimpanan) : 'Rp 0';
        
        const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
        document.getElementById('totalPinjaman').textContent = totalPinjaman > 0 ? formatRupiah(totalPinjaman) : 'Rp 0';
        
        const totalSHU = totalSimpanan * 0.1;
        document.getElementById('totalSHU').textContent = totalSHU > 0 ? formatRupiah(totalSHU) : 'Rp 0';
        
        const totalKas = Math.max(0, totalSimpanan - totalPinjaman);
        document.getElementById('totalKas').textContent = totalKas > 0 ? formatRupiah(totalKas) : 'Rp 0';
        
        // Update juga tampilan di tabel pinjaman terbaru
        updatePinjamanTerbaruTable();
        updateAnggotaBaruTable();
    }

    function updateFinancialDataInRealTime() {
        // Calculate totals
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
        const totalSHU = totalSimpanan * 0.1;
        const totalKas = Math.max(0, totalSimpanan - totalPinjaman);
        
        // Update dashboard with animation
        animateNumber('totalSimpanan', totalSimpanan, 'Rp ');
        animateNumber('totalPinjaman', totalPinjaman, 'Rp ');
        animateNumber('totalSHU', totalSHU, 'Rp ');
        animateNumber('totalKas', totalKas, 'Rp ');
        
        // Update per anggota
        updateAnggotaFinancialData();
        
        // Save timestamp
        const lastSyncTime = new Date().toLocaleString('id-ID');
        const lastSyncElement = document.getElementById('lastSyncTime');
        if (lastSyncElement) {
            lastSyncElement.textContent = `Terakhir sync: ${lastSyncTime}`;
        }
    }

    function animateNumber(elementId, targetValue, prefix = '') {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const currentText = element.textContent.replace(prefix, '').replace(/[^0-9]/g, '');
        const currentValue = parseInt(currentText) || 0;
        
        // Only animate if difference is significant
        if (Math.abs(targetValue - currentValue) > 1000) {
            let startValue = currentValue;
            const duration = 800;
            const startTime = Date.now();
            
            const animate = () => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const current = Math.floor(startValue + (targetValue - startValue) * easeOutQuart);
                
                element.textContent = prefix + formatRupiah(current);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    element.textContent = prefix + formatRupiah(targetValue);
                }
            };
            
            animate();
        } else {
            element.textContent = prefix + formatRupiah(targetValue);
        }
    }

    function updateAnggotaFinancialData() {
        anggotaData.forEach(member => {
            const memberSimpanan = simpananData
                .filter(s => s.idAnggota === member.id)
                .reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
            
            const memberPinjaman = pinjamanData
                .filter(p => p.idAnggota === member.id)
                .reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
            
            member.totalSimpanan = memberSimpanan;
            member.totalPinjaman = memberPinjaman;
            member.saldo = memberSimpanan - memberPinjaman;
        });
        
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
    }

    function formatRupiah(amount) {
        if (amount === 0) return 'Rp 0';
        if (amount >= 1000000000) {
            return 'Rp ' + (amount / 1000000000).toFixed(1) + ' M';
        } else if (amount >= 1000000) {
            return 'Rp ' + (amount / 1000000).toFixed(1) + ' Jt';
        } else {
            return 'Rp ' + amount.toLocaleString('id-ID');
        }
    }

    // ===== FUNGSI CHART =====
    function setupFinanceChart() {
        const ctx = document.getElementById('financeChart');
        if (!ctx) {
            console.error('Canvas element not found');
            return;
        }
        
        // Destroy existing chart if exists
        if (financeChart) {
            financeChart.destroy();
        }
        
        // Generate sample data for chart
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
        const currentMonth = new Date().getMonth();
        const displayMonths = months.slice(Math.max(0, currentMonth - 5), currentMonth + 1);
        
        // Calculate real data from simpananData
        const monthlyData = {};
        simpananData.forEach(simpanan => {
            if (simpanan.tanggalSetor) {
                const date = new Date(simpanan.tanggalSetor);
                const month = date.getMonth();
                const year = date.getFullYear();
                const key = `${year}-${month}`;
                
                if (!monthlyData[key]) {
                    monthlyData[key] = 0;
                }
                monthlyData[key] += parseInt(simpanan.nominal) || 0;
            }
        });
        
        // Prepare chart data
        const chartData = displayMonths.map((month, index) => {
            const monthIndex = (currentMonth - 5 + index + 12) % 12;
            const year = new Date().getFullYear();
            const key = `${year}-${monthIndex}`;
            return monthlyData[key] || Math.floor(Math.random() * 5000000) + 1000000;
        });
        
        financeChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: displayMonths,
                datasets: [{
                    label: 'Total Simpanan (Rp)',
                    data: chartData,
                    borderColor: '#2e7d32',
                    backgroundColor: 'rgba(46, 125, 50, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += 'Rp ' + context.parsed.y.toLocaleString('id-ID');
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                if (value >= 1000000) {
                                    return 'Rp ' + (value / 1000000).toFixed(1) + ' Jt';
                                }
                                return 'Rp ' + value.toLocaleString('id-ID');
                            }
                        }
                    }
                }
            }
        });
        
        console.log('Finance chart setup completed');
    }

    function refreshChartData() {
        loadLocalStorageData();
        setupFinanceChart();
        showNotification('Grafik diperbarui', 'info');
    }

    function switchChartType(type) {
        refreshChartData();
        showNotification(`Menampilkan grafik ${type === 'monthly' ? 'bulanan' : 'tahunan'}`, 'info');
    }

    // ===== FUNGSI EXPORT/IMPORT EXCEL =====
    function exportToExcel() {
        try {
            const wb = XLSX.utils.book_new();
            
            // 1. Sheet Data Anggota
            const wsAnggota = XLSX.utils.json_to_sheet(anggotaData.map(a => ({
                'ID_Anggota': a.id || '',
                'Posisi': a.posisi || '',
                'Nama_Lengkap': a.nama || '',
                'Alamat': a.alamat || '',
                'Jenis_Kelamin': a.jenisKelamin || '',
                'Agama': a.agama || '',
                'Status_Pernikahan': a.status || '',
                'Email': a.email || '',
                'WhatsApp': a.whatsapp || '',
                'NIK': a.nik || '',
                'Tanggal_Daftar': a.tanggalDaftar || '',
                'Status_Aktif': a.statusAktif || 'Aktif',
                'Total_Simpanan': a.totalSimpanan || 0,
                'Total_Pinjaman': a.totalPinjaman || 0,
                'Saldo': a.saldo || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsAnggota, 'Data Anggota');
            
            // 2. Sheet Data Simpanan
            const wsSimpanan = XLSX.utils.json_to_sheet(simpananData.map(s => ({
                'ID_Simpanan': s.id || '',
                'ID_Anggota': s.idAnggota || '',
                'Nama_Anggota': s.nama || '',
                'Jenis_Simpanan': s.jenisSimpanan || '',
                'Tanggal_Setor': s.tanggalSetor || '',
                'Nominal': s.nominal || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsSimpanan, 'Data Simpanan');
            
            // 3. Sheet Data Pinjaman
            const wsPinjaman = XLSX.utils.json_to_sheet(pinjamanData.map(p => ({
                'ID_Pinjaman': p.id || '',
                'ID_Anggota': p.idAnggota || '',
                'Nama_Anggota': p.namaAnggota || '',
                'Jumlah_Pinjaman': p.jumlahPinjaman || 0,
                'Tanggal_Pinjam': p.tanggalPinjam || '',
                'Jangka_Waktu': p.jangkaWaktu || '',
                'Bunga (%)': p.bunga || 0,
                'Sisa_Hutang': p.sisaHutang || 0,
                'Status': p.status || 'Aktif'
            })));
            XLSX.utils.book_append_sheet(wb, wsPinjaman, 'Data Pinjaman');
            
            // 4. Sheet Data Barang
            const wsBarang = XLSX.utils.json_to_sheet(barangData.map(b => ({
                'ID_Barang': b.id || '',
                'Nama_Barang': b.namaBarang || '',
                'Stok': b.stok || 0,
                'Harga_Beli': b.hargaBeli || 0,
                'Harga_Jual': b.hargaJual || 0,
                'Laba': b.laba || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsBarang, 'Data Barang');
            
            // 5. Sheet Data Transaksi
            const wsTransaksi = XLSX.utils.json_to_sheet(transaksiData.map(t => ({
                'ID_Transaksi': t.id || '',
                'Tanggal': t.tanggal || '',
                'Jenis': t.jenis || '',
                'Keterangan': t.keterangan || '',
                'Nominal': t.nominal || 0,
                'Saldo_Akhir': t.saldoAkhir || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsTransaksi, 'Data Transaksi');
            
            // Generate filename with timestamp
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-');
            const filename = `Data_Koperasi_Asmara_Tani_${timestamp}.xlsx`;
            
            XLSX.writeFile(wb, filename);
            showNotification('Data berhasil diexport ke Excel!', 'success');
            
        } catch (error) {
            console.error('Error exporting to Excel:', error);
            showNotification('Gagal mengexport data: ' + error.message, 'error');
        }
    }

    function importExcelData() {
        const fileInput = document.getElementById('excelFile');
        const importType = document.getElementById('importType').value;
        
        if (fileInput.files.length === 0) {
            showNotification('Pilih file Excel terlebih dahulu!', 'error');
            return;
        }
        
        const file = fileInput.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
            if (importType === 'anggota') {
                jsonData.forEach(item => {
                    const newMember = {
                        id: item.ID_Anggota || 'AGT-' + (anggotaData.length + 1).toString().padStart(3, '0'),
                        posisi: item.Posisi || 'Anggota',
                        nama: item.Nama_Lengkap || item.Nama,
                        alamat: item.Alamat,
                        jenisKelamin: item.Jenis_Kelamin,
                        agama: item.Agama,
                        status: item.Status_Pernikahan,
                        email: item.Email,
                        whatsapp: item.WhatsApp,
                        nik: item.NIK,
                        tanggalDaftar: item.Tanggal_Daftar || new Date().toLocaleDateString('id-ID'),
                        statusAktif: item.Status_Aktif || 'Aktif',
                        totalSimpanan: item.Total_Simpanan || 0,
                        totalPinjaman: item.Total_Pinjaman || 0,
                        saldo: item.Saldo || 0
                    };
                    
                    const existingIndex = anggotaData.findIndex(m => m.id === newMember.id);
                    if (existingIndex !== -1) {
                        anggotaData[existingIndex] = newMember;
                    } else {
                        anggotaData.push(newMember);
                    }
                });
                
                localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
                localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
                refreshAnggotaTable();
                populateAnggotaDropdowns();
                
                if (kelolaAnggotaSystem) {
                    kelolaAnggotaSystem.refreshData();
                }
                
            } else if (importType === 'simpanan') {
                jsonData.forEach(item => {
                    const newSimpanan = {
                        id: item.ID_Simpanan || 'SPN-' + (simpananData.length + 1).toString().padStart(3, '0'),
                        idAnggota: item.ID_Anggota,
                        nama: item.Nama_Anggota,
                        jenisSimpanan: item.Jenis_Simpanan,
                        tanggalSetor: item.Tanggal_Setor,
                        nominal: parseInt(item.Nominal) || 0
                    };
                    
                    const existingIndex = simpananData.findIndex(s => s.id === newSimpanan.id);
                    if (existingIndex !== -1) {
                        simpananData[existingIndex] = newSimpanan;
                    } else {
                        simpananData.push(newSimpanan);
                    }
                });
                
                localStorage.setItem('simpananData', JSON.stringify(simpananData));
                refreshSimpananTable();
            } else if (importType === 'pinjaman') {
                jsonData.forEach(item => {
                    const newPinjaman = {
                        id: item.ID_Pinjaman || 'PNH-' + (pinjamanData.length + 1).toString().padStart(3, '0'),
                        idAnggota: item.ID_Anggota,
                        namaAnggota: item.Nama_Anggota,
                        jumlahPinjaman: parseInt(item.Jumlah_Pinjaman) || 0,
                        tanggalPinjam: item.Tanggal_Pinjam,
                        jangkaWaktu: item.Jangka_Waktu,
                        bunga: parseFloat(item['Bunga (%)']) || 0,
                        sisaHutang: parseInt(item.Sisa_Hutang) || 0,
                        status: item.Status || 'Aktif'
                    };
                    
                    const existingIndex = pinjamanData.findIndex(p => p.id === newPinjaman.id);
                    if (existingIndex !== -1) {
                        pinjamanData[existingIndex] = newPinjaman;
                    } else {
                        pinjamanData.push(newPinjaman);
                    }
                });
                
                localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
                refreshPinjamanTable();
            } else if (importType === 'barang') {
                jsonData.forEach(item => {
                    const newBarang = {
                        id: item.ID_Barang || 'BRG-' + (barangData.length + 1).toString().padStart(3, '0'),
                        namaBarang: item.Nama_Barang,
                        stok: parseInt(item.Stok) || 0,
                        hargaBeli: parseInt(item.Harga_Beli) || 0,
                        hargaJual: parseInt(item.Harga_Jual) || 0,
                        laba: parseInt(item.Laba) || 0
                    };
                    
                    const existingIndex = barangData.findIndex(b => b.id === newBarang.id);
                    if (existingIndex !== -1) {
                        barangData[existingIndex] = newBarang;
                    } else {
                        barangData.push(newBarang);
                    }
                });
                
                localStorage.setItem('barangData', JSON.stringify(barangData));
                refreshBarangTable();
            }
            
            updateDashboardStats();
            updateFinancialDataInRealTime();
            showNotification('Data berhasil diimport!', 'success');
            document.getElementById('importExcelModal').style.display = 'none';
        };
        
        reader.readAsArrayBuffer(file);
    }

    // ===== FUNGSI SINCRONISASI DATA =====
    function syncDataBetweenSystems() {
        console.log('Synchronizing data between systems...');
        
        // 1. Load data from login-register
        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
        
        console.log('Registered users found:', registeredUsers.length);
        
        // 2. Sync to anggotaData (dashboard system)
        registeredUsers.forEach((user, index) => {
            const existingIndex = anggotaData.findIndex(a => 
                a.email === user.email || 
                a.nik === user.nik ||
                a.whatsapp === user.phone
            );
            
            if (existingIndex === -1) {
                const newAnggota = {
                    id: 'AGT-' + (anggotaData.length + 1).toString().padStart(3, '0'),
                    posisi: 'Anggota',
                    nama: user.fullName || 'Anggota Baru',
                    alamat: user.address || '',
                    jenisKelamin: user.gender || 'Laki-laki',
                    agama: user.religion || 'Islam',
                    status: 'Belum Menikah',
                    email: user.email || '',
                    whatsapp: user.phone || '',
                    nik: user.nik || '',
                    tanggalDaftar: user.registrationDate || new Date().toLocaleDateString('id-ID'),
                    statusAktif: 'Aktif',
                    foto: user.photo || '',
                    totalSimpanan: 0,
                    totalPinjaman: 0,
                    saldo: 0,
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                console.log(`Adding new member ${index + 1}:`, newAnggota.nama);
                anggotaData.push(newAnggota);
            }
        });
        
        // 3. Save synchronized data
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
        
        // 4. Also sync to kelola anggota system
        if (kelolaAnggotaSystem) {
            kelolaAnggotaSystem.anggotaData = [...kelolaAnggotaSystem.anggotaData, ...anggotaData];
            kelolaAnggotaSystem.loadAnggotaTable();
            console.log(' Kelola anggota system refreshed');
        }
        
        // 5. Refresh UI
        refreshAnggotaTable();
        populateAnggotaDropdowns();
        updateDashboardStats();
        
        console.log(' Data synchronization completed:', {
            registeredUsers: registeredUsers.length,
            anggotaData: anggotaData.length
        });
        
        if (registeredUsers.length > 0) {
            showNotification(` ${registeredUsers.length} anggota berhasil disinkronisasi`, 'success');
        }
    }

    function forceSyncAllData() {
        loadLocalStorageData();
        syncDataBetweenSystems();
        updateFinancialDataInRealTime();
        refreshChartData();
        showNotification('Semua data berhasil disinkronisasi!', 'success');
    }

    function setupAutoRefresh() {
        // Auto refresh data every 30 seconds
        setInterval(() => {
            loadLocalStorageData();
            updateFinancialDataInRealTime();
            refreshChartData();
        }, 30000);
        
        // Auto sync between systems every 60 seconds
        setInterval(() => {
            syncDataBetweenSystems();
        }, 60000);
        
        console.log('Auto refresh setup completed');
    }

    // ===== FUNGSI LAINNYA =====
    function loadInitialData() {
        console.log('Loading initial data...');
        
        loadLocalStorageData();
        setupFinanceChart();
        updateDashboardStats();
        refreshAnggotaTable();
        refreshSimpananTable();
        refreshPinjamanTable();
        refreshBarangTable();
        populateAnggotaDropdowns();
        updateActivityList();
        
        // Update current year
        const currentYear = new Date().getFullYear();
        document.getElementById('currentYear').textContent = currentYear;
        document.getElementById('currentYearFooter').textContent = currentYear;
        
        updateFinancialDataInRealTime();
        syncDataBetweenSystems();
        
        console.log(' Initial data loaded successfully');
        console.log('Status sistem:');
        console.log('- Anggota:', anggotaData.length);
        console.log('- Simpanan:', simpananData.length);
        console.log('- Pinjaman:', pinjamanData.length);
        console.log('- Barang:', barangData.length);
    }

    function editMember(memberId) {
        const member = anggotaData.find(m => m.id === memberId);
        if (!member) return;
        
        document.getElementById('memberModalTitle').textContent = 'Edit Anggota';
        document.getElementById('memberId').value = member.id;
        document.getElementById('posisi').value = member.posisi;
        document.getElementById('nama').value = member.nama;
        document.getElementById('alamat').value = member.alamat;
        document.getElementById('jenisKelamin').value = member.jenisKelamin;
        document.getElementById('agama').value = member.agama;
        document.getElementById('status').value = member.status;
        document.getElementById('emailMember').value = member.email;
        document.getElementById('whatsapp').value = member.whatsapp;
        document.getElementById('nik').value = member.nik;
        
        document.getElementById('addMemberModal').style.display = 'flex';
    }

    function showDeleteConfirm(id, type) {
        currentEditingId = id;
        currentEditingType = type;
        
        let message = '';
        switch(type) {
            case 'anggota':
                const member = anggotaData.find(m => m.id === id);
                message = `Apakah Anda yakin ingin menghapus anggota "${member?.nama}"?`;
                break;
            case 'simpanan':
                message = 'Apakah Anda yakin ingin menghapus data simpanan ini?';
                break;
            case 'pinjaman':
                message = 'Apakah Anda yakin ingin menghapus data pinjaman ini?';
                break;
            case 'barang':
                message = 'Apakah Anda yakin ingin menghapus data barang ini?';
                break;
        }
        
        document.getElementById('confirmMessage').textContent = message;
        document.getElementById('confirmModal').style.display = 'flex';
    }

    async function confirmDeleteData() {
        if (currentEditingType === 'anggota') {
            anggotaData = anggotaData.filter(member => member.id !== currentEditingId);
            localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
            localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
            refreshAnggotaTable();
            populateAnggotaDropdowns();
            
            if (kelolaAnggotaSystem) {
                kelolaAnggotaSystem.refreshData();
            }
            
        } else if (currentEditingType === 'simpanan') {
            simpananData = simpananData.filter(simpanan => simpanan.id !== currentEditingId);
            localStorage.setItem('simpananData', JSON.stringify(simpananData));
            refreshSimpananTable();
            
        } else if (currentEditingType === 'pinjaman') {
            pinjamanData = pinjamanData.filter(pinjaman => pinjaman.id !== currentEditingId);
            localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
            refreshPinjamanTable();
            
        } else if (currentEditingType === 'barang') {
            barangData = barangData.filter(barang => barang.id !== currentEditingId);
            localStorage.setItem('barangData', JSON.stringify(barangData));
            refreshBarangTable();
        }
        
        updateDashboardStats();
        updateFinancialDataInRealTime();
        showNotification('Data berhasil dihapus!', 'success');
    }

    function showPrintPreview(type) {
        const previewContent = document.getElementById('printPreviewContent');
        
        if (type === 'laporan') {
            const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
            const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
            const totalSHU = totalSimpanan * 0.1;
            const totalKas = Math.max(0, totalSimpanan - totalPinjaman);
            
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = now.toLocaleDateString('id-ID', options);
            
            previewContent.innerHTML = `
                <style>
                    @media print {
                        body * {
                            visibility: hidden;
                        }
                        .print-preview-content, .print-preview-content * {
                            visibility: visible;
                        }
                        .print-preview-content {
                            position: absolute;
                            left: 0;
                            top: 0;
                            width: 100%;
                            padding: 20px;
                        }
                        .no-print {
                            display: none !important;
                        }
                    }
                    .print-preview-content {
                        font-family: Arial, sans-serif;
                        padding: 20px;
                    }
                    .header {
                        text-align: center;
                        border-bottom: 3px solid #2e7d32;
                        padding-bottom: 20px;
                        margin-bottom: 30px;
                    }
                    .header h1 {
                        color: #2e7d32;
                        margin-bottom: 5px;
                    }
                    .header .subtitle {
                        color: #666;
                        font-size: 14px;
                    }
                    .neraca-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin: 20px 0;
                    }
                    .neraca-table th {
                        background-color: #f5f5f5;
                        padding: 12px;
                        text-align: left;
                        border: 1px solid #ddd;
                        font-weight: bold;
                    }
                    .neraca-table td {
                        padding: 12px;
                        border: 1px solid #ddd;
                    }
                    .total-row {
                        background-color: #e8f5e9;
                        font-weight: bold;
                    }
                    .section-title {
                        background-color: #2e7d32;
                        color: white;
                        padding: 10px;
                        margin-top: 30px;
                        font-weight: bold;
                    }
                    .footer {
                        margin-top: 50px;
                        text-align: right;
                        border-top: 1px solid #ddd;
                        padding-top: 20px;
                        font-size: 12px;
                        color: #666;
                    }
                </style>
                
                <div class="print-preview-content">
                    <div class="header">
                        <h1>KOPERASI ASMARA TANI</h1>
                        <div class="subtitle">#koperasijenius</div>
                        <h2>LAPORAN NERACA</h2>
                        <div>Periode: ${formattedDate}</div>
                    </div>
                    
                    <div class="section-title">AKTIVA</div>
                    <table class="neraca-table">
                        <tr>
                            <td>Kas</td>
                            <td style="text-align: right;">Rp ${totalKas.toLocaleString('id-ID')}</td>
                        </tr>
                        <tr>
                            <td>Simpanan Bank</td>
                            <td style="text-align: right;">Rp ${(totalSimpanan * 0.8).toLocaleString('id-ID')}</td>
                        </tr>
                        <tr>
                            <td>Piutang Anggota</td>
                            <td style="text-align: right;">Rp ${totalPinjaman.toLocaleString('id-ID')}</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL AKTIVA</strong></td>
                            <td style="text-align: right;"><strong>Rp ${(totalKas + (totalSimpanan * 0.8) + totalPinjaman).toLocaleString('id-ID')}</strong></td>
                        </tr>
                    </table>
                    
                    <div class="section-title">PASIVA</div>
                    <table class="neraca-table">
                        <tr>
                            <td>Simpanan Anggota</td>
                            <td style="text-align: right;">Rp ${totalSimpanan.toLocaleString('id-ID')}</td>
                        </tr>
                        <tr>
                            <td>Cadangan</td>
                            <td style="text-align: right;">Rp ${(totalSimpanan * 0.1).toLocaleString('id-ID')}</td>
                        </tr>
                        <tr>
                            <td>SHU</td>
                            <td style="text-align: right;">Rp ${totalSHU.toLocaleString('id-ID')}</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL PASIVA</strong></td>
                            <td style="text-align: right;"><strong>Rp ${(totalSimpanan + (totalSimpanan * 0.1) + totalSHU).toLocaleString('id-ID')}</strong></td>
                        </tr>
                    </table>
                    
                    <div class="footer">
                        <div>Dicetak pada: ${new Date().toLocaleString('id-ID')}</div>
                        <div style="margin-top: 30px;">
                            <div>Mengetahui,</div>
                            <div style="margin-top: 50px;">
                                <div>_________________________</div>
                                <div>Ketua Koperasi</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="no-print" style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" onclick="printLaporan()" style="margin-right: 10px;">
                        <i class="fas fa-print"></i> Cetak Laporan
                    </button>
                    <button class="btn btn-outline" onclick="downloadPDF('laporan')">
                        <i class="fas fa-file-pdf"></i> Download PDF
                    </button>
                </div>
            `;
            
        } else if (type === 'shu') {
            const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
            const totalSHU = totalSimpanan * 0.1;
            
            const now = new Date();
            const year = now.getFullYear();
            
            previewContent.innerHTML = `
                <style>
                    @media print {
                        body * {
                            visibility: hidden;
                        }
                        .print-preview-content, .print-preview-content * {
                            visibility: visible;
                        }
                        .print-preview-content {
                            position: absolute;
                            left: 0;
                            top: 0;
                            width: 100%;
                            padding: 20px;
                        }
                        .no-print {
                            display: none !important;
                        }
                    }
                    .print-preview-content {
                        font-family: Arial, sans-serif;
                        padding: 20px;
                    }
                    .header {
                        text-align: center;
                        border-bottom: 3px solid #2e7d32;
                        padding-bottom: 20px;
                        margin-bottom: 30px;
                    }
                    .header h1 {
                        color: #2e7d32;
                        margin-bottom: 5px;
                    }
                    .header .subtitle {
                        color: #666;
                        font-size: 14px;
                    }
                    .shu-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin: 20px 0;
                    }
                    .shu-table th {
                        background-color: #f5f5f5;
                        padding: 12px;
                        text-align: left;
                        border: 1px solid #ddd;
                        font-weight: bold;
                    }
                    .shu-table td {
                        padding: 12px;
                        border: 1px solid #ddd;
                    }
                    .total-row {
                        background-color: #e8f5e9;
                        font-weight: bold;
                    }
                    .percentage {
                        text-align: center;
                        width: 100px;
                    }
                    .amount {
                        text-align: right;
                        width: 200px;
                    }
                    .footer {
                        margin-top: 50px;
                        text-align: right;
                        border-top: 1px solid #ddd;
                        padding-top: 20px;
                        font-size: 12px;
                        color: #666;
                    }
                    .distribution-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 20px;
                        margin: 20px 0;
                    }
                    .distribution-card {
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        padding: 15px;
                        background: #f9f9f9;
                    }
                    .distribution-card h4 {
                        margin-top: 0;
                        color: #2e7d32;
                        border-bottom: 2px solid #2e7d32;
                        padding-bottom: 8px;
                    }
                    .distribution-value {
                        font-size: 18px;
                        font-weight: bold;
                        color: #2e7d32;
                        margin-top: 10px;
                    }
                </style>
                
                <div class="print-preview-content">
                    <div class="header">
                        <h1>KOPERASI ASMARA TANI</h1>
                        <div class="subtitle">#koperasijenius</div>
                        <h2>LAPORAN PEMBAGIAN SHU</h2>
                        <div>Tahun: ${year}</div>
                        <div style="font-size: 16px; margin-top: 10px; color: #2e7d32;">
                            <strong>Total SHU yang dibagikan: Rp ${totalSHU.toLocaleString('id-ID')}</strong>
                        </div>
                    </div>
                    
                    <div class="distribution-grid">
                        <div class="distribution-card">
                            <h4>CADANGAN KOPERASI (40%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.4).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk pengembangan usaha koperasi
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>JASA ANGGOTA (30%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.3).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Dibagikan kepada anggota sesuai partisipasi
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>DANA PENGURUS (10%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk honor pengurus koperasi
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>DANA KARYAWAN (10%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk bonus karyawan koperasi
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>DANA PENDIDIKAN (5%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.05).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk pelatihan dan pendidikan anggota
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>DANA SOSIAL (5%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.05).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk kegiatan sosial koperasi
                            </div>
                        </div>
                    </div>
                    
                    <table class="shu-table">
                        <thead>
                            <tr>
                                <th>KETERANGAN</th>
                                <th class="percentage">PERSENTASE</th>
                                <th class="amount">JUMLAH</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Cadangan Koperasi</td>
                                <td class="percentage">40%</td>
                                <td class="amount">Rp ${(totalSHU * 0.4).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Jasa Anggota</td>
                                <td class="percentage">30%</td>
                                <td class="amount">Rp ${(totalSHU * 0.3).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Dana Pengurus</td>
                                <td class="percentage">10%</td>
                                <td class="amount">Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Dana Karyawan</td>
                                <td class="percentage">10%</td>
                                <td class="amount">Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Dana Pendidikan</td>
                                <td class="percentage">5%</td>
                                <td class="amount">Rp ${(totalSHU * 0.05).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Dana Sosial</td>
                                <td class="percentage">5%</td>
                                <td class="amount">Rp ${(totalSHU * 0.05).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr class="total-row">
                                <td><strong>TOTAL SHU</strong></td>
                                <td class="percentage"><strong>100%</strong></td>
                                <td class="amount"><strong>Rp ${totalSHU.toLocaleString('id-ID')}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <div>Dicetak pada: ${new Date().toLocaleString('id-ID')}</div>
                        <div style="margin-top: 30px;">
                            <div>Mengetahui,</div>
                            <div style="display: flex; justify-content: space-between; margin-top: 50px;">
                                <div>
                                    <div>_________________________</div>
                                    <div>Ketua Koperasi</div>
                                </div>
                                <div>
                                    <div>_________________________</div>
                                    <div>Bendahara</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="no-print" style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" onclick="printLaporan()" style="margin-right: 10px;">
                        <i class="fas fa-print"></i> Cetak SHU
                    </button>
                    <button class="btn btn-outline" onclick="downloadPDF('shu')">
                        <i class="fas fa-file-pdf"></i> Download PDF
                    </button>
                </div>
            `;
        }
        
        document.getElementById('printPreviewModal').style.display = 'flex';
    }

    function printLaporan() {
        window.print();
    }

    function downloadPDF(type) {
        showNotification('Fitur download PDF akan segera tersedia!', 'info');
    }

    function updatePinjamanTerbaruTable() {
        const tableBody = document.querySelector('#pinjamanTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        // Ambil 5 pinjaman terbaru
        const pinjamanTerbaru = [...pinjamanData]
            .sort((a, b) => new Date(b.tanggalPinjam) - new Date(a.tanggalPinjam))
            .slice(0, 5);
        
        if (pinjamanTerbaru.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-info-circle"></i> Belum ada data pinjaman
                    </td>
                </tr>
            `;
            return;
        }
        
        pinjamanTerbaru.forEach(pinjaman => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${pinjaman.namaAnggota}</td>
                <td>${pinjaman.tanggalPinjam}</td>
                <td>Rp ${pinjaman.jumlahPinjaman.toLocaleString('id-ID')}</td>
                <td><span class="badge badge-success">${pinjaman.status}</span></td>
            `;
            tableBody.appendChild(row);
        });
    }

    function updateAnggotaBaruTable() {
        const tableBody = document.querySelector('#anggotaTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        // Ambil 5 anggota terbaru
        const anggotaTerbaru = [...anggotaData]
            .sort((a, b) => new Date(b.tanggalDaftar) - new Date(a.tanggalDaftar))
            .slice(0, 5);
        
        if (anggotaTerbaru.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="3" style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-info-circle"></i> Belum ada data anggota
                    </td>
                </tr>
            `;
            return;
        }
        
        anggotaTerbaru.forEach(anggota => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${anggota.nama}</td>
                <td>${anggota.tanggalDaftar}</td>
                <td><span class="badge badge-success">${anggota.statusAktif}</span></td>
            `;
            tableBody.appendChild(row);
        });
    }

    function updateActivityList() {
        const activityList = document.getElementById('activityList');
        if (!activityList) return;
        
        activityList.innerHTML = '';
        
        const activities = [
            { icon: 'fa-users', bgColor: 'bg-primary', title: 'Anggota Baru', desc: `${anggotaData.length} anggota terdaftar`, time: 'Baru saja' },
            { icon: 'fa-hand-holding-usd', bgColor: 'bg-success', title: 'Simpanan', desc: `${simpananData.length} transaksi simpanan`, time: 'Baru saja' },
            { icon: 'fa-file-invoice-dollar', bgColor: 'bg-warning', title: 'Pinjaman', desc: `${pinjamanData.length} pinjaman aktif`, time: 'Baru saja' },
            { icon: 'fa-chart-line', bgColor: 'bg-info', title: 'Laporan', desc: 'Dashboard aktif', time: 'Baru saja' }
        ];
        
        activities.forEach(activity => {
            const li = document.createElement('li');
            li.className = 'activity-item';
            li.innerHTML = `
                <div class="activity-icon ${activity.bgColor}">
                    <i class="fas ${activity.icon}"></i>
                </div>
                <div class="activity-content">
                    <h4>${activity.title}</h4>
                    <p>${activity.desc}</p>
                </div>
                <div class="activity-time">${activity.time}</div>
            `;
            activityList.appendChild(li);
        });
    }

    // ===== FUNGSI SHOW NOTIFICATION =====
    function showNotification(message, type = 'info') {
        // Hapus notifikasi lama jika ada
        const existingNotif = document.querySelector('.sync-notification');
        if (existingNotif) existingNotif.remove();
        
        // Buat notifikasi baru
        const notification = document.createElement('div');
        notification.className = 'sync-notification';
        if (type === 'success') notification.classList.add('success');
        else if (type === 'error') notification.classList.add('error');
        else if (type === 'warning') notification.classList.add('warning');
        
        // Set icon berdasarkan type
        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        else if (type === 'error') icon = 'exclamation-circle';
        else if (type === 'warning') icon = 'exclamation-triangle';
        
        notification.innerHTML = `
            <i class="fas fa-${icon}"></i>
            <span>${message}</span>
        `;
        
        // Tambahkan ke body
        document.body.appendChild(notification);
        
        // Hapus otomatis setelah 3 detik
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease forwards';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    // ===== PENGATURAN EVENT LISTENERS =====
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM Content Loaded - Initializing complete system...');
        
        // Initialize complete system
        initializeCompleteSystem();
        
        // Setup untuk auto sync data dari login-register
        setTimeout(() => {
            syncDataBetweenSystems();
            showNotification('Data berhasil disinkronisasi dari sistem registrasi', 'success');
        }, 2000);
    });

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Koperasi Asmara Tani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* SEMUA CSS DARI SEBELUMNYA TETAP SAMA 100% */
        :root {
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary: #ff9800;
            --accent: #ff5722;
            --light: #f5f5f5;
            --dark: #333;
            --gray: #757575;
            --gray-light: #e0e0e0;
            --danger: #f44336;
            --warning: #ffc107;
            --success: #4caf50;
            --info: #2196f3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Container Utama */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: linear-gradient(to bottom, var(--primary-dark), var(--primary));
            color: white;
            transition: all 0.3s ease;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-header img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-header h1 {
            font-size: 1.4rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .sidebar-header .tagline {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }
        
        .sidebar-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            display: none;
            transition: transform 0.3s ease;
        }
        
        .sidebar-close:hover {
            transform: scale(1.2);
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .sidebar-menu ul {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 8px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .sidebar-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--secondary);
            padding-left: 30px;
        }
        
        .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: var(--secondary);
            font-weight: 600;
        }
        
        .sidebar-menu i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }
        
        /* Top Navigation */
        .top-nav {
            background: white;
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 999;
        }
        
        .nav-left {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .nav-buttons {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
            transition: transform 0.3s ease;
            display: none;
        }
        
        .menu-toggle:hover {
            transform: scale(1.1);
        }
        
        .current-time {
            font-size: 0.95rem;
            color: var(--primary-dark);
            font-weight: 600;
            background: var(--light);
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .current-time i {
            color: var(--primary);
        }
        
        .home-btn, .dashboard-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .home-btn:hover, .dashboard-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            background: var(--light);
            border-radius: 25px;
            padding: 10px 20px;
            width: 320px;
            transition: all 0.3s ease;
        }
        
        .search-bar:focus-within {
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
            transform: translateY(-2px);
        }
        
        .search-bar input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            margin-left: 12px;
            font-size: 0.95rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 15px;
            border-radius: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .user-info:hover {
            background: var(--light);
            transform: translateY(-2px);
        }
        
        .user-info img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }
        
        .user-details h4 {
            font-size: 0.95rem;
            margin-bottom: 2px;
        }
        
        .user-details p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Content Area */
        .content {
            padding: 30px;
            flex: 1;
            background: #f8f9fa;
        }
        
        .page-title {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-title h1 {
            font-size: 2rem;
            color: var(--primary-dark);
            position: relative;
            padding-bottom: 12px;
        }
        
        .page-title h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        /* Dashboard Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-info h3 {
            font-size: 0.95rem;
            color: var(--gray);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-info p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        
        .stat-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
        }
        
        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        .bg-primary { background: linear-gradient(135deg, var(--primary), var(--primary-light)); }
        .bg-secondary { background: linear-gradient(135deg, var(--secondary), #ffb74d); }
        .bg-accent { background: linear-gradient(135deg, var(--accent), #ff8a65); }
        .bg-info { background: linear-gradient(135deg, var(--info), #64b5f6); }
        .bg-success { background: linear-gradient(135deg, var(--success), #81c784); }
        .bg-warning { background: linear-gradient(135deg, var(--warning), #ffd54f); }
        
        /* Chart and Table Sections */
        .dashboard-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .chart-container, .table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .chart-container:before, .table-container:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .chart-container:hover, .table-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .section-header h2 {
            font-size: 1.3rem;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .chart-wrapper {
            height: 280px;
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px 18px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }
        
        th {
            background-color: rgba(46, 125, 50, 0.05);
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        tr {
            transition: background-color 0.3s ease;
        }
        
        tr:hover {
            background-color: rgba(46, 125, 50, 0.03);
        }
        
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .badge:hover {
            transform: scale(1.05);
        }
        
        .badge-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #e6a700;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .badge-danger {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }
        
        .badge-overdue {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }
        
        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover:before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        
        /* Recent Activity */
        .activity-list {
            list-style: none;
        }
        
        .activity-item {
            display: flex;
            padding: 18px 0;
            border-bottom: 1px solid var(--gray-light);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            background-color: rgba(46, 125, 50, 0.03);
            border-radius: 10px;
            padding-left: 15px;
            padding-right: 15px;
            transform: translateX(5px);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover .activity-icon {
            transform: scale(1.1);
        }
        
        .activity-content h4 {
            font-size: 0.95rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .activity-content p {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: var(--gray);
            margin-left: auto;
            white-space: nowrap;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .required {
            color: var(--danger);
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--gray-light);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }
        
        /* Footer */
        .footer {
            background: white;
            padding: 20px 30px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
            margin-top: 30px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.03);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            color: white;
        }
        
        .modal-header h3 {
            color: white;
            font-size: 1.4rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            transition: transform 0.3s ease;
        }
        
        .modal-close:hover {
            transform: scale(1.2);
        }
        
        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 25px;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }
        
        .tab:hover {
            background-color: rgba(46, 125, 50, 0.05);
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
            background: rgba(46, 125, 50, 0.05);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Admin Profile Section */
        .admin-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .admin-profile img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }
        
        .admin-details h4 {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .admin-details p {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 3px;
        }
        
        .admin-details .admin-role {
            font-size: 10px;
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Bank Logo */
        .bank-logo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            background: var(--light);
            border-radius: 5px;
            font-size: 0.8rem;
        }
        
        .bank-logo i {
            color: var(--primary);
        }
        
        /* Modal Konfirmasi */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .confirm-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
            overflow: hidden;
        }
        
        .confirm-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            background: linear-gradient(90deg, var(--warning), #ffb74d);
            color: white;
        }
        
        .confirm-body {
            padding: 25px;
            text-align: center;
        }
        
        .confirm-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Print Card */
        .print-card {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 3000;
            padding: 20px;
        }
        
        @media print {
            .print-card {
                display: block;
            }
            .no-print {
                display: none;
            }
        }
        
        /* Responsive Design - Tablet */
        @media (max-width: 1200px) {
            .sidebar {
                width: 250px;
            }
            
            .main-content {
                margin-left: 250px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 20px;
            }
            
            .dashboard-row {
                gap: 20px;
            }
        }
        
        /* Responsive Design - Small Tablet */
        @media (max-width: 992px) {
            .dashboard-row {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .sidebar-close {
                display: block;
            }
            
            .search-bar {
                width: 250px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 18px;
            }
            
            .content {
                padding: 25px;
            }
        }
        
        /* Responsive Design - Mobile Landscape & Small Tablet */
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                margin-bottom: 25px;
            }
            
            .search-bar {
                width: 200px;
            }
            
            .nav-right {
                gap: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .section-header .btn {
                align-self: flex-end;
            }
            
            .chart-wrapper {
                height: 220px;
            }
            
            .card {
                padding: 20px;
            }
            
            .chart-container, .table-container {
                padding: 20px;
            }
            
            .page-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .page-title h1 {
                font-size: 1.8rem;
            }
            
            .stat-info p {
                font-size: 1.8rem;
            }
            
            .stat-icon {
                width: 70px;
                height: 70px;
                font-size: 1.8rem;
            }
        }
        
        /* Responsive Design - Mobile Portrait */
        @media (max-width: 576px) {
            .stats-cards {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .search-bar {
                display: none;
            }
            
            .top-nav {
                padding: 15px 20px;
            }
            
            .content {
                padding: 15px;
            }
            
            .card {
                padding: 18px;
                border-radius: 12px;
            }
            
            .chart-container, .table-container {
                padding: 18px;
                border-radius: 12px;
            }
            
            .chart-wrapper {
                height: 200px;
            }
            
            .user-details {
                display: none;
            }
            
            .page-title h1 {
                font-size: 1.6rem;
            }
            
            .section-header h2 {
                font-size: 1.2rem;
            }
            
            .stat-info p {
                font-size: 1.6rem;
            }
            
            .stat-icon {
                width: 60px;
                height: 60px;
                font-size: 1.6rem;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            .btn-sm {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 12px 14px;
                font-size: 0.85rem;
            }
            
            .admin-profile {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }
            
            .admin-profile img {
                width: 70px;
                height: 70px;
            }
            
            .nav-buttons {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .home-btn, .dashboard-btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .current-time {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
        
        /* Responsive Design - Small Mobile */
        @media (max-width: 400px) {
            .content {
                padding: 12px;
            }
            
            .top-nav {
                padding: 12px 15px;
            }
            
            .card {
                padding: 15px;
                border-radius: 10px;
            }
            
            .chart-container, .table-container {
                padding: 15px;
                border-radius: 10px;
            }
            
            .page-title h1 {
                font-size: 1.4rem;
            }
            
            .section-header h2 {
                font-size: 1.1rem;
            }
            
            .stat-info p {
                font-size: 1.4rem;
            }
            
            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }
            
            .btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }
            
            th, td {
                padding: 10px 12px;
                font-size: 0.8rem;
            }
            
            .home-btn, .dashboard-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            .menu-toggle {
                font-size: 1.3rem;
            }
            
            .user-info img {
                width: 40px;
                height: 40px;
            }
        }
        
        /* Responsive Design - Extra Small Mobile */
        @media (max-width: 360px) {
            .content {
                padding: 10px;
            }
            
            .top-nav {
                padding: 10px 12px;
            }
            
            .card {
                padding: 12px;
            }
            
            .chart-container, .table-container {
                padding: 12px;
            }
            
            .page-title h1 {
                font-size: 1.3rem;
            }
            
            .stat-info p {
                font-size: 1.3rem;
            }
            
            .stat-icon {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            
            .nav-buttons {
                gap: 8px;
            }
            
            .home-btn, .dashboard-btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .current-time {
                font-size: 0.75rem;
                padding: 5px 10px;
            }
        }

        /* ===== GOOGLE SHEETS SYNC STYLES ===== */
        .google-sheets-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4285F4, #34A853);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3);
            cursor: pointer;
            z-index: 9998;
            transition: all 0.3s ease;
            border: 3px solid white;
        }

        .google-sheets-indicator:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(66, 133, 244, 0.4);
        }

        .google-sheets-indicator.syncing {
            animation: spin 1s linear infinite;
            background: linear-gradient(135deg, #FBBC05, #EA4335);
        }

        .google-sheets-indicator.success {
            background: linear-gradient(135deg, #34A853, #0F9D58);
            animation: pulse 0.5s ease;
        }

        .google-sheets-indicator.error {
            background: linear-gradient(135deg, #EA4335, #D93025);
            animation: shake 0.5s ease;
        }

        .google-sheets-indicator.not-configured {
            background: linear-gradient(135deg, #999, #666);
            opacity: 0.7;
        }

        .google-sheets-indicator.not-configured:hover {
            opacity: 1;
        }

        .google-sheets-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.2);
            z-index: 9996;
            display: none;
            overflow: hidden;
            border: 2px solid #4285F4;
        }

        .google-sheets-panel.active {
            display: block;
            animation: slideUp 0.3s ease;
        }

        .google-sheets-header {
            padding: 15px;
            background: linear-gradient(135deg, #4285F4, #34A853);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .google-sheets-header h4 {
            margin: 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .google-sheets-content {
            padding: 15px;
        }

        .google-sheets-status {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            background: #f8f9fa;
            border-left: 4px solid #4285F4;
        }

        .google-sheets-status.syncing {
            border-left-color: #FBBC05;
        }

        .google-sheets-status.success {
            border-left-color: #34A853;
        }

        .google-sheets-status.error {
            border-left-color: #EA4335;
        }

        .google-sheets-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .google-sheets-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .google-sheets-btn.primary {
            background: #4285F4;
            color: white;
        }

        .google-sheets-btn.primary:hover {
            background: #3367D6;
            transform: translateY(-2px);
        }

        .google-sheets-btn.success {
            background: #34A853;
            color: white;
        }

        .google-sheets-btn.success:hover {
            background: #2E8B57;
            transform: translateY(-2px);
        }

        .google-sheets-btn.warning {
            background: #FBBC05;
            color: white;
        }

        .google-sheets-btn.warning:hover {
            background: #F9AB00;
            transform: translateY(-2px);
        }

        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
            20%, 40%, 60%, 80% { transform: translateX(2px); }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Sync Notification */
        .sync-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 10px 15px;
            background: #4285F4;
            color: white;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        }

        .sync-notification.success {
            background: #34A853;
        }

        .sync-notification.error {
            background: #EA4335;
        }

        .sync-notification.warning {
            background: #FBBC05;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .google-sheets-panel {
                width: calc(100% - 40px);
                left: 10px;
                right: 10px;
            }
            
            .google-sheets-indicator {
                bottom: 80px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .sync-notification {
                top: 70px;
                right: 10px;
                max-width: calc(100% - 20px);
            }
        }
    </style>
</head>
<body>
    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Logo Koperasi Asmara Tani">
                <h1>Koperasi Asmara Tani</h1>
                <div class="tagline">#koperasijenius</div>
                <button class="sidebar-close" id="sidebarClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <ul>
                    <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-home"></i> <span>Dashboard Utama</span></a></li>
                    <li><a href="#" data-tab="anggota"><i class="fas fa-users"></i> <span>Data Anggota</span></a></li>
                    <li><a href="tabungan-digital.html" data-tab="tabungan"><i class="fas fa-book"></i> <span>Tabungan Digital</span></a></li>
                    <li><a href="#" data-tab="simpanan"><i class="fas fa-hand-holding-usd"></i> <span>Simpanan Anggota</span></a></li>
                    <li><a href="#" data-tab="pinjaman"><i class="fas fa-file-invoice-dollar"></i> <span>Pinjaman & Angsuran</span></a></li>
                    <li><a href="#" data-tab="laporan"><i class="fas fa-chart-line"></i> <span>Laporan Keuangan</span></a></li>
                    <li><a href="#" data-tab="unit-usaha"><i class="fas fa-shopping-cart"></i> <span>Unit Usaha</span></a></li>
                    <li><a href="#" data-tab="shu"><i class="fas fa-calculator"></i> <span>Laporan SHU</span></a></li>
                    <li><a href="call-alert.html" id="callAlertBtn"><i class="fas fa-bell"></i> <span>Call Alert</span></a></li>
                    <li><a href="#" data-tab="pengaturan"><i class="fas fa-cog"></i> <span>Pengaturan Sistem</span></a></li>
                    <li><a href="https://koperasi-asmara-tani.vercel.app/"><i class="fas fa-sign-out-alt"></i> <span>Keluar</span></a></li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navigation -->
            <div class="top-nav">
                <div class="nav-left">
                    <div class="nav-buttons">
                        <button class="menu-toggle" id="menuToggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <button class="home-btn" id="homeBtn">
                            <i class="fas fa-home"></i>
                            <span>Beranda</span>
                        </button>
                        <button class="dashboard-btn" id="dashboardBtn">
                            <i class="fas fa-arrow-left"></i>
                            <span>Dashboard</span>
                        </button>
                    </div>
                    <div class="current-time" id="currentTime">
                        <i class="fas fa-clock"></i>
                        <span>Mengambil waktu...</span>
                    </div>
                </div>
                <div class="nav-right">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Cari data..." id="globalSearch">
                    </div>
                    <div class="user-info">
                        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Admin">
                        <div class="user-details">
                            <h4 id="topNavUsername">Admin Koperasi</h4>
                            <p id="topNavRole">Super Administrator</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Tab -->
                <div class="tab-content active" id="dashboard">
                    <div class="page-title">
                        <h1>Dashboard Utama</h1>
                        <div>
                            <button class="btn btn-outline btn-sm" id="exportExcelBtn"><i class="fas fa-file-excel"></i> Export Excel</button>
                            <button class="btn btn-outline btn-sm" id="importExcelBtn"><i class="fas fa-file-import"></i> Import Excel</button>
                            <button class="btn btn-primary btn-sm" id="syncNowBtn"><i class="fas fa-sync-alt"></i> Sync Now</button>
                        </div>
                    </div>

                    <!-- Admin Profile Section -->
                    <div class="admin-profile" id="adminProfileSection">
                        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Admin">
                        <div class="admin-details">
                            <h4 id="adminUsername">Admin Koperasi</h4>
                            <p id="adminEmail">admin@koperasiasmaratani.id</p>
                            <p id="adminRole">Super Administrator</p>
                            <p class="admin-role">No. Rekening: <span id="adminRekening" class="bank-logo"><i class="fas fa-university"></i> 4098-01-019526-53-3 (BRI)</span></p>
                            <p id="lastSyncTime" style="font-size: 10px; color: #666; margin-top: 3px;">Terakhir sync: -</p>
                        </div>
                    
                        <div>
                            <button class="btn btn-primary" onclick="window.location.href='call-alert.html'">
                                <i class="fas fa-bell"></i> Call Alert
                            </button>
                            <button class="btn btn-outline" onclick="window.location.href='tabungan-digital.html'">
                                <i class="fas fa-wallet"></i> Tabungan Digital
                            </button>
                        </div>
                    </div>

                    <!-- Stat Cards -->
                    <div class="stats-cards">
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Anggota</h3>
                                <p id="totalAnggota">0</p>
                            </div>
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Simpanan</h3>
                                <p id="totalSimpanan">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-secondary">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Pinjaman Aktif</h3>
                                <p id="totalPinjaman">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-accent">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total SHU</h3>
                                <p id="totalSHU">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-info">
                                <i class="fas fa-calculator"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Kas</h3>
                                <p id="totalKas">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-success">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Tables Row -->
                    <div class="dashboard-row">
                        <!-- Chart Section -->
                        <div class="chart-container">
                            <div class="section-header">
                                <h2>Grafik Perkembangan Keuangan</h2>
                                <div>
                                    <button class="btn btn-outline btn-sm" id="refreshChart"><i class="fas fa-sync-alt"></i> Refresh</button>
                                    <button class="btn btn-outline btn-sm" id="yearlyChart">Tahunan</button>
                                    <button class="btn btn-primary btn-sm" id="monthlyChart">Bulanan</button>
                                </div>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="financeChart"></canvas>
                            </div>
                        </div>
                        <!-- Recent Activity -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Notifikasi Terbaru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaNotif">Lihat Semua</button>
                            </div>
                            <ul class="activity-list" id="activityList">
                                <!-- Data akan diisi secara dinamis -->
                            </ul>
                        </div>
                    </div>

                    <!-- Tables Row -->
                    <div class="dashboard-row">
                        <!-- Pinjaman Terbaru -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Pinjaman Terbaru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaPinjaman">Lihat Semua</button>
                            </div>
                            <table id="pinjamanTable">
                                <thead>
                                    <tr>
                                        <th>Nama Anggota</th>
                                        <th>Tanggal</th>
                                        <th>Jumlah</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Anggota Baru -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Anggota Baru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaAnggota">Lihat Semua</button>
                            </div>
                            <table id="anggotaTable">
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>Tanggal Bergabung</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Data Anggota Tab -->
                <div class="tab-content" id="anggota">
                    <div class="page-title">
                        <h1>Data Anggota</h1>
                        <button class="btn btn-primary" id="addMemberBtn"><i class="fas fa-plus"></i> Tambah Anggota</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Daftar Anggota Koperasi</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari anggota..." id="searchAnggota">
                            </div>
                        </div>
                        <table id="anggotaFullTable">
                            <thead>
                                <tr>
                                    <th>ID Anggota</th>
                                    <th>Nama</th>
                                    <th>NIK</th>
                                    <th>Jenis Kelamin</th>
                                    <th>Alamat</th>
                                    <th>No. HP</th>
                                    <th>Tanggal Bergabung</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Simpanan Anggota Tab -->
                <div class="tab-content" id="simpanan">
                    <div class="page-title">
                        <h1>Simpanan Anggota</h1>
                        <button class="btn btn-primary" id="addSimpananBtn"><i class="fas fa-plus"></i> Tambah Simpanan</button>
                    </div>

                    <div class="tabs">
                        <div class="tab active" data-simpanan-tab="pokok">Simpanan Pokok</div>
                        <div class="tab" data-simpanan-tab="wajib">Simpanan Wajib</div>
                        <div class="tab" data-simpanan-tab="sukarela">Simpanan Sukarela</div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2 id="simpananTitle">Daftar Simpanan Pokok</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari simpanan..." id="searchSimpanan">
                            </div>
                        </div>
                        <table id="simpananTable">
                            <thead>
                                <tr>
                                    <th>ID Anggota</th>
                                    <th>Nama</th>
                                    <th>Jenis Simpanan</th>
                                    <th>Tanggal Setor</th>
                                    <th>Nominal</th>
                                    <th>Total Akumulasi</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pinjaman & Angsuran Tab -->
                <div class="tab-content" id="pinjaman">
                    <div class="page-title">
                        <h1>Pinjaman & Angsuran</h1>
                        <button class="btn btn-primary" id="addPinjamanBtn"><i class="fas fa-plus"></i> Tambah Pinjaman</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Daftar Pinjaman</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari pinjaman..." id="searchPinjaman">
                            </div>
                        </div>
                        <table id="pinjamanFullTable">
                            <thead>
                                <tr>
                                    <th>ID Pinjaman</th>
                                    <th>Nama Anggota</th>
                                    <th>Jumlah Pinjaman</th>
                                    <th>Tanggal Pinjam</th>
                                    <th>Jangka Waktu</th>
                                    <th>Bunga</th>
                                    <th>Sisa Hutang</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan Keuangan Tab -->
                <div class="tab-content" id="laporan">
                    <div class="page-title">
                        <h1>Laporan Keuangan</h1>
                        <button class="btn btn-primary" id="cetakLaporanBtn"><i class="fas fa-download"></i> Cetak Laporan</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Laporan Neraca</h2>
                        </div>
                        <table id="neracaTable">
                            <thead>
                                <tr>
                                    <th>Keterangan</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Unit Usaha Tab -->
                <div class="tab-content" id="unit-usaha">
                    <div class="page-title">
                        <h1>Unit Usaha / Toko Koperasi</h1>
                        <button class="btn btn-primary" id="addBarangBtn"><i class="fas fa-plus"></i> Tambah Barang</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Data Stok Barang</h2>
                        </div>
                        <table id="barangTable">
                            <thead>
                                <tr>
                                    <th>Kode Barang</th>
                                    <th>Nama Barang</th>
                                    <th>Stok</th>
                                    <th>Harga Beli</th>
                                    <th>Harga Jual</th>
                                    <th>Laba</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan SHU Tab -->
                <div class="tab-content" id="shu">
                    <div class="page-title">
                        <h1>Laporan SHU (Sisa Hasil Usaha)</h1>
                        <button class="btn btn-primary" id="cetakSHUBtn"><i class="fas fa-print"></i> Cetak Laporan</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Pembagian SHU Tahun <span id="currentYear"></span></h2>
                        </div>
                        <table id="shuTable">
                            <thead>
                                <tr>
                                    <th>Keterangan</th>
                                    <th>Persentase</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pengaturan Tab -->
                <div class="tab-content" id="pengaturan">
                    <div class="page-title">
                        <h1>Pengaturan Sistem & User</h1>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Data Admin</h2>
                        </div>
                        <form id="adminForm">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" class="form-control" value="admin_koperasi">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" class="form-control" value="admin@koperasiasmaratani.id">
                            </div>
                            <div class="form-group">
                                <label for="role">Role</label>
                                <select id="role" class="form-control">
                                    <option value="admin">Admin</option>
                                    <option value="pengurus">Pengurus</option>
                                    <option value="bendahara">Bendahara</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="foto">Ganti Foto Profil</label>
                                <input type="file" id="foto" class="form-control" accept="image/*">
                            </div>
                            <div class="form-group">
                                <label for="norek">No Rekening Admin</label>
                                <input type="text" id="norek" class="form-control" placeholder="Masukkan nomor rekening" value="1234-5678-9012-3456">
                            </div>
                            <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="footer">
                <p>&copy; <span id="currentYearFooter"></span> Koperasi Asmara Tani  Dashboard Admin</p>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Anggota -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="memberModalTitle">Tambah Anggota Baru</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="memberForm">
                    <input type="hidden" id="memberId">
                    <div class="form-group">
                        <label for="posisi">Posisi <span class="required">*</span></label>
                        <select id="posisi" class="form-control" required>
                            <option value="">Pilih Posisi</option>
                            <option value="Admin">Admin</option>
                            <option value="Pengurus">Pengurus</option>
                            <option value="Anggota">Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="nama">Nama Lengkap <span class="required">*</span></label>
                        <input type="text" id="nama" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="alamat">Alamat Lengkap <span class="required">*</span></label>
                        <textarea id="alamat" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="jenisKelamin">Jenis Kelamin <span class="required">*</span></label>
                        <select id="jenisKelamin" class="form-control" required>
                            <option value="">Pilih Jenis Kelamin</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="agama">Agama <span class="required">*</span></label>
                        <select id="agama" class="form-control" required>
                            <option value="">Pilih Agama</option>
                            <option value="Islam">Islam</option>
                            <option value="Kristen">Kristen</option>
                            <option value="Hindu">Hindu</option>
                            <option value="Budha">Budha</option>
                            <option value="Konghucu">Konghucu</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="status">Status <span class="required">*</span></label>
                        <select id="status" class="form-control" required>
                            <option value="">Pilih Status</option>
                            <option value="Menikah">Menikah</option>
                            <option value="Belum Menikah">Belum Menikah</option>
                            <option value="Duda">Duda</option>
                            <option value="Janda">Janda</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="email">Alamat Email <span class="required">*</span></label>
                        <input type="email" id="emailMember" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="whatsapp">No WhatsApp <span class="required">*</span></label>
                        <input type="text" id="whatsapp" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="nik">No NIK KTP <span class="required">*</span></label>
                        <input type="text" id="nik" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="foto">Upload Foto Anda <span class="required">*</span></label>
                        <input type="file" id="fotoMember" class="form-control" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="buktiTransfer">Upload Bukti Transfer (Opsional)</label>
                        <input type="file" id="buktiTransfer" class="form-control" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label>Tanggal Daftar</label>
                        <input type="text" id="tanggalDaftar" class="form-control" readonly>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelMemberBtn">Batal</button>
                <button class="btn btn-primary" id="saveMemberBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Simpanan -->
    <div class="modal" id="addSimpananModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="simpananModalTitle">Tambah Simpanan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="simpananForm">
                    <input type="hidden" id="simpananId">
                    <div class="form-group">
                        <label for="idAnggotaSimpanan">ID Anggota <span class="required">*</span></label>
                        <select id="idAnggotaSimpanan" class="form-control" required>
                            <option value="">Pilih Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jenisSimpanan">Jenis Simpanan <span class="required">*</span></label>
                        <select id="jenisSimpanan" class="form-control" required>
                            <option value="">Pilih Jenis</option>
                            <option value="Pokok">Pokok</option>
                            <option value="Wajib">Wajib</option>
                            <option value="Sukarela">Sukarela</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tanggalSimpanan">Tanggal Setor <span class="required">*</span></label>
                        <input type="date" id="tanggalSimpanan" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="nominalSimpanan">Nominal <span class="required">*</span></label>
                        <input type="number" id="nominalSimpanan" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelSimpananBtn">Batal</button>
                <button class="btn btn-primary" id="saveSimpananBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Pinjaman -->
    <div class="modal" id="addPinjamanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pinjamanModalTitle">Tambah Pinjaman</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="pinjamanForm">
                    <input type="hidden" id="pinjamanId">
                    <div class="form-group">
                        <label for="idAnggotaPinjaman">ID Anggota <span class="required">*</span></label>
                        <select id="idAnggotaPinjaman" class="form-control" required>
                            <option value="">Pilih Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jumlahPinjaman">Jumlah Pinjaman <span class="required">*</span></label>
                        <input type="number" id="jumlahPinjaman" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="tanggalPinjaman">Tanggal Pinjam <span class="required">*</span></label>
                        <input type="date" id="tanggalPinjaman" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="jangkaWaktu">Jangka Waktu <span class="required">*</span></label>
                        <select id="jangkaWaktu" class="form-control" required>
                            <option value="">Pilih Jangka Waktu</option>
                            <option value="6 Bulan">6 Bulan</option>
                            <option value="12 Bulan">12 Bulan</option>
                            <option value="24 Bulan">24 Bulan</option>
                            <option value="36 Bulan">36 Bulan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bungaPinjaman">Bunga (%) <span class="required">*</span></label>
                        <input type="number" id="bungaPinjaman" class="form-control" step="0.1" value="1.5" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelPinjamanBtn">Batal</button>
                <button class="btn btn-primary" id="savePinjamanBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Barang -->
    <div class="modal" id="addBarangModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="barangModalTitle">Tambah Barang</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="barangForm">
                    <input type="hidden" id="barangId">
                    <div class="form-group">
                        <label for="namaBarang">Nama Barang <span class="required">*</span></label>
                        <input type="text" id="namaBarang" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="stokBarang">Stok <span class="required">*</span></label>
                        <input type="number" id="stokBarang" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hargaBeli">Harga Beli <span class="required">*</span></label>
                        <input type="number" id="hargaBeli" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hargaJual">Harga Jual <span class="required">*</span></label>
                        <input type="number" id="hargaJual" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelBarangBtn">Batal</button>
                <button class="btn btn-primary" id="saveBarangBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Konfirmasi Hapus -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <div class="confirm-header">
                <h3>Konfirmasi Hapus</h3>
            </div>
            <div class="confirm-body">
                <p id="confirmMessage">Apakah Anda yakin ingin menghapus data ini?</p>
            </div>
            <div class="confirm-footer">
                <button class="btn btn-outline" id="cancelDeleteBtn">Batal</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Modal Import Excel -->
    <div class="modal" id="importExcelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Data dari Excel</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="excelFile">Pilih File Excel</label>
                    <input type="file" id="excelFile" class="form-control" accept=".xlsx, .xls">
                </div>
                <div class="form-group">
                    <label for="importType">Jenis Data</label>
                    <select id="importType" class="form-control">
                        <option value="anggota">Data Anggota</option>
                        <option value="simpanan">Data Simpanan</option>
                        <option value="pinjaman">Data Pinjaman</option>
                        <option value="barang">Data Barang</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelImportBtn">Batal</button>
                <button class="btn btn-primary" id="confirmImportBtn">Import</button>
            </div>
        </div>
    </div>

    <!-- Kartu Cetak Anggota -->
    <div class="print-card" id="printCard">
        <div style="text-align: center; padding: 20px; border: 2px solid #000;">
            <h2>KOPERASI ASMARA TANI</h2>
            <p>#koperasijenius</p>
            <hr>
            <div id="cardContent">
                <!-- Konten kartu akan diisi secara dinamis -->
            </div>
        </div>
    </div>

    <!-- Google Sheets Indicator -->
    <div class="google-sheets-indicator" id="googleSheetsIndicator" title="Google Sheets Sync">
        <i class="fab fa-google"></i>
    </div>

    <!-- Google Sheets Panel -->
    <div class="google-sheets-panel" id="googleSheetsPanel">
        <div class="google-sheets-header">
            <h4><i class="fab fa-google"></i> Google Sheets Sync</h4>
            <button id="closeGoogleSheetsBtn" style="background: none; border: none; color: white; cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="google-sheets-content">
            <div id="googleSheetsStatus" class="google-sheets-status">
                <div style="font-weight: 600; font-size: 12px; margin-bottom: 5px;">Status</div>
                <div style="font-size: 11px; color: #666;">Mengkonfigurasi...</div>
            </div>
            
            <div style="margin: 15px 0;">
                <div style="font-weight: 600; font-size: 12px; margin-bottom: 8px;">Konfigurasi</div>
                <div class="form-group" style="margin-bottom: 10px;">
                    <input type="text" id="googleSheetsId" class="form-control" style="font-size: 12px; padding: 8px;" placeholder="Spreadsheet ID">
                </div>
                <div class="form-group" style="margin-bottom: 10px;">
                    <input type="text" id="googleApiKey" class="form-control" style="font-size: 12px; padding: 8px;" placeholder="Google API Key">
                </div>
                <button id="saveGoogleConfigBtn" class="google-sheets-btn success" style="width: 100%;">
                    <i class="fas fa-save"></i> Simpan Konfigurasi
                </button>
            </div>
            
            <div style="margin: 15px 0;">
                <div style="font-weight: 600; font-size: 12px; margin-bottom: 8px;">Aksi Sync</div>
                <div class="google-sheets-actions">
                    <button id="syncFromSheetsBtn" class="google-sheets-btn primary">
                        <i class="fas fa-download"></i> Ambil Data
                    </button>
                    <button id="syncToSheetsBtn" class="google-sheets-btn success">
                        <i class="fas fa-upload"></i> Kirim Data
                    </button>
                </div>
            </div>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                <div style="font-weight: 600; font-size: 12px; margin-bottom: 5px;">Sync Log</div>
                <div id="googleSheetsLog" style="max-height: 100px; overflow-y: auto; font-size: 10px; color: #666; background: #f5f5f5; padding: 8px; border-radius: 3px;">
                    <!-- Log akan muncul di sini -->
                </div>
            </div>
        </div>
    </div>

    <script>
    // ===== KONFIGURASI UTAMA =====
    const CONFIG = {
        GOOGLE_SHEETS: {
            apiKey: localStorage.getItem('google_api_key') || '',
            spreadsheetId: localStorage.getItem('google_sheets_id') || '',
            baseUrl: 'https://sheets.googleapis.com/v4/spreadsheets'
        },
        SYNC_INTERVAL: 30000, // 30 detik
        TAB_SHEET_MAPPING: {
            'anggota': 'Anggota',
            'simpanan': 'Simpanan',
            'pinjaman': 'Pinjaman',
            'barang': 'Barang',
            'transaksi': 'Transaksi',
            'shu': 'SHU'
        }
    };

    // ===== VARIABEL GLOBAL =====
    let anggotaData = [];
    let simpananData = [];
    let pinjamanData = [];
    let barangData = [];
    let transaksiData = [];
    let shuData = [];
    let currentEditingId = null;
    let currentEditingType = null;
    let financeChart = null;

    // ===== INISIALISASI =====
    document.addEventListener('DOMContentLoaded', function() {
        // Inisialisasi tahun
        const currentYear = new Date().getFullYear();
        document.getElementById('currentYear').textContent = currentYear;
        document.getElementById('currentYearFooter').textContent = currentYear;
        
        // Setup waktu real-time
        setupRealTime();
        
        // Load data dari localStorage
        loadLocalStorageData();
        
        // Setup Google Sheets
        setupGoogleSheets();
        
        // Setup semua event listeners
        setupEventListeners();
        
        // Setup chart
        setupFinanceChart();
        
        // Load data awal
        loadInitialData();
        
        // Mulai sinkronisasi otomatis
        startAutoSync();
        
        // Setup komunikasi antar-halaman
        setupCrossPageCommunication();
        
        // Inisialisasi data sampel jika kosong
        initializeSampleData();
    });

    // ===== FUNGSI UTAMA =====
    
    function setupRealTime() {
        updateTime();
        setInterval(updateTime, 1000);
        
        function updateTime() {
            const now = new Date();
            const hariIndo = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const bulanIndo = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            const hari = hariIndo[now.getDay()];
            const tanggal = now.getDate();
            const bulan = bulanIndo[now.getMonth()];
            const tahun = now.getFullYear();
            const jam = now.getHours().toString().padStart(2, '0');
            const menit = now.getMinutes().toString().padStart(2, '0');
            const detik = now.getSeconds().toString().padStart(2, '0');
            
            const timeString = `${hari}, ${tanggal} ${bulan} ${tahun} - ${jam}:${menit}:${detik} WIB`;
            document.getElementById('currentTime').innerHTML = `<i class="fas fa-clock"></i> ${timeString}`;
            document.getElementById('tanggalDaftar').value = timeString;
        }
    }

    function loadLocalStorageData() {
        anggotaData = JSON.parse(localStorage.getItem('anggotaData')) || [];
        simpananData = JSON.parse(localStorage.getItem('simpananData')) || [];
        pinjamanData = JSON.parse(localStorage.getItem('pinjamanData')) || [];
        barangData = JSON.parse(localStorage.getItem('barangData')) || [];
        transaksiData = JSON.parse(localStorage.getItem('transaksiData')) || [];
        shuData = JSON.parse(localStorage.getItem('shuData')) || [];
    }

    // ===== GOOGLE SHEETS SYNC FUNCTIONS =====
    
    async function syncAllDataToGoogleSheets() {
        try {
            // 1. SYNC DATA ANGGOTA (SEMUA FIELD)
            await syncAnggotaToSheets();
            
            // 2. SYNC DATA SIMPANAN
            await syncSimpananToSheets();
            
            // 3. SYNC DATA PINJAMAN
            await syncPinjamanToSheets();
            
            // 4. SYNC DATA BARANG
            await syncBarangToSheets();
            
            // 5. SYNC DATA TRANSAKSI
            await syncTransaksiToSheets();
            
            // 6. SYNC DATA SHU
            await syncSHUToSheets();
            
            // Update timestamp
            const now = new Date();
            localStorage.setItem('last_sync_time', now.toISOString());
            
            // Update UI
            updateGoogleSheetsStatus();
            showNotification('SEMUA data berhasil disinkronisasi ke Google Sheets!', 'success');
            
            // Broadcast perubahan
            broadcastDataChange('all');
            
        } catch (error) {
            showNotification('Gagal sync data: ' + error.message, 'error');
        }
    }

    // ===== SYNC DATA ANGGOTA LENGKAP =====

    async function syncAnggotaToSheets() {
        if (anggotaData.length === 0) {
            addGoogleSheetsLog('Data anggota kosong');
            return;
        }
        
        // HEADERS LENGKAP untuk data anggota
        const headers = [
            'ID Anggota', 'Posisi', 'Nama Lengkap', 'Alamat', 
            'Jenis Kelamin', 'Agama', 'Status', 'Email', 
            'No WhatsApp', 'NIK KTP', 'Tanggal Daftar', 
            'Status Aktif', 'Foto', 'Bukti Transfer',
            'Total Simpanan', 'Total Pinjaman', 'Saldo Terakhir',
            'Terakhir Update'
        ];
        
        // Konversi data ke array of arrays
        const values = anggotaData.map(anggota => [
            anggota.id || '',
            anggota.posisi || '',
            anggota.nama || '',
            anggota.alamat || '',
            anggota.jenisKelamin || '',
            anggota.agama || '',
            anggota.status || '',
            anggota.email || '',
            anggota.whatsapp || '',
            anggota.nik || '',
            anggota.tanggalDaftar || '',
            anggota.statusAktif || 'Aktif',
            anggota.foto || '',
            anggota.buktiTransfer || '',
            anggota.totalSimpanan || 0,
            anggota.totalPinjaman || 0,
            anggota.saldo || 0,
            new Date().toISOString()
        ]);
        
        // Tambahkan headers di baris pertama
        values.unshift(headers);
        
        // Kirim ke Google Sheets
        await updateGoogleSheet('Anggota', values);
        addGoogleSheetsLog(`Data anggota: ${anggotaData.length} record disimpan`);
    }

    // ===== SYNC DATA SIMPANAN LENGKAP =====

    async function syncSimpananToSheets() {
        const headers = [
            'ID Simpanan', 'ID Anggota', 'Nama Anggota',
            'Jenis Simpanan', 'Tanggal Setor', 'Nominal',
            'Metode Bayar', 'Keterangan', 'Status',
            'Terverifikasi Oleh', 'Waktu Input'
        ];
        
        const values = simpananData.map(simpanan => [
            simpanan.id || `SPN-${Date.now()}`,
            simpanan.idAnggota || '',
            simpanan.nama || '',
            simpanan.jenisSimpanan || '',
            simpanan.tanggalSetor || new Date().toISOString().split('T')[0],
            simpanan.nominal || 0,
            simpanan.metode || 'Transfer',
            simpanan.keterangan || '',
            simpanan.status || 'Berhasil',
            simpanan.verifiedBy || 'Admin',
            new Date().toISOString()
        ]);
        
        values.unshift(headers);
        await updateGoogleSheet('Simpanan', values);
        addGoogleSheetsLog(`Data simpanan: ${simpananData.length} record disimpan`);
    }

    // ===== SYNC DATA PINJAMAN =====

    async function syncPinjamanToSheets() {
        const headers = [
            'ID Pinjaman', 'ID Anggota', 'Nama Anggota',
            'Jumlah Pinjaman', 'Tanggal Pinjam', 'Jangka Waktu',
            'Bunga', 'Sisa Hutang', 'Status', 'Keterangan',
            'Waktu Input'
        ];
        
        const values = pinjamanData.map(pinjaman => [
            pinjaman.id || `PJN-${Date.now()}`,
            pinjaman.idAnggota || '',
            pinjaman.namaAnggota || '',
            pinjaman.jumlahPinjaman || 0,
            pinjaman.tanggalPinjam || '',
            pinjaman.jangkaWaktu || '',
            pinjaman.bunga || '1.5%',
            pinjaman.sisaHutang || 0,
            pinjaman.status || 'Belum Lunas',
            pinjaman.keterangan || '',
            new Date().toISOString()
        ]);
        
        values.unshift(headers);
        await updateGoogleSheet('Pinjaman', values);
        addGoogleSheetsLog(`Data pinjaman: ${pinjamanData.length} record disimpan`);
    }

    // ===== SYNC DATA BARANG =====

    async function syncBarangToSheets() {
        const headers = [
            'ID Barang', 'Nama Barang', 'Stok',
            'Harga Beli', 'Harga Jual', 'Laba',
            'Kategori', 'Supplier', 'Waktu Input'
        ];
        
        const values = barangData.map(barang => [
            barang.id || `BRG-${Date.now()}`,
            barang.namaBarang || '',
            barang.stok || 0,
            barang.hargaBeli || 0,
            barang.hargaJual || 0,
            barang.laba || 0,
            barang.kategori || '',
            barang.supplier || '',
            new Date().toISOString()
        ]);
        
        values.unshift(headers);
        await updateGoogleSheet('Barang', values);
        addGoogleSheetsLog(`Data barang: ${barangData.length} record disimpan`);
    }

    // ===== SYNC DATA TRANSAKSI =====

    async function syncTransaksiToSheets() {
        const headers = [
            'ID Transaksi', 'ID Anggota', 'Nama Anggota',
            'Jenis Transaksi', 'Tanggal', 'Nominal',
            'Keterangan', 'Status', 'Metode Bayar',
            'Waktu Input'
        ];
        
        const values = transaksiData.map(transaksi => [
            transaksi.id || `TRX-${Date.now()}`,
            transaksi.idAnggota || '',
            transaksi.namaAnggota || '',
            transaksi.jenis || '',
            transaksi.tanggal || '',
            transaksi.nominal || 0,
            transaksi.keterangan || '',
            transaksi.status || 'Berhasil',
            transaksi.metode || 'Transfer',
            new Date().toISOString()
        ]);
        
        values.unshift(headers);
        await updateGoogleSheet('Transaksi', values);
        addGoogleSheetsLog(`Data transaksi: ${transaksiData.length} record disimpan`);
    }

    // ===== SYNC DATA SHU =====

    async function syncSHUToSheets() {
        const headers = [
            'Tahun', 'Keterangan', 'Persentase',
            'Jumlah', 'Tanggal Distribusi', 'Status'
        ];
        
        const values = shuData.map(shu => [
            shu.tahun || new Date().getFullYear(),
            shu.keterangan || '',
            shu.persentase || '0%',
            shu.jumlah || 0,
            shu.tanggalDistribusi || '',
            shu.status || 'Belum Dibagikan'
        ]);
        
        values.unshift(headers);
        await updateGoogleSheet('SHU', values);
        addGoogleSheetsLog(`Data SHU: ${shuData.length} record disimpan`);
    }

    // ===== FUNGSI UPDATE GOOGLE SHEET =====

    async function updateGoogleSheet(sheetName, data) {
        if (!CONFIG.GOOGLE_SHEETS.apiKey || !CONFIG.GOOGLE_SHEETS.spreadsheetId) {
            throw new Error('Google Sheets belum dikonfigurasi');
        }
        
        // Clear existing sheet
        await clearSheet(sheetName);
        
        // Write new data
        const url = `${CONFIG.GOOGLE_SHEETS.baseUrl}/${CONFIG.GOOGLE_SHEETS.spreadsheetId}/values/${sheetName}!A1:append?valueInputOption=USER_ENTERED&key=${CONFIG.GOOGLE_SHEETS.apiKey}`;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ values: data })
        });
        
        if (!response.ok) {
            throw new Error(`Gagal update sheet ${sheetName}`);
        }
        
        return true;
    }

    async function clearSheet(sheetName) {
        const url = `${CONFIG.GOOGLE_SHEETS.baseUrl}/${CONFIG.GOOGLE_SHEETS.spreadsheetId}/values/${sheetName}!A:Z?key=${CONFIG.GOOGLE_SHEETS.apiKey}`;
        
        await fetch(url, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ values: [] })
        });
    }

    async function readFromGoogleSheets(sheetName) {
        const url = `${CONFIG.GOOGLE_SHEETS.baseUrl}/${CONFIG.GOOGLE_SHEETS.spreadsheetId}/values/${sheetName}!A:Z?key=${CONFIG.GOOGLE_SHEETS.apiKey}`;
        
        const response = await fetch(url);
        if (!response.ok) return [];
        
        const data = await response.json();
        return data.values || [];
    }

    // ===== FUNGSI SYNC DARI GOOGLE SHEETS (READ) =====

    async function syncAllDataFromGoogleSheets() {
        try {
            // 1. AMBIL DATA ANGGOTA
            const anggotaFromSheets = await readFromGoogleSheets('Anggota');
            if (anggotaFromSheets.length > 1) {
                const anggotaData = convertSheetToAnggota(anggotaFromSheets);
                localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
                addGoogleSheetsLog(`Data anggota: ${anggotaData.length} record diambil`);
            }
            
            // 2. AMBIL DATA SIMPANAN
            const simpananFromSheets = await readFromGoogleSheets('Simpanan');
            if (simpananFromSheets.length > 1) {
                const simpananData = convertSheetToSimpanan(simpananFromSheets);
                localStorage.setItem('simpananData', JSON.stringify(simpananData));
                addGoogleSheetsLog(`Data simpanan: ${simpananData.length} record diambil`);
            }
            
            // 3. AMBIL DATA PINJAMAN
            const pinjamanFromSheets = await readFromGoogleSheets('Pinjaman');
            if (pinjamanFromSheets.length > 1) {
                const pinjamanData = convertSheetToPinjaman(pinjamanFromSheets);
                localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
                addGoogleSheetsLog(`Data pinjaman: ${pinjamanData.length} record diambil`);
            }
            
            // Refresh UI
            loadLocalStorageData();
            loadInitialData();
            showNotification('SEMUA data berhasil diambil dari Google Sheets!', 'success');
            
            // Broadcast perubahan
            broadcastDataChange('all');
            
        } catch (error) {
            showNotification('Gagal mengambil data: ' + error.message, 'error');
        }
    }

    // ===== FUNGSI KONVERSI SHEET KE OBJECT =====

    function convertSheetToAnggota(sheetData) {
        const headers = sheetData[0];
        const rows = sheetData.slice(1);
        
        return rows.map(row => {
            const anggota = {};
            headers.forEach((header, index) => {
                const key = header.toLowerCase()
                    .replace(/\s+/g, '_')
                    .replace(/[^a-z0-9_]/gi, '');
                anggota[key] = row[index] || '';
            });
            return anggota;
        });
    }

    function convertSheetToSimpanan(sheetData) {
        const headers = sheetData[0];
        const rows = sheetData.slice(1);
        
        return rows.map(row => {
            const simpanan = {};
            headers.forEach((header, index) => {
                const key = header.toLowerCase()
                    .replace(/\s+/g, '_')
                    .replace(/[^a-z0-9_]/gi, '');
                simpanan[key] = row[index] || '';
            });
            return simpanan;
        });
    }

    function convertSheetToPinjaman(sheetData) {
        const headers = sheetData[0];
        const rows = sheetData.slice(1);
        
        return rows.map(row => {
            const pinjaman = {};
            headers.forEach((header, index) => {
                const key = header.toLowerCase()
                    .replace(/\s+/g, '_')
                    .replace(/[^a-z0-9_]/gi, '');
                pinjaman[key] = row[index] || '';
            });
            return pinjaman;
        });
    }

    // ===== SETUP GOOGLE SHEETS UI =====

    function setupGoogleSheets() {
        // Update status Google Sheets
        updateGoogleSheetsStatus();
        
        // Event listeners untuk Google Sheets
        document.getElementById('googleSheetsIndicator').addEventListener('click', toggleGoogleSheetsPanel);
        document.getElementById('closeGoogleSheetsBtn').addEventListener('click', toggleGoogleSheetsPanel);
        document.getElementById('saveGoogleConfigBtn').addEventListener('click', saveGoogleConfig);
        document.getElementById('syncFromSheetsBtn').addEventListener('click', syncAllDataFromGoogleSheets);
        document.getElementById('syncToSheetsBtn').addEventListener('click', syncAllDataToGoogleSheets);
        document.getElementById('syncNowBtn').addEventListener('click', syncAllDataToGoogleSheets);
    }

    function updateGoogleSheetsStatus() {
        const indicator = document.getElementById('googleSheetsIndicator');
        const statusDiv = document.getElementById('googleSheetsStatus');
        const lastSync = localStorage.getItem('last_sync_time');
        
        if (CONFIG.GOOGLE_SHEETS.apiKey && CONFIG.GOOGLE_SHEETS.spreadsheetId) {
            indicator.className = 'google-sheets-indicator success';
            indicator.title = `Google Sheets Sync (Terakhir: ${lastSync ? new Date(lastSync).toLocaleTimeString() : 'Belum sync'})`;
            
            if (statusDiv) {
                statusDiv.innerHTML = `
                    <div style="font-weight: 600; font-size: 12px; margin-bottom: 5px; color: #34A853;">
                        <i class="fas fa-check-circle"></i> Terkonfigurasi
                    </div>
                    <div style="font-size: 11px; color: #666;">
                        Terakhir sync: ${lastSync ? new Date(lastSync).toLocaleString() : 'Belum sync'}
                    </div>
                `;
                statusDiv.className = 'google-sheets-status success';
            }
            
            // Update admin profile
            if (lastSync) {
                document.getElementById('lastSyncTime').textContent = 
                    `Terakhir sync: ${new Date(lastSync).toLocaleTimeString()}`;
            }
        } else {
            indicator.className = 'google-sheets-indicator not-configured';
            indicator.title = 'Google Sheets Sync (Belum dikonfigurasi)';
            
            if (statusDiv) {
                statusDiv.innerHTML = `
                    <div style="font-weight: 600; font-size: 12px; margin-bottom: 5px; color: #FBBC05;">
                        <i class="fas fa-exclamation-triangle"></i> Belum Dikonfigurasi
                    </div>
                    <div style="font-size: 11px; color: #666;">
                        Masukkan Spreadsheet ID dan API Key
                    </div>
                `;
                statusDiv.className = 'google-sheets-status';
            }
        }
    }

    function toggleGoogleSheetsPanel() {
        const panel = document.getElementById('googleSheetsPanel');
        if (panel.classList.contains('active')) {
            panel.classList.remove('active');
        } else {
            panel.classList.add('active');
            document.getElementById('googleSheetsId').value = CONFIG.GOOGLE_SHEETS.spreadsheetId;
            document.getElementById('googleApiKey').value = CONFIG.GOOGLE_SHEETS.apiKey;
            updateGoogleSheetsStatus();
        }
    }

    async function saveGoogleConfig() {
        const sheetId = document.getElementById('googleSheetsId').value.trim();
        const apiKey = document.getElementById('googleApiKey').value.trim();
        
        if (!sheetId || !apiKey) {
            showNotification('Harap isi semua field konfigurasi!', 'error');
            return;
        }
        
        CONFIG.GOOGLE_SHEETS.spreadsheetId = sheetId;
        CONFIG.GOOGLE_SHEETS.apiKey = apiKey;
        
        localStorage.setItem('google_sheets_id', sheetId);
        localStorage.setItem('google_api_key', apiKey);
        
        showNotification('Konfigurasi Google Sheets disimpan!', 'success');
        updateGoogleSheetsStatus();
        
        // Buat sheet default
        await createDefaultSheets();
    }

    async function createDefaultSheets() {
        const sheets = [
            {
                name: 'Anggota',
                headers: [
                    ['ID Anggota', 'Posisi', 'Nama Lengkap', 'Alamat', 'Jenis Kelamin', 'Agama', 'Status', 
                     'Email', 'No WhatsApp', 'NIK KTP', 'Tanggal Daftar', 'Status Aktif', 'Foto', 
                     'Bukti Transfer', 'Total Simpanan', 'Total Pinjaman', 'Saldo Terakhir', 'Terakhir Update']
                ]
            },
            {
                name: 'Simpanan',
                headers: [
                    ['ID Simpanan', 'ID Anggota', 'Nama Anggota', 'Jenis Simpanan', 'Tanggal Setor', 
                     'Nominal', 'Metode Bayar', 'Keterangan', 'Status', 'Terverifikasi Oleh', 'Waktu Input']
                ]
            },
            {
                name: 'Pinjaman',
                headers: [
                    ['ID Pinjaman', 'ID Anggota', 'Nama Anggota', 'Jumlah Pinjaman', 'Tanggal Pinjam',
                     'Jangka Waktu', 'Bunga', 'Sisa Hutang', 'Status', 'Keterangan', 'Waktu Input']
                ]
            },
            {
                name: 'Barang',
                headers: [
                    ['ID Barang', 'Nama Barang', 'Stok', 'Harga Beli', 'Harga Jual', 
                     'Laba', 'Kategori', 'Supplier', 'Waktu Input']
                ]
            },
            {
                name: 'Transaksi',
                headers: [
                    ['ID Transaksi', 'ID Anggota', 'Nama Anggota', 'Jenis Transaksi', 'Tanggal',
                     'Nominal', 'Keterangan', 'Status', 'Metode Bayar', 'Waktu Input']
                ]
            },
            {
                name: 'SHU',
                headers: [
                    ['Tahun', 'Keterangan', 'Persentase', 'Jumlah', 'Tanggal Distribusi', 'Status']
                ]
            }
        ];
        
        for (const sheet of sheets) {
            await createSheetIfNotExists(sheet.name, sheet.headers);
        }
    }

    async function createSheetIfNotExists(sheetName, initialData) {
        try {
            const url = `${CONFIG.GOOGLE_SHEETS.baseUrl}/${CONFIG.GOOGLE_SHEETS.spreadsheetId}/values/${sheetName}!A1?key=${CONFIG.GOOGLE_SHEETS.apiKey}`;
            const response = await fetch(url);
            
            if (!response.ok) {
                // Sheet belum ada, buat dengan data awal
                await updateGoogleSheet(sheetName, initialData);
                addGoogleSheetsLog(`Sheet "${sheetName}" dibuat`);
            }
        } catch (error) {
            console.log(`Sheet "${sheetName}" sudah ada atau error:`, error);
        }
    }

    function addGoogleSheetsLog(message) {
        const logDiv = document.getElementById('googleSheetsLog');
        const timestamp = new Date().toLocaleTimeString();
        
        const logEntry = document.createElement('div');
        logEntry.style.marginBottom = '3px';
        logEntry.style.padding = '2px 4px';
        logEntry.style.backgroundColor = '#f0f0f0';
        logEntry.style.borderRadius = '2px';
        logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
        
        logDiv.prepend(logEntry);
        
        // Limit log entries
        if (logDiv.children.length > 10) {
            logDiv.removeChild(logDiv.lastChild);
        }
    }

    // ===== SETUP EVENT LISTENERS =====
    
    function setupEventListeners() {
        // Sidebar toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebarClose');
        
        menuToggle.addEventListener('click', () => sidebar.classList.add('active'));
        sidebarClose.addEventListener('click', () => sidebar.classList.remove('active'));
        
        // Tab navigation
        document.querySelectorAll('.sidebar-menu a').forEach(item => {
            item.addEventListener('click', function(e) {
                if (this.getAttribute('href') && this.getAttribute('href').startsWith('http')) return;
                
                e.preventDefault();
                
                // Update active tab
                document.querySelectorAll('.sidebar-menu a').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding content
                const tabId = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
                
                // Close sidebar on mobile
                if (window.innerWidth <= 992) sidebar.classList.remove('active');
            });
        });
        
        // Setup semua tombol lainnya
        setupAllButtons();
        
        // Tombol Call Alert
        document.getElementById('callAlertBtn').addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'call-alert.html';
        });
    }

    function setupAllButtons() {
        // Export Excel
        document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
        
        // Import Excel
        document.getElementById('importExcelBtn').addEventListener('click', () => {
            document.getElementById('importExcelModal').style.display = 'flex';
        });
        
        // Chart buttons
        document.getElementById('refreshChart').addEventListener('click', refreshChartData);
        document.getElementById('monthlyChart').addEventListener('click', () => switchChartType('monthly'));
        document.getElementById('yearlyChart').addEventListener('click', () => switchChartType('yearly'));
        
        // Lihat semua buttons
        document.getElementById('lihatSemuaNotif').addEventListener('click', () => {
            document.querySelector('[data-tab="pinjaman"]').click();
        });
        document.getElementById('lihatSemuaPinjaman').addEventListener('click', () => {
            document.querySelector('[data-tab="pinjaman"]').click();
        });
        document.getElementById('lihatSemuaAnggota').addEventListener('click', () => {
            document.querySelector('[data-tab="anggota"]').click();
        });
        
        // Cetak laporan
        document.getElementById('cetakLaporanBtn').addEventListener('click', () => window.print());
        document.getElementById('cetakSHUBtn').addEventListener('click', () => window.print());
        
        // Modal buttons
        setupModalButtons();
        
        // Admin form
        document.getElementById('adminForm').addEventListener('submit', saveAdminSettings);
    }

    function setupModalButtons() {
        // Tambah Anggota
        document.getElementById('addMemberBtn').addEventListener('click', () => {
            document.getElementById('memberModalTitle').textContent = 'Tambah Anggota Baru';
            document.getElementById('memberId').value = '';
            document.getElementById('memberForm').reset();
            document.getElementById('addMemberModal').style.display = 'flex';
        });
        
        // Simpan Anggota
        document.getElementById('saveMemberBtn').addEventListener('click', saveMemberData);
        document.getElementById('cancelMemberBtn').addEventListener('click', () => {
            document.getElementById('addMemberModal').style.display = 'none';
        });
        
        // Tambah Simpanan
        document.getElementById('addSimpananBtn').addEventListener('click', () => {
            document.getElementById('simpananModalTitle').textContent = 'Tambah Simpanan';
            document.getElementById('simpananId').value = '';
            document.getElementById('simpananForm').reset();
            populateAnggotaDropdowns();
            document.getElementById('addSimpananModal').style.display = 'flex';
        });
        
        // Simpan Simpanan
        document.getElementById('saveSimpananBtn').addEventListener('click', saveSimpananData);
        document.getElementById('cancelSimpananBtn').addEventListener('click', () => {
            document.getElementById('addSimpananModal').style.display = 'none';
        });
        
        // Tambah Pinjaman
        document.getElementById('addPinjamanBtn').addEventListener('click', () => {
            document.getElementById('pinjamanModalTitle').textContent = 'Tambah Pinjaman';
            document.getElementById('pinjamanId').value = '';
            document.getElementById('pinjamanForm').reset();
            populatePinjamanDropdowns();
            document.getElementById('addPinjamanModal').style.display = 'flex';
        });
        
        // Simpan Pinjaman
        document.getElementById('savePinjamanBtn').addEventListener('click', savePinjamanData);
        document.getElementById('cancelPinjamanBtn').addEventListener('click', () => {
            document.getElementById('addPinjamanModal').style.display = 'none';
        });
        
        // Tambah Barang
        document.getElementById('addBarangBtn').addEventListener('click', () => {
            document.getElementById('barangModalTitle').textContent = 'Tambah Barang';
            document.getElementById('barangId').value = '';
            document.getElementById('barangForm').reset();
            document.getElementById('addBarangModal').style.display = 'flex';
        });
        
        // Simpan Barang
        document.getElementById('saveBarangBtn').addEventListener('click', saveBarangData);
        document.getElementById('cancelBarangBtn').addEventListener('click', () => {
            document.getElementById('addBarangModal').style.display = 'none';
        });
        
        // Modal close buttons
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.addEventListener('click', function() {
                this.closest('.modal').style.display = 'none';
            });
        });
        
        // Import Excel modal
        document.getElementById('cancelImportBtn').addEventListener('click', () => {
            document.getElementById('importExcelModal').style.display = 'none';
        });
        document.getElementById('confirmImportBtn').addEventListener('click', importExcelData);
        
        // Konfirmasi hapus
        document.getElementById('cancelDeleteBtn').addEventListener('click', () => {
            document.getElementById('confirmModal').style.display = 'none';
        });
        document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDeleteData);
        
        // Tabs simpanan
        document.querySelectorAll('[data-simpanan-tab]').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('[data-simpanan-tab]').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                const tabType = this.getAttribute('data-simpanan-tab');
                let title = '';
                if (tabType === 'pokok') title = 'Daftar Simpanan Pokok';
                else if (tabType === 'wajib') title = 'Daftar Simpanan Wajib';
                else if (tabType === 'sukarela') title = 'Daftar Simpanan Sukarela';
                
                document.getElementById('simpananTitle').textContent = title;
                refreshSimpananTable(tabType);
            });
        });
    }

    // ===== FUNGSI SAVE DATA =====

    async function saveMemberData() {
        const posisi = document.getElementById('posisi').value;
        const nama = document.getElementById('nama').value;
        const alamat = document.getElementById('alamat').value;
        const jenisKelamin = document.getElementById('jenisKelamin').value;
        const agama = document.getElementById('agama').value;
        const status = document.getElementById('status').value;
        const email = document.getElementById('emailMember').value;
        const whatsapp = document.getElementById('whatsapp').value;
        const nik = document.getElementById('nik').value;
        const tanggalDaftar = document.getElementById('tanggalDaftar').value;
        
        if (!posisi || !nama || !alamat || !jenisKelamin || !agama || !status || !email || !whatsapp || !nik) {
            showNotification('Harap lengkapi semua field yang wajib!', 'error');
            return;
        }
        
        const memberId = document.getElementById('memberId').value;
        
        if (memberId) {
            // EDIT anggota
            const index = anggotaData.findIndex(member => member.id === memberId);
            if (index !== -1) {
                anggotaData[index] = {
                    ...anggotaData[index],
                    posisi: posisi,
                    nama: nama,
                    alamat: alamat,
                    jenisKelamin: jenisKelamin,
                    agama: agama,
                    status: status,
                    email: email,
                    whatsapp: whatsapp,
                    nik: nik,
                    lastUpdated: new Date().toISOString()
                };
            }
        } else {
            // TAMBAH anggota baru
            const idAnggota = 'AGT-' + (anggotaData.length + 1).toString().padStart(3, '0');
            
            const newMember = {
                id: idAnggota,
                posisi: posisi,
                nama: nama,
                alamat: alamat,
                jenisKelamin: jenisKelamin,
                agama: agama,
                status: status,
                email: email,
                whatsapp: whatsapp,
                nik: nik,
                tanggalDaftar: tanggalDaftar,
                statusAktif: 'Aktif',
                foto: '',
                buktiTransfer: '',
                totalSimpanan: 0,
                totalPinjaman: 0,
                saldo: 0,
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            anggotaData.push(newMember);
        }
        
        // Simpan ke localStorage
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        
        // Simpan ke Google Sheets
        await syncAnggotaToSheets();
        
        // Update dashboard
        updateDashboardStats();
        refreshAnggotaTable();
        populateAnggotaDropdowns();
        
        // Broadcast perubahan
        broadcastDataChange('anggota');
        
        showNotification('Data anggota berhasil disimpan!', 'success');
        document.getElementById('addMemberModal').style.display = 'none';
    }

    async function saveSimpananData() {
        const idAnggota = document.getElementById('idAnggotaSimpanan').value;
        const jenisSimpanan = document.getElementById('jenisSimpanan').value;
        const tanggalSimpanan = document.getElementById('tanggalSimpanan').value;
        const nominalSimpanan = document.getElementById('nominalSimpanan').value;
        
        if (!idAnggota || !jenisSimpanan || !tanggalSimpanan || !nominalSimpanan) {
            showNotification('Harap lengkapi semua field!', 'error');
            return;
        }
        
        const simpananId = document.getElementById('simpananId').value;
        const anggota = anggotaData.find(a => a.id === idAnggota);
        
        if (simpananId) {
            // Edit simpanan
            const index = simpananData.findIndex(s => s.id === simpananId);
            if (index !== -1) {
                simpananData[index] = {
                    ...simpananData[index],
                    idAnggota: idAnggota,
                    nama: anggota.nama,
                    jenisSimpanan: jenisSimpanan,
                    tanggalSetor: tanggalSimpanan,
                    nominal: parseInt(nominalSimpanan)
                };
            }
        } else {
            // Tambah simpanan baru
            const idSimpanan = 'SPN-' + (simpananData.length + 1).toString().padStart(3, '0');
            
            const newSimpanan = {
                id: idSimpanan,
                idAnggota: idAnggota,
                nama: anggota.nama,
                jenisSimpanan: jenisSimpanan,
                tanggalSetor: tanggalSimpanan,
                nominal: parseInt(nominalSimpanan),
                metode: 'Transfer',
                status: 'Berhasil',
                verifiedBy: 'Admin',
                waktuInput: new Date().toISOString()
            };
            
            simpananData.push(newSimpanan);
        }
        
        // Simpan ke localStorage
        localStorage.setItem('simpananData', JSON.stringify(simpananData));
        
        // Simpan ke Google Sheets
        await syncSimpananToSheets();
        
        // Update dashboard
        updateDashboardStats();
        refreshSimpananTable();
        
        // Broadcast perubahan
        broadcastDataChange('simpanan');
        
        showNotification('Data simpanan berhasil disimpan!', 'success');
        document.getElementById('addSimpananModal').style.display = 'none';
    }

    async function savePinjamanData() {
        const idAnggota = document.getElementById('idAnggotaPinjaman').value;
        const jumlahPinjaman = document.getElementById('jumlahPinjaman').value;
        const tanggalPinjaman = document.getElementById('tanggalPinjaman').value;
        const jangkaWaktu = document.getElementById('jangkaWaktu').value;
        const bungaPinjaman = document.getElementById('bungaPinjaman').value;
        
        if (!idAnggota || !jumlahPinjaman || !tanggalPinjaman || !jangkaWaktu || !bungaPinjaman) {
            showNotification('Harap lengkapi semua field!', 'error');
            return;
        }
        
        const pinjamanId = document.getElementById('pinjamanId').value;
        const anggota = anggotaData.find(a => a.id === idAnggota);
        
        if (pinjamanId) {
            // Edit pinjaman
            const index = pinjamanData.findIndex(p => p.id === pinjamanId);
            if (index !== -1) {
                pinjamanData[index] = {
                    ...pinjamanData[index],
                    idAnggota: idAnggota,
                    namaAnggota: anggota.nama,
                    jumlahPinjaman: parseInt(jumlahPinjaman),
                    tanggalPinjam: tanggalPinjaman,
                    jangkaWaktu: jangkaWaktu,
                    bunga: bungaPinjaman + '%',
                    sisaHutang: parseInt(jumlahPinjaman),
                    status: 'Belum Lunas',
                    lastUpdated: new Date().toISOString()
                };
            }
        } else {
            // Tambah pinjaman baru
            const idPinjaman = 'PJN-' + (pinjamanData.length + 1).toString().padStart(3, '0');
            
            const newPinjaman = {
                id: idPinjaman,
                idAnggota: idAnggota,
                namaAnggota: anggota.nama,
                jumlahPinjaman: parseInt(jumlahPinjaman),
                tanggalPinjam: tanggalPinjaman,
                jangkaWaktu: jangkaWaktu,
                bunga: bungaPinjaman + '%',
                sisaHutang: parseInt(jumlahPinjaman),
                status: 'Belum Lunas',
                keterangan: '',
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            pinjamanData.push(newPinjaman);
        }
        
        // Simpan ke localStorage
        localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
        
        // Simpan ke Google Sheets
        await syncPinjamanToSheets();
        
        // Update dashboard
        updateDashboardStats();
        refreshPinjamanTable();
        
        // Broadcast perubahan
        broadcastDataChange('pinjaman');
        
        showNotification('Data pinjaman berhasil disimpan!', 'success');
        document.getElementById('addPinjamanModal').style.display = 'none';
    }

    async function saveBarangData() {
        const namaBarang = document.getElementById('namaBarang').value;
        const stokBarang = document.getElementById('stokBarang').value;
        const hargaBeli = document.getElementById('hargaBeli').value;
        const hargaJual = document.getElementById('hargaJual').value;
        
        if (!namaBarang || !stokBarang || !hargaBeli || !hargaJual) {
            showNotification('Harap lengkapi semua field!', 'error');
            return;
        }
        
        const barangId = document.getElementById('barangId').value;
        const laba = parseInt(hargaJual) - parseInt(hargaBeli);
        
        if (barangId) {
            // Edit barang
            const index = barangData.findIndex(b => b.id === barangId);
            if (index !== -1) {
                barangData[index] = {
                    ...barangData[index],
                    namaBarang: namaBarang,
                    stok: parseInt(stokBarang),
                    hargaBeli: parseInt(hargaBeli),
                    hargaJual: parseInt(hargaJual),
                    laba: laba
                };
            }
        } else {
            // Tambah barang baru
            const idBarang = 'BRG-' + (barangData.length + 1).toString().padStart(3, '0');
            
            const newBarang = {
                id: idBarang,
                namaBarang: namaBarang,
                stok: parseInt(stokBarang),
                hargaBeli: parseInt(hargaBeli),
                hargaJual: parseInt(hargaJual),
                laba: laba,
                kategori: '',
                supplier: '',
                createdAt: new Date().toISOString()
            };
            
            barangData.push(newBarang);
        }
        
        // Simpan ke localStorage
        localStorage.setItem('barangData', JSON.stringify(barangData));
        
        // Simpan ke Google Sheets
        await syncBarangToSheets();
        
        // Refresh table
        refreshBarangTable();
        
        showNotification('Data barang berhasil disimpan!', 'success');
        document.getElementById('addBarangModal').style.display = 'none';
    }

    // ===== FUNGSI LOAD DATA =====

    function loadInitialData() {
        // Update dashboard stats
        updateDashboardStats();
        
        // Refresh semua tabel
        refreshAnggotaTable();
        refreshSimpananTable();
        refreshPinjamanTable();
        refreshBarangTable();
        refreshActivityList();
        refreshNeracaTable();
        refreshShuTable();
        
        // Isi dropdown
        populateAnggotaDropdowns();
        populatePinjamanDropdowns();
    }

    function updateDashboardStats() {
        document.getElementById('totalAnggota').textContent = anggotaData.length;
        
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        document.getElementById('totalSimpanan').textContent = formatRupiah(totalSimpanan);
        
        const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
        document.getElementById('totalPinjaman').textContent = formatRupiah(totalPinjaman);
        
        const totalSHU = totalSimpanan * 0.1;
        document.getElementById('totalSHU').textContent = formatRupiah(totalSHU);
        
        const totalKas = totalSimpanan - totalPinjaman;
        document.getElementById('totalKas').textContent = formatRupiah(Math.max(0, totalKas));
    }

    function formatRupiah(amount) {
        if (amount >= 1000000000) {
            return 'Rp ' + (amount / 1000000000).toFixed(1) + ' M';
        } else if (amount >= 1000000) {
            return 'Rp ' + (amount / 1000000).toFixed(1) + ' Jt';
        } else {
            return 'Rp ' + amount.toLocaleString('id-ID');
        }
    }

    // ===== FUNGSI REFRESH TABEL =====

    function refreshAnggotaTable() {
        const tableBody = document.querySelector('#anggotaFullTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        anggotaData.forEach(anggota => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${anggota.id || ''}</td>
                <td>${anggota.nama || ''}</td>
                <td>${anggota.nik || ''}</td>
                <td>${anggota.jenisKelamin || ''}</td>
                <td>${anggota.alamat || ''}</td>
                <td>${anggota.whatsapp || ''}</td>
                <td>${anggota.tanggalDaftar || ''}</td>
                <td><span class="badge ${anggota.statusAktif === 'Aktif' ? 'badge-success' : 'badge-danger'}">
                    ${anggota.statusAktif || 'Aktif'}
                </span></td>
                <td>
                    <button class="btn btn-outline btn-sm edit-member" data-id="${anggota.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-member" data-id="${anggota.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="btn btn-outline btn-sm print-member" data-id="${anggota.id}">
                        <i class="fas fa-print"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Tambah event listener untuk tombol aksi
        document.querySelectorAll('.edit-member').forEach(button => {
            button.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                editMember(memberId);
            });
        });
        
        document.querySelectorAll('.delete-member').forEach(button => {
            button.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                confirmDelete(memberId, 'anggota');
            });
        });
        
        document.querySelectorAll('.print-member').forEach(button => {
            button.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                printMemberCard(memberId);
            });
        });
        
        // Refresh tabel anggota di dashboard
        const dashboardTableBody = document.querySelector('#anggotaTable tbody');
        if (dashboardTableBody) {
            dashboardTableBody.innerHTML = '';
            
            const recentMembers = anggotaData.slice(-3).reverse();
            recentMembers.forEach(member => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${member.nama}</td>
                    <td>${member.tanggalDaftar}</td>
                    <td><span class="badge ${member.statusAktif === 'Aktif' ? 'badge-success' : 'badge-danger'}">
                        ${member.statusAktif || 'Aktif'}
                    </span></td>
                `;
                dashboardTableBody.appendChild(row);
            });
        }
    }

    function refreshSimpananTable(jenis = 'pokok') {
        const tableBody = document.querySelector('#simpananTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        const filteredSimpanan = simpananData.filter(simpanan => 
            simpanan.jenisSimpanan === (jenis === 'pokok' ? 'Pokok' : 
            jenis === 'wajib' ? 'Wajib' : 'Sukarela')
        );
        
        filteredSimpanan.forEach(simpanan => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${simpanan.idAnggota}</td>
                <td>${simpanan.nama}</td>
                <td>${simpanan.jenisSimpanan}</td>
                <td>${simpanan.tanggalSetor}</td>
                <td>${formatRupiah(simpanan.nominal)}</td>
                <td>
                    <button class="btn btn-outline btn-sm edit-simpanan" data-id="${simpanan.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-simpanan" data-id="${simpanan.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Tambah event listener
        document.querySelectorAll('.edit-simpanan').forEach(button => {
            button.addEventListener('click', function() {
                const simpananId = this.getAttribute('data-id');
                editSimpanan(simpananId);
            });
        });
        
        document.querySelectorAll('.delete-simpanan').forEach(button => {
            button.addEventListener('click', function() {
                const simpananId = this.getAttribute('data-id');
                confirmDelete(simpananId, 'simpanan');
            });
        });
    }

    function refreshPinjamanTable() {
        const tableBody = document.querySelector('#pinjamanFullTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        pinjamanData.forEach(pinjaman => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${pinjaman.id}</td>
                <td>${pinjaman.namaAnggota}</td>
                <td>${formatRupiah(pinjaman.jumlahPinjaman)}</td>
                <td>${pinjaman.tanggalPinjam}</td>
                <td>${pinjaman.jangkaWaktu}</td>
                <td>${pinjaman.bunga}</td>
                <td>${formatRupiah(pinjaman.sisaHutang)}</td>
                <td><span class="badge ${pinjaman.status === 'Lunas' ? 'badge-success' : 'badge-warning'}">
                    ${pinjaman.status}
                </span></td>
                <td>
                    <button class="btn btn-outline btn-sm edit-pinjaman" data-id="${pinjaman.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-pinjaman" data-id="${pinjaman.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Tambah event listener
        document.querySelectorAll('.edit-pinjaman').forEach(button => {
            button.addEventListener('click', function() {
                const pinjamanId = this.getAttribute('data-id');
                editPinjaman(pinjamanId);
            });
        });
        
        document.querySelectorAll('.delete-pinjaman').forEach(button => {
            button.addEventListener('click', function() {
                const pinjamanId = this.getAttribute('data-id');
                confirmDelete(pinjamanId, 'pinjaman');
            });
        });
        
        // Refresh tabel pinjaman di dashboard
        const dashboardTableBody = document.querySelector('#pinjamanTable tbody');
        if (dashboardTableBody) {
            dashboardTableBody.innerHTML = '';
            
            const recentPinjaman = pinjamanData.slice(-3).reverse();
            recentPinjaman.forEach(pinjaman => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${pinjaman.namaAnggota}</td>
                    <td>${pinjaman.tanggalPinjam}</td>
                    <td>${formatRupiah(pinjaman.jumlahPinjaman)}</td>
                    <td><span class="badge ${pinjaman.status === 'Lunas' ? 'badge-success' : 'badge-warning'}">
                        ${pinjaman.status}
                    </span></td>
                `;
                dashboardTableBody.appendChild(row);
            });
        }
    }

    function refreshBarangTable() {
        const tableBody = document.querySelector('#barangTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        barangData.forEach(barang => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${barang.id}</td>
                <td>${barang.namaBarang}</td>
                <td>${barang.stok}</td>
                <td>${formatRupiah(barang.hargaBeli)}</td>
                <td>${formatRupiah(barang.hargaJual)}</td>
                <td>${formatRupiah(barang.laba)}</td>
                <td>
                    <button class="btn btn-outline btn-sm edit-barang" data-id="${barang.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-barang" data-id="${barang.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Tambah event listener
        document.querySelectorAll('.edit-barang').forEach(button => {
            button.addEventListener('click', function() {
                const barangId = this.getAttribute('data-id');
                editBarang(barangId);
            });
        });
        
        document.querySelectorAll('.delete-barang').forEach(button => {
            button.addEventListener('click', function() {
                const barangId = this.getAttribute('data-id');
                confirmDelete(barangId, 'barang');
            });
        });
    }

    function refreshActivityList() {
        const activityList = document.getElementById('activityList');
        if (!activityList) return;
        
        activityList.innerHTML = '';
        
        // Buat aktivitas berdasarkan data terbaru
        const activities = [];
        
        // Aktivitas anggota baru
        if (anggotaData.length > 0) {
            const latestMember = anggotaData[anggotaData.length - 1];
            activities.push({
                icon: 'fas fa-user-plus',
                bgClass: 'bg-primary',
                title: 'Anggota Baru',
                description: `${latestMember.nama} bergabung sebagai anggota`,
                time: 'Baru saja'
            });
        }
        
        // Aktivitas pembayaran pinjaman
        if (pinjamanData.length > 0) {
            activities.push({
                icon: 'fas fa-money-check-dollar',
                bgClass: 'bg-success',
                title: 'Pembayaran Pinjaman',
                description: `${pinjamanData.length} pinjaman aktif`,
                time: 'Hari ini'
            });
        }
        
        // Aktivitas laporan keuangan
        activities.push({
            icon: 'fas fa-file-invoice',
            bgClass: 'bg-info',
            title: 'Laporan Keuangan',
            description: 'Laporan bulan ' + new Date().toLocaleDateString('id-ID', { month: 'long' }) + ' siap',
            time: '1 hari lalu'
        });
        
        // Tambahkan aktivitas ke list
        activities.forEach(activity => {
            const li = document.createElement('li');
            li.className = 'activity-item';
            li.innerHTML = `
                <div class="activity-icon ${activity.bgClass}">
                    <i class="${activity.icon}"></i>
                </div>
                <div class="activity-content">
                    <h4>${activity.title}</h4>
                    <p>${activity.description}</p>
                </div>
                <div class="activity-time">${activity.time}</div>
            `;
            activityList.appendChild(li);
        });
    }

    function refreshNeracaTable() {
        const tableBody = document.querySelector('#neracaTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
        
        const neracaData = [
            { keterangan: '<strong>Aktiva</strong>', jumlah: '' },
            { keterangan: 'Kas', jumlah: formatRupiah(totalSimpanan - totalPinjaman) },
            { keterangan: 'Simpanan Bank', jumlah: formatRupiah(totalSimpanan * 0.8) },
            { keterangan: 'Piutang Anggota', jumlah: formatRupiah(totalPinjaman) },
            { keterangan: '<strong>Total Aktiva</strong>', jumlah: `<strong>${formatRupiah(totalSimpanan * 1.8)}</strong>` },
            { keterangan: '<strong>Pasiva</strong>', jumlah: '' },
            { keterangan: 'Simpanan Anggota', jumlah: formatRupiah(totalSimpanan) },
            { keterangan: 'Cadangan', jumlah: formatRupiah(totalSimpanan * 0.1) },
            { keterangan: 'SHU', jumlah: formatRupiah(totalSimpanan * 0.1) },
            { keterangan: '<strong>Total Pasiva</strong>', jumlah: `<strong>${formatRupiah(totalSimpanan * 1.2)}</strong>` }
        ];
        
        neracaData.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.keterangan}</td>
                <td>${item.jumlah}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    function refreshShuTable() {
        const tableBody = document.querySelector('#shuTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        const totalSHU = totalSimpanan * 0.1;
        
        const shuData = [
            { keterangan: 'Cadangan Koperasi', persentase: '40%', jumlah: formatRupiah(totalSHU * 0.4) },
            { keterangan: 'Jasa Anggota', persentase: '30%', jumlah: formatRupiah(totalSHU * 0.3) },
            { keterangan: 'Dana Pengurus', persentase: '10%', jumlah: formatRupiah(totalSHU * 0.1) },
            { keterangan: 'Dana Karyawan', persentase: '10%', jumlah: formatRupiah(totalSHU * 0.1) },
            { keterangan: 'Dana Pendidikan', persentase: '5%', jumlah: formatRupiah(totalSHU * 0.05) },
            { keterangan: 'Dana Sosial', persentase: '5%', jumlah: formatRupiah(totalSHU * 0.05) },
            { keterangan: '<strong>Total SHU</strong>', persentase: '<strong>100%</strong>', jumlah: `<strong>${formatRupiah(totalSHU)}</strong>` }
        ];
        
        shuData.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.keterangan}</td>
                <td>${item.persentase}</td>
                <td>${item.jumlah}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    // ===== FUNGSI EDIT DATA =====

    function editMember(memberId) {
        const member = anggotaData.find(m => m.id === memberId);
        if (member) {
            document.getElementById('memberModalTitle').textContent = 'Edit Data Anggota';
            document.getElementById('memberId').value = member.id;
            document.getElementById('posisi').value = member.posisi;
            document.getElementById('nama').value = member.nama;
            document.getElementById('alamat').value = member.alamat;
            document.getElementById('jenisKelamin').value = member.jenisKelamin;
            document.getElementById('agama').value = member.agama;
            document.getElementById('status').value = member.status;
            document.getElementById('emailMember').value = member.email;
            document.getElementById('whatsapp').value = member.whatsapp;
            document.getElementById('nik').value = member.nik;
            document.getElementById('tanggalDaftar').value = member.tanggalDaftar;
            
            document.getElementById('addMemberModal').style.display = 'flex';
        }
    }

    function editSimpanan(simpananId) {
        const simpanan = simpananData.find(s => s.id === simpananId);
        if (simpanan) {
            document.getElementById('simpananModalTitle').textContent = 'Edit Data Simpanan';
            document.getElementById('simpananId').value = simpanan.id;
            document.getElementById('idAnggotaSimpanan').value = simpanan.idAnggota;
            document.getElementById('jenisSimpanan').value = simpanan.jenisSimpanan;
            document.getElementById('tanggalSimpanan').value = simpanan.tanggalSetor;
            document.getElementById('nominalSimpanan').value = simpanan.nominal;
            
            document.getElementById('addSimpananModal').style.display = 'flex';
        }
    }

    function editPinjaman(pinjamanId) {
        const pinjaman = pinjamanData.find(p => p.id === pinjamanId);
        if (pinjaman) {
            document.getElementById('pinjamanModalTitle').textContent = 'Edit Data Pinjaman';
            document.getElementById('pinjamanId').value = pinjaman.id;
            document.getElementById('idAnggotaPinjaman').value = pinjaman.idAnggota;
            document.getElementById('jumlahPinjaman').value = pinjaman.jumlahPinjaman;
            document.getElementById('tanggalPinjaman').value = pinjaman.tanggalPinjam;
            document.getElementById('jangkaWaktu').value = pinjaman.jangkaWaktu;
            document.getElementById('bungaPinjaman').value = parseFloat(pinjaman.bunga);
            
            document.getElementById('addPinjamanModal').style.display = 'flex';
        }
    }

    function editBarang(barangId) {
        const barang = barangData.find(b => b.id === barangId);
        if (barang) {
            document.getElementById('barangModalTitle').textContent = 'Edit Data Barang';
            document.getElementById('barangId').value = barang.id;
            document.getElementById('namaBarang').value = barang.namaBarang;
            document.getElementById('stokBarang').value = barang.stok;
            document.getElementById('hargaBeli').value = barang.hargaBeli;
            document.getElementById('hargaJual').value = barang.hargaJual;
            
            document.getElementById('addBarangModal').style.display = 'flex';
        }
    }

    // ===== FUNGSI HAPUS DATA =====

    function confirmDelete(id, type) {
        currentEditingId = id;
        currentEditingType = type;
        
        document.getElementById('confirmMessage').textContent = `Apakah Anda yakin ingin menghapus data ${type} ini?`;
        document.getElementById('confirmModal').style.display = 'flex';
    }

    async function confirmDeleteData() {
        if (currentEditingType === 'anggota') {
            anggotaData = anggotaData.filter(member => member.id !== currentEditingId);
            localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
            await syncAnggotaToSheets();
            refreshAnggotaTable();
            populateAnggotaDropdowns();
            
        } else if (currentEditingType === 'simpanan') {
            simpananData = simpananData.filter(simpanan => simpanan.id !== currentEditingId);
            localStorage.setItem('simpananData', JSON.stringify(simpananData));
            await syncSimpananToSheets();
            refreshSimpananTable();
            
        } else if (currentEditingType === 'pinjaman') {
            pinjamanData = pinjamanData.filter(pinjaman => pinjaman.id !== currentEditingId);
            localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
            await syncPinjamanToSheets();
            refreshPinjamanTable();
            
        } else if (currentEditingType === 'barang') {
            barangData = barangData.filter(barang => barang.id !== currentEditingId);
            localStorage.setItem('barangData', JSON.stringify(barangData));
            await syncBarangToSheets();
            refreshBarangTable();
        }
        
        updateDashboardStats();
        showNotification('Data berhasil dihapus!', 'success');
        document.getElementById('confirmModal').style.display = 'none';
        
        // Broadcast perubahan
        broadcastDataChange(currentEditingType);
    }

    // ===== FUNGSI DROPDOWN =====

    function populateAnggotaDropdowns() {
        const dropdownSimpanan = document.getElementById('idAnggotaSimpanan');
        const dropdownPinjaman = document.getElementById('idAnggotaPinjaman');
        
        if (dropdownSimpanan) {
            dropdownSimpanan.innerHTML = '<option value="">Pilih Anggota</option>';
            anggotaData.forEach(anggota => {
                const option = document.createElement('option');
                option.value = anggota.id;
                option.textContent = `${anggota.id} - ${anggota.nama}`;
                dropdownSimpanan.appendChild(option);
            });
        }
        
        if (dropdownPinjaman) {
            dropdownPinjaman.innerHTML = '<option value="">Pilih Anggota</option>';
            anggotaData.forEach(anggota => {
                const option = document.createElement('option');
                option.value = anggota.id;
                option.textContent = `${anggota.id} - ${anggota.nama}`;
                dropdownPinjaman.appendChild(option);
            });
        }
    }

    function populatePinjamanDropdowns() {
        // Implementasi jika diperlukan
    }

    // ===== FUNGSI CHART =====

    function setupFinanceChart() {
        const ctx = document.getElementById('financeChart').getContext('2d');
        
        // Data bulanan
        const monthlyData = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'],
            datasets: [{
                label: 'Simpanan (Juta Rupiah)',
                data: [120, 150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400],
                borderColor: '#4caf50',
                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Pinjaman (Juta Rupiah)',
                data: [80, 100, 120, 150, 180, 200, 230, 250, 270, 290, 310, 330],
                borderColor: '#ff9800',
                backgroundColor: 'rgba(255, 152, 0, 0.1)',
                tension: 0.4,
                fill: true
            }]
        };
        
        // Data tahunan
        const yearlyData = {
            labels: ['2019', '2020', '2021', '2022', '2023'],
            datasets: [{
                label: 'Simpanan (Miliar Rupiah)',
                data: [1.2, 1.8, 2.2, 2.8, 3.2],
                borderColor: '#4caf50',
                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Pinjaman (Miliar Rupiah)',
                data: [0.8, 1.2, 1.5, 1.8, 2.1],
                borderColor: '#ff9800',
                backgroundColor: 'rgba(255, 152, 0, 0.1)',
                tension: 0.4,
                fill: true
            }]
        };
        
        financeChart = new Chart(ctx, {
            type: 'line',
            data: monthlyData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Perkembangan Keuangan Koperasi'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function refreshChartData() {
        // Refresh data chart dengan data acak untuk simulasi
        const newData = financeChart.data.datasets.map(dataset => ({
            ...dataset,
            data: dataset.data.map(value => value + Math.floor(Math.random() * 50) - 25)
        }));
        
        financeChart.data.datasets = newData;
        financeChart.update();
        showNotification('Grafik telah diperbarui dengan data terbaru!', 'success');
    }

    function switchChartType(type) {
        if (type === 'monthly') {
            financeChart.data.labels = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
            financeChart.data.datasets[0].label = 'Simpanan (Juta Rupiah)';
            financeChart.data.datasets[1].label = 'Pinjaman (Juta Rupiah)';
            document.getElementById('monthlyChart').classList.add('btn-primary');
            document.getElementById('monthlyChart').classList.remove('btn-outline');
            document.getElementById('yearlyChart').classList.add('btn-outline');
            document.getElementById('yearlyChart').classList.remove('btn-primary');
        } else {
            financeChart.data.labels = ['2019', '2020', '2021', '2022', '2023'];
            financeChart.data.datasets[0].label = 'Simpanan (Miliar Rupiah)';
            financeChart.data.datasets[1].label = 'Pinjaman (Miliar Rupiah)';
            document.getElementById('yearlyChart').classList.add('btn-primary');
            document.getElementById('yearlyChart').classList.remove('btn-outline');
            document.getElementById('monthlyChart').classList.add('btn-outline');
            document.getElementById('monthlyChart').classList.remove('btn-primary');
        }
        
        financeChart.update();
    }

    // ===== FUNGSI EKSPOR/IMPOR EXCEL =====

    function exportToExcel() {
        const wb = XLSX.utils.book_new();
        
        // Sheet data anggota
        const wsAnggota = XLSX.utils.json_to_sheet(anggotaData.map(a => ({
            'ID_Anggota': a.id,
            'Posisi': a.posisi,
            'Nama': a.nama,
            'Alamat': a.alamat,
            'Jenis_Kelamin': a.jenisKelamin,
            'Agama': a.agama,
            'Status': a.status,
            'Email': a.email,
            'WhatsApp': a.whatsapp,
            'NIK': a.nik,
            'Tanggal_Daftar': a.tanggalDaftar,
            'Status_Aktif': a.statusAktif
        })));
        XLSX.utils.book_append_sheet(wb, wsAnggota, 'Data Anggota');
        
        // Sheet data simpanan
        const wsSimpanan = XLSX.utils.json_to_sheet(simpananData.map(s => ({
            'ID_Simpanan': s.id,
            'ID_Anggota': s.idAnggota,
            'Nama_Anggota': s.nama,
            'Jenis_Simpanan': s.jenisSimpanan,
            'Tanggal_Setor': s.tanggalSetor,
            'Nominal': s.nominal
        })));
        XLSX.utils.book_append_sheet(wb, wsSimpanan, 'Data Simpanan');
        
        // Sheet data pinjaman
        const wsPinjaman = XLSX.utils.json_to_sheet(pinjamanData.map(p => ({
            'ID_Pinjaman': p.id,
            'ID_Anggota': p.idAnggota,
            'Nama_Anggota': p.namaAnggota,
            'Jumlah_Pinjaman': p.jumlahPinjaman,
            'Tanggal_Pinjam': p.tanggalPinjam,
            'Jangka_Waktu': p.jangkaWaktu,
            'Bunga': p.bunga,
            'Sisa_Hutang': p.sisaHutang,
            'Status': p.status
        })));
        XLSX.utils.book_append_sheet(wb, wsPinjaman, 'Data Pinjaman');
        
        // Sheet data barang
        const wsBarang = XLSX.utils.json_to_sheet(barangData.map(b => ({
            'ID_Barang': b.id,
            'Nama_Barang': b.namaBarang,
            'Stok': b.stok,
            'Harga_Beli': b.hargaBeli,
            'Harga_Jual': b.hargaJual,
            'Laba': b.laba
        })));
        XLSX.utils.book_append_sheet(wb, wsBarang, 'Data Barang');
        
        XLSX.writeFile(wb, 'Data_Koperasi_Asmara_Tani.xlsx');
        showNotification('Data berhasil diexport ke Excel!', 'success');
    }

    function importExcelData() {
        const fileInput = document.getElementById('excelFile');
        const importType = document.getElementById('importType').value;
        
        if (fileInput.files.length === 0) {
            showNotification('Pilih file Excel terlebih dahulu!', 'error');
            return;
        }
        
        const file = fileInput.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
            if (importType === 'anggota') {
                jsonData.forEach(item => {
                    const newMember = {
                        id: item.ID_Anggota || 'AGT-' + (anggotaData.length + 1).toString().padStart(3, '0'),
                        posisi: item.Posisi || 'Anggota',
                        nama: item.Nama,
                        alamat: item.Alamat,
                        jenisKelamin: item.Jenis_Kelamin,
                        agama: item.Agama,
                        status: item.Status,
                        email: item.Email,
                        whatsapp: item.WhatsApp,
                        nik: item.NIK,
                        tanggalDaftar: item.Tanggal_Daftar || new Date().toLocaleDateString('id-ID'),
                        statusAktif: item.Status_Aktif || 'Aktif'
                    };
                    
                    const existingIndex = anggotaData.findIndex(m => m.id === newMember.id);
                    if (existingIndex !== -1) {
                        anggotaData[existingIndex] = newMember;
                    } else {
                        anggotaData.push(newMember);
                    }
                });
                
                localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
                refreshAnggotaTable();
                populateAnggotaDropdowns();
                syncAnggotaToSheets();
                
            } else if (importType === 'simpanan') {
                jsonData.forEach(item => {
                    const newSimpanan = {
                        id: item.ID_Simpanan || 'SPN-' + (simpananData.length + 1).toString().padStart(3, '0'),
                        idAnggota: item.ID_Anggota,
                        nama: item.Nama_Anggota,
                        jenisSimpanan: item.Jenis_Simpanan,
                        tanggalSetor: item.Tanggal_Setor,
                        nominal: parseInt(item.Nominal)
                    };
                    
                    const existingIndex = simpananData.findIndex(s => s.id === newSimpanan.id);
                    if (existingIndex !== -1) {
                        simpananData[existingIndex] = newSimpanan;
                    } else {
                        simpananData.push(newSimpanan);
                    }
                });
                
                localStorage.setItem('simpananData', JSON.stringify(simpananData));
                refreshSimpananTable();
                syncSimpananToSheets();
            }
            
            updateDashboardStats();
            showNotification('Data berhasil diimport!', 'success');
            document.getElementById('importExcelModal').style.display = 'none';
        };
        
        reader.readAsArrayBuffer(file);
    }

    // ===== FUNGSI CETAK KARTU =====

    function printMemberCard(memberId) {
        const member = anggotaData.find(m => m.id === memberId);
        if (member) {
            const cardContent = document.getElementById('cardContent');
            cardContent.innerHTML = `
                <h3>KARTU ANGGOTA</h3>
                <p><strong>ID Anggota:</strong> ${member.id}</p>
                <p><strong>Nama:</strong> ${member.nama}</p>
                <p><strong>Alamat:</strong> ${member.alamat}</p>
                <p><strong>No. HP:</strong> ${member.whatsapp}</p>
                <p><strong>Tanggal Bergabung:</strong> ${member.tanggalDaftar}</p>
                <hr>
                <p><em>Kartu ini berlaku selama menjadi anggota Koperasi Asmara Tani</em></p>
            `;
            
            window.print();
        }
    }

    // ===== FUNGSI PENGATURAN ADMIN =====

    function saveAdminSettings(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const role = document.getElementById('role').value;
        const norek = document.getElementById('norek').value;
        
        // Update admin profile
        document.getElementById('adminUsername').textContent = username;
        document.getElementById('adminEmail').textContent = email;
        document.getElementById('adminRole').textContent = role.charAt(0).toUpperCase() + role.slice(1);
        document.getElementById('adminRekening').textContent = norek;
        
        document.getElementById('topNavUsername').textContent = username;
        document.getElementById('topNavRole').textContent = role.charAt(0).toUpperCase() + role.slice(1);
        
        showNotification('Pengaturan admin berhasil disimpan!', 'success');
    }

    // ===== KOMUNIKASI ANTAR-HALAMAN =====
    
    function setupCrossPageCommunication() {
        // Listen for storage events
        window.addEventListener('storage', function(e) {
            if (e.key === 'dashboard_updated') {
                const updateData = JSON.parse(e.newValue);
                handleCrossPageUpdate(updateData);
            }
        });
        
        // Start polling for changes
        setInterval(checkForUpdates, 5000);
    }

    function handleCrossPageUpdate(updateData) {
        if (!updateData) return;
        
        // Update localStorage
        if (updateData.anggota) {
            localStorage.setItem('anggotaData', JSON.stringify(updateData.anggota));
        }
        if (updateData.simpanan) {
            localStorage.setItem('simpananData', JSON.stringify(updateData.simpanan));
        }
        
        // Refresh UI
        loadLocalStorageData();
        loadInitialData();
        
        showNotification('Data diperbarui dari halaman lain', 'info');
    }

    function broadcastDataChange(dataType) {
        const updateData = {
            timestamp: new Date().toISOString(),
            source: 'dashboard-admin'
        };
        
        if (dataType === 'all' || dataType === 'anggota') {
            updateData.anggota = anggotaData;
        }
        if (dataType === 'all' || dataType === 'simpanan') {
            updateData.simpanan = simpananData;
        }
        if (dataType === 'all' || dataType === 'pinjaman') {
            updateData.pinjaman = pinjamanData;
        }
        
        // Save to storage to trigger events
        localStorage.setItem('dashboard_updated', JSON.stringify(updateData));
        
        // Update sync flag for tabungan-digital.html
        localStorage.setItem('last_data_update', new Date().toISOString());
        localStorage.setItem('update_source', 'dashboard-admin');
    }

    function checkForUpdates() {
        const lastUpdate = localStorage.getItem('last_data_update');
        const updateSource = localStorage.getItem('update_source');
        
        if (lastUpdate && updateSource !== 'dashboard-admin') {
            const updateTime = new Date(lastUpdate);
            const now = new Date();
            const diff = (now - updateTime) / 1000;
            
            if (diff < 10) {
                loadLocalStorageData();
                loadInitialData();
                showNotification('Data diperbarui dari tabungan digital', 'info');
                
                localStorage.removeItem('last_data_update');
                localStorage.removeItem('update_source');
            }
        }
    }

    // ===== FUNGSI BANTUAN =====
    
    function showNotification(message, type = 'info') {
        // Remove existing notifications
        const existingNotif = document.querySelector('.sync-notification');
        if (existingNotif) existingNotif.remove();
        
        const notification = document.createElement('div');
        notification.className = `sync-notification ${type}`;
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 
                             type === 'error' ? 'exclamation-circle' : 
                             type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        // Auto remove after 3 seconds
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease forwards';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    function startAutoSync() {
        // Auto sync setiap 30 detik
        setInterval(async () => {
            if (CONFIG.GOOGLE_SHEETS.apiKey && CONFIG.GOOGLE_SHEETS.spreadsheetId) {
                await syncAllDataToGoogleSheets();
            }
        }, 30000);
    }

    function initializeSampleData() {
        if (anggotaData.length === 0) {
            const sampleAnggota = [
                {
                    id: 'AGT-001',
                    posisi: 'Anggota',
                    nama: 'Budi Santoso',
                    alamat: 'Jl. Merdeka No. 123, Jakarta',
                    jenisKelamin: 'Laki-laki',
                    agama: 'Islam',
                    status: 'Menikah',
                    email: 'budi.santoso@email.com',
                    whatsapp: '081234567890',
                    nik: '1234567890123456',
                    tanggalDaftar: '2023-01-15',
                    statusAktif: 'Aktif',
                    totalSimpanan: 500000,
                    totalPinjaman: 0,
                    saldo: 500000
                },
                {
                    id: 'AGT-002',
                    posisi: 'Pengurus',
                    nama: 'Sari Dewi',
                    alamat: 'Jl. Sudirman No. 45, Bandung',
                    jenisKelamin: 'Perempuan',
                    agama: 'Islam',
                    status: 'Belum Menikah',
                    email: 'sari.dewi@email.com',
                    whatsapp: '081298765432',
                    nik: '2345678901234567',
                    tanggalDaftar: '2023-02-20',
                    statusAktif: 'Aktif',
                    totalSimpanan: 750000,
                    totalPinjaman: 2000000,
                    saldo: -1250000
                }
            ];
            
            anggotaData = sampleAnggota;
            localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        }
        
        if (simpananData.length === 0) {
            const sampleSimpanan = [
                {
                    id: 'SPN-001',
                    idAnggota: 'AGT-001',
                    nama: 'Budi Santoso',
                    jenisSimpanan: 'Pokok',
                    tanggalSetor: '2023-01-15',
                    nominal: 50000,
                    metode: 'Transfer',
                    status: 'Berhasil',
                    verifiedBy: 'Admin'
                }
            ];
            
            simpananData = sampleSimpanan;
            localStorage.setItem('simpananData', JSON.stringify(simpananData));
        }
        
        if (pinjamanData.length === 0) {
            const samplePinjaman = [
                {
                    id: 'PJN-001',
                    idAnggota: 'AGT-002',
                    namaAnggota: 'Sari Dewi',
                    jumlahPinjaman: 2000000,
                    tanggalPinjam: '2023-03-10',
                    jangkaWaktu: '12 Bulan',
                    bunga: '1.5%',
                    sisaHutang: 2000000,
                    status: 'Belum Lunas'
                }
            ];
            
            pinjamanData = samplePinjaman;
            localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
        }
        
        loadInitialData();
    }
    </script>
</body>
</html>

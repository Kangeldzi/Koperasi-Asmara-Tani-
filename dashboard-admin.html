<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Koperasi Asmara Tani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* SEMUA CSS DARI SEBELUMNYA (TIDAK DIUBAH) */
        :root {
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary: #ff9800;
            --accent: #ff5722;
            --light: #f5f5f5;
            --dark: #333;
            --gray: #757575;
            --gray-light: #e0e0e0;
            --danger: #f44336;
            --warning: #ffc107;
            --success: #4caf50;
            --info: #2196f3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Container Utama */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: linear-gradient(to bottom, var(--primary-dark), var(--primary));
            color: white;
            transition: all 0.3s ease;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-header img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-header h1 {
            font-size: 1.4rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .sidebar-header .tagline {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }
        
        .sidebar-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            display: none;
            transition: transform 0.3s ease;
        }
        
        .sidebar-close:hover {
            transform: scale(1.2);
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .sidebar-menu ul {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 8px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .sidebar-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--secondary);
            padding-left: 30px;
        }
        
        .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: var(--secondary);
            font-weight: 600;
        }
        
        .sidebar-menu i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }
        
        /* Top Navigation */
        .top-nav {
            background: white;
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 999;
        }
        
        .nav-left {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .nav-buttons {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
            transition: transform 0.3s ease;
            display: none;
        }
        
        .menu-toggle:hover {
            transform: scale(1.1);
        }
        
        .current-time {
            font-size: 0.95rem;
            color: var(--primary-dark);
            font-weight: 600;
            background: var(--light);
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .current-time i {
            color: var(--primary);
        }
        
        .home-btn, .dashboard-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .home-btn:hover, .dashboard-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            background: var(--light);
            border-radius: 25px;
            padding: 10px 20px;
            width: 320px;
            transition: all 0.3s ease;
        }
        
        .search-bar:focus-within {
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
            transform: translateY(-2px);
        }
        
        .search-bar input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            margin-left: 12px;
            font-size: 0.95rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 15px;
            border-radius: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .user-info:hover {
            background: var(--light);
            transform: translateY(-2px);
        }
        
        .user-info img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }
        
        .user-details h4 {
            font-size: 0.95rem;
            margin-bottom: 2px;
        }
        
        .user-details p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Content Area */
        .content {
            padding: 30px;
            flex: 1;
            background: #f8f9fa;
        }
        
        .page-title {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-title h1 {
            font-size: 2rem;
            color: var(--primary-dark);
            position: relative;
            padding-bottom: 12px;
        }
        
        .page-title h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        /* PERBAIKAN GAP TOMBOL DI PAGE TITLE */
        .page-title > div {
            display: flex !important;
            gap: 12px !important;
            flex-wrap: wrap !important;
            align-items: center !important;
        }
        
        .page-title .btn {
            margin: 2px 3px !important;
        }
        
        /* Dashboard Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-info h3 {
            font-size: 0.95rem;
            color: var(--gray);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-info p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        
        .stat-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
        }
        
        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        .bg-primary { background: linear-gradient(135deg, var(--primary), var(--primary-light)); }
        .bg-secondary { background: linear-gradient(135deg, var(--secondary), #ffb74d); }
        .bg-accent { background: linear-gradient(135deg, var(--accent), #ff8a65); }
        .bg-info { background: linear-gradient(135deg, var(--info), #64b5f6); }
        .bg-success { background: linear-gradient(135deg, var(--success), #81c784); }
        .bg-warning { background: linear-gradient(135deg, var(--warning), #ffd54f); }
        
        /* Chart and Table Sections */
        .dashboard-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .chart-container, .table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .chart-container:before, .table-container:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .chart-container:hover, .table-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .section-header h2 {
            font-size: 1.3rem;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .chart-wrapper {
            height: 280px;
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px 18px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }
        
        th {
            background-color: rgba(46, 125, 50, 0.05);
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        tr {
            transition: background-color 0.3s ease;
        }
        
        tr:hover {
            background-color: rgba(46, 125, 50, 0.03);
        }
        
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .badge:hover {
            transform: scale(1.05);
        }
        
        .badge-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #e6a700;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .badge-danger {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }
        
        .badge-overdue {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }
        
        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover:before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-sm {
            padding: 10px 15px !important;
            margin: 2px 3px;
            font-size: 0.85rem;
        }
        
        /* Recent Activity */
        .activity-list {
            list-style: none;
        }
        
        .activity-item {
            display: flex;
            padding: 18px 0;
            border-bottom: 1px solid var(--gray-light);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            background-color: rgba(46, 125, 50, 0.03);
            border-radius: 10px;
            padding-left: 15px;
            padding-right: 15px;
            transform: translateX(5px);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover .activity-icon {
            transform: scale(1.1);
        }
        
        .activity-content h4 {
            font-size: 0.95rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .activity-content p {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: var(--gray);
            margin-left: auto;
            white-space: nowrap;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .required {
            color: var(--danger);
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--gray-light);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }
        
        /* Footer */
        .footer {
            background: white;
            padding: 20px 30px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
            margin-top: 30px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.03);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            color: white;
        }
        
        .modal-header h3 {
            color: white;
            font-size: 1.4rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            transition: transform 0.3s ease;
        }
        
        .modal-close:hover {
            transform: scale(1.2);
        }
        
        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 25px;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }
        
        .tab:hover {
            background-color: rgba(46, 125, 50, 0.05);
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
            background: rgba(46, 125, 50, 0.05);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Admin Profile Section */
        .admin-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .admin-profile img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }
        
        .admin-details h4 {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .admin-details p {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 3px;
        }
        
        .admin-details .admin-role {
            font-size: 10px;
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Bank Logo */
        .bank-logo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            background: var(--light);
            border-radius: 5px;
            font-size: 0.8rem;
        }
        
        .bank-logo i {
            color: var(--primary);
        }
        
        /* Modal Konfirmasi */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .confirm-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
            overflow: hidden;
        }
        
        .confirm-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            background: linear-gradient(90deg, var(--warning), #ffb74d);
            color: white;
        }
        
        .confirm-body {
            padding: 25px;
            text-align: center;
        }
        
        .confirm-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Print Card */
        .print-card {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 3000;
            padding: 20px;
        }
        
        @media print {
            .print-card {
                display: block;
            }
            .no-print {
                display: none;
            }
        }
        
        /* ===== STYLE UNTUK TABEL KELOLA ANGGOTA ===== */
        .table-responsive {
            overflow-x: auto;
        }
        
        .anggota-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .anggota-table th {
            background: rgba(46, 125, 50, 0.05);
            padding: 12px 15px;
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 0.85rem;
        }
        
        .anggota-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-light);
            font-size: 0.85rem;
        }
        
        /* WhatsApp Link */
        .whatsapp-link {
            color: #25D366 !important;
            text-decoration: none !important;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }
        
        .whatsapp-link:hover {
            color: #128C7E !important;
            text-decoration: underline !important;
        }
        
        .saldo-display {
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        /* Password Container dengan Ikon Mata */
        .password-container {
            position: relative;
            width: 100%;
        }
        
        .password-container .form-control {
            padding-right: 40px;
        }
        
        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
        }
        
        .toggle-password:hover {
            color: var(--primary);
        }
        
        /* Alert Styles */
        .alert {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }
        
        .alert-success {
            background: #e8f5e8;
            color: var(--success);
            border: 1px solid #c8e6c9;
        }
        
        .alert-error {
            background: #ffebee;
            color: var(--danger);
            border: 1px solid #ffcdd2;
        }
        
        /* Detail Section */
        .anggota-detail-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .anggota-detail-section h4 {
            margin-bottom: 10px;
            color: var(--primary-dark);
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .detail-item {
            margin-bottom: 10px;
        }
        
        .detail-label {
            font-weight: 600;
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 4px;
        }
        
        .detail-value {
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        /* Sync Status */
        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 10px;
        }
        
        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* CSS untuk Form Anggota Baru */
        .input-group {
            display: flex;
            align-items: center;
        }

        .input-group span {
            padding: 10px 15px;
            background: var(--light);
            border: 1px solid var(--gray-light);
            border-right: none;
            border-radius: 8px 0 0 8px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .input-group input {
            border-radius: 0 8px 8px 0;
        }

        /* Simpanan Card */
        .simpanan-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .simpanan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Modal Responsive */
        @media (max-width: 768px) {
            #addMemberModal .modal-content {
                max-width: 95% !important;
            }
            
            .detail-grid {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Responsive Design - Tablet */
        @media (max-width: 1200px) {
            .sidebar {
                width: 250px;
            }
            
            .main-content {
                margin-left: 250px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 20px;
            }
            
            .dashboard-row {
                gap: 20px;
            }
        }
        
        /* Responsive Design - Small Tablet */
        @media (max-width: 992px) {
            .dashboard-row {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .sidebar-close {
                display: block;
            }
            
            .search-bar {
                width: 250px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 18px;
            }
            
            .content {
                padding: 25px;
            }
        }
        
        /* Responsive Design - Mobile Landscape & Small Tablet */
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                margin-bottom: 25px;
            }
            
            .search-bar {
                width: 200px;
            }
            
            .nav-right {
                gap: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .section-header .btn {
                align-self: flex-end;
            }
            
            .chart-wrapper {
                height: 220px;
            }
            
            .card {
                padding: 20px;
            }
            
            .chart-container, .table-container {
                padding: 20px;
            }
            
            .page-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .page-title h1 {
                font-size: 1.8rem;
            }
            
            .stat-info p {
                font-size: 1.8rem;
            }
            
            .stat-icon {
                width: 70px;
                height: 70px;
                font-size: 1.8rem;
            }
        }
        
        /* Responsive Design - Mobile Portrait */
        @media (max-width: 576px) {
            .stats-cards {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .search-bar {
                display: none;
            }
            
            .top-nav {
                padding: 15px 20px;
            }
            
            .content {
                padding: 15px;
            }
            
            .card {
                padding: 18px;
                border-radius: 12px;
            }
            
            .chart-container, .table-container {
                padding: 18px;
                border-radius: 12px;
            }
            
            .chart-wrapper {
                height: 200px;
            }
            
            .user-details {
                display: none;
            }
            
            .page-title h1 {
                font-size: 1.6rem;
            }
            
            .section-header h2 {
                font-size: 1.2rem;
            }
            
            .stat-info p {
                font-size: 1.6rem;
            }
            
            .stat-icon {
                width: 60px;
                height: 60px;
                font-size: 1.6rem;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            .btn-sm {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 12px 14px;
                font-size: 0.85rem;
            }
            
            .admin-profile {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }
            
            .admin-profile img {
                width: 70px;
                height: 70px;
            }
            
            .nav-buttons {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .home-btn, .dashboard-btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .current-time {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
        
        /* Responsive Design - Small Mobile */
        @media (max-width: 400px) {
            .content {
                padding: 12px;
            }
            
            .top-nav {
                padding: 12px 15px;
            }
            
            .card {
                padding: 15px;
                border-radius: 10px;
            }
            
            .chart-container, .table-container {
                padding: 15px;
                border-radius: 10px;
            }
            
            .page-title h1 {
                font-size: 1.4rem;
            }
            
            .section-header h2 {
                font-size: 1.1rem;
            }
            
            .stat-info p {
                font-size: 1.4rem;
            }
            
            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }
            
            .btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }
            
            th, td {
                padding: 10px 12px;
                font-size: 0.8rem;
            }
            
            .home-btn, .dashboard-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            .menu-toggle {
                font-size: 1.3rem;
            }
            
            .user-info img {
                width: 40px;
                height: 40px;
            }
        }
        
        /* Responsive Design - Extra Small Mobile */
        @media (max-width: 360px) {
            .content {
                padding: 10px;
            }
            
            .top-nav {
                padding: 10px 12px;
            }
            
            .card {
                padding: 12px;
            }
            
            .chart-container, .table-container {
                padding: 12px;
            }
            
            .page-title h1 {
                font-size: 1.3rem;
            }
            
            .stat-info p {
                font-size: 1.3rem;
            }
            
            .stat-icon {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            
            .nav-buttons {
                gap: 8px;
            }
            
            .home-btn, .dashboard-btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .current-time {
                font-size: 0.75rem;
                padding: 5px 10px;
            }
        }
        
        /* CSS untuk Notification */
        .sync-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 12px 20px;
            background: #4285F4;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        }
        
        .sync-notification.success {
            background: #34A853;
        }
        
        .sync-notification.error {
            background: #EA4335;
        }
        
        .sync-notification.warning {
            background: #FBBC05;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* ============== CSS TAMBAHAN UNTUK PERBAIKAN ============== */
        
        /* ===== MODERN FORM STYLES ===== */
        .form-section-title {
            font-size: 1.1rem;
            color: var(--primary-dark);
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
            font-weight: 600;
            position: relative;
        }

        .form-section-title:before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 40px;
            height: 2px;
            background: var(--secondary);
        }

        /* Grid form responsive */
        .form-grid-responsive {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Foto profil modern */
        .foto-profil-container {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
        }

        .foto-profil-placeholder {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3.5rem;
            border: 5px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .foto-profil-placeholder:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .foto-profil-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .upload-foto-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 2;
        }

        .upload-foto-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        /* Card form modern */
        .form-card-group {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .form-card-group:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }

        /* Input group modern */
        .input-group-modern {
            display: flex;
            align-items: center;
            position: relative;
        }

        .input-group-modern .prefix {
            position: absolute;
            left: 15px;
            color: var(--gray);
            font-weight: 500;
            z-index: 2;
        }

        .input-group-modern .form-control {
            padding-left: 50px;
        }

        .input-group-modern .suffix {
            position: absolute;
            right: 15px;
            color: var(--gray);
            font-weight: 500;
        }

        /* Simpanan cards modern */
        .simpanan-card-modern {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .simpanan-card-modern:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .simpanan-card-modern.pokok {
            border-color: rgba(46, 125, 50, 0.3);
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.05), rgba(76, 175, 80, 0.05));
        }

        .simpanan-card-modern.wajib {
            border-color: rgba(255, 152, 0, 0.3);
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.05), rgba(255, 183, 77, 0.05));
        }

        .simpanan-card-modern.sukarela {
            border-color: rgba(255, 87, 34, 0.3);
            background: linear-gradient(135deg, rgba(255, 87, 34, 0.05), rgba(255, 138, 101, 0.05));
        }

        .simpanan-card-modern:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }

        .simpanan-card-modern.pokok:before {
            background: linear-gradient(to bottom, var(--primary), var(--primary-light));
        }

        .simpanan-card-modern.wajib:before {
            background: linear-gradient(to bottom, var(--secondary), #ffb74d);
        }

        .simpanan-card-modern.sukarela:before {
            background: linear-gradient(to bottom, var(--accent), #ff8a65);
        }

        /* Total simpanan display modern */
        .total-simpanan-display {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(46, 125, 50, 0.3);
            position: relative;
            overflow: hidden;
        }

        .total-simpanan-display:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1%, transparent 1%);
            background-size: 10px 10px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .total-simpanan-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .total-simpanan-amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }

        .total-simpanan-detail {
            font-size: 0.8rem;
            opacity: 0.9;
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }

        /* Responsive improvements for mobile */
        @media (max-width: 768px) {
            .form-grid-responsive {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .form-card-group {
                padding: 15px;
            }
            
            .simpanan-card-modern {
                padding: 15px;
            }
            
            .total-simpanan-display {
                padding: 20px;
            }
            
            .total-simpanan-amount {
                font-size: 1.6rem;
            }
            
            .foto-profil-container {
                width: 120px;
                height: 120px;
            }
            
            .foto-profil-placeholder {
                font-size: 2.8rem;
            }
            
            .upload-foto-btn {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }

        @media (max-width: 576px) {
            .modal-content {
                width: 95% !important;
                margin: 10px;
            }
            
            .form-section-title {
                font-size: 1rem;
            }
            
            .total-simpanan-amount {
                font-size: 1.4rem;
            }
        }

        /* Loading animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== RESPONSIVE TABLE STYLES ===== */
        .table-container-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 10px;
        }

        .anggota-table-responsive {
            min-width: 100%;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .anggota-table-responsive th,
            .anggota-table-responsive td {
                padding: 10px 8px;
                font-size: 0.8rem;
            }
            
            .anggota-table-responsive .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .anggota-table-responsive .btn-sm {
                padding: 6px 10px !important;
                font-size: 0.75rem;
            }
            
            /* Hide some columns on mobile */
            .anggota-table-responsive th:nth-child(3), /* NIK */
            .anggota-table-responsive td:nth-child(3),
            .anggota-table-responsive th:nth-child(4), /* Jenis Kelamin */
            .anggota-table-responsive td:nth-child(4) {
                display: none;
            }
        }

        @media (max-width: 576px) {
            /* Hide more columns on small mobile */
            .anggota-table-responsive th:nth-child(7), /* Tanggal Bergabung */
            .anggota-table-responsive td:nth-child(7) {
                display: none;
            }
            
            .anggota-table-responsive .user-avatar {
                width: 30px;
                height: 30px;
            }
        }

        /* Badge status responsive */
        .badge-responsive {
            padding: 4px 8px;
            font-size: 0.75rem;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Logo Koperasi Asmara Tani">
                <h1>Koperasi Asmara Tani</h1>
                <div class="tagline">#koperasijenius</div>
                <button class="sidebar-close" id="sidebarClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <ul>
                    <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-home"></i> <span>Dashboard Utama</span></a></li>
                    <li><a href="#" data-tab="anggota"><i class="fas fa-users"></i> <span>Data Anggota</span></a></li>
                    <!-- MENU TABUNGAN DIGITAL DI SIDEBAR -->
                    <li><a href="tabungan-digital.html"><i class="fas fa-book"></i> <span>Tabungan Digital</span></a></li>
                    <li><a href="#" data-tab="simpanan"><i class="fas fa-hand-holding-usd"></i> <span>Simpanan Anggota</span></a></li>
                    <li><a href="#" data-tab="pinjaman"><i class="fas fa-file-invoice-dollar"></i> <span>Pinjaman & Angsuran</span></a></li>
                    <li><a href="#" data-tab="laporan"><i class="fas fa-chart-line"></i> <span>Laporan Keuangan</span></a></li>
                    <li><a href="#" data-tab="unit-usaha"><i class="fas fa-shopping-cart"></i> <span>Unit Usaha</span></a></li>
                    <li><a href="#" data-tab="shu"><i class="fas fa-calculator"></i> <span>Laporan SHU</span></a></li>
                    <!-- LINK CALL ALERT LANGSUNG -->
                    <li><a href="call-alert.html" target="_blank"><i class="fas fa-bell"></i> <span>Call Alert</span></a></li>
                    <li><a href="#" data-tab="pengaturan"><i class="fas fa-cog"></i> <span>Pengaturan Sistem</span></a></li>
                    <li><a href="https://koperasi-asmara-tani.vercel.app/"><i class="fas fa-sign-out-alt"></i> <span>Keluar</span></a></li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navigation -->
            <div class="top-nav">
                <div class="nav-left">
                    <div class="nav-buttons">
                        <button class="menu-toggle" id="menuToggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <!-- TOMBOL BERANDA -->
                        <button class="home-btn" id="homeBtn" onclick="window.location.href='index.html'">
                            <i class="fas fa-home"></i>
                            <span>Beranda</span>
                        </button>
                        <!-- TOMBOL DASHBOARD -->
                        <button class="dashboard-btn" id="dashboardBtn" onclick="window.location.href='dashboard-admin.html'">
                            <i class="fas fa-chart-line"></i>
                            <span>Dashboard</span>
                        </button>
                    </div>
                    <div class="current-time" id="currentTime">
                        <i class="fas fa-clock"></i>
                        <span>Mengambil waktu...</span>
                    </div>
                </div>
                <div class="nav-right">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Cari data..." id="globalSearch">
                    </div>
                    <div class="user-info">
                        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Admin">
                        <div class="user-details">
                            <h4 id="topNavUsername">Admin Koperasi</h4>
                            <p id="topNavRole">Super Administrator</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Tab -->
                <div class="tab-content active" id="dashboard">
                    <div class="page-title">
                        <h1>Dashboard Utama</h1>
                        <div>
                            <!-- TOMBOL EXPORT DAN IMPORT EXCEL -->
                            <button class="btn btn-outline btn-sm" id="exportExcelBtn"><i class="fas fa-file-excel"></i> Export Excel</button>
                            <button class="btn btn-outline btn-sm" id="importExcelBtn"><i class="fas fa-file-import"></i> Import Excel</button>
                            <button class="btn btn-primary btn-sm" id="syncNowBtn"><i class="fas fa-sync-alt"></i> Sync Now</button>
                            <button class="btn btn-primary btn-sm" id="forceSyncBtn"><i class="fas fa-bolt"></i> Force Sync</button>
                        </div>
                    </div>

                    <!-- Admin Profile Section -->
                    <div class="admin-profile" id="adminProfileSection">
                        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Admin">
                        <div class="admin-details">
                            <h4 id="adminUsername">Admin Koperasi</h4>
                            <p id="adminEmail">admin@koperasiasmaratani.id</p>
                            <p id="adminRole">Super Administrator</p>
                            <p class="admin-role">No. Rekening: <span id="adminRekening" class="bank-logo"><i class="fas fa-university"></i> 4098-01-019526-53-3 (BRI)</span></p>
                            <p id="lastSyncTime" style="font-size: 10px; color: #666; margin-top: 3px;">Terakhir sync: -</p>
                        </div>
                    
                        <div>
                            <!-- LINK LANGSUNG KE CALL ALERT -->
                            <button class="btn btn-primary" onclick="window.location.href='call-alert.html'">
                                <i class="fas fa-bell"></i> Call Alert
                            </button>
                            <!-- LINK LANGSUNG KE TABUNGAN DIGITAL -->
                            <button class="btn btn-outline" onclick="window.location.href='tabungan-digital.html'">
                                <i class="fas fa-wallet"></i> Tabungan Digital
                            </button>
                        </div>
                    </div>

                    <!-- Stat Cards -->
                    <div class="stats-cards">
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Anggota</h3>
                                <p id="totalAnggota">0</p>
                            </div>
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Simpanan</h3>
                                <p id="totalSimpanan">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-secondary">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Pinjaman Aktif</h3>
                                <p id="totalPinjaman">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-accent">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total SHU</h3>
                                <p id="totalSHU">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-info">
                                <i class="fas fa-calculator"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Kas</h3>
                                <p id="totalKas">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-success">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Tables Row -->
                    <div class="dashboard-row">
                        <!-- Chart Section -->
                        <div class="chart-container">
                            <div class="section-header">
                                <h2>Grafik Perkembangan Keuangan</h2>
                                <div>
                                    <button class="btn btn-outline btn-sm" id="refreshChart"><i class="fas fa-sync-alt"></i> Refresh</button>
                                    <button class="btn btn-outline btn-sm" id="yearlyChart">Tahunan</button>
                                    <button class="btn btn-primary btn-sm" id="monthlyChart">Bulanan</button>
                                </div>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="financeChart"></canvas>
                            </div>
                        </div>
                        <!-- Recent Activity -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Notifikasi Terbaru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaNotif">Lihat Semua</button>
                            </div>
                            <ul class="activity-list" id="activityList">
                                <!-- Data akan diisi secara dinamis -->
                            </ul>
                        </div>
                    </div>

                    <!-- Tables Row -->
                    <div class="dashboard-row">
                        <!-- Pinjaman Terbaru -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Pinjaman Terbaru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaPinjaman">Lihat Semua</button>
                            </div>
                            <table id="pinjamanTable">
                                <thead>
                                    <tr>
                                        <th>Nama Anggota</th>
                                        <th>Tanggal</th>
                                        <th>Jumlah</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Anggota Baru -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Anggota Baru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaAnggota">Lihat Semua</button>
                            </div>
                            <table id="anggotaTable">
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>Tanggal Bergabung</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Data Anggota Tab -->
                <div class="tab-content" id="anggota">
                    <div class="page-title">
                        <h1>Data Anggota</h1>
                        <div>
                            <button class="btn btn-primary" id="addMemberBtn"><i class="fas fa-plus"></i> Tambah Anggota</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Daftar Anggota Koperasi</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari anggota..." id="searchAnggota">
                            </div>
                        </div>
                        <table id="anggotaFullTable">
                            <thead>
                                <tr>
                                    <th>ID/NIA</th>
                                    <th>Nama</th>
                                    <th>NIK</th>
                                    <th>Jenis Kelamin</th>
                                    <th>Alamat</th>
                                    <th>No. HP</th>
                                    <th>Tanggal Bergabung</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Simpanan Anggota Tab -->
                <div class="tab-content" id="simpanan">
                    <div class="page-title">
                        <h1>Simpanan Anggota</h1>
                        <button class="btn btn-primary" id="addSimpananBtn"><i class="fas fa-plus"></i> Tambah Simpanan</button>
                    </div>

                    <div class="tabs">
                        <div class="tab active" data-simpanan-tab="pokok">Simpanan Pokok</div>
                        <div class="tab" data-simpanan-tab="wajib">Simpanan Wajib</div>
                        <div class="tab" data-simpanan-tab="sukarela">Simpanan Sukarela</div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2 id="simpananTitle">Daftar Simpanan Pokok</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari simpanan..." id="searchSimpanan">
                            </div>
                        </div>
                        <table id="simpananTable">
                            <thead>
                                <tr>
                                    <th>ID Anggota</th>
                                    <th>Nama</th>
                                    <th>Jenis Simpanan</th>
                                    <th>Tanggal Setor</th>
                                    <th>Nominal</th>
                                    <th>Total Akumulasi</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pinjaman & Angsuran Tab -->
                <div class="tab-content" id="pinjaman">
                    <div class="page-title">
                        <h1>Pinjaman & Angsuran</h1>
                        <button class="btn btn-primary" id="addPinjamanBtn"><i class="fas fa-plus"></i> Tambah Pinjaman</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Daftar Pinjaman</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari pinjaman..." id="searchPinjaman">
                            </div>
                        </div>
                        <table id="pinjamanFullTable">
                            <thead>
                                <tr>
                                    <th>ID Pinjaman</th>
                                    <th>Nama Anggota</th>
                                    <th>Jumlah Pinjaman</th>
                                    <th>Tanggal Pinjam</th>
                                    <th>Jangka Waktu</th>
                                    <th>Bunga</th>
                                    <th>Sisa Hutang</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan Keuangan Tab -->
                <div class="tab-content" id="laporan">
                    <div class="page-title">
                        <h1>Laporan Keuangan</h1>
                        <button class="btn btn-primary" id="cetakLaporanBtn"><i class="fas fa-print"></i> Cetak Laporan</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Laporan Neraca</h2>
                        </div>
                        <table id="neracaTable">
                            <thead>
                                <tr>
                                    <th>Keterangan</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Unit Usaha Tab -->
                <div class="tab-content" id="unit-usaha">
                    <div class="page-title">
                        <h1>Unit Usaha / Toko Koperasi</h1>
                        <button class="btn btn-primary" id="addBarangBtn"><i class="fas fa-plus"></i> Tambah Barang</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Data Stok Barang</h2>
                        </div>
                        <table id="barangTable">
                            <thead>
                                <tr>
                                    <th>Kode Barang</th>
                                    <th>Nama Barang</th>
                                    <th>Stok</th>
                                    <th>Harga Beli</th>
                                    <th>Harga Jual</th>
                                    <th>Laba</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan SHU Tab -->
                <div class="tab-content" id="shu">
                    <div class="page-title">
                        <h1>Laporan SHU (Sisa Hasil Usaha)</h1>
                        <button class="btn btn-primary" id="cetakSHUBtn"><i class="fas fa-print"></i> Cetak Laporan</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Pembagian SHU Tahun <span id="currentYear"></span></h2>
                        </div>
                        <table id="shuTable">
                            <thead>
                                <tr>
                                    <th>Keterangan</th>
                                    <th>Persentase</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pengaturan Tab -->
                <div class="tab-content" id="pengaturan">
                    <div class="page-title">
                        <h1>Pengaturan Sistem & User</h1>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Data Admin</h2>
                        </div>
                        <form id="adminForm">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" class="form-control" value="admin_koperasi">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" class="form-control" value="admin@koperasiasmaratani.id">
                            </div>
                            <div class="form-group">
                                <label for="role">Role</label>
                                <select id="role" class="form-control">
                                    <option value="admin">Admin</option>
                                    <option value="pengurus">Pengurus</option>
                                    <option value="bendahara">Bendahara</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="foto">Ganti Foto Profil</label>
                                <input type="file" id="foto" class="form-control" accept="image/*">
                            </div>
                            <div class="form-group">
                                <label for="norek">No Rekening Admin</label>
                                <input type="text" id="norek" class="form-control" placeholder="Masukkan nomor rekening" value="1234-5678-9012-3456">
                            </div>
                            <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="footer">
                <p>&copy; <span id="currentYearFooter"></span> Koperasi Asmara Tani  Dashboard Admin</p>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL TAMBAH ANGGOTA MODERN ==================== -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="memberModalTitle">Tambah Anggota Baru</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                <form id="memberForm">
                    <input type="hidden" id="memberId">
                    
                    <!-- SECTION 1: FOTO PROFIL -->
                    <div class="form-section-title">
                        <i class="fas fa-user-circle"></i> Foto Profil
                    </div>
                    
                    <div class="form-card-group" style="text-align: center; background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                        <div class="foto-profil-container">
                            <div class="foto-profil-placeholder" id="fotoProfilPlaceholder">
                                <i class="fas fa-user"></i>
                            </div>
                            <div id="fotoProfilImg" style="display: none;"></div>
                            <button type="button" class="upload-foto-btn" id="uploadFotoBtn">
                                <i class="fas fa-camera"></i>
                            </button>
                            <input type="file" id="fotoMember" accept="image/*" style="display: none;">
                        </div>
                        <div style="margin-top: 10px;">
                            <p style="color: var(--gray); font-size: 0.85rem; margin-bottom: 5px;">
                                Klik ikon kamera untuk upload foto
                            </p>
                            <p style="color: var(--gray); font-size: 0.75rem;">
                                Format: JPG/PNG, Maks: 2MB
                            </p>
                        </div>
                    </div>
                    
                    <!-- SECTION 2: DATA DASAR -->
                    <div class="form-section-title">
                        <i class="fas fa-id-card"></i> Data Dasar
                    </div>
                    
                    <div class="form-grid-responsive">
                        <!-- ID/NIA (Automatic but editable) -->
                        <div class="form-card-group">
                            <label for="nia" class="required">ID/NIA Anggota</label>
                            <div class="input-group-modern">
                                <span class="prefix">NIA-</span>
                                <input type="text" id="nia" class="form-control" 
                                       placeholder="001" required
                                       pattern="[0-9]{3,6}"
                                       title="Format: 3-6 digit angka">
                                <span class="suffix">
                                    <i class="fas fa-hashtag"></i>
                                </span>
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> ID akan digenerate otomatis
                            </div>
                        </div>
                        
                        <!-- Posisi -->
                        <div class="form-card-group">
                            <label for="posisi" class="required">Posisi</label>
                            <select id="posisi" class="form-control" required style="background: white;">
                                <option value="">Pilih Posisi</option>
                                <option value="Ketua">Ketua</option>
                                <option value="Wakil Ketua">Wakil Ketua</option>
                                <option value="Sekretaris">Sekretaris</option>
                                <option value="Bendahara">Bendahara</option>
                                <option value="Pengawas">Pengawas</option>
                                <option value="Anggota Biasa" selected>Anggota Biasa</option>
                            </select>
                        </div>
                        
                        <!-- Nama Lengkap -->
                        <div class="form-card-group">
                            <label for="nama" class="required">Nama Lengkap</label>
                            <input type="text" id="nama" class="form-control" 
                                   placeholder="Masukkan nama lengkap" required>
                        </div>
                        
                        <!-- Jenis Kelamin -->
                        <div class="form-card-group">
                            <label for="jenisKelamin" class="required">Jenis Kelamin</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="jenisKelamin" value="Laki-laki" required 
                                           style="margin-right: 8px;" checked>
                                    <i class="fas fa-male" style="color: var(--info); margin-right: 5px;"></i>
                                    Laki-laki
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="jenisKelamin" value="Perempuan" required 
                                           style="margin-right: 8px;">
                                    <i class="fas fa-female" style="color: var(--accent); margin-right: 5px;"></i>
                                    Perempuan
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SECTION 3: KONTAK & IDENTITAS -->
                    <div class="form-section-title">
                        <i class="fas fa-address-book"></i> Kontak & Identitas
                    </div>
                    
                    <div class="form-grid-responsive">
                        <!-- Email -->
                        <div class="form-card-group">
                            <label for="emailMember" class="required">Email</label>
                            <div class="input-group-modern">
                                <span class="prefix">
                                    <i class="fas fa-envelope"></i>
                                </span>
                                <input type="email" id="emailMember" class="form-control" 
                                       placeholder="nama@email.com" required>
                            </div>
                        </div>
                        
                        <!-- WhatsApp -->
                        <div class="form-card-group">
                            <label for="whatsapp" class="required">WhatsApp</label>
                            <div class="input-group-modern">
                                <span class="prefix">
                                    <i class="fab fa-whatsapp" style="color: #25D366;"></i>
                                </span>
                                <input type="tel" id="whatsapp" class="form-control" 
                                       placeholder="6281234567890" required
                                       pattern="^[0-9]{10,15}$">
                            </div>
                        </div>
                        
                        <!-- NIK -->
                        <div class="form-card-group">
                            <label for="nik" class="required">NIK KTP</label>
                            <input type="text" id="nik" class="form-control" 
                                   placeholder="16 digit NIK" required
                                   pattern="[0-9]{16}"
                                   title="Masukkan 16 digit NIK">
                        </div>
                        
                        <!-- Agama -->
                        <div class="form-card-group">
                            <label for="agama" class="required">Agama</label>
                            <select id="agama" class="form-control" required style="background: white;">
                                <option value="">Pilih Agama</option>
                                <option value="Islam" selected>Islam</option>
                                <option value="Kristen">Kristen</option>
                                <option value="Katolik">Katolik</option>
                                <option value="Hindu">Hindu</option>
                                <option value="Budha">Budha</option>
                                <option value="Konghucu">Konghucu</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- SECTION 4: ALAMAT -->
                    <div class="form-section-title">
                        <i class="fas fa-map-marker-alt"></i> Alamat
                    </div>
                    
                    <div class="form-card-group">
                        <label for="alamat" class="required">Alamat Lengkap</label>
                        <textarea id="alamat" class="form-control" rows="3" 
                                  placeholder="Jl. Contoh No. 123, Kelurahan, Kecamatan, Kota, Provinsi"
                                  required maxlength="200"></textarea>
                        <div style="display: flex; justify-content: flex-end; margin-top: 8px;">
                            <span id="alamatCounter" style="font-size: 0.75rem; color: var(--gray);">
                                0/200 karakter
                            </span>
                        </div>
                    </div>
                    
                    <!-- SECTION 5: SIMPANAN -->
                    <div class="form-section-title">
                        <i class="fas fa-piggy-bank"></i> Simpanan Awal
                    </div>
                    
                    <div class="form-grid-responsive">
                        <!-- Simpanan Pokok -->
                        <div class="simpanan-card-modern pokok">
                            <label for="simpananPokok">
                                <i class="fas fa-landmark" style="color: var(--primary); margin-right: 8px;"></i>
                                Simpanan Pokok
                            </label>
                            <div class="input-group-modern" style="margin-top: 10px;">
                                <span class="prefix">Rp</span>
                                <input type="number" id="simpananPokok" class="form-control" 
                                       value="200000" min="0" step="5000">
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> Minimal Rp 200.000, dibayar sekali
                            </div>
                        </div>
                        
                        <!-- Simpanan Wajib -->
                        <div class="simpanan-card-modern wajib">
                            <label for="simpananWajib">
                                <i class="fas fa-calendar-check" style="color: var(--secondary); margin-right: 8px;"></i>
                                Simpanan Wajib
                            </label>
                            <div class="input-group-modern" style="margin-top: 10px;">
                                <span class="prefix">Rp</span>
                                <input type="number" id="simpananWajib" class="form-control" 
                                       value="20000" min="0" step="5000">
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> Minimal Rp 20.000, dibayar setiap bulan
                            </div>
                        </div>
                        
                        <!-- Simpanan Sukarela -->
                        <div class="simpanan-card-modern sukarela">
                            <label for="simpananSukarela">
                                <i class="fas fa-hand-holding-heart" style="color: var(--accent); margin-right: 8px;"></i>
                                Simpanan Sukarela
                            </label>
                            <div class="input-group-modern" style="margin-top: 10px;">
                                <span class="prefix">Rp</span>
                                <input type="number" id="simpananSukarela" class="form-control" 
                                       value="0" min="0" step="1000">
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> Opsional, sesuai kemampuan
                            </div>
                        </div>
                    </div>
                    
                    <!-- TOTAL SIMPANAN -->
                    <div class="total-simpanan-display">
                        <div class="total-simpanan-label">TOTAL SIMPANAN AWAL</div>
                        <div class="total-simpanan-amount" id="totalSimpananDisplay">Rp 220.000</div>
                        <div class="total-simpanan-detail">
                            <div>Pokok: <span id="detailPokok">Rp 200.000</span></div>
                            <div>Wajib: <span id="detailWajib">Rp 20.000</span></div>
                            <div>Sukarela: <span id="detailSukarela">Rp 0</span></div>
                        </div>
                    </div>
                    
                    <!-- SECTION 6: PASSWORD -->
                    <div class="form-section-title">
                        <i class="fas fa-lock"></i> Keamanan
                    </div>
                    
                    <div class="form-grid-responsive">
                        <div class="form-card-group">
                            <label for="passwordMember" class="required">Password Login</label>
                            <div class="password-container">
                                <input type="password" id="passwordMember" class="form-control" 
                                       placeholder="Minimal 6 karakter" required
                                       minlength="6">
                                <button type="button" class="toggle-password" id="togglePasswordMember">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-shield-alt"></i> Untuk login dashboard anggota
                            </div>
                        </div>
                        
                        <!-- Tanggal Daftar -->
                        <div class="form-card-group">
                            <label for="tanggalDaftar">Tanggal Bergabung</label>
                            <input type="date" id="tanggalDaftar" class="form-control" required>
                        </div>
                    </div>
                    
                    <!-- SECTION 7: STATUS -->
                    <div class="form-section-title">
                        <i class="fas fa-user-check"></i> Status
                    </div>
                    
                    <div class="form-card-group">
                        <label for="statusAktif" class="required">Status Keanggotaan</label>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 15px; 
                                   background: rgba(76, 175, 80, 0.1); border-radius: 8px; border: 2px solid rgba(76, 175, 80, 0.3);">
                                <input type="radio" name="statusAktif" value="Aktif" required 
                                       style="margin-right: 8px;" checked>
                                <i class="fas fa-check-circle" style="color: var(--success); margin-right: 5px;"></i>
                                Aktif
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 15px; 
                                   background: rgba(244, 67, 54, 0.1); border-radius: 8px; border: 2px solid rgba(244, 67, 54, 0.3);">
                                <input type="radio" name="statusAktif" value="Tidak Aktif" required 
                                       style="margin-right: 8px;">
                                <i class="fas fa-times-circle" style="color: var(--danger); margin-right: 5px;"></i>
                                Tidak Aktif
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 15px; 
                                   background: rgba(255, 193, 7, 0.1); border-radius: 8px; border: 2px solid rgba(255, 193, 7, 0.3);">
                                <input type="radio" name="statusAktif" value="Menunggu" required 
                                       style="margin-right: 8px;">
                                <i class="fas fa-clock" style="color: var(--warning); margin-right: 5px;"></i>
                                Menunggu
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelMemberBtn" style="padding: 12px 25px;">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="btn btn-primary" id="saveMemberBtn" style="padding: 12px 30px;">
                    <i class="fas fa-save"></i> Simpan Data Anggota
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Detail Anggota -->
    <div class="modal" id="detailAnggotaModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Detail Anggota</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="detailAnggotaContent">
                <!-- Detail anggota akan dimuat di sini -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="document.getElementById('detailAnggotaModal').style.display='none'">Tutup</button>
                <button class="btn btn-primary" id="editDetailBtn">Edit</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Simpanan -->
    <div class="modal" id="addSimpananModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="simpananModalTitle">Tambah Simpanan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="simpananForm">
                    <input type="hidden" id="simpananId">
                    <div class="form-group">
                        <label for="idAnggotaSimpanan">ID Anggota <span class="required">*</span></label>
                        <select id="idAnggotaSimpanan" class="form-control" required>
                            <option value="">Pilih Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jenisSimpanan">Jenis Simpanan <span class="required">*</span></label>
                        <select id="jenisSimpanan" class="form-control" required>
                            <option value="">Pilih Jenis</option>
                            <option value="Pokok">Pokok</option>
                            <option value="Wajib">Wajib</option>
                            <option value="Sukarela">Sukarela</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tanggalSimpanan">Tanggal Setor <span class="required">*</span></label>
                        <input type="date" id="tanggalSimpanan" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="nominalSimpanan">Nominal <span class="required">*</span></label>
                        <input type="number" id="nominalSimpanan" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelSimpananBtn">Batal</button>
                <button class="btn btn-primary" id="saveSimpananBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Pinjaman -->
    <div class="modal" id="addPinjamanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pinjamanModalTitle">Tambah Pinjaman</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="pinjamanForm">
                    <input type="hidden" id="pinjamanId">
                    <div class="form-group">
                        <label for="idAnggotaPinjaman">ID Anggota <span class="required">*</span></label>
                        <select id="idAnggotaPinjaman" class="form-control" required>
                            <option value="">Pilih Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jumlahPinjaman">Jumlah Pinjaman <span class="required">*</span></label>
                        <input type="number" id="jumlahPinjaman" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="tanggalPinjaman">Tanggal Pinjam <span class="required">*</span></label>
                        <input type="date" id="tanggalPinjaman" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="jangkaWaktu">Jangka Waktu <span class="required">*</span></label>
                        <select id="jangkaWaktu" class="form-control" required>
                            <option value="">Pilih Jangka Waktu</option>
                            <option value="6 Bulan">6 Bulan</option>
                            <option value="12 Bulan">12 Bulan</option>
                            <option value="24 Bulan">24 Bulan</option>
                            <option value="36 Bulan">36 Bulan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bungaPinjaman">Bunga (%) <span class="required">*</span></label>
                        <input type="number" id="bungaPinjaman" class="form-control" step="0.1" value="1.5" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelPinjamanBtn">Batal</button>
                <button class="btn btn-primary" id="savePinjamanBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Barang -->
    <div class="modal" id="addBarangModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="barangModalTitle">Tambah Barang</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="barangForm">
                    <input type="hidden" id="barangId">
                    <div class="form-group">
                        <label for="namaBarang">Nama Barang <span class="required">*</span></label>
                        <input type="text" id="namaBarang" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="stokBarang">Stok <span class="required">*</span></label>
                        <input type="number" id="stokBarang" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hargaBeli">Harga Beli <span class="required">*</span></label>
                        <input type="number" id="hargaBeli" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hargaJual">Harga Jual <span class="required">*</span></label>
                        <input type="number" id="hargaJual" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelBarangBtn">Batal</button>
                <button class="btn btn-primary" id="saveBarangBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Konfirmasi Hapus -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <div class="confirm-header">
                <h3>Konfirmasi Hapus</h3>
            </div>
            <div class="confirm-body">
                <p id="confirmMessage">Apakah Anda yakin ingin menghapus data ini?</p>
            </div>
            <div class="confirm-footer">
                <button class="btn btn-outline" id="cancelDeleteBtn">Batal</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Modal Import Excel -->
    <div class="modal" id="importExcelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Data dari Excel</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="excelFile">Pilih File Excel</label>
                    <input type="file" id="excelFile" class="form-control" accept=".xlsx, .xls">
                </div>
                <div class="form-group">
                    <label for="importType">Jenis Data</label>
                    <select id="importType" class="form-control">
                        <option value="anggota">Data Anggota</option>
                        <option value="simpanan">Data Simpanan</option>
                        <option value="pinjaman">Data Pinjaman</option>
                        <option value="barang">Data Barang</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelImportBtn">Batal</button>
                <button class="btn btn-primary" id="confirmImportBtn">Import</button>
            </div>
        </div>
    </div>

    <!-- Preview Print Modal -->
    <div class="modal" id="printPreviewModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Preview Cetak Laporan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="printPreviewContent">
                <!-- Preview cetak akan diisi di sini -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="document.getElementById('printPreviewModal').style.display='none'">Tutup</button>
                <button class="btn btn-primary" onclick="printLaporan()"><i class="fas fa-print"></i> Cetak</button>
            </div>
        </div>
    </div>

    <script>
    // ===== KONFIGURASI UTAMA =====
    const CONFIG = {
        GOOGLE_SHEETS: {
            apiKey: localStorage.getItem('google_api_key') || '',
            spreadsheetId: localStorage.getItem('google_sheets_id') || '',
            baseUrl: 'https://sheets.googleapis.com/v4/spreadsheets'
        },
        SYNC_INTERVAL: 30000, // 30 detik
        REAL_TIME_INTERVAL: 5000, // 5 detik untuk real-time sync
        TAB_SHEET_MAPPING: {
            'anggota': 'Anggota',
            'simpanan': 'Simpanan',
            'pinjaman': 'Pinjaman',
            'barang': 'Barang',
            'transaksi': 'Transaksi',
            'shu': 'SHU'
        }
    };

    // ===== VARIABEL GLOBAL =====
    let anggotaData = [];
    let simpananData = [];
    let pinjamanData = [];
    let barangData = [];
    let transaksiData = [];
    let shuData = [];
    let currentEditingId = null;
    let currentEditingType = null;
    let financeChart = null;

    // ===== INISIALISASI KOMPLIT SISTEM =====
    function initializeCompleteSystem() {
        console.log('=== SYSTEM INITIALIZATION STARTED ===');
        
        // 1. Setup real-time clock
        setupRealTimeFull();
        
        // 2. Load data
        loadLocalStorageData();
        
        // 3. Setup charts
        setupFinanceChart();
        
        // 4. Setup sidebar navigation
        setupSidebarNavigationFull();
        
        // 5. Setup all button functionality
        activateAllButtons();
        
        // 6. Setup modal controls
        setupModalControls();
        
        // 7. Setup member detail modals
        setupMemberDetailModals();
        
        // 8. Setup new member form with modern design
        setupNewMemberForm();
        
        // 9. Setup NIA system
        setupNIASystem();
        
        // 10. Load initial data
        loadInitialData();
        
        // 11. Setup auto refresh
        setupAutoRefresh();
        
        // 12. Sync NIA from registration system
        syncNIAFromRegistration();
        
        // 13. Setup cross-page sync
        setupCrossPageSync();
        
        // 14. Update UI
        updateDashboardStats();
        updateFinancialDataInRealTime();
        
        console.log('=== SYSTEM INITIALIZATION COMPLETED ===');
        showNotification('Sistem berhasil dimuat dengan sistem NIA otomatis!', 'success');
    }

    // ===== FUNGSI REAL-TIME LENGKAP =====
    function setupRealTimeFull() {
        console.log('Setting up real-time clock...');
        
        function updateTimeFull() {
            const now = new Date();
            
            // Nama hari dalam bahasa Indonesia
            const hariIndo = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            
            // Nama bulan dalam bahasa Indonesia
            const bulanIndo = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
            
            // Ambil komponen waktu
            const hari = hariIndo[now.getDay()];
            const tanggal = now.getDate();
            const bulan = bulanIndo[now.getMonth()];
            const tahun = now.getFullYear();
            
            // Format waktu dengan leading zero
            const jam = now.getHours().toString().padStart(2, '0');
            const menit = now.getMinutes().toString().padStart(2, '0');
            const detik = now.getSeconds().toString().padStart(2, '0');
            
            // Format lengkap untuk header
            const timeStringHeader = `${hari}, ${tanggal} ${bulan} ${tahun} | ${jam}:${menit}:${detik} WIB`;
            
            // Format untuk form
            const timeStringForm = `${hari}, ${tanggal} ${bulan} ${tahun} - ${jam}:${menit}:${detik} WIB`;
            
            // Update semua elemen waktu
            const timeElements = document.querySelectorAll('#currentTime, .current-time');
            timeElements.forEach(el => {
                if (el.id === 'currentTime') {
                    el.innerHTML = `<i class="fas fa-clock"></i> ${timeStringHeader}`;
                }
            });
            
            // Update form jika ada
            const tanggalDaftarInput = document.getElementById('tanggalDaftar');
            if (tanggalDaftarInput) {
                tanggalDaftarInput.value = timeStringForm;
            }
            
            // Update juga di admin profile
            const lastSyncElement = document.getElementById('lastSyncTime');
            if (lastSyncElement) {
                lastSyncElement.textContent = `Terakhir update: ${jam}:${menit}:${detik}`;
            }
        }
        
        // Update langsung dan set interval
        updateTimeFull();
        setInterval(updateTimeFull, 1000);
        
        console.log(' Real-time clock aktif');
    }

    function loadLocalStorageData() {
        console.log('Loading data from localStorage...');
        
        try {
            anggotaData = JSON.parse(localStorage.getItem('koperasi_anggota')) || JSON.parse(localStorage.getItem('anggotaData')) || [];
            simpananData = JSON.parse(localStorage.getItem('simpananData')) || [];
            pinjamanData = JSON.parse(localStorage.getItem('pinjamanData')) || [];
            barangData = JSON.parse(localStorage.getItem('barangData')) || [];
            transaksiData = JSON.parse(localStorage.getItem('transaksiData')) || [];
            shuData = JSON.parse(localStorage.getItem('shuData')) || [];
            
            console.log('Data loaded:', {
                anggota: anggotaData.length,
                simpanan: simpananData.length,
                pinjaman: pinjamanData.length,
                barang: barangData.length
            });
        } catch (error) {
            console.error('Error loading localStorage data:', error);
        }
    }

    // ===== SISTEM ID/NIA OTOMATIS =====

    // Fungsi untuk generate ID/NIA otomatis
    function generateNIA() {
        // Ambil data dari localStorage
        const anggotaData = JSON.parse(localStorage.getItem('koperasi_anggota')) || [];
        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
        
        // Gabungkan semua data untuk mendapatkan ID tertinggi
        const allMembers = [...anggotaData, ...registeredUsers];
        
        // Cari ID tertinggi dengan format NIA-XXX
        let highestId = 0;
        
        allMembers.forEach(member => {
            if (member.id && member.id.startsWith('NIA-')) {
                const idNumber = parseInt(member.id.replace('NIA-', ''));
                if (idNumber > highestId) {
                    highestId = idNumber;
                }
            }
            
            // Juga cek dari nia field jika ada
            if (member.nia && member.nia.startsWith('NIA-')) {
                const idNumber = parseInt(member.nia.replace('NIA-', ''));
                if (idNumber > highestId) {
                    highestId = idNumber;
                }
            }
        });
        
        // Generate ID baru (tambah 1)
        const newIdNumber = highestId + 1;
        const newNIA = 'NIA-' + newIdNumber.toString().padStart(3, '0');
        
        return newNIA;
    }

    // Fungsi untuk sinkronisasi ID dari sistem registrasi ke dashboard
    function syncNIAFromRegistration() {
        console.log('Synchronizing NIA from registration system...');
        
        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
        let anggotaData = JSON.parse(localStorage.getItem('koperasi_anggota')) || [];
        
        let newMembersCount = 0;
        
        registeredUsers.forEach(user => {
            // Cek apakah user sudah ada di anggotaData
            const existingMember = anggotaData.find(member => 
                member.email === user.email || 
                member.nik === user.nik
            );
            
            if (!existingMember) {
                // Generate NIA untuk user baru
                const newNIA = generateNIA();
                
                // Buat data anggota baru
                const newMember = {
                    id: newNIA,
                    nia: newNIA,
                    posisi: 'Anggota Biasa',
                    nama: user.fullName || user.nama || 'Anggota Baru',
                    alamat: user.address || user.alamat || '',
                    jenisKelamin: user.gender || user.jenisKelamin || 'Laki-laki',
                    agama: user.religion || user.agama || 'Islam',
                    status: 'Belum Menikah',
                    email: user.email || '',
                    whatsapp: user.phone || user.whatsapp || '',
                    nik: user.nik || '',
                    tanggalDaftar: user.registrationDate || user.tanggalDaftar || new Date().toISOString().split('T')[0],
                    statusAktif: 'Aktif',
                    foto: user.photo || user.foto || '',
                    simpananPokok: 200000,
                    simpananWajib: 20000,
                    simpananSukarela: 0,
                    totalSimpanan: 220000,
                    totalPinjaman: 0,
                    saldo: 220000,
                    password: user.password || '',
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                anggotaData.push(newMember);
                newMembersCount++;
                
                console.log(`Generated NIA ${newNIA} for: ${newMember.nama}`);
            }
        });
        
        // Simpan data yang sudah disinkronisasi
        if (newMembersCount > 0) {
            localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
            localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
            console.log(` Added ${newMembersCount} new members with auto-generated NIA`);
        }
        
        return newMembersCount;
    }

    // Fungsi untuk mengatur form dengan NIA otomatis
    function setupNIASystem() {
        const niaInput = document.getElementById('nia');
        
        if (niaInput) {
            // Generate NIA otomatis saat modal dibuka
            const autoNIA = generateNIA();
            niaInput.value = autoNIA.replace('NIA-', '');
            
            // Update ketika ada perubahan data
            niaInput.addEventListener('focus', function() {
                if (this.value === '' || this.value === '0') {
                    const autoNIA = generateNIA();
                    this.value = autoNIA.replace('NIA-', '');
                }
            });
        }
    }

    // Fungsi untuk validasi dan format NIA
    function formatNIA(niaValue) {
        // Hapus semua non-digit
        const numbers = niaValue.replace(/\D/g, '');
        
        // Tambahkan prefix NIA- jika belum ada
        if (numbers && !niaValue.toUpperCase().startsWith('NIA-')) {
            return 'NIA-' + numbers.padStart(3, '0');
        }
        
        return niaValue.toUpperCase();
    }

    // Fungsi untuk cek duplikasi NIA
    function checkDuplicateNIA(niaValue) {
        const anggotaData = JSON.parse(localStorage.getItem('koperasi_anggota')) || [];
        const formattedNIA = formatNIA(niaValue);
        
        return anggotaData.some(member => 
            member.id === formattedNIA || 
            member.nia === formattedNIA
        );
    }

    // ===== FUNGSI UNTUK FORM ANGGOTA BARU MODERN =====
    function setupNewMemberForm() {
        console.log('Setting up new member form with modern design...');
        
        // Setup foto profil modern
        setupFotoProfil();
        
        // Setup NIA system
        setupNIASystem();
        
        // SET DEFAULT SIMPANAN SESUAI PERMINTAAN
        document.getElementById('simpananPokok').value = 200000; // Rp 200.000
        document.getElementById('simpananWajib').value = 20000;  // Rp 20.000
        document.getElementById('simpananSukarela').value = 0;   // Rp 0 (semampunya)
        
        // Update total simpanan secara real-time
        const simpananInputs = ['simpananPokok', 'simpananWajib', 'simpananSukarela'];
        simpananInputs.forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('input', updateTotalSimpananDisplay);
            }
        });
        
        // Setup karakter counter untuk alamat
        const alamatInput = document.getElementById('alamat');
        const alamatCounter = document.getElementById('alamatCounter');
        
        if (alamatInput && alamatCounter) {
            alamatInput.addEventListener('input', function() {
                const count = this.value.length;
                alamatCounter.textContent = `${count}/200 karakter`;
                
                if (count > 200) {
                    alamatCounter.style.color = 'var(--danger)';
                } else if (count > 180) {
                    alamatCounter.style.color = 'var(--warning)';
                } else {
                    alamatCounter.style.color = 'var(--gray)';
                }
            });
            
            // Initialize counter
            alamatCounter.textContent = `0/200 karakter`;
        }
        
        // Setup radio buttons for status
        const statusRadios = document.querySelectorAll('input[name="statusAktif"]');
        statusRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                // Add visual feedback
                document.querySelectorAll('label[for^="status"]').forEach(label => {
                    label.style.opacity = '0.7';
                    label.style.transform = 'scale(0.98)';
                    label.style.boxShadow = 'none';
                });
                
                const selectedLabel = this.closest('label');
                if (selectedLabel) {
                    selectedLabel.style.opacity = '1';
                    selectedLabel.style.transform = 'scale(1)';
                    selectedLabel.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                }
            });
        });
        
        // Toggle password visibility
        const togglePasswordMember = document.getElementById('togglePasswordMember');
        const passwordMember = document.getElementById('passwordMember');
        
        if (togglePasswordMember && passwordMember) {
            togglePasswordMember.addEventListener('click', function() {
                const type = passwordMember.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordMember.setAttribute('type', type);
                this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
        }
        
        // Set tanggal default
        const tanggalDaftar = document.getElementById('tanggalDaftar');
        if (tanggalDaftar) {
            const today = new Date().toISOString().split('T')[0];
            tanggalDaftar.value = today;
        }
        
        console.log(' New member form setup completed with modern design');
    }

    function setupFotoProfil() {
        const fotoProfilPlaceholder = document.getElementById('fotoProfilPlaceholder');
        const fotoProfilImg = document.getElementById('fotoProfilImg');
        const fotoMember = document.getElementById('fotoMember');
        const uploadFotoBtn = document.getElementById('uploadFotoBtn');
        
        if (fotoProfilPlaceholder && uploadFotoBtn) {
            // Click on placeholder atau tombol kamera
            fotoProfilPlaceholder.addEventListener('click', () => fotoMember.click());
            uploadFotoBtn.addEventListener('click', () => fotoMember.click());
            
            // Handle file selection
            fotoMember.addEventListener('change', function(e) {
                const file = this.files[0];
                if (file) {
                    // Validasi ukuran file
                    if (file.size > 2 * 1024 * 1024) {
                        showNotification('Ukuran file maksimal 2MB', 'error');
                        return;
                    }
                    
                    // Validasi tipe file
                    if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                        showNotification('Format file harus JPG atau PNG', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // Tampilkan gambar
                        fotoProfilImg.innerHTML = `<img src="${e.target.result}" class="foto-profil-img">`;
                        fotoProfilImg.style.display = 'block';
                        fotoProfilPlaceholder.style.display = 'none';
                        
                        // Tambahkan efek animasi
                        fotoProfilImg.style.opacity = '0';
                        setTimeout(() => {
                            fotoProfilImg.style.opacity = '1';
                            fotoProfilImg.style.transform = 'scale(1.05)';
                        }, 10);
                        
                        setTimeout(() => {
                            fotoProfilImg.style.transform = 'scale(1)';
                        }, 200);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    }

    // Fungsi update total simpanan display
    function updateTotalSimpananDisplay() {
        const pokok = parseFloat(document.getElementById('simpananPokok').value) || 0;
        const wajib = parseFloat(document.getElementById('simpananWajib').value) || 0;
        const sukarela = parseFloat(document.getElementById('simpananSukarela').value) || 0;
        
        const total = pokok + wajib + sukarela;
        
        // Update total display
        const display = document.getElementById('totalSimpananDisplay');
        if (display) {
            display.textContent = `Rp ${total.toLocaleString('id-ID')}`;
        }
        
        // Update detail display
        document.getElementById('detailPokok').textContent = `Rp ${pokok.toLocaleString('id-ID')}`;
        document.getElementById('detailWajib').textContent = `Rp ${wajib.toLocaleString('id-ID')}`;
        document.getElementById('detailSukarela').textContent = `Rp ${sukarela.toLocaleString('id-ID')}`;
    }

    // ===== SETUP SIDEBAR NAVIGATION LENGKAP =====
    function setupSidebarNavigationFull() {
        console.log('Setting up complete sidebar navigation...');
        
        // 1. Tab Navigation
        document.querySelectorAll('.sidebar-menu a[data-tab]').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all
                document.querySelectorAll('.sidebar-menu a').forEach(i => {
                    i.classList.remove('active');
                });
                
                // Add active to clicked
                this.classList.add('active');
                
                // Show corresponding tab
                const tabId = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                const targetTab = document.getElementById(tabId);
                if (targetTab) {
                    targetTab.classList.add('active');
                    showNotification(`Membuka tab: ${targetTab.querySelector('h1').textContent}`, 'info');
                }
                
                // Close sidebar on mobile
                if (window.innerWidth <= 992) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            });
        });
        
        // 2. External Links
        const externalLinks = [
            { selector: 'a[href="tabungan-digital.html"]', newTab: true },
            { selector: 'a[href="call-alert.html"]', newTab: true },
            { selector: 'a[href^="https://"]', newTab: true }
        ];
        
        externalLinks.forEach(linkConfig => {
            document.querySelectorAll(linkConfig.selector).forEach(link => {
                link.addEventListener('click', function(e) {
                    if (linkConfig.newTab) {
                        e.preventDefault();
                        window.open(this.href, '_blank');
                    }
                });
            });
        });
        
        // 3. Menu Toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebarClose');
        
        if (menuToggle) {
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
        }
        
        if (sidebarClose) {
            sidebarClose.addEventListener('click', () => {
                sidebar.classList.remove('active');
            });
        }
        
        console.log(' Sidebar navigation setup completed');
    }

    // ===== PERBAIKAN 1: AKTIVASI SEMUA TOMBOL MENU DAN TOMBOL AKSI =====
    function activateAllButtons() {
        console.log('Mengaktifkan semua tombol...');
        
        // 1. Tombol Dashboard Utama
        activateDashboardButtons();
        
        // 2. Tombol Data Anggota
        activateAnggotaButtons();
        
        // 3. Tombol Simpanan
        activateSimpananButtons();
        
        // 4. Tombol Pinjaman
        activatePinjamanButtons();
        
        // 5. Tombol Laporan
        activateLaporanButtons();
        
        // 6. Tombol Unit Usaha
        activateUnitUsahaButtons();
        
        // 7. Tombol SHU
        activateSHUButtons();
        
        // 8. Tombol Pengaturan
        activatePengaturanButtons();
        
        console.log(' Semua tombol telah diaktifkan');
    }

    // ===== FUNGSI PENGATIF TOMBOL PER MODUL =====
    function activateDashboardButtons() {
        // Export Excel
        const exportBtn = document.getElementById('exportExcelBtn');
        if (exportBtn) {
            exportBtn.addEventListener('click', exportToExcel);
        }
        
        // Import Excel
        const importBtn = document.getElementById('importExcelBtn');
        if (importBtn) {
            importBtn.addEventListener('click', () => {
                document.getElementById('importExcelModal').style.display = 'flex';
            });
        }
        
        // Sync Now
        const syncNowBtn = document.getElementById('syncNowBtn');
        if (syncNowBtn) {
            syncNowBtn.addEventListener('click', () => {
                syncDataBetweenSystems();
                showNotification('Sinkronisasi data berhasil!', 'success');
            });
        }
        
        // Force Sync
        const forceSyncBtn = document.getElementById('forceSyncBtn');
        if (forceSyncBtn) {
            forceSyncBtn.addEventListener('click', () => {
                forceSyncAllData();
                showNotification('Force sync berhasil dilakukan!', 'success');
            });
        }
        
        // Refresh Chart
        const refreshChart = document.getElementById('refreshChart');
        if (refreshChart) {
            refreshChart.addEventListener('click', refreshChartData);
        }
        
        // Chart Type Buttons
        const yearlyChart = document.getElementById('yearlyChart');
        const monthlyChart = document.getElementById('monthlyChart');
        
        if (yearlyChart) yearlyChart.addEventListener('click', () => switchChartType('yearly'));
        if (monthlyChart) monthlyChart.addEventListener('click', () => switchChartType('monthly'));
        
        // Lihat Semua Buttons
        const lihatSemuaNotif = document.getElementById('lihatSemuaNotif');
        const lihatSemuaPinjaman = document.getElementById('lihatSemuaPinjaman');
        const lihatSemuaAnggota = document.getElementById('lihatSemuaAnggota');
        
        if (lihatSemuaNotif) {
            lihatSemuaNotif.addEventListener('click', () => {
                document.querySelector('[data-tab="laporan"]').click();
            });
        }
        
        if (lihatSemuaPinjaman) {
            lihatSemuaPinjaman.addEventListener('click', () => {
                document.querySelector('[data-tab="pinjaman"]').click();
            });
        }
        
        if (lihatSemuaAnggota) {
            lihatSemuaAnggota.addEventListener('click', () => {
                document.querySelector('[data-tab="anggota"]').click();
            });
        }
        
        // Home & Dashboard Buttons
        const homeBtn = document.getElementById('homeBtn');
        const dashboardBtn = document.getElementById('dashboardBtn');
        
        if (homeBtn) {
            homeBtn.addEventListener('click', () => {
                window.location.href = 'index.html';
            });
        }
        
        if (dashboardBtn) {
            dashboardBtn.addEventListener('click', () => {
                window.location.href = 'dashboard-admin.html';
            });
        }
        
        console.log(' Dashboard buttons activated');
    }

    function activateAnggotaButtons() {
        // Tambah Anggota Button
        const addMemberBtn = document.getElementById('addMemberBtn');
        if (addMemberBtn) {
            addMemberBtn.addEventListener('click', () => {
                document.getElementById('memberModalTitle').textContent = 'Tambah Anggota Baru';
                document.getElementById('memberId').value = '';
                document.getElementById('memberForm').reset();
                
                // Reset foto profil
                const fotoProfilPlaceholder = document.getElementById('fotoProfilPlaceholder');
                const fotoProfilImg = document.getElementById('fotoProfilImg');
                if (fotoProfilPlaceholder && fotoProfilImg) {
                    fotoProfilPlaceholder.style.display = 'flex';
                    fotoProfilImg.style.display = 'none';
                    fotoProfilImg.innerHTML = '';
                }
                
                // Set tanggal default
                document.getElementById('tanggalDaftar').value = new Date().toISOString().split('T')[0];
                
                // Set NIA otomatis
                const autoNIA = generateNIA();
                document.getElementById('nia').value = autoNIA.replace('NIA-', '');
                
                // Set default simpanan sesuai permintaan
                document.getElementById('simpananPokok').value = 200000;
                document.getElementById('simpananWajib').value = 20000;
                document.getElementById('simpananSukarela').value = 0;
                
                // Reset total simpanan display
                updateTotalSimpananDisplay();
                
                document.getElementById('addMemberModal').style.display = 'flex';
            });
        }
        
        // Save Member Button
        const saveMemberBtn = document.getElementById('saveMemberBtn');
        if (saveMemberBtn) {
            saveMemberBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                await saveMemberData();
            });
        }
        
        // Cancel Member Button
        const cancelMemberBtn = document.getElementById('cancelMemberBtn');
        if (cancelMemberBtn) {
            cancelMemberBtn.addEventListener('click', () => {
                document.getElementById('addMemberModal').style.display = 'none';
            });
        }
        
        console.log(' Anggota buttons activated');
    }

    function activateSimpananButtons() {
        // Tambah Simpanan Button
        const addSimpananBtn = document.getElementById('addSimpananBtn');
        if (addSimpananBtn) {
            addSimpananBtn.addEventListener('click', () => {
                document.getElementById('simpananModalTitle').textContent = 'Tambah Simpanan';
                document.getElementById('simpananId').value = '';
                document.getElementById('simpananForm').reset();
                populateAnggotaDropdowns();
                document.getElementById('addSimpananModal').style.display = 'flex';
            });
        }
        
        // Save Simpanan Button
        const saveSimpananBtn = document.getElementById('saveSimpananBtn');
        if (saveSimpananBtn) {
            saveSimpananBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                await saveSimpananData();
                document.getElementById('addSimpananModal').style.display = 'none';
            });
        }
        
        // Cancel Simpanan Button
        const cancelSimpananBtn = document.getElementById('cancelSimpananBtn');
        if (cancelSimpananBtn) {
            cancelSimpananBtn.addEventListener('click', () => {
                document.getElementById('addSimpananModal').style.display = 'none';
            });
        }
        
        // Simpanan Tabs
        document.querySelectorAll('[data-simpanan-tab]').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabType = this.getAttribute('data-simpanan-tab');
                
                // Update active tab
                document.querySelectorAll('[data-simpanan-tab]').forEach(t => {
                    t.classList.remove('active');
                });
                this.classList.add('active');
                
                // Update title
                let title = 'Daftar Simpanan ';
                switch(tabType) {
                    case 'pokok': title += 'Pokok'; break;
                    case 'wajib': title += 'Wajib'; break;
                    case 'sukarela': title += 'Sukarela'; break;
                }
                document.getElementById('simpananTitle').textContent = title;
                
                // Refresh table
                refreshSimpananTable();
            });
        });
        
        console.log(' Simpanan buttons activated');
    }

    function activatePinjamanButtons() {
        // Tambah Pinjaman Button
        const addPinjamanBtn = document.getElementById('addPinjamanBtn');
        if (addPinjamanBtn) {
            addPinjamanBtn.addEventListener('click', () => {
                document.getElementById('pinjamanModalTitle').textContent = 'Tambah Pinjaman';
                document.getElementById('pinjamanId').value = '';
                document.getElementById('pinjamanForm').reset();
                populateAnggotaDropdowns();
                document.getElementById('addPinjamanModal').style.display = 'flex';
            });
        }
        
        // Save Pinjaman Button
        const savePinjamanBtn = document.getElementById('savePinjamanBtn');
        if (savePinjamanBtn) {
            savePinjamanBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                await savePinjamanData();
                document.getElementById('addPinjamanModal').style.display = 'none';
            });
        }
        
        // Cancel Pinjaman Button
        const cancelPinjamanBtn = document.getElementById('cancelPinjamanBtn');
        if (cancelPinjamanBtn) {
            cancelPinjamanBtn.addEventListener('click', () => {
                document.getElementById('addPinjamanModal').style.display = 'none';
            });
        }
        
        console.log(' Pinjaman buttons activated');
    }

    function activateLaporanButtons() {
        // Cetak Laporan Button
        const cetakLaporanBtn = document.getElementById('cetakLaporanBtn');
        if (cetakLaporanBtn) {
            cetakLaporanBtn.addEventListener('click', () => {
                showPrintPreview('laporan');
            });
        }
        
        console.log(' Laporan buttons activated');
    }

    function activateUnitUsahaButtons() {
        // Tambah Barang Button
        const addBarangBtn = document.getElementById('addBarangBtn');
        if (addBarangBtn) {
            addBarangBtn.addEventListener('click', () => {
                document.getElementById('barangModalTitle').textContent = 'Tambah Barang';
                document.getElementById('barangId').value = '';
                document.getElementById('barangForm').reset();
                document.getElementById('addBarangModal').style.display = 'flex';
            });
        }
        
        // Save Barang Button
        const saveBarangBtn = document.getElementById('saveBarangBtn');
        if (saveBarangBtn) {
            saveBarangBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                await saveBarangData();
                document.getElementById('addBarangModal').style.display = 'none';
            });
        }
        
        // Cancel Barang Button
        const cancelBarangBtn = document.getElementById('cancelBarangBtn');
        if (cancelBarangBtn) {
            cancelBarangBtn.addEventListener('click', () => {
                document.getElementById('addBarangModal').style.display = 'none';
            });
        }
        
        console.log(' Unit usaha buttons activated');
    }

    function activateSHUButtons() {
        // Cetak SHU Button
        const cetakSHUBtn = document.getElementById('cetakSHUBtn');
        if (cetakSHUBtn) {
            cetakSHUBtn.addEventListener('click', () => {
                showPrintPreview('shu');
            });
        }
        
        console.log(' SHU buttons activated');
    }

    function activatePengaturanButtons() {
        // Admin Form Submit
        const adminForm = document.getElementById('adminForm');
        if (adminForm) {
            adminForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveAdminSettings();
            });
        }
        
        console.log(' Pengaturan buttons activated');
    }

    // ===== FUNGSI MODAL CONTROL =====
    function setupModalControls() {
        console.log('Setting up modal controls...');
        
        // Close buttons untuk semua modal
        document.querySelectorAll('.modal-close, .btn-outline[id*="cancel"], .btn-outline[onclick*="none"]').forEach(btn => {
            btn.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        // Close modal when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        });
        
        // Import Excel Modal Controls
        const cancelImportBtn = document.getElementById('cancelImportBtn');
        const confirmImportBtn = document.getElementById('confirmImportBtn');
        
        if (cancelImportBtn) {
            cancelImportBtn.addEventListener('click', () => {
                document.getElementById('importExcelModal').style.display = 'none';
            });
        }
        
        if (confirmImportBtn) {
            confirmImportBtn.addEventListener('click', () => {
                importExcelData();
            });
        }
        
        // Confirm Delete Modal Controls
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        
        if (cancelDeleteBtn) {
            cancelDeleteBtn.addEventListener('click', () => {
                document.getElementById('confirmModal').style.display = 'none';
            });
        }
        
        if (confirmDeleteBtn) {
            confirmDeleteBtn.addEventListener('click', async () => {
                await confirmDeleteData();
                document.getElementById('confirmModal').style.display = 'none';
            });
        }
        
        // Print Preview Modal Controls
        const printPreviewModal = document.getElementById('printPreviewModal');
        if (printPreviewModal) {
            const printPreviewClose = printPreviewModal.querySelector('.modal-close');
            if (printPreviewClose) {
                printPreviewClose.addEventListener('click', () => {
                    printPreviewModal.style.display = 'none';
                });
            }
        }
        
        console.log(' Modal controls setup completed');
    }

    // ===== PERBAIKAN 3: MODAL POP-UP DATA ANGGOTA LENGKAP =====
    function setupMemberDetailModals() {
        console.log('Setting up member detail modals...');
        
        // Setup untuk modal detail anggota
        document.addEventListener('click', function(e) {
            // Handle view member buttons (Data Anggota tab)
            if (e.target.closest('.view-member')) {
                const button = e.target.closest('.view-member');
                const memberId = button.getAttribute('data-id');
                
                if (memberId) {
                    viewMemberDetail(memberId);
                }
            }
            
            // Handle edit member buttons (Data Anggota tab)
            if (e.target.closest('.edit-member')) {
                const button = e.target.closest('.edit-member');
                const memberId = button.getAttribute('data-id');
                
                if (memberId) {
                    editMemberNew(memberId);
                }
            }
            
            // Handle delete member buttons (Data Anggota tab)
            if (e.target.closest('.delete-member')) {
                const button = e.target.closest('.delete-member');
                const memberId = button.getAttribute('data-id');
                
                if (memberId) {
                    showDeleteConfirm(memberId, 'anggota');
                }
            }
        });
        
        console.log(' Member detail modals setup completed');
    }

    // ===== FUNGSI SAVE DATA ANGGOTA BARU =====
    async function saveMemberData() {
        // Validasi required fields
        const requiredFields = ['nia', 'posisi', 'nama', 'alamat', 'emailMember', 'whatsapp', 'nik', 'passwordMember'];
        let isValid = true;
        
        requiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field && !field.value.trim()) {
                field.style.borderColor = 'var(--danger)';
                isValid = false;
            } else if (field) {
                field.style.borderColor = '';
            }
        });
        
        // Validasi jenis kelamin
        const jenisKelamin = document.querySelector('input[name="jenisKelamin"]:checked');
        if (!jenisKelamin) {
            showNotification('Pilih jenis kelamin!', 'error');
            return false;
        }
        
        // Validasi status aktif
        const statusAktif = document.querySelector('input[name="statusAktif"]:checked');
        if (!statusAktif) {
            showNotification('Pilih status keanggotaan!', 'error');
            return false;
        }
        
        if (!isValid) {
            showNotification('Harap lengkapi semua field yang wajib diisi!', 'error');
            return false;
        }
        
        // Validasi email
        const email = document.getElementById('emailMember').value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            showNotification('Format email tidak valid!', 'error');
            return false;
        }
        
        // Validasi password minimal 6 karakter
        const password = document.getElementById('passwordMember').value;
        if (password.length < 6) {
            showNotification('Password minimal 6 karakter!', 'error');
            return false;
        }
        
        // Validasi minimal simpanan
        const simpananPokok = parseFloat(document.getElementById('simpananPokok').value) || 0;
        const simpananWajib = parseFloat(document.getElementById('simpananWajib').value) || 0;
        
        if (simpananPokok < 200000) {
            showNotification('Simpanan Pokok minimal Rp 200.000', 'error');
            document.getElementById('simpananPokok').style.borderColor = 'var(--danger)';
            return false;
        }
        
        if (simpananWajib < 20000) {
            showNotification('Simpanan Wajib minimal Rp 20.000', 'error');
            document.getElementById('simpananWajib').style.borderColor = 'var(--danger)';
            return false;
        }
        
        // Format dan validasi NIA
        let niaValue = document.getElementById('nia').value;
        niaValue = formatNIA(niaValue);
        
        // Cek duplikasi NIA (kecuali edit mode)
        const memberId = document.getElementById('memberId').value;
        if (!memberId) { // Mode tambah baru
            if (checkDuplicateNIA(niaValue)) {
                showNotification('ID/NIA sudah terdaftar! Gunakan ID lain.', 'error');
                
                // Generate NIA baru
                const newNIA = generateNIA();
                document.getElementById('nia').value = newNIA.replace('NIA-', '');
                
                return false;
            }
        }
        
        // Ambil data dari form
        const memberData = {
            id: niaValue,
            nia: niaValue,
            posisi: document.getElementById('posisi').value,
            nama: document.getElementById('nama').value,
            alamat: document.getElementById('alamat').value,
            jenisKelamin: jenisKelamin.value,
            agama: document.getElementById('agama').value,
            status: 'Belum Menikah',
            email: document.getElementById('emailMember').value,
            whatsapp: document.getElementById('whatsapp').value,
            nik: document.getElementById('nik').value,
            tanggalDaftar: document.getElementById('tanggalDaftar').value,
            statusAktif: statusAktif.value,
            password: password,
            
            // Data simpanan dengan default sesuai permintaan
            simpananPokok: simpananPokok,
            simpananWajib: simpananWajib,
            simpananSukarela: parseFloat(document.getElementById('simpananSukarela').value) || 0,
            totalSimpanan: calculateTotalSimpananValue(),
            
            // Foto
            foto: document.getElementById('fotoProfilImg').querySelector('img')?.src || '',
            
            // Timestamp
            createdAt: new Date().toISOString(),
            lastUpdated: new Date().toISOString()
        };
        
        // Cek apakah edit atau tambah baru
        if (memberId) {
            // EDIT anggota
            const index = anggotaData.findIndex(member => member.id === memberId);
            if (index !== -1) {
                anggotaData[index] = { ...anggotaData[index], ...memberData };
                showNotification('Data anggota berhasil diperbarui!', 'success');
            }
        } else {
            // TAMBAH anggota baru
            anggotaData.push(memberData);
            showNotification('Data anggota berhasil disimpan!', 'success');
        }
        
        // Simpan ke localStorage
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
        
        // Update dashboard
        updateDashboardStats();
        updateFinancialDataInRealTime();
        refreshAnggotaTable();
        populateAnggotaDropdowns();
        
        // Tutup modal
        document.getElementById('addMemberModal').style.display = 'none';
        
        return true;
    }

    function calculateTotalSimpananValue() {
        const pokok = parseFloat(document.getElementById('simpananPokok').value) || 0;
        const wajib = parseFloat(document.getElementById('simpananWajib').value) || 0;
        const sukarela = parseFloat(document.getElementById('simpananSukarela').value) || 0;
        return pokok + wajib + sukarela;
    }

    async function saveSimpananData() {
        const idAnggota = document.getElementById('idAnggotaSimpanan').value;
        const jenisSimpanan = document.getElementById('jenisSimpanan').value;
        const tanggalSimpanan = document.getElementById('tanggalSimpanan').value;
        const nominalSimpanan = parseInt(document.getElementById('nominalSimpanan').value) || 0;
        
        if (!idAnggota || !jenisSimpanan || !tanggalSimpanan || nominalSimpanan <= 0) {
            showNotification('Harap lengkapi semua field dengan benar!', 'error');
            return;
        }
        
        // Find member
        const member = anggotaData.find(m => m.id === idAnggota);
        if (!member) {
            showNotification('Anggota tidak ditemukan!', 'error');
            return;
        }
        
        // Create simpanan record
        const simpananId = 'SPN-' + (simpananData.length + 1).toString().padStart(3, '0');
        const newSimpanan = {
            id: simpananId,
            idAnggota: idAnggota,
            nama: member.nama,
            jenisSimpanan: jenisSimpanan,
            tanggalSetor: tanggalSimpanan,
            nominal: nominalSimpanan,
            createdAt: new Date().toISOString()
        };
        
        simpananData.push(newSimpanan);
        localStorage.setItem('simpananData', JSON.stringify(simpananData));
        
        // Update real-time financial data
        updateFinancialDataInRealTime();
        
        // Update chart
        refreshChartData();
        
        showNotification(`Simpanan ${jenisSimpanan} sebesar Rp ${nominalSimpanan.toLocaleString('id-ID')} berhasil disimpan!`, 'success');
        
        // Refresh tables
        refreshSimpananTable();
    }

    async function savePinjamanData() {
        const idAnggota = document.getElementById('idAnggotaPinjaman').value;
        const jumlahPinjaman = parseInt(document.getElementById('jumlahPinjaman').value) || 0;
        const tanggalPinjaman = document.getElementById('tanggalPinjaman').value;
        const jangkaWaktu = document.getElementById('jangkaWaktu').value;
        const bungaPinjaman = parseFloat(document.getElementById('bungaPinjaman').value) || 0;
        
        if (!idAnggota || jumlahPinjaman <= 0 || !tanggalPinjaman || !jangkaWaktu || bungaPinjaman <= 0) {
            showNotification('Harap lengkapi semua field dengan benar!', 'error');
            return;
        }
        
        // Find member
        const member = anggotaData.find(m => m.id === idAnggota);
        if (!member) {
            showNotification('Anggota tidak ditemukan!', 'error');
            return;
        }
        
        // Create pinjaman record
        const pinjamanId = 'PNH-' + (pinjamanData.length + 1).toString().padStart(3, '0');
        const newPinjaman = {
            id: pinjamanId,
            idAnggota: idAnggota,
            namaAnggota: member.nama,
            jumlahPinjaman: jumlahPinjaman,
            tanggalPinjam: tanggalPinjaman,
            jangkaWaktu: jangkaWaktu,
            bunga: bungaPinjaman,
            sisaHutang: jumlahPinjaman,
            status: 'Aktif',
            createdAt: new Date().toISOString()
        };
        
        pinjamanData.push(newPinjaman);
        localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
        
        // Update real-time financial data
        updateFinancialDataInRealTime();
        
        showNotification(`Pinjaman sebesar Rp ${jumlahPinjaman.toLocaleString('id-ID')} berhasil disimpan!`, 'success');
        
        // Refresh tables
        refreshPinjamanTable();
    }

    async function saveBarangData() {
        const namaBarang = document.getElementById('namaBarang').value;
        const stokBarang = parseInt(document.getElementById('stokBarang').value) || 0;
        const hargaBeli = parseInt(document.getElementById('hargaBeli').value) || 0;
        const hargaJual = parseInt(document.getElementById('hargaJual').value) || 0;
        
        if (!namaBarang || stokBarang <= 0 || hargaBeli <= 0 || hargaJual <= 0) {
            showNotification('Harap lengkapi semua field dengan benar!', 'error');
            return;
        }
        
        const laba = hargaJual - hargaBeli;
        
        // Create barang record
        const barangId = 'BRG-' + (barangData.length + 1).toString().padStart(3, '0');
        const newBarang = {
            id: barangId,
            namaBarang: namaBarang,
            stok: stokBarang,
            hargaBeli: hargaBeli,
            hargaJual: hargaJual,
            laba: laba,
            createdAt: new Date().toISOString()
        };
        
        barangData.push(newBarang);
        localStorage.setItem('barangData', JSON.stringify(barangData));
        
        showNotification(`Barang "${namaBarang}" berhasil ditambahkan!`, 'success');
        
        // Refresh tables
        refreshBarangTable();
    }

    function saveAdminSettings() {
        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const role = document.getElementById('role').value;
        const norek = document.getElementById('norek').value;
        
        // Update UI
        document.getElementById('topNavUsername').textContent = username;
        document.getElementById('topNavRole').textContent = role;
        document.getElementById('adminUsername').textContent = username;
        document.getElementById('adminEmail').textContent = email;
        document.getElementById('adminRole').textContent = role;
        document.getElementById('adminRekening').textContent = norek;
        
        showNotification('Pengaturan admin berhasil disimpan!', 'success');
    }

    // ===== FUNGSI REFRESH DATA =====
    function refreshAnggotaTable() {
        const tableBody = document.querySelector('#anggotaFullTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        if (anggotaData.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="9" style="text-align: center; padding: 30px; color: #666;">
                        <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px; display: block; color: var(--gray-light);"></i>
                        Belum ada data anggota
                    </td>
                </tr>
            `;
            return;
        }
        
        anggotaData.forEach(member => {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${member.nia || member.id}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        ${member.foto ? 
                            `<img src="${member.foto}" style="width: 35px; height: 35px; border-radius: 50%; object-fit: cover;">` : 
                            `<div style="width: 35px; height: 35px; border-radius: 50%; background: var(--primary-light); display: flex; align-items: center; justify-content: center; color: white;">
                                <i class="fas fa-user"></i>
                            </div>`
                        }
                        <span>${member.nama}</span>
                    </div>
                </td>
                <td>${member.nik || '-'}</td>
                <td>${member.jenisKelamin}</td>
                <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    ${member.alamat}
                </td>
                <td>${member.whatsapp}</td>
                <td>${member.tanggalDaftar}</td>
                <td>
                    <span class="badge ${member.statusAktif === 'Aktif' ? 'badge-success' : member.statusAktif === 'Tidak Aktif' ? 'badge-danger' : 'badge-warning'} badge-responsive">
                        ${member.statusAktif}
                    </span>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="btn btn-outline btn-sm view-member" data-id="${member.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-outline btn-sm edit-member" data-id="${member.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline btn-sm delete-member" data-id="${member.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners untuk aksi
        document.querySelectorAll('.view-member').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                viewMemberDetail(memberId);
            });
        });
        
        document.querySelectorAll('.edit-member').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                editMemberNew(memberId);
            });
        });
        
        document.querySelectorAll('.delete-member').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                showDeleteConfirm(memberId, 'anggota');
            });
        });
    }

    function refreshSimpananTable() {
        const tableBody = document.querySelector('#simpananTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        // Filter berdasarkan tab aktif
        const activeTab = document.querySelector('.tabs .tab.active');
        const tabType = activeTab ? activeTab.getAttribute('data-simpanan-tab') : 'pokok';
        
        const filteredData = simpananData.filter(s => 
            s.jenisSimpanan.toLowerCase().includes(tabType.toLowerCase())
        );
        
        filteredData.forEach(simpanan => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${simpanan.idAnggota}</td>
                <td>${simpanan.nama}</td>
                <td>${simpanan.jenisSimpanan}</td>
                <td>${simpanan.tanggalSetor}</td>
                <td>Rp ${simpanan.nominal.toLocaleString('id-ID')}</td>
                <td>Rp ${calculateTotalSimpanan(simpanan.idAnggota, simpanan.jenisSimpanan).toLocaleString('id-ID')}</td>
                <td>
                    <button class="btn btn-outline btn-sm edit-simpanan" data-id="${simpanan.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-simpanan" data-id="${simpanan.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners
        document.querySelectorAll('.edit-simpanan').forEach(btn => {
            btn.addEventListener('click', function() {
                const simpananId = this.getAttribute('data-id');
                editSimpanan(simpananId);
            });
        });
        
        document.querySelectorAll('.delete-simpanan').forEach(btn => {
            btn.addEventListener('click', function() {
                const simpananId = this.getAttribute('data-id');
                showDeleteConfirm(simpananId, 'simpanan');
            });
        });
    }

    function editSimpanan(simpananId) {
        const simpanan = simpananData.find(s => s.id === simpananId);
        if (!simpanan) return;
        
        document.getElementById('simpananModalTitle').textContent = 'Edit Simpanan';
        document.getElementById('simpananId').value = simpanan.id;
        document.getElementById('idAnggotaSimpanan').value = simpanan.idAnggota;
        document.getElementById('jenisSimpanan').value = simpanan.jenisSimpanan;
        document.getElementById('tanggalSimpanan').value = simpanan.tanggalSetor;
        document.getElementById('nominalSimpanan').value = simpanan.nominal;
        
        populateAnggotaDropdowns();
        document.getElementById('addSimpananModal').style.display = 'flex';
    }

    function refreshPinjamanTable() {
        const tableBody = document.querySelector('#pinjamanFullTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        pinjamanData.forEach(pinjaman => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${pinjaman.id}</td>
                <td>${pinjaman.namaAnggota}</td>
                <td>Rp ${pinjaman.jumlahPinjaman.toLocaleString('id-ID')}</td>
                <td>${pinjaman.tanggalPinjam}</td>
                <td>${pinjaman.jangkaWaktu}</td>
                <td>${pinjaman.bunga}%</td>
                <td>Rp ${pinjaman.sisaHutang.toLocaleString('id-ID')}</td>
                <td><span class="badge badge-success">${pinjaman.status}</span></td>
                <td>
                    <button class="btn btn-outline btn-sm edit-pinjaman" data-id="${pinjaman.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-pinjaman" data-id="${pinjaman.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners
        document.querySelectorAll('.edit-pinjaman').forEach(btn => {
            btn.addEventListener('click', function() {
                const pinjamanId = this.getAttribute('data-id');
                editPinjaman(pinjamanId);
            });
        });
        
        document.querySelectorAll('.delete-pinjaman').forEach(btn => {
            btn.addEventListener('click', function() {
                const pinjamanId = this.getAttribute('data-id');
                showDeleteConfirm(pinjamanId, 'pinjaman');
            });
        });
    }

    function editPinjaman(pinjamanId) {
        const pinjaman = pinjamanData.find(p => p.id === pinjamanId);
        if (!pinjaman) return;
        
        document.getElementById('pinjamanModalTitle').textContent = 'Edit Pinjaman';
        document.getElementById('pinjamanId').value = pinjaman.id;
        document.getElementById('idAnggotaPinjaman').value = pinjaman.idAnggota;
        document.getElementById('jumlahPinjaman').value = pinjaman.jumlahPinjaman;
        document.getElementById('tanggalPinjaman').value = pinjaman.tanggalPinjam;
        document.getElementById('jangkaWaktu').value = pinjaman.jangkaWaktu;
        document.getElementById('bungaPinjaman').value = pinjaman.bunga;
        
        populateAnggotaDropdowns();
        document.getElementById('addPinjamanModal').style.display = 'flex';
    }

    function refreshBarangTable() {
        const tableBody = document.querySelector('#barangTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        barangData.forEach(barang => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${barang.id}</td>
                <td>${barang.namaBarang}</td>
                <td>${barang.stok}</td>
                <td>Rp ${barang.hargaBeli.toLocaleString('id-ID')}</td>
                <td>Rp ${barang.hargaJual.toLocaleString('id-ID')}</td>
                <td>Rp ${barang.laba.toLocaleString('id-ID')}</td>
                <td>
                    <button class="btn btn-outline btn-sm edit-barang" data-id="${barang.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-barang" data-id="${barang.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    function calculateTotalSimpanan(idAnggota, jenisSimpanan) {
        return simpananData
            .filter(s => s.idAnggota === idAnggota && s.jenisSimpanan === jenisSimpanan)
            .reduce((sum, s) => sum + s.nominal, 0);
    }

    function populateAnggotaDropdowns() {
        const dropdowns = [
            document.getElementById('idAnggotaSimpanan'),
            document.getElementById('idAnggotaPinjaman')
        ];
        
        dropdowns.forEach(dropdown => {
            if (!dropdown) return;
            
            dropdown.innerHTML = '<option value="">Pilih Anggota</option>';
            anggotaData.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.id} - ${member.nama}`;
                dropdown.appendChild(option);
            });
        });
    }

    // ===== FUNGSI VIEW DETAIL ANGGOTA =====
    function viewMemberDetail(memberId) {
        const member = anggotaData.find(m => m.id === memberId);
        if (!member) return;
        
        const totalSimpanan = (member.simpananPokok || 0) + (member.simpananWajib || 0) + (member.simpananSukarela || 0);
        
        const detailHTML = `
            <div style="display: flex; gap: 25px; margin-bottom: 25px;">
                <!-- Foto Profil -->
                <div>
                    ${member.foto ? 
                        `<img src="${member.foto}" style="width: 150px; height: 150px; border-radius: 10px; object-fit: cover; border: 3px solid var(--primary-light);">` : 
                        `<div style="width: 150px; height: 150px; border-radius: 10px; background: linear-gradient(135deg, var(--primary-light), var(--primary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem;">
                            <i class="fas fa-user"></i>
                        </div>`
                    }
                </div>
                
                <!-- Info Utama -->
                <div style="flex: 1;">
                    <h3 style="color: var(--primary-dark); margin-bottom: 10px;">${member.nama}</h3>
                    <p style="color: var(--gray); margin-bottom: 5px;">
                        <i class="fas fa-id-card"></i> ${member.nia || member.id} | ${member.posisi}
                    </p>
                    <p style="color: var(--gray); margin-bottom: 5px;">
                        <i class="fas fa-envelope"></i> ${member.email}
                    </p>
                    <p style="color: var(--gray); margin-bottom: 5px;">
                        <i class="fab fa-whatsapp"></i> ${member.whatsapp}
                    </p>
                    <p style="color: var(--gray); margin-bottom: 5px;">
                        <i class="fas fa-venus-mars"></i> ${member.jenisKelamin} | ${member.agama}
                    </p>
                    <p style="color: var(--gray);">
                        <i class="fas fa-calendar-alt"></i> Bergabung: ${member.tanggalDaftar}
                    </p>
                </div>
                
                <!-- Status -->
                <div>
                    <span class="badge ${member.statusAktif === 'Aktif' ? 'badge-success' : 'badge-danger'}" style="font-size: 1rem; padding: 8px 15px;">
                        ${member.statusAktif}
                    </span>
                </div>
            </div>
            
            <!-- Grid Data Detail -->
            <div class="detail-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                <div>
                    <div class="detail-item">
                        <div class="detail-label">NIK KTP</div>
                        <div class="detail-value">${member.nik || '-'}</div>
                    </div>
                </div>
                
                <!-- FIELD PASSWORD BARU -->
                <div>
                    <div class="detail-item">
                        <div class="detail-label">Password Login</div>
                        <div class="detail-value">
                            <div class="password-container" style="position: relative;">
                                <input type="password" 
                                       value="${member.password || ''}" 
                                       readonly 
                                       id="viewPassword${member.id}"
                                       style="width: 100%; padding: 8px 12px; border: 1px solid var(--gray-light); border-radius: 6px; background: #f8f9fa;">
                                <button type="button" 
                                        class="toggle-password" 
                                        onclick="toggleViewPassword('${member.id}')"
                                        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--gray); cursor: pointer;">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="detail-item">
                        <div class="detail-label">Jenis Kelamin</div>
                        <div class="detail-value">${member.jenisKelamin}</div>
                    </div>
                </div>
                
                <div>
                    <div class="detail-item">
                        <div class="detail-label">Agama</div>
                        <div class="detail-value">${member.agama}</div>
                    </div>
                </div>
            </div>
            
            <!-- Info Minimal Simpanan -->
            <div style="margin-bottom: 20px; padding: 10px 15px; background: #fff8e1; border-radius: 8px; border-left: 4px solid var(--warning);">
                <div style="display: flex; align-items: center; gap: 10px; color: var(--dark);">
                    <i class="fas fa-info-circle" style="color: var(--warning);"></i>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 2px;">Minimal Simpanan Anggota Koperasi:</div>
                        <div style="font-size: 0.9rem;">
                             Simpanan Pokok: <strong>Rp 200.000</strong> (dibayar sekali saat pendaftaran)<br>
                             Simpanan Wajib: <strong>Rp 20.000</strong> (dibayar setiap bulan)<br>
                             Simpanan Sukarela: <strong>Sesuai kemampuan</strong> (opsional, bisa ditambah kapan saja)
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Alamat Lengkap -->
            <div style="margin-bottom: 25px;">
                <div class="detail-label">Alamat Lengkap</div>
                <div class="detail-value" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                    ${member.alamat || '-'}
                </div>
            </div>
            
            <!-- Detail Simpanan -->
            <div class="anggota-detail-section">
                <h4 style="color: var(--primary-dark); margin-bottom: 20px;">Detail Simpanan</h4>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px;">
                    <div class="simpanan-card" style="background: white; padding: 15px; border-radius: 10px; border: 1px solid var(--gray-light); position: relative;">
                        ${(member.simpananPokok || 0) >= 200000 ? 
                            '<div style="position: absolute; top: 5px; right: 5px; color: var(--success);"><i class="fas fa-check-circle"></i></div>' : 
                            '<div style="position: absolute; top: 5px; right: 5px; color: var(--danger);"><i class="fas fa-times-circle"></i></div>'
                        }
                        <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 8px;">Simpanan Pokok</div>
                        <div style="font-size: 1.3rem; font-weight: bold; color: var(--primary);">
                            Rp ${(member.simpananPokok || 0).toLocaleString('id-ID')}
                        </div>
                        ${(member.simpananPokok || 0) < 200000 ? 
                            '<div style="font-size: 0.75rem; color: var(--danger); margin-top: 5px;"><i class="fas fa-exclamation-triangle"></i> Belum memenuhi minimum</div>' : 
                            '<div style="font-size: 0.75rem; color: var(--success); margin-top: 5px;"><i class="fas fa-check"></i> Memenuhi syarat</div>'
                        }
                    </div>
                    
                    <div class="simpanan-card" style="background: white; padding: 15px; border-radius: 10px; border: 1px solid var(--gray-light); position: relative;">
                        ${(member.simpananWajib || 0) >= 20000 ? 
                            '<div style="position: absolute; top: 5px; right: 5px; color: var(--success);"><i class="fas fa-check-circle"></i></div>' : 
                            '<div style="position: absolute; top: 5px; right: 5px; color: var(--danger);"><i class="fas fa-times-circle"></i></div>'
                        }
                        <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 8px;">Simpanan Wajib</div>
                        <div style="font-size: 1.3rem; font-weight: bold; color: var(--secondary);">
                            Rp ${(member.simpananWajib || 0).toLocaleString('id-ID')}
                        </div>
                        ${(member.simpananWajib || 0) < 20000 ? 
                            '<div style="font-size: 0.75rem; color: var(--danger); margin-top: 5px;"><i class="fas fa-exclamation-triangle"></i> Belum memenuhi minimum</div>' : 
                            '<div style="font-size: 0.75rem; color: var(--success); margin-top: 5px;"><i class="fas fa-check"></i> Memenuhi syarat</div>'
                        }
                    </div>
                    
                    <div class="simpanan-card" style="background: white; padding: 15px; border-radius: 10px; border: 1px solid var(--gray-light); position: relative;">
                        <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 8px;">Simpanan Sukarela</div>
                        <div style="font-size: 1.3rem; font-weight: bold; color: var(--accent);">
                            Rp ${(member.simpananSukarela || 0).toLocaleString('id-ID')}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--info); margin-top: 5px;">
                            <i class="fas fa-heart"></i> Sukarela sesuai kemampuan
                        </div>
                    </div>
                </div>
                
                <!-- Total Simpanan -->
                <div style="background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 1rem; margin-bottom: 5px;">TOTAL SIMPANAN</div>
                    <div style="font-size: 2rem; font-weight: bold;">
                        Rp ${totalSimpanan.toLocaleString('id-ID')}
                    </div>
                    <div style="font-size: 0.85rem; opacity: 0.9; margin-top: 10px;">
                        Status: ${((member.simpananPokok || 0) >= 200000 && (member.simpananWajib || 0) >= 20000) ? 
                            '<span style="color: #c8e6c9;"><i class="fas fa-check-circle"></i> Simpanan memenuhi syarat</span>' : 
                            '<span style="color: #ffcdd2;"><i class="fas fa-exclamation-circle"></i> Simpanan belum memenuhi syarat minimum</span>'
                        }
                    </div>
                </div>
            </div>
            
            <!-- Informasi Tambahan -->
            <div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 0.9rem; color: var(--gray);">
                <div style="display: flex; justify-content: space-between;">
                    <div>
                        <i class="fas fa-clock"></i> Dibuat: ${new Date(member.createdAt).toLocaleString('id-ID')}
                    </div>
                    <div>
                        <i class="fas fa-sync-alt"></i> Terakhir update: ${new Date(member.lastUpdated).toLocaleString('id-ID')}
                    </div>
                </div>
            </div>
        `;
        
        // Update konten modal
        document.getElementById('detailAnggotaContent').innerHTML = detailHTML;
        
        // Update tombol edit
        const editDetailBtn = document.getElementById('editDetailBtn');
        if (editDetailBtn) {
            editDetailBtn.onclick = () => {
                editMemberNew(memberId);
                document.getElementById('detailAnggotaModal').style.display = 'none';
            };
        }
        
        // Tampilkan modal
        document.getElementById('detailAnggotaModal').style.display = 'flex';
    }

    // ===== FUNGSI TOGGLE PASSWORD VIEW =====
    function toggleViewPassword(memberId) {
        const passwordField = document.getElementById(`viewPassword${memberId}`);
        const toggleButton = passwordField.nextElementSibling;
        
        if (passwordField.type === 'password') {
            passwordField.type = 'text';
            toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
            passwordField.type = 'password';
            toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
        }
    }

    // ===== FUNGSI EDIT ANGGOTA BARU =====
    function editMemberNew(memberId) {
        const member = anggotaData.find(m => m.id === memberId);
        if (!member) return;
        
        // Set judul modal
        document.getElementById('memberModalTitle').textContent = 'Edit Data Anggota';
        document.getElementById('memberId').value = member.id;
        
        // Isi form dengan data member
        // Ekstrak angka dari NIA untuk display
        const niaNumber = member.nia ? member.nia.replace('NIA-', '') : member.id.replace('NIA-', '');
        document.getElementById('nia').value = niaNumber;
        document.getElementById('posisi').value = member.posisi;
        document.getElementById('nama').value = member.nama;
        document.getElementById('alamat').value = member.alamat;
        
        // Set jenis kelamin radio button
        document.querySelectorAll('input[name="jenisKelamin"]').forEach(radio => {
            if (radio.value === member.jenisKelamin) {
                radio.checked = true;
            }
        });
        
        document.getElementById('agama').value = member.agama;
        
        // Set status aktif radio button
        document.querySelectorAll('input[name="statusAktif"]').forEach(radio => {
            if (radio.value === member.statusAktif) {
                radio.checked = true;
            }
        });
        
        document.getElementById('emailMember').value = member.email;
        document.getElementById('whatsapp').value = member.whatsapp;
        document.getElementById('nik').value = member.nik;
        document.getElementById('tanggalDaftar').value = member.tanggalDaftar;
        document.getElementById('passwordMember').value = member.password || '';
        
        // Isi data simpanan
        document.getElementById('simpananPokok').value = member.simpananPokok || 200000;
        document.getElementById('simpananWajib').value = member.simpananWajib || 20000;
        document.getElementById('simpananSukarela').value = member.simpananSukarela || 0;
        
        // Update foto preview jika ada
        const fotoProfilPlaceholder = document.getElementById('fotoProfilPlaceholder');
        const fotoProfilImg = document.getElementById('fotoProfilImg');
        if (member.foto) {
            fotoProfilImg.innerHTML = `<img src="${member.foto}" class="foto-profil-img">`;
            fotoProfilImg.style.display = 'block';
            fotoProfilPlaceholder.style.display = 'none';
        } else {
            fotoProfilPlaceholder.style.display = 'flex';
            fotoProfilImg.style.display = 'none';
            fotoProfilImg.innerHTML = '';
        }
        
        // Hitung total simpanan
        updateTotalSimpananDisplay();
        
        // Update alamat counter
        const alamatCounter = document.getElementById('alamatCounter');
        if (alamatCounter) {
            const count = member.alamat ? member.alamat.length : 0;
            alamatCounter.textContent = `${count}/200 karakter`;
        }
        
        // Tampilkan modal
        document.getElementById('addMemberModal').style.display = 'flex';
    }

    // ===== FUNGSI UPDATE DASHBOARD =====
    function updateDashboardStats() {
        document.getElementById('totalAnggota').textContent = anggotaData.length || '0';
        
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        document.getElementById('totalSimpanan').textContent = totalSimpanan > 0 ? formatRupiah(totalSimpanan) : 'Rp 0';
        
        const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
        document.getElementById('totalPinjaman').textContent = totalPinjaman > 0 ? formatRupiah(totalPinjaman) : 'Rp 0';
        
        const totalSHU = totalSimpanan * 0.1;
        document.getElementById('totalSHU').textContent = totalSHU > 0 ? formatRupiah(totalSHU) : 'Rp 0';
        
        const totalKas = Math.max(0, totalSimpanan - totalPinjaman);
        document.getElementById('totalKas').textContent = totalKas > 0 ? formatRupiah(totalKas) : 'Rp 0';
        
        // Update juga tampilan di tabel pinjaman terbaru
        updatePinjamanTerbaruTable();
        updateAnggotaBaruTable();
    }

    function updateFinancialDataInRealTime() {
        // Calculate totals
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
        const totalSHU = totalSimpanan * 0.1;
        const totalKas = Math.max(0, totalSimpanan - totalPinjaman);
        
        // Update dashboard with animation
        animateNumber('totalSimpanan', totalSimpanan, 'Rp ');
        animateNumber('totalPinjaman', totalPinjaman, 'Rp ');
        animateNumber('totalSHU', totalSHU, 'Rp ');
        animateNumber('totalKas', totalKas, 'Rp ');
        
        // Update per anggota
        updateAnggotaFinancialData();
        
        // Save timestamp
        const lastSyncTime = new Date().toLocaleString('id-ID');
        const lastSyncElement = document.getElementById('lastSyncTime');
        if (lastSyncElement) {
            lastSyncElement.textContent = `Terakhir sync: ${lastSyncTime}`;
        }
    }

    function animateNumber(elementId, targetValue, prefix = '') {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const currentText = element.textContent.replace(prefix, '').replace(/[^0-9]/g, '');
        const currentValue = parseInt(currentText) || 0;
        
        // Only animate if difference is significant
        if (Math.abs(targetValue - currentValue) > 1000) {
            let startValue = currentValue;
            const duration = 800;
            const startTime = Date.now();
            
            const animate = () => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const current = Math.floor(startValue + (targetValue - startValue) * easeOutQuart);
                
                element.textContent = prefix + formatRupiah(current);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    element.textContent = prefix + formatRupiah(targetValue);
                }
            };
            
            animate();
        } else {
            element.textContent = prefix + formatRupiah(targetValue);
        }
    }

    function updateAnggotaFinancialData() {
        anggotaData.forEach(member => {
            const memberSimpanan = simpananData
                .filter(s => s.idAnggota === member.id)
                .reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
            
            const memberPinjaman = pinjamanData
                .filter(p => p.idAnggota === member.id)
                .reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
            
            member.totalSimpanan = memberSimpanan;
            member.totalPinjaman = memberPinjaman;
            member.saldo = memberSimpanan - memberPinjaman;
        });
        
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
    }

    function formatRupiah(amount) {
        if (amount === 0) return 'Rp 0';
        if (amount >= 1000000000) {
            return 'Rp ' + (amount / 1000000000).toFixed(1) + ' M';
        } else if (amount >= 1000000) {
            return 'Rp ' + (amount / 1000000).toFixed(1) + ' Jt';
        } else {
            return 'Rp ' + amount.toLocaleString('id-ID');
        }
    }

    // ===== FUNGSI CHART =====
    function setupFinanceChart() {
        const ctx = document.getElementById('financeChart');
        if (!ctx) {
            console.error('Canvas element not found');
            return;
        }
        
        // Destroy existing chart if exists
        if (financeChart) {
            financeChart.destroy();
        }
        
        // Generate sample data for chart
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
        const currentMonth = new Date().getMonth();
        const displayMonths = months.slice(Math.max(0, currentMonth - 5), currentMonth + 1);
        
        // Calculate real data from simpananData
        const monthlyData = {};
        simpananData.forEach(simpanan => {
            if (simpanan.tanggalSetor) {
                const date = new Date(simpanan.tanggalSetor);
                const month = date.getMonth();
                const year = date.getFullYear();
                const key = `${year}-${month}`;
                
                if (!monthlyData[key]) {
                    monthlyData[key] = 0;
                }
                monthlyData[key] += parseInt(simpanan.nominal) || 0;
            }
        });
        
        // Prepare chart data
        const chartData = displayMonths.map((month, index) => {
            const monthIndex = (currentMonth - 5 + index + 12) % 12;
            const year = new Date().getFullYear();
            const key = `${year}-${monthIndex}`;
            return monthlyData[key] || Math.floor(Math.random() * 5000000) + 1000000;
        });
        
        financeChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: displayMonths,
                datasets: [{
                    label: 'Total Simpanan (Rp)',
                    data: chartData,
                    borderColor: '#2e7d32',
                    backgroundColor: 'rgba(46, 125, 50, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += 'Rp ' + context.parsed.y.toLocaleString('id-ID');
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                if (value >= 1000000) {
                                    return 'Rp ' + (value / 1000000).toFixed(1) + ' Jt';
                                }
                                return 'Rp ' + value.toLocaleString('id-ID');
                            }
                        }
                    }
                }
            }
        });
        
        console.log('Finance chart setup completed');
    }

    function refreshChartData() {
        loadLocalStorageData();
        setupFinanceChart();
        showNotification('Grafik diperbarui', 'info');
    }

    function switchChartType(type) {
        refreshChartData();
        showNotification(`Menampilkan grafik ${type === 'monthly' ? 'bulanan' : 'tahunan'}`, 'info');
    }

    // ===== FUNGSI EXPORT/IMPORT EXCEL =====
    function exportToExcel() {
        try {
            const wb = XLSX.utils.book_new();
            
            // 1. Sheet Data Anggota
            const wsAnggota = XLSX.utils.json_to_sheet(anggotaData.map(a => ({
                'ID_Anggota': a.id || '',
                'Posisi': a.posisi || '',
                'Nama_Lengkap': a.nama || '',
                'Alamat': a.alamat || '',
                'Jenis_Kelamin': a.jenisKelamin || '',
                'Agama': a.agama || '',
                'Status_Pernikahan': a.status || '',
                'Email': a.email || '',
                'WhatsApp': a.whatsapp || '',
                'NIK': a.nik || '',
                'Tanggal_Daftar': a.tanggalDaftar || '',
                'Status_Aktif': a.statusAktif || 'Aktif',
                'Total_Simpanan': a.totalSimpanan || 0,
                'Total_Pinjaman': a.totalPinjaman || 0,
                'Saldo': a.saldo || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsAnggota, 'Data Anggota');
            
            // 2. Sheet Data Simpanan
            const wsSimpanan = XLSX.utils.json_to_sheet(simpananData.map(s => ({
                'ID_Simpanan': s.id || '',
                'ID_Anggota': s.idAnggota || '',
                'Nama_Anggota': s.nama || '',
                'Jenis_Simpanan': s.jenisSimpanan || '',
                'Tanggal_Setor': s.tanggalSetor || '',
                'Nominal': s.nominal || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsSimpanan, 'Data Simpanan');
            
            // 3. Sheet Data Pinjaman
            const wsPinjaman = XLSX.utils.json_to_sheet(pinjamanData.map(p => ({
                'ID_Pinjaman': p.id || '',
                'ID_Anggota': p.idAnggota || '',
                'Nama_Anggota': p.namaAnggota || '',
                'Jumlah_Pinjaman': p.jumlahPinjaman || 0,
                'Tanggal_Pinjam': p.tanggalPinjam || '',
                'Jangka_Waktu': p.jangkaWaktu || '',
                'Bunga (%)': p.bunga || 0,
                'Sisa_Hutang': p.sisaHutang || 0,
                'Status': p.status || 'Aktif'
            })));
            XLSX.utils.book_append_sheet(wb, wsPinjaman, 'Data Pinjaman');
            
            // 4. Sheet Data Barang
            const wsBarang = XLSX.utils.json_to_sheet(barangData.map(b => ({
                'ID_Barang': b.id || '',
                'Nama_Barang': b.namaBarang || '',
                'Stok': b.stok || 0,
                'Harga_Beli': b.hargaBeli || 0,
                'Harga_Jual': b.hargaJual || 0,
                'Laba': b.laba || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsBarang, 'Data Barang');
            
            // 5. Sheet Data Transaksi
            const wsTransaksi = XLSX.utils.json_to_sheet(transaksiData.map(t => ({
                'ID_Transaksi': t.id || '',
                'Tanggal': t.tanggal || '',
                'Jenis': t.jenis || '',
                'Keterangan': t.keterangan || '',
                'Nominal': t.nominal || 0,
                'Saldo_Akhir': t.saldoAkhir || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsTransaksi, 'Data Transaksi');
            
            // Generate filename with timestamp
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-');
            const filename = `Data_Koperasi_Asmara_Tani_${timestamp}.xlsx`;
            
            XLSX.writeFile(wb, filename);
            showNotification('Data berhasil diexport ke Excel!', 'success');
            
        } catch (error) {
            console.error('Error exporting to Excel:', error);
            showNotification('Gagal mengexport data: ' + error.message, 'error');
        }
    }

    function importExcelData() {
        const fileInput = document.getElementById('excelFile');
        const importType = document.getElementById('importType').value;
        
        if (fileInput.files.length === 0) {
            showNotification('Pilih file Excel terlebih dahulu!', 'error');
            return;
        }
        
        const file = fileInput.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
            if (importType === 'anggota') {
                jsonData.forEach(item => {
                    const newMember = {
                        id: item.ID_Anggota || 'NIA-' + (anggotaData.length + 1).toString().padStart(3, '0'),
                        nia: item.ID_Anggota || 'NIA-' + (anggotaData.length + 1).toString().padStart(3, '0'),
                        posisi: item.Posisi || 'Anggota',
                        nama: item.Nama_Lengkap || item.Nama,
                        alamat: item.Alamat,
                        jenisKelamin: item.Jenis_Kelamin,
                        agama: item.Agama,
                        status: item.Status_Pernikahan,
                        email: item.Email,
                        whatsapp: item.WhatsApp,
                        nik: item.NIK,
                        tanggalDaftar: item.Tanggal_Daftar || new Date().toLocaleDateString('id-ID'),
                        statusAktif: item.Status_Aktif || 'Aktif',
                        totalSimpanan: item.Total_Simpanan || 0,
                        totalPinjaman: item.Total_Pinjaman || 0,
                        saldo: item.Saldo || 0
                    };
                    
                    const existingIndex = anggotaData.findIndex(m => m.id === newMember.id);
                    if (existingIndex !== -1) {
                        anggotaData[existingIndex] = newMember;
                    } else {
                        anggotaData.push(newMember);
                    }
                });
                
                localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
                localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
                refreshAnggotaTable();
                populateAnggotaDropdowns();
                
            } else if (importType === 'simpanan') {
                jsonData.forEach(item => {
                    const newSimpanan = {
                        id: item.ID_Simpanan || 'SPN-' + (simpananData.length + 1).toString().padStart(3, '0'),
                        idAnggota: item.ID_Anggota,
                        nama: item.Nama_Anggota,
                        jenisSimpanan: item.Jenis_Simpanan,
                        tanggalSetor: item.Tanggal_Setor,
                        nominal: parseInt(item.Nominal) || 0
                    };
                    
                    const existingIndex = simpananData.findIndex(s => s.id === newSimpanan.id);
                    if (existingIndex !== -1) {
                        simpananData[existingIndex] = newSimpanan;
                    } else {
                        simpananData.push(newSimpanan);
                    }
                });
                
                localStorage.setItem('simpananData', JSON.stringify(simpananData));
                refreshSimpananTable();
            } else if (importType === 'pinjaman') {
                jsonData.forEach(item => {
                    const newPinjaman = {
                        id: item.ID_Pinjaman || 'PNH-' + (pinjamanData.length + 1).toString().padStart(3, '0'),
                        idAnggota: item.ID_Anggota,
                        namaAnggota: item.Nama_Anggota,
                        jumlahPinjaman: parseInt(item.Jumlah_Pinjaman) || 0,
                        tanggalPinjam: item.Tanggal_Pinjam,
                        jangkaWaktu: item.Jangka_Waktu,
                        bunga: parseFloat(item['Bunga (%)']) || 0,
                        sisaHutang: parseInt(item.Sisa_Hutang) || 0,
                        status: item.Status || 'Aktif'
                    };
                    
                    const existingIndex = pinjamanData.findIndex(p => p.id === newPinjaman.id);
                    if (existingIndex !== -1) {
                        pinjamanData[existingIndex] = newPinjaman;
                    } else {
                        pinjamanData.push(newPinjaman);
                    }
                });
                
                localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
                refreshPinjamanTable();
            } else if (importType === 'barang') {
                jsonData.forEach(item => {
                    const newBarang = {
                        id: item.ID_Barang || 'BRG-' + (barangData.length + 1).toString().padStart(3, '0'),
                        namaBarang: item.Nama_Barang,
                        stok: parseInt(item.Stok) || 0,
                        hargaBeli: parseInt(item.Harga_Beli) || 0,
                        hargaJual: parseInt(item.Harga_Jual) || 0,
                        laba: parseInt(item.Laba) || 0
                    };
                    
                    const existingIndex = barangData.findIndex(b => b.id === newBarang.id);
                    if (existingIndex !== -1) {
                        barangData[existingIndex] = newBarang;
                    } else {
                        barangData.push(newBarang);
                    }
                });
                
                localStorage.setItem('barangData', JSON.stringify(barangData));
                refreshBarangTable();
            }
            
            updateDashboardStats();
            updateFinancialDataInRealTime();
            showNotification('Data berhasil diimport!', 'success');
            document.getElementById('importExcelModal').style.display = 'none';
        };
        
        reader.readAsArrayBuffer(file);
    }

    // ===== FUNGSI SINCRONISASI DATA =====
    function syncDataBetweenSystems() {
        console.log('Synchronizing data between systems...');
        
        // 1. Load data from login-register
        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
        
        console.log('Registered users found:', registeredUsers.length);
        
        // 2. Sync to anggotaData (dashboard system)
        registeredUsers.forEach((user, index) => {
            const existingIndex = anggotaData.findIndex(a => 
                a.email === user.email || 
                a.nik === user.nik ||
                a.whatsapp === user.phone
            );
            
            if (existingIndex === -1) {
                const newNIA = generateNIA();
                const newAnggota = {
                    id: newNIA,
                    nia: newNIA,
                    posisi: 'Anggota',
                    nama: user.fullName || 'Anggota Baru',
                    alamat: user.address || '',
                    jenisKelamin: user.gender || 'Laki-laki',
                    agama: user.religion || 'Islam',
                    status: 'Belum Menikah',
                    email: user.email || '',
                    whatsapp: user.phone || '',
                    nik: user.nik || '',
                    tanggalDaftar: user.registrationDate || new Date().toLocaleDateString('id-ID'),
                    statusAktif: 'Aktif',
                    foto: user.photo || '',
                    totalSimpanan: 0,
                    totalPinjaman: 0,
                    saldo: 0,
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                console.log(`Adding new member ${index + 1}:`, newAnggota.nama);
                anggotaData.push(newAnggota);
            }
        });
        
        // 3. Save synchronized data
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
        
        // 4. Refresh UI
        refreshAnggotaTable();
        populateAnggotaDropdowns();
        updateDashboardStats();
        
        console.log(' Data synchronization completed:', {
            registeredUsers: registeredUsers.length,
            anggotaData: anggotaData.length
        });
        
        if (registeredUsers.length > 0) {
            showNotification(` ${registeredUsers.length} anggota berhasil disinkronisasi`, 'success');
        }
    }

    function forceSyncAllData() {
        loadLocalStorageData();
        syncDataBetweenSystems();
        updateFinancialDataInRealTime();
        refreshChartData();
        showNotification('Semua data berhasil disinkronisasi!', 'success');
    }

    function setupAutoRefresh() {
        // Auto refresh data every 30 seconds
        setInterval(() => {
            loadLocalStorageData();
            updateFinancialDataInRealTime();
            refreshChartData();
        }, 30000);
        
        // Auto sync between systems every 60 seconds
        setInterval(() => {
            syncDataBetweenSystems();
        }, 60000);
        
        console.log('Auto refresh setup completed');
    }

    // ===== FUNGSI UNTUK REAL-TIME SYNC =====
    function setupCrossPageSync() {
        console.log('Setting up cross-page synchronization...');
        
        // Event listener untuk perubahan di localStorage
        window.addEventListener('storage', function(e) {
            if (e.key === 'registeredUsers' || e.key === 'koperasi_anggota') {
                console.log('Storage changed:', e.key);
                
                // Sync NIA dari registration
                const newMembers = syncNIAFromRegistration();
                
                if (newMembers > 0) {
                    showNotification(`${newMembers} anggota baru disinkronisasi dengan NIA otomatis!`, 'success');
                    
                    // Refresh data
                    loadLocalStorageData();
                    refreshAnggotaTable();
                    updateDashboardStats();
                }
            }
        });
        
        // Auto-sync setiap 10 detik
        setInterval(() => {
            const newMembers = syncNIAFromRegistration();
            if (newMembers > 0) {
                console.log(`Auto-sync added ${newMembers} new members`);
            }
        }, 10000);
        
        console.log(' Cross-page sync setup completed');
    }

    // ===== FUNGSI LAINNYA =====
    function loadInitialData() {
        console.log('Loading initial data...');
        
        loadLocalStorageData();
        setupFinanceChart();
        updateDashboardStats();
        refreshAnggotaTable();
        refreshSimpananTable();
        refreshPinjamanTable();
        refreshBarangTable();
        populateAnggotaDropdowns();
        updateActivityList();
        
        // Update current year
        const currentYear = new Date().getFullYear();
        document.getElementById('currentYear').textContent = currentYear;
        document.getElementById('currentYearFooter').textContent = currentYear;
        
        updateFinancialDataInRealTime();
        syncDataBetweenSystems();
        
        console.log(' Initial data loaded successfully');
        console.log('Status sistem:');
        console.log('- Anggota:', anggotaData.length);
        console.log('- Simpanan:', simpananData.length);
        console.log('- Pinjaman:', pinjamanData.length);
        console.log('- Barang:', barangData.length);
    }

    function showDeleteConfirm(id, type) {
        currentEditingId = id;
        currentEditingType = type;
        
        let message = '';
        switch(type) {
            case 'anggota':
                const member = anggotaData.find(m => m.id === id);
                message = `Apakah Anda yakin ingin menghapus anggota "${member?.nama}"?`;
                break;
            case 'simpanan':
                message = 'Apakah Anda yakin ingin menghapus data simpanan ini?';
                break;
            case 'pinjaman':
                message = 'Apakah Anda yakin ingin menghapus data pinjaman ini?';
                break;
            case 'barang':
                message = 'Apakah Anda yakin ingin menghapus data barang ini?';
                break;
        }
        
        document.getElementById('confirmMessage').textContent = message;
        document.getElementById('confirmModal').style.display = 'flex';
    }

    async function confirmDeleteData() {
        if (currentEditingType === 'anggota') {
            anggotaData = anggotaData.filter(member => member.id !== currentEditingId);
            localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
            localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
            refreshAnggotaTable();
            populateAnggotaDropdowns();
            
        } else if (currentEditingType === 'simpanan') {
            simpananData = simpananData.filter(simpanan => simpanan.id !== currentEditingId);
            localStorage.setItem('simpananData', JSON.stringify(simpananData));
            refreshSimpananTable();
            
        } else if (currentEditingType === 'pinjaman') {
            pinjamanData = pinjamanData.filter(pinjaman => pinjaman.id !== currentEditingId);
            localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
            refreshPinjamanTable();
            
        } else if (currentEditingType === 'barang') {
            barangData = barangData.filter(barang => barang.id !== currentEditingId);
            localStorage.setItem('barangData', JSON.stringify(barangData));
            refreshBarangTable();
        }
        
        updateDashboardStats();
        updateFinancialDataInRealTime();
        showNotification('Data berhasil dihapus!', 'success');
    }

    function showPrintPreview(type) {
        const previewContent = document.getElementById('printPreviewContent');
        
        if (type === 'laporan') {
            const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
            const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
            const totalSHU = totalSimpanan * 0.1;
            const totalKas = Math.max(0, totalSimpanan - totalPinjaman);
            
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = now.toLocaleDateString('id-ID', options);
            
            previewContent.innerHTML = `
                <style>
                    @media print {
                        body * {
                            visibility: hidden;
                        }
                        .print-preview-content, .print-preview-content * {
                            visibility: visible;
                        }
                        .print-preview-content {
                            position: absolute;
                            left: 0;
                            top: 0;
                            width: 100%;
                            padding: 20px;
                        }
                        .no-print {
                            display: none !important;
                        }
                    }
                    .print-preview-content {
                        font-family: Arial, sans-serif;
                        padding: 20px;
                    }
                    .header {
                        text-align: center;
                        border-bottom: 3px solid #2e7d32;
                        padding-bottom: 20px;
                        margin-bottom: 30px;
                    }
                    .header h1 {
                        color: #2e7d32;
                        margin-bottom: 5px;
                    }
                    .header .subtitle {
                        color: #666;
                        font-size: 14px;
                    }
                    .neraca-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin: 20px 0;
                    }
                    .neraca-table th {
                        background-color: #f5f5f5;
                        padding: 12px;
                        text-align: left;
                        border: 1px solid #ddd;
                        font-weight: bold;
                    }
                    .neraca-table td {
                        padding: 12px;
                        border: 1px solid #ddd;
                    }
                    .total-row {
                        background-color: #e8f5e9;
                        font-weight: bold;
                    }
                    .section-title {
                        background-color: #2e7d32;
                        color: white;
                        padding: 10px;
                        margin-top: 30px;
                        font-weight: bold;
                    }
                    .footer {
                        margin-top: 50px;
                        text-align: right;
                        border-top: 1px solid #ddd;
                        padding-top: 20px;
                        font-size: 12px;
                        color: #666;
                    }
                </style>
                
                <div class="print-preview-content">
                    <div class="header">
                        <h1>KOPERASI ASMARA TANI</h1>
                        <div class="subtitle">#koperasijenius</div>
                        <h2>LAPORAN NERACA</h2>
                        <div>Periode: ${formattedDate}</div>
                    </div>
                    
                    <div class="section-title">AKTIVA</div>
                    <table class="neraca-table">
                        <tr>
                            <td>Kas</td>
                            <td style="text-align: right;">Rp ${totalKas.toLocaleString('id-ID')}</td>
                        </tr>
                        <tr>
                            <td>Simpanan Bank</td>
                            <td style="text-align: right;">Rp ${(totalSimpanan * 0.8).toLocaleString('id-ID')}</td>
                        </tr>
                        <tr>
                            <td>Piutang Anggota</td>
                            <td style="text-align: right;">Rp ${totalPinjaman.toLocaleString('id-ID')}</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL AKTIVA</strong></td>
                            <td style="text-align: right;"><strong>Rp ${(totalKas + (totalSimpanan * 0.8) + totalPinjaman).toLocaleString('id-ID')}</strong></td>
                        </tr>
                    </table>
                    
                    <div class="section-title">PASIVA</div>
                    <table class="neraca-table">
                        <tr>
                            <td>Simpanan Anggota</td>
                            <td style="text-align: right;">Rp ${totalSimpanan.toLocaleString('id-ID')}</td>
                        </tr>
                        <tr>
                            <td>Cadangan</td>
                            <td style="text-align: right;">Rp ${(totalSimpanan * 0.1).toLocaleString('id-ID')}</td>
                        </tr>
                        <tr>
                            <td>SHU</td>
                            <td style="text-align: right;">Rp ${totalSHU.toLocaleString('id-ID')}</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL PASIVA</strong></td>
                            <td style="text-align: right;"><strong>Rp ${(totalSimpanan + (totalSimpanan * 0.1) + totalSHU).toLocaleString('id-ID')}</strong></td>
                        </tr>
                    </table>
                    
                    <div class="footer">
                        <div>Dicetak pada: ${new Date().toLocaleString('id-ID')}</div>
                        <div style="margin-top: 30px;">
                            <div>Mengetahui,</div>
                            <div style="margin-top: 50px;">
                                <div>_________________________</div>
                                <div>Ketua Koperasi</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="no-print" style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" onclick="printLaporan()" style="margin-right: 10px;">
                        <i class="fas fa-print"></i> Cetak Laporan
                    </button>
                    <button class="btn btn-outline" onclick="downloadPDF('laporan')">
                        <i class="fas fa-file-pdf"></i> Download PDF
                    </button>
                </div>
            `;
            
        } else if (type === 'shu') {
            const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
            const totalSHU = totalSimpanan * 0.1;
            
            const now = new Date();
            const year = now.getFullYear();
            
            previewContent.innerHTML = `
                <style>
                    @media print {
                        body * {
                            visibility: hidden;
                        }
                        .print-preview-content, .print-preview-content * {
                            visibility: visible;
                        }
                        .print-preview-content {
                            position: absolute;
                            left: 0;
                            top: 0;
                            width: 100%;
                            padding: 20px;
                        }
                        .no-print {
                            display: none !important;
                        }
                    }
                    .print-preview-content {
                        font-family: Arial, sans-serif;
                        padding: 20px;
                    }
                    .header {
                        text-align: center;
                        border-bottom: 3px solid #2e7d32;
                        padding-bottom: 20px;
                        margin-bottom: 30px;
                    }
                    .header h1 {
                        color: #2e7d32;
                        margin-bottom: 5px;
                    }
                    .header .subtitle {
                        color: #666;
                        font-size: 14px;
                    }
                    .shu-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin: 20px 0;
                    }
                    .shu-table th {
                        background-color: #f5f5f5;
                        padding: 12px;
                        text-align: left;
                        border: 1px solid #ddd;
                        font-weight: bold;
                    }
                    .shu-table td {
                        padding: 12px;
                        border: 1px solid #ddd;
                    }
                    .total-row {
                        background-color: #e8f5e9;
                        font-weight: bold;
                    }
                    .percentage {
                        text-align: center;
                        width: 100px;
                    }
                    .amount {
                        text-align: right;
                        width: 200px;
                    }
                    .footer {
                        margin-top: 50px;
                        text-align: right;
                        border-top: 1px solid #ddd;
                        padding-top: 20px;
                        font-size: 12px;
                        color: #666;
                    }
                    .distribution-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 20px;
                        margin: 20px 0;
                    }
                    .distribution-card {
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        padding: 15px;
                        background: #f9f9f9;
                    }
                    .distribution-card h4 {
                        margin-top: 0;
                        color: #2e7d32;
                        border-bottom: 2px solid #2e7d32;
                        padding-bottom: 8px;
                    }
                    .distribution-value {
                        font-size: 18px;
                        font-weight: bold;
                        color: #2e7d32;
                        margin-top: 10px;
                    }
                </style>
                
                <div class="print-preview-content">
                    <div class="header">
                        <h1>KOPERASI ASMARA Tani</h1>
                        <div class="subtitle">#koperasijenius</div>
                        <h2>LAPORAN PEMBAGIAN SHU</h2>
                        <div>Tahun: ${year}</div>
                        <div style="font-size: 16px; margin-top: 10px; color: #2e7d32;">
                            <strong>Total SHU yang dibagikan: Rp ${totalSHU.toLocaleString('id-ID')}</strong>
                        </div>
                    </div>
                    
                    <div class="distribution-grid">
                        <div class="distribution-card">
                            <h4>CADANGAN KOPERASI (40%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.4).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk pengembangan usaha koperasi
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>JASA ANGGOTA (30%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.3).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Dibagikan kepada anggota sesuai partisipasi
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>DANA PENGURUS (10%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk honor pengurus koperasi
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>DANA KARYAWAN (10%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk bonus karyawan koperasi
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>DANA PENDIDIKAN (5%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.05).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk pelatihan dan pendidikan anggota
                            </div>
                        </div>
                        
                        <div class="distribution-card">
                            <h4>DANA SOSIAL (5%)</h4>
                            <div class="distribution-value">Rp ${(totalSHU * 0.05).toLocaleString('id-ID')}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Untuk kegiatan sosial koperasi
                            </div>
                        </div>
                    </div>
                    
                    <table class="shu-table">
                        <thead>
                            <tr>
                                <th>KETERANGAN</th>
                                <th class="percentage">PERSENTASE</th>
                                <th class="amount">JUMLAH</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Cadangan Koperasi</td>
                                <td class="percentage">40%</td>
                                <td class="amount">Rp ${(totalSHU * 0.4).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Jasa Anggota</td>
                                <td class="percentage">30%</td>
                                <td class="amount">Rp ${(totalSHU * 0.3).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Dana Pengurus</td>
                                <td class="percentage">10%</td>
                                <td class="amount">Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Dana Karyawan</td>
                                <td class="percentage">10%</td>
                                <td class="amount">Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Dana Pendidikan</td>
                                <td class="percentage">5%</td>
                                <td class="amount">Rp ${(totalSHU * 0.05).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td>Dana Sosial</td>
                                <td class="percentage">5%</td>
                                <td class="amount">Rp ${(totalSHU * 0.05).toLocaleString('id-ID')}</td>
                            </tr>
                            <tr class="total-row">
                                <td><strong>TOTAL SHU</strong></td>
                                <td class="percentage"><strong>100%</strong></td>
                                <td class="amount"><strong>Rp ${totalSHU.toLocaleString('id-ID')}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <div>Dicetak pada: ${new Date().toLocaleString('id-ID')}</div>
                        <div style="margin-top: 30px;">
                            <div>Mengetahui,</div>
                            <div style="display: flex; justify-content: space-between; margin-top: 50px;">
                                <div>
                                    <div>_________________________</div>
                                    <div>Ketua Koperasi</div>
                                </div>
                                <div>
                                    <div>_________________________</div>
                                    <div>Bendahara</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="no-print" style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" onclick="printLaporan()" style="margin-right: 10px;">
                        <i class="fas fa-print"></i> Cetak SHU
                    </button>
                    <button class="btn btn-outline" onclick="downloadPDF('shu')">
                        <i class="fas fa-file-pdf"></i> Download PDF
                    </button>
                </div>
            `;
        }
        
        document.getElementById('printPreviewModal').style.display = 'flex';
    }

    function printLaporan() {
        window.print();
    }

    function downloadPDF(type) {
        showNotification('Fitur download PDF akan segera tersedia!', 'info');
    }

    function updatePinjamanTerbaruTable() {
        const tableBody = document.querySelector('#pinjamanTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        // Ambil 5 pinjaman terbaru
        const pinjamanTerbaru = [...pinjamanData]
            .sort((a, b) => new Date(b.tanggalPinjam) - new Date(a.tanggalPinjam))
            .slice(0, 5);
        
        if (pinjamanTerbaru.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-info-circle"></i> Belum ada data pinjaman
                    </td>
                </tr>
            `;
            return;
        }
        
        pinjamanTerbaru.forEach(pinjaman => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${pinjaman.namaAnggota}</td>
                <td>${pinjaman.tanggalPinjam}</td>
                <td>Rp ${pinjaman.jumlahPinjaman.toLocaleString('id-ID')}</td>
                <td><span class="badge badge-success">${pinjaman.status}</span></td>
            `;
            tableBody.appendChild(row);
        });
    }

    function updateAnggotaBaruTable() {
        const tableBody = document.querySelector('#anggotaTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        // Ambil 5 anggota terbaru
        const anggotaTerbaru = [...anggotaData]
            .sort((a, b) => new Date(b.tanggalDaftar) - new Date(a.tanggalDaftar))
            .slice(0, 5);
        
        if (anggotaTerbaru.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="3" style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-info-circle"></i> Belum ada data anggota
                    </td>
                </tr>
            `;
            return;
        }
        
        anggotaTerbaru.forEach(anggota => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${anggota.nama}</td>
                <td>${anggota.tanggalDaftar}</td>
                <td><span class="badge badge-success">${anggota.statusAktif}</span></td>
            `;
            tableBody.appendChild(row);
        });
    }

    function updateActivityList() {
        const activityList = document.getElementById('activityList');
        if (!activityList) return;
        
        activityList.innerHTML = '';
        
        const activities = [
            { icon: 'fa-users', bgColor: 'bg-primary', title: 'Anggota Baru', desc: `${anggotaData.length} anggota terdaftar`, time: 'Baru saja' },
            { icon: 'fa-hand-holding-usd', bgColor: 'bg-success', title: 'Simpanan', desc: `${simpananData.length} transaksi simpanan`, time: 'Baru saja' },
            { icon: 'fa-file-invoice-dollar', bgColor: 'bg-warning', title: 'Pinjaman', desc: `${pinjamanData.length} pinjaman aktif`, time: 'Baru saja' },
            { icon: 'fa-chart-line', bgColor: 'bg-info', title: 'Laporan', desc: 'Dashboard aktif', time: 'Baru saja' }
        ];
        
        activities.forEach(activity => {
            const li = document.createElement('li');
            li.className = 'activity-item';
            li.innerHTML = `
                <div class="activity-icon ${activity.bgColor}">
                    <i class="fas ${activity.icon}"></i>
                </div>
                <div class="activity-content">
                    <h4>${activity.title}</h4>
                    <p>${activity.desc}</p>
                </div>
                <div class="activity-time">${activity.time}</div>
            `;
            activityList.appendChild(li);
        });
    }

    // ===== FUNGSI SHOW NOTIFICATION =====
    function showNotification(message, type = 'info') {
        // Hapus notifikasi lama jika ada
        const existingNotif = document.querySelector('.sync-notification');
        if (existingNotif) existingNotif.remove();
        
        // Buat notifikasi baru
        const notification = document.createElement('div');
        notification.className = 'sync-notification';
        if (type === 'success') notification.classList.add('success');
        else if (type === 'error') notification.classList.add('error');
        else if (type === 'warning') notification.classList.add('warning');
        
        // Set icon berdasarkan type
        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        else if (type === 'error') icon = 'exclamation-circle';
        else if (type === 'warning') icon = 'exclamation-triangle';
        
        notification.innerHTML = `
            <i class="fas fa-${icon}"></i>
            <span>${message}</span>
        `;
        
        // Tambahkan ke body
        document.body.appendChild(notification);
        
        // Hapus otomatis setelah 3 detik
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease forwards';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    // ===== PENGATURAN EVENT LISTENERS =====
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM Content Loaded - Initializing complete system...');
        
        // Initialize complete system
        initializeCompleteSystem();
        
        // Setup untuk auto sync data dari login-register
        setTimeout(() => {
            syncDataBetweenSystems();
            showNotification('Data berhasil disinkronisasi dari sistem registrasi', 'success');
        }, 2000);
    });
</script>
</body>
</html>

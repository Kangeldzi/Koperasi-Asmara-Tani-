<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Koperasi Asmara Tani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* SEMUA CSS DARI SEBELUMNYA TETAP SAMA */
        :root {
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary: #ff9800;
            --accent: #ff5722;
            --light: #f5f5f5;
            --dark: #333;
            --gray: #757575;
            --gray-light: #e0e0e0;
            --danger: #f44336;
            --warning: #ffc107;
            --success: #4caf50;
            --info: #2196f3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Container Utama */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: linear-gradient(to bottom, var(--primary-dark), var(--primary));
            color: white;
            transition: all 0.3s ease;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-header img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-header h1 {
            font-size: 1.4rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .sidebar-header .tagline {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }
        
        .sidebar-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            display: none;
            transition: transform 0.3s ease;
        }
        
        .sidebar-close:hover {
            transform: scale(1.2);
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .sidebar-menu ul {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 8px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .sidebar-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--secondary);
            padding-left: 30px;
        }
        
        .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: var(--secondary);
            font-weight: 600;
        }
        
        .sidebar-menu i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }
        
        /* Top Navigation */
        .top-nav {
            background: white;
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 999;
        }
        
        .nav-left {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .nav-buttons {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
            transition: transform 0.3s ease;
            display: none;
        }
        
        .menu-toggle:hover {
            transform: scale(1.1);
        }
        
        .current-time {
            font-size: 0.95rem;
            color: var(--primary-dark);
            font-weight: 600;
            background: var(--light);
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .current-time i {
            color: var(--primary);
        }
        
        .home-btn, .dashboard-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .home-btn:hover, .dashboard-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            background: var(--light);
            border-radius: 25px;
            padding: 10px 20px;
            width: 320px;
            transition: all 0.3s ease;
        }
        
        .search-bar:focus-within {
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
            transform: translateY(-2px);
        }
        
        .search-bar input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            margin-left: 12px;
            font-size: 0.95rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 15px;
            border-radius: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .user-info:hover {
            background: var(--light);
            transform: translateY(-2px);
        }
        
        .user-info img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }
        
        .user-details h4 {
            font-size: 0.95rem;
            margin-bottom: 2px;
        }
        
        .user-details p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Content Area */
        .content {
            padding: 30px;
            flex: 1;
            background: #f8f9fa;
        }
        
        .page-title {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-title h1 {
            font-size: 2rem;
            color: var(--primary-dark);
            position: relative;
            padding-bottom: 12px;
        }
        
        .page-title h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        /* PERBAIKAN GAP TOMBOL DI PAGE TITLE */
        .page-title > div {
            display: flex !important;
            gap: 12px !important;
            flex-wrap: wrap !important;
            align-items: center !important;
        }
        
        .page-title .btn {
            margin: 2px 3px !important;
        }
        
        /* Dashboard Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-info h3 {
            font-size: 0.95rem;
            color: var(--gray);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-info p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        
        .stat-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
        }
        
        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        .bg-primary { background: linear-gradient(135deg, var(--primary), var(--primary-light)); }
        .bg-secondary { background: linear-gradient(135deg, var(--secondary), #ffb74d); }
        .bg-accent { background: linear-gradient(135deg, var(--accent), #ff8a65); }
        .bg-info { background: linear-gradient(135deg, var(--info), #64b5f6); }
        .bg-success { background: linear-gradient(135deg, var(--success), #81c784); }
        .bg-warning { background: linear-gradient(135deg, var(--warning), #ffd54f); }
        
        /* Chart and Table Sections */
        .dashboard-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .chart-container, .table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .chart-container:before, .table-container:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .chart-container:hover, .table-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .section-header h2 {
            font-size: 1.3rem;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .chart-wrapper {
            height: 280px;
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px 18px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }
        
        th {
            background-color: rgba(46, 125, 50, 0.05);
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        tr {
            transition: background-color 0.3s ease;
        }
        
        tr:hover {
            background-color: rgba(46, 125, 50, 0.03);
        }
        
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .badge:hover {
            transform: scale(1.05);
        }
        
        .badge-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #e6a700;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .badge-danger {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }
        
        .badge-overdue {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }
        
        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover:before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-sm {
            padding: 10px 15px !important;
            margin: 2px 3px;
            font-size: 0.85rem;
        }
        
        /* Recent Activity */
        .activity-list {
            list-style: none;
        }
        
        .activity-item {
            display: flex;
            padding: 18px 0;
            border-bottom: 1px solid var(--gray-light);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            background-color: rgba(46, 125, 50, 0.03);
            border-radius: 10px;
            padding-left: 15px;
            padding-right: 15px;
            transform: translateX(5px);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover .activity-icon {
            transform: scale(1.1);
        }
        
        .activity-content h4 {
            font-size: 0.95rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .activity-content p {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: var(--gray);
            margin-left: auto;
            white-space: nowrap;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .required {
            color: var(--danger);
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--gray-light);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }
        
        /* Footer */
        .footer {
            background: white;
            padding: 20px 30px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
            margin-top: 30px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.03);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            color: white;
        }
        
        .modal-header h3 {
            color: white;
            font-size: 1.4rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            transition: transform 0.3s ease;
        }
        
        .modal-close:hover {
            transform: scale(1.2);
        }
        
        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 25px;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }
        
        .tab:hover {
            background-color: rgba(46, 125, 50, 0.05);
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
            background: rgba(46, 125, 50, 0.05);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Admin Profile Section */
        .admin-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .admin-profile img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }
        
        .admin-details h4 {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .admin-details p {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 3px;
        }
        
        .admin-details .admin-role {
            font-size: 10px;
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Bank Logo */
        .bank-logo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            background: var(--light);
            border-radius: 5px;
            font-size: 0.8rem;
        }
        
        .bank-logo i {
            color: var(--primary);
        }
        
        /* Modal Konfirmasi */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .confirm-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
            overflow: hidden;
        }
        
        .confirm-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            background: linear-gradient(90deg, var(--warning), #ffb74d);
            color: white;
        }
        
        .confirm-body {
            padding: 25px;
            text-align: center;
        }
        
        .confirm-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Print Card */
        .print-card {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 3000;
            padding: 20px;
        }
        
        @media print {
            .print-card {
                display: block;
            }
            .no-print {
                display: none;
            }
        }
        
        /* ===== STYLE UNTUK TABEL KELOLA ANGGOTA ===== */
        .table-responsive {
            overflow-x: auto;
        }
        
        .anggota-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .anggota-table th {
            background: rgba(46, 125, 50, 0.05);
            padding: 12px 15px;
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 0.85rem;
        }
        
        .anggota-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-light);
            font-size: 0.85rem;
        }
        
        /* WhatsApp Link */
        .whatsapp-link {
            color: #25D366 !important;
            text-decoration: none !important;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }
        
        .whatsapp-link:hover {
            color: #128C7E !important;
            text-decoration: underline !important;
        }
        
        .saldo-display {
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        /* Password Container dengan Ikon Mata */
        .password-container {
            position: relative;
            width: 100%;
        }
        
        .password-container .form-control {
            padding-right: 40px;
        }
        
        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
        }
        
        .toggle-password:hover {
            color: var(--primary);
        }
        
        /* Alert Styles */
        .alert {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }
        
        .alert-success {
            background: #e8f5e8;
            color: var(--success);
            border: 1px solid #c8e6c9;
        }
        
        .alert-error {
            background: #ffebee;
            color: var(--danger);
            border: 1px solid #ffcdd2;
        }
        
        /* Detail Section */
        .anggota-detail-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .anggota-detail-section h4 {
            margin-bottom: 10px;
            color: var(--primary-dark);
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .detail-item {
            margin-bottom: 10px;
        }
        
        .detail-label {
            font-weight: 600;
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 4px;
        }
        
        .detail-value {
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        /* CSS untuk Form Anggota Baru */
        .input-group {
            display: flex;
            align-items: center;
        }

        .input-group span {
            padding: 10px 15px;
            background: var(--light);
            border: 1px solid var(--gray-light);
            border-right: none;
            border-radius: 8px 0 0 8px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .input-group input {
            border-radius: 0 8px 8px 0;
        }

        /* Simpanan Card */
        .simpanan-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .simpanan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Modal Responsive */
        @media (max-width: 768px) {
            #addMemberModal .modal-content {
                max-width: 95% !important;
            }
            
            .detail-grid {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Responsive Design - Tablet */
        @media (max-width: 1200px) {
            .sidebar {
                width: 250px;
            }
            
            .main-content {
                margin-left: 250px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 20px;
            }
            
            .dashboard-row {
                gap: 20px;
            }
        }
        
        /* Responsive Design - Small Tablet */
        @media (max-width: 992px) {
            .dashboard-row {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .sidebar-close {
                display: block;
            }
            
            .search-bar {
                width: 250px;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 18px;
            }
            
            .content {
                padding: 25px;
            }
        }
        
        /* Responsive Design - Mobile Landscape & Small Tablet */
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                margin-bottom: 25px;
            }
            
            .search-bar {
                width: 200px;
            }
            
            .nav-right {
                gap: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .section-header .btn {
                align-self: flex-end;
            }
            
            .chart-wrapper {
                height: 220px;
            }
            
            .card {
                padding: 20px;
            }
            
            .chart-container, .table-container {
                padding: 20px;
            }
            
            .page-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .page-title h1 {
                font-size: 1.8rem;
            }
            
            .stat-info p {
                font-size: 1.8rem;
            }
            
            .stat-icon {
                width: 70px;
                height: 70px;
                font-size: 1.8rem;
            }
        }
        
        /* Responsive Design - Mobile Portrait */
        @media (max-width: 576px) {
            .stats-cards {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .search-bar {
                display: none;
            }
            
            .top-nav {
                padding: 15px 20px;
            }
            
            .content {
                padding: 15px;
            }
            
            .card {
                padding: 18px;
                border-radius: 12px;
            }
            
            .chart-container, .table-container {
                padding: 18px;
                border-radius: 12px;
            }
            
            .chart-wrapper {
                height: 200px;
            }
            
            .user-details {
                display: none;
            }
            
            .page-title h1 {
                font-size: 1.6rem;
            }
            
            .section-header h2 {
                font-size: 1.2rem;
            }
            
            .stat-info p {
                font-size: 1.6rem;
            }
            
            .stat-icon {
                width: 60px;
                height: 60px;
                font-size: 1.6rem;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            .btn-sm {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 12px 14px;
                font-size: 0.85rem;
            }
            
            .admin-profile {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }
            
            .admin-profile img {
                width: 70px;
                height: 70px;
            }
            
            .nav-buttons {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .home-btn, .dashboard-btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .current-time {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
        
        /* Responsive Design - Small Mobile */
        @media (max-width: 400px) {
            .content {
                padding: 12px;
            }
            
            .top-nav {
                padding: 12px 15px;
            }
            
            .card {
                padding: 15px;
                border-radius: 10px;
            }
            
            .chart-container, .table-container {
                padding: 15px;
                border-radius: 10px;
            }
            
            .page-title h1 {
                font-size: 1.4rem;
            }
            
            .section-header h2 {
                font-size: 1.1rem;
            }
            
            .stat-info p {
                font-size: 1.4rem;
            }
            
            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }
            
            .btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }
            
            th, td {
                padding: 10px 12px;
                font-size: 0.8rem;
            }
            
            .home-btn, .dashboard-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            .menu-toggle {
                font-size: 1.3rem;
            }
            
            .user-info img {
                width: 40px;
                height: 40px;
            }
        }
        
        /* Responsive Design - Extra Small Mobile */
        @media (max-width: 360px) {
            .content {
                padding: 10px;
            }
            
            .top-nav {
                padding: 10px 12px;
            }
            
            .card {
                padding: 12px;
            }
            
            .chart-container, .table-container {
                padding: 12px;
            }
            
            .page-title h1 {
                font-size: 1.3rem;
            }
            
            .stat-info p {
                font-size: 1.3rem;
            }
            
            .stat-icon {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            
            .nav-buttons {
                gap: 8px;
            }
            
            .home-btn, .dashboard-btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .current-time {
                font-size: 0.75rem;
                padding: 5px 10px;
            }
        }
        
        /* ============== CSS TAMBAHAN UNTUK PERBAIKAN ============== */
        
        /* ===== MODERN FORM STYLES ===== */
        .form-section-title {
            font-size: 1.1rem;
            color: var(--primary-dark);
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
            font-weight: 600;
            position: relative;
        }

        .form-section-title:before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 40px;
            height: 2px;
            background: var(--secondary);
        }

        /* Grid form responsive */
        .form-grid-responsive {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Foto profil modern */
        .foto-profil-container {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
        }

        .foto-profil-placeholder {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3.5rem;
            border: 5px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .foto-profil-placeholder:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .foto-profil-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .upload-foto-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 2;
        }

        .upload-foto-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        /* Card form modern */
        .form-card-group {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .form-card-group:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }

        /* Input group modern */
        .input-group-modern {
            display: flex;
            align-items: center;
            position: relative;
        }

        .input-group-modern .prefix {
            position: absolute;
            left: 15px;
            color: var(--gray);
            font-weight: 500;
            z-index: 2;
        }

        .input-group-modern .form-control {
            padding-left: 50px;
        }

        .input-group-modern .suffix {
            position: absolute;
            right: 15px;
            color: var(--gray);
            font-weight: 500;
        }

        /* Simpanan cards modern */
        .simpanan-card-modern {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .simpanan-card-modern:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .simpanan-card-modern.pokok {
            border-color: rgba(46, 125, 50, 0.3);
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.05), rgba(76, 175, 80, 0.05));
        }

        .simpanan-card-modern.wajib {
            border-color: rgba(255, 152, 0, 0.3);
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.05), rgba(255, 183, 77, 0.05));
        }

        .simpanan-card-modern.sukarela {
            border-color: rgba(255, 87, 34, 0.3);
            background: linear-gradient(135deg, rgba(255, 87, 34, 0.05), rgba(255, 138, 101, 0.05));
        }

        .simpanan-card-modern:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }

        .simpanan-card-modern.pokok:before {
            background: linear-gradient(to bottom, var(--primary), var(--primary-light));
        }

        .simpanan-card-modern.wajib:before {
            background: linear-gradient(to bottom, var(--secondary), #ffb74d);
        }

        .simpanan-card-modern.sukarela:before {
            background: linear-gradient(to bottom, var(--accent), #ff8a65);
        }

        /* Total simpanan display modern */
        .total-simpanan-display {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(46, 125, 50, 0.3);
            position: relative;
            overflow: hidden;
        }

        .total-simpanan-display:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1%, transparent 1%);
            background-size: 10px 10px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .total-simpanan-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .total-simpanan-amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }

        .total-simpanan-detail {
            font-size: 0.8rem;
            opacity: 0.9;
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }

        /* Responsive improvements for mobile */
        @media (max-width: 768px) {
            .form-grid-responsive {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .form-card-group {
                padding: 15px;
            }
            
            .simpanan-card-modern {
                padding: 15px;
            }
            
            .total-simpanan-display {
                padding: 20px;
            }
            
            .total-simpanan-amount {
                font-size: 1.6rem;
            }
            
            .foto-profil-container {
                width: 120px;
                height: 120px;
            }
            
            .foto-profil-placeholder {
                font-size: 2.8rem;
            }
            
            .upload-foto-btn {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }

        @media (max-width: 576px) {
            .modal-content {
                width: 95% !important;
                margin: 10px;
            }
            
            .form-section-title {
                font-size: 1rem;
            }
            
            .total-simpanan-amount {
                font-size: 1.4rem;
            }
        }

        /* Loading animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== RESPONSIVE TABLE STYLES ===== */
        .table-container-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 10px;
        }

        .anggota-table-responsive {
            min-width: 100%;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .anggota-table-responsive th,
            .anggota-table-responsive td {
                padding: 10px 8px;
                font-size: 0.8rem;
            }
            
            .anggota-table-responsive .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .anggota-table-responsive .btn-sm {
                padding: 6px 10px !important;
                font-size: 0.75rem;
            }
            
            /* Hide some columns on mobile */
            .anggota-table-responsive th:nth-child(3), /* NIK */
            .anggota-table-responsive td:nth-child(3),
            .anggota-table-responsive th:nth-child(4), /* Jenis Kelamin */
            .anggota-table-responsive td:nth-child(4) {
                display: none;
            }
        }

        @media (max-width: 576px) {
            /* Hide more columns on small mobile */
            .anggota-table-responsive th:nth-child(7), /* Tanggal Bergabung */
            .anggota-table-responsive td:nth-child(7) {
                display: none;
            }
            
            .anggota-table-responsive .user-avatar {
                width: 30px;
                height: 30px;
            }
        }

        /* Badge status responsive */
        .badge-responsive {
            padding: 4px 8px;
            font-size: 0.75rem;
            white-space: nowrap;
        }

        /* ===== CSS UNTUK ENHANCED SYNC SYSTEM ===== */
        /* Sync Notification Styles */
        .sync-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 12px 20px;
            background: #4285F4;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        }
        
        .sync-notification.success {
            background: #34A853;
        }
        
        .sync-notification.error {
            background: #EA4335;
        }
        
        .sync-notification.warning {
            background: #FBBC05;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Logo Koperasi Asmara Tani">
                <h1>Koperasi Asmara Tani</h1>
                <div class="tagline">#koperasijenius</div>
                <button class="sidebar-close" id="sidebarClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <ul>
                    <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-home"></i> <span>Dashboard Utama</span></a></li>
                    <li><a href="#" data-tab="anggota"><i class="fas fa-users"></i> <span>Data Anggota</span></a></li>
                    <!-- MENU TABUNGAN DIGITAL DI SIDEBAR -->
                    <li><a href="tabungan-digital.html"><i class="fas fa-book"></i> <span>Tabungan Digital</span></a></li>
                    <li><a href="#" data-tab="simpanan"><i class="fas fa-hand-holding-usd"></i> <span>Simpanan Anggota</span></a></li>
                    <li><a href="#" data-tab="pinjaman"><i class="fas fa-file-invoice-dollar"></i> <span>Pinjaman & Angsuran</span></a></li>
                    <li><a href="#" data-tab="laporan"><i class="fas fa-chart-line"></i> <span>Laporan Keuangan</span></a></li>
                    <li><a href="#" data-tab="unit-usaha"><i class="fas fa-shopping-cart"></i> <span>Unit Usaha</span></a></li>
                    <li><a href="#" data-tab="shu"><i class="fas fa-calculator"></i> <span>Laporan SHU</span></a></li>
                    <!-- LINK CALL ALERT LANGSUNG -->
                    <li><a href="call-alert.html" target="_blank"><i class="fas fa-bell"></i> <span>Call Alert</span></a></li>
                    <li><a href="#" data-tab="pengaturan"><i class="fas fa-cog"></i> <span>Pengaturan Sistem</span></a></li>
                    <li><a href="https://koperasi-asmara-tani.vercel.app/"><i class="fas fa-sign-out-alt"></i> <span>Keluar</span></a></li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navigation -->
            <div class="top-nav">
                <div class="nav-left">
                    <div class="nav-buttons">
                        <button class="menu-toggle" id="menuToggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <!-- TOMBOL BERANDA -->
                        <button class="home-btn" id="homeBtn" onclick="window.location.href='index.html'">
                            <i class="fas fa-home"></i>
                            <span>Beranda</span>
                        </button>
                        <!-- TOMBOL DASHBOARD -->
                        <button class="dashboard-btn" id="dashboardBtn" onclick="window.location.href='dashboard-admin.html'">
                            <i class="fas fa-chart-line"></i>
                            <span>Dashboard</span>
                        </button>
                    </div>
                    <div class="current-time" id="currentTime">
                        <i class="fas fa-clock"></i>
                        <span>Mengambil waktu...</span>
                    </div>
                </div>
                <div class="nav-right">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Cari data..." id="globalSearch">
                    </div>
                    <div class="user-info">
                        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Admin">
                        <div class="user-details">
                            <h4 id="topNavUsername">Admin Koperasi</h4>
                            <p id="topNavRole">Super Administrator</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Tab -->
                <div class="tab-content active" id="dashboard">
                    <div class="page-title">
                        <h1>Dashboard Admin</h1>
                        <div>
                            <!-- TOMBOL EXPORT DAN IMPORT EXCEL -->
                            <button class="btn btn-outline btn-sm" id="exportExcelBtn"><i class="fas fa-file-excel"></i> Export Excel</button>
                            <button class="btn btn-outline btn-sm" id="importExcelBtn"><i class="fas fa-file-import"></i> Import Excel</button>
                        </div>
                    </div>

                    <!-- Admin Profile Section -->
                    <div class="admin-profile" id="adminProfileSection">
                        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg" alt="Admin">
                        <div class="admin-details">
                            <h4 id="adminUsername">Admin Koperasi</h4>
                            <p id="adminEmail">admin@koperasiasmaratani.id</p>
                            <p id="adminRole">Super Administrator</p>
                            <p class="admin-role">No. Rekening: <span id="adminRekening" class="bank-logo"><i class="fas fa-university"></i> 4098-01-019526-53-3 (BRI)</span></p>
                            <p id="lastSyncTime" style="font-size: 10px; color: #666; margin-top: 3px;">Terakhir update: -</p>
                        </div>
                    
                        <div>
                            <!-- LINK LANGSUNG KE CALL ALERT -->
                            <button class="btn btn-primary" onclick="window.location.href='call-alert.html'">
                                <i class="fas fa-bell"></i> Call Alert
                            </button>
                            <!-- LINK LANGSUNG KE TABUNGAN DIGITAL -->
                            <button class="btn btn-outline" onclick="window.location.href='tabungan-digital.html'">
                                <i class="fas fa-wallet"></i> Tabungan Digital
                            </button>
                        </div>
                    </div>

                    <!-- Stat Cards -->
                    <div class="stats-cards">
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Anggota</h3>
                                <p id="totalAnggota">0</p>
                            </div>
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Simpanan</h3>
                                <p id="totalSimpanan">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-secondary">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Pinjaman Aktif</h3>
                                <p id="totalPinjaman">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-accent">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total SHU</h3>
                                <p id="totalSHU">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-info">
                                <i class="fas fa-calculator"></i>
                            </div>
                        </div>
                        
                        <div class="card stat-card">
                            <div class="stat-info">
                                <h3>Total Kas</h3>
                                <p id="totalKas">Rp 0</p>
                            </div>
                            <div class="stat-icon bg-success">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Tables Row -->
                    <div class="dashboard-row">
                        <!-- Chart Section -->
                        <div class="chart-container">
                            <div class="section-header">
                                <h2>Grafik Perkembangan Keuangan</h2>
                                <div>
                                    <button class="btn btn-outline btn-sm" id="refreshChart"><i class="fas fa-sync-alt"></i> Refresh</button>
                                    <button class="btn btn-outline btn-sm" id="yearlyChart">Tahunan</button>
                                    <button class="btn btn-primary btn-sm" id="monthlyChart">Bulanan</button>
                                </div>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="financeChart"></canvas>
                            </div>
                        </div>
                        <!-- Recent Activity -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Notifikasi Terbaru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaNotif">Lihat Semua</button>
                            </div>
                            <ul class="activity-list" id="activityList">
                                <!-- Data akan diisi secara dinamis -->
                            </ul>
                        </div>
                    </div>

                    <!-- Tables Row -->
                    <div class="dashboard-row">
                        <!-- Pinjaman Terbaru -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Pinjaman Terbaru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaPinjaman">Lihat Semua</button>
                            </div>
                            <table id="pinjamanTable">
                                <thead>
                                    <tr>
                                        <th>Nama Anggota</th>
                                        <th>Tanggal</th>
                                        <th>Jumlah</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Anggota Baru -->
                        <div class="table-container">
                            <div class="section-header">
                                <h2>Anggota Baru</h2>
                                <button class="btn btn-outline btn-sm" id="lihatSemuaAnggota">Lihat Semua</button>
                            </div>
                            <table id="anggotaTable">
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>Tanggal Bergabung</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data akan diisi secara dinamis -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Data Anggota Tab -->
                <div class="tab-content" id="anggota">
                    <div class="page-title">
                        <h1>Data Anggota</h1>
                        <div>
                            <button class="btn btn-primary" id="addMemberBtn"><i class="fas fa-plus"></i> Tambah Anggota</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Daftar Anggota Koperasi</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari anggota..." id="searchAnggota">
                            </div>
                        </div>
                        <table id="anggotaFullTable">
                            <thead>
                                <tr>
                                    <th>ID/NIA</th>
                                    <th>Nama</th>
                                    <th>NIK</th>
                                    <th>Jenis Kelamin</th>
                                    <th>Alamat</th>
                                    <th>No. HP</th>
                                    <th>Tanggal Bergabung</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tabungan Digital Tab -->
                <div class="tab-content" id="tabunganDigital">
                    <!-- Konten akan diisi secara dinamis -->
                </div>

                <!-- Simpanan Anggota Tab -->
                <div class="tab-content" id="simpanan">
                    <div class="page-title">
                        <h1>Simpanan Anggota</h1>
                        <button class="btn btn-primary" id="addSimpananBtn"><i class="fas fa-plus"></i> Tambah Simpanan</button>
                    </div>

                    <div class="tabs">
                        <div class="tab active" data-simpanan-tab="pokok">Simpanan Pokok</div>
                        <div class="tab" data-simpanan-tab="wajib">Simpanan Wajib</div>
                        <div class="tab" data-simpanan-tab="sukarela">Simpanan Sukarela</div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2 id="simpananTitle">Daftar Simpanan Pokok</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari simpanan..." id="searchSimpanan">
                            </div>
                        </div>
                        <table id="simpananTable">
                            <thead>
                                <tr>
                                    <th>ID Anggota</th>
                                    <th>Nama</th>
                                    <th>Jenis Simpanan</th>
                                    <th>Tanggal Setor</th>
                                    <th>Nominal</th>
                                    <th>Total Akumulasi</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pinjaman & Angsuran Tab -->
                <div class="tab-content" id="pinjaman">
                    <div class="page-title">
                        <h1>Pinjaman & Angsuran</h1>
                        <button class="btn btn-primary" id="addPinjamanBtn"><i class="fas fa-plus"></i> Tambah Pinjaman</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Daftar Pinjaman</h2>
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari pinjaman..." id="searchPinjaman">
                            </div>
                        </div>
                        <table id="pinjamanFullTable">
                            <thead>
                                <tr>
                                    <th>ID Pinjaman</th>
                                    <th>Nama Anggota</th>
                                    <th>Jumlah Pinjaman</th>
                                    <th>Tanggal Pinjam</th>
                                    <th>Jangka Waktu</th>
                                    <th>Bunga</th>
                                    <th>Sisa Hutang</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan Keuangan Tab -->
                <div class="tab-content" id="laporan">
                    <div class="page-title">
                        <h1>Laporan Keuangan</h1>
                        <button class="btn btn-primary" id="cetakLaporanBtn"><i class="fas fa-print"></i> Cetak Laporan</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Laporan Neraca</h2>
                        </div>
                        <table id="neracaTable">
                            <thead>
                                <tr>
                                    <th>Keterangan</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Unit Usaha Tab -->
                <div class="tab-content" id="unit-usaha">
                    <div class="page-title">
                        <h1>Unit Usaha / Toko Koperasi</h1>
                        <button class="btn btn-primary" id="addBarangBtn"><i class="fas fa-plus"></i> Tambah Barang</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Data Stok Barang</h2>
                        </div>
                        <table id="barangTable">
                            <thead>
                                <tr>
                                    <th>Kode Barang</th>
                                    <th>Nama Barang</th>
                                    <th>Stok</th>
                                    <th>Harga Beli</th>
                                    <th>Harga Jual</th>
                                    <th>Laba</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan SHU Tab -->
                <div class="tab-content" id="shu">
                    <div class="page-title">
                        <h1>Laporan SHU (Sisa Hasil Usaha)</h1>
                        <button class="btn btn-primary" id="cetakSHUBtn"><i class="fas fa-print"></i> Cetak Laporan</button>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Pembagian SHU Tahun <span id="currentYear"></span></h2>
                        </div>
                        <table id="shuTable">
                            <thead>
                                <tr>
                                    <th>Keterangan</th>
                                    <th>Persentase</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi secara dinamis -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pengaturan Tab -->
                <div class="tab-content" id="pengaturan">
                    <div class="page-title">
                        <h1>Pengaturan Sistem & User</h1>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            <h2>Data Admin</h2>
                        </div>
                        <form id="adminForm">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" class="form-control" value="admin_koperasi">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" class="form-control" value="admin@koperasiasmaratani.id">
                            </div>
                            <div class="form-group">
                                <label for="role">Role</label>
                                <select id="role" class="form-control">
                                    <option value="admin">Admin</option>
                                    <option value="pengurus">Pengurus</option>
                                    <option value="bendahara">Bendahara</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="foto">Ganti Foto Profil</label>
                                <input type="file" id="foto" class="form-control" accept="image/*">
                            </div>
                            <div class="form-group">
                                <label for="norek">No Rekening Admin</label>
                                <input type="text" id="norek" class="form-control" placeholder="Masukkan nomor rekening" value="1234-5678-9012-3456">
                            </div>
                            <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="footer">
                <p>&copy; <span id="currentYearFooter"></span> Koperasi Asmara Tani  Dashboard Admin</p>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL TAMBAH ANGGOTA MODERN ==================== -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="memberModalTitle">Tambah Anggota Baru</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                <form id="memberForm">
                    <input type="hidden" id="memberId">
                    
                    <!-- SECTION 1: FOTO PROFIL -->
                    <div class="form-section-title">
                        <i class="fas fa-user-circle"></i> Foto Profil
                    </div>
                    
                    <div class="form-card-group" style="text-align: center; background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                        <div class="foto-profil-container">
                            <div class="foto-profil-placeholder" id="fotoProfilPlaceholder">
                                <i class="fas fa-user"></i>
                            </div>
                            <div id="fotoProfilImg" style="display: none;"></div>
                            <button type="button" class="upload-foto-btn" id="uploadFotoBtn">
                                <i class="fas fa-camera"></i>
                            </button>
                            <input type="file" id="fotoMember" accept="image/*" style="display: none;">
                        </div>
                        <div style="margin-top: 10px;">
                            <p style="color: var(--gray); font-size: 0.85rem; margin-bottom: 5px;">
                                Klik ikon kamera untuk upload foto
                            </p>
                            <p style="color: var(--gray); font-size: 0.75rem;">
                                Format: JPG/PNG, Maks: 2MB
                            </p>
                        </div>
                    </div>
                    
                    <!-- SECTION 2: DATA DASAR -->
                    <div class="form-section-title">
                        <i class="fas fa-id-card"></i> Data Dasar
                    </div>
                    
                    <div class="form-grid-responsive">
                        <!-- ID/NIA (Automatic but editable) -->
                        <div class="form-card-group">
                            <label for="nia" class="required">ID/NIA Anggota</label>
                            <div class="input-group-modern">
                                <span class="prefix">NIA-</span>
                                <input type="text" id="nia" class="form-control" 
                                       placeholder="001" required
                                       pattern="[0-9]{3,6}"
                                       title="Format: 3-6 digit angka">
                                <span class="suffix">
                                    <i class="fas fa-hashtag"></i>
                                </span>
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> ID akan digenerate otomatis
                            </div>
                        </div>
                        
                        <!-- Posisi -->
                        <div class="form-card-group">
                            <label for="posisi" class="required">Posisi</label>
                            <select id="posisi" class="form-control" required style="background: white;">
                                <option value="">Pilih Posisi</option>
                                <option value="Ketua">Ketua</option>
                                <option value="Wakil Ketua">Wakil Ketua</option>
                                <option value="Sekretaris">Sekretaris</option>
                                <option value="Bendahara">Bendahara</option>
                                <option value="Pengawas">Pengawas</option>
                                <option value="Anggota Biasa" selected>Anggota Biasa</option>
                            </select>
                        </div>
                        
                        <!-- Nama Lengkap -->
                        <div class="form-card-group">
                            <label for="nama" class="required">Nama Lengkap</label>
                            <input type="text" id="nama" class="form-control" 
                                   placeholder="Masukkan nama lengkap" required>
                        </div>
                        
                        <!-- Jenis Kelamin -->
                        <div class="form-card-group">
                            <label for="jenisKelamin" class="required">Jenis Kelamin</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="jenisKelamin" value="Laki-laki" required 
                                           style="margin-right: 8px;" checked>
                                    <i class="fas fa-male" style="color: var(--info); margin-right: 5px;"></i>
                                    Laki-laki
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="jenisKelamin" value="Perempuan" required 
                                           style="margin-right: 8px;">
                                    <i class="fas fa-female" style="color: var(--accent); margin-right: 5px;"></i>
                                    Perempuan
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SECTION 3: KONTAK & IDENTITAS -->
                    <div class="form-section-title">
                        <i class="fas fa-address-book"></i> Kontak & Identitas
                    </div>
                    
                    <div class="form-grid-responsive">
                        <!-- Email -->
                        <div class="form-card-group">
                            <label for="emailMember" class="required">Email</label>
                            <div class="input-group-modern">
                                <span class="prefix">
                                    <i class="fas fa-envelope"></i>
                                </span>
                                <input type="email" id="emailMember" class="form-control" 
                                       placeholder="nama@email.com" required>
                            </div>
                        </div>
                        
                        <!-- WhatsApp -->
                        <div class="form-card-group">
                            <label for="whatsapp" class="required">WhatsApp</label>
                            <div class="input-group-modern">
                                <span class="prefix">
                                    <i class="fab fa-whatsapp" style="color: #25D366;"></i>
                                </span>
                                <input type="tel" id="whatsapp" class="form-control" 
                                       placeholder="6281234567890" required
                                       pattern="^[0-9]{10,15}$">
                            </div>
                        </div>
                        
                        <!-- NIK -->
                        <div class="form-card-group">
                            <label for="nik" class="required">NIK KTP</label>
                            <input type="text" id="nik" class="form-control" 
                                   placeholder="16 digit NIK" required
                                   pattern="[0-9]{16}"
                                   title="Masukkan 16 digit NIK">
                        </div>
                        
                        <!-- Agama -->
                        <div class="form-card-group">
                            <label for="agama" class="required">Agama</label>
                            <select id="agama" class="form-control" required style="background: white;">
                                <option value="">Pilih Agama</option>
                                <option value="Islam" selected>Islam</option>
                                <option value="Kristen">Kristen</option>
                                <option value="Katolik">Katolik</option>
                                <option value="Hindu">Hindu</option>
                                <option value="Budha">Budha</option>
                                <option value="Konghucu">Konghucu</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- SECTION 4: ALAMAT -->
                    <div class="form-section-title">
                        <i class="fas fa-map-marker-alt"></i> Alamat
                    </div>
                    
                    <div class="form-card-group">
                        <label for="alamat" class="required">Alamat Lengkap</label>
                        <textarea id="alamat" class="form-control" rows="3" 
                                  placeholder="Jl. Contoh No. 123, Kelurahan, Kecamatan, Kota, Provinsi"
                                  required maxlength="200"></textarea>
                        <div style="display: flex; justify-content: flex-end; margin-top: 8px;">
                            <span id="alamatCounter" style="font-size: 0.75rem; color: var(--gray);">
                                0/200 karakter
                            </span>
                        </div>
                    </div>
                    
                    <!-- SECTION 5: SIMPANAN -->
                    <div class="form-section-title">
                        <i class="fas fa-piggy-bank"></i> Simpanan Awal
                    </div>
                    
                    <div class="form-grid-responsive">
                        <!-- Simpanan Pokok -->
                        <div class="simpanan-card-modern pokok">
                            <label for="simpananPokok">
                                <i class="fas fa-landmark" style="color: var(--primary); margin-right: 8px;"></i>
                                Simpanan Pokok
                            </label>
                            <div class="input-group-modern" style="margin-top: 10px;">
                                <span class="prefix">Rp</span>
                                <input type="number" id="simpananPokok" class="form-control" 
                                       value="0" min="0" step="5000">
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> Minimal Rp 200.000, dibayar sekali
                            </div>
                        </div>
                        
                        <!-- Simpanan Wajib -->
                        <div class="simpanan-card-modern wajib">
                            <label for="simpananWajib">
                                <i class="fas fa-calendar-check" style="color: var(--secondary); margin-right: 8px;"></i>
                                Simpanan Wajib
                            </label>
                            <div class="input-group-modern" style="margin-top: 10px;">
                                <span class="prefix">Rp</span>
                                <input type="number" id="simpananWajib" class="form-control" 
                                       value="0" min="0" step="5000">
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> Minimal Rp 20.000, dibayar setiap bulan
                            </div>
                        </div>
                        
                        <!-- Simpanan Sukarela -->
                        <div class="simpanan-card-modern sukarela">
                            <label for="simpananSukarela">
                                <i class="fas fa-hand-holding-heart" style="color: var(--accent); margin-right: 8px;"></i>
                                Simpanan Sukarela
                            </label>
                            <div class="input-group-modern" style="margin-top: 10px;">
                                <span class="prefix">Rp</span>
                                <input type="number" id="simpananSukarela" class="form-control" 
                                       value="0" min="0" step="1000">
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> Opsional, sesuai kemampuan
                            </div>
                        </div>
                    </div>
                    
                    <!-- TOTAL SIMPANAN -->
                    <div class="total-simpanan-display">
                        <div class="total-simpanan-label">TOTAL SIMPANAN AWAL</div>
                        <div class="total-simpanan-amount" id="totalSimpananDisplay">Rp 220.000</div>
                        <div class="total-simpanan-detail">
                            <div>Pokok: <span id="detailPokok">Rp 0</span></div>
                            <div>Wajib: <span id="detailWajib">Rp 0</span></div>
                            <div>Sukarela: <span id="detailSukarela">Rp 0</span></div>
                        </div>
                    </div>
                    
                    <!-- SECTION 6: PASSWORD -->
                    <div class="form-section-title">
                        <i class="fas fa-lock"></i> Keamanan
                    </div>
                    
                    <div class="form-grid-responsive">
                        <div class="form-card-group">
                            <label for="passwordMember" class="required">Password Login</label>
                            <div class="password-container">
                                <input type="password" id="passwordMember" class="form-control" 
                                       placeholder="Minimal 6 karakter" required
                                       minlength="6">
                                <button type="button" class="toggle-password" id="togglePasswordMember">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-shield-alt"></i> Untuk login dashboard anggota
                            </div>
                        </div>
                        
                        <!-- Tanggal Daftar -->
                        <div class="form-card-group">
                            <label for="tanggalDaftar">Tanggal Bergabung</label>
                            <input type="date" id="tanggalDaftar" class="form-control" required>
                        </div>
                    </div>
                    
                    <!-- SECTION 7: STATUS -->
                    <div class="form-section-title">
                        <i class="fas fa-user-check"></i> Status
                    </div>
                    
                    <div class="form-card-group">
                        <label for="statusAktif" class="required">Status Keanggotaan</label>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 15px; 
                                   background: rgba(76, 175, 80, 0.1); border-radius: 8px; border: 2px solid rgba(76, 175, 80, 0.3);">
                                <input type="radio" name="statusAktif" value="Aktif" required 
                                       style="margin-right: 8px;" checked>
                                <i class="fas fa-check-circle" style="color: var(--success); margin-right: 5px;"></i>
                                Aktif
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 15px; 
                                   background: rgba(244, 67, 54, 0.1); border-radius: 8px; border: 2px solid rgba(244, 67, 54, 0.3);">
                                <input type="radio" name="statusAktif" value="Tidak Aktif" required 
                                       style="margin-right: 8px;">
                                <i class="fas fa-times-circle" style="color: var(--danger); margin-right: 5px;"></i>
                                Tidak Aktif
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 15px; 
                                   background: rgba(255, 193, 7, 0.1); border-radius: 8px; border: 2px solid rgba(255, 193, 7, 0.3);">
                                <input type="radio" name="statusAktif" value="Menunggu" required 
                                       style="margin-right: 8px;">
                                <i class="fas fa-clock" style="color: var(--warning); margin-right: 5px;"></i>
                                Menunggu
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelMemberBtn" style="padding: 12px 25px;">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="btn btn-primary" id="saveMemberBtn" style="padding: 12px 30px;">
                    <i class="fas fa-save"></i> Simpan Data Anggota
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Detail Anggota -->
    <div class="modal" id="detailAnggotaModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Detail Anggota</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="detailAnggotaContent">
                <!-- Detail anggota akan dimuat di sini -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="document.getElementById('detailAnggotaModal').style.display='none'">Tutup</button>
                <button class="btn btn-primary" id="editDetailBtn">Edit</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Simpanan -->
    <div class="modal" id="addSimpananModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="simpananModalTitle">Tambah Simpanan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="simpananForm">
                    <input type="hidden" id="simpananId">
                    <div class="form-group">
                        <label for="idAnggotaSimpanan">ID Anggota <span class="required">*</span></label>
                        <select id="idAnggotaSimpanan" class="form-control" required>
                            <option value="">Pilih Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jenisSimpanan">Jenis Simpanan <span class="required">*</span></label>
                        <select id="jenisSimpanan" class="form-control" required>
                            <option value="">Pilih Jenis</option>
                            <option value="Pokok">Pokok</option>
                            <option value="Wajib">Wajib</option>
                            <option value="Sukarela">Sukarela</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tanggalSimpanan">Tanggal Setor <span class="required">*</span></label>
                        <input type="date" id="tanggalSimpanan" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="nominalSimpanan">Nominal <span class="required">*</span></label>
                        <input type="number" id="nominalSimpanan" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelSimpananBtn">Batal</button>
                <button class="btn btn-primary" id="saveSimpananBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Pinjaman -->
    <div class="modal" id="addPinjamanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pinjamanModalTitle">Tambah Pinjaman</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="pinjamanForm">
                    <input type="hidden" id="pinjamanId">
                    <div class="form-group">
                        <label for="idAnggotaPinjaman">ID Anggota <span class="required">*</span></label>
                        <select id="idAnggotaPinjaman" class="form-control" required>
                            <option value="">Pilih Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jumlahPinjaman">Jumlah Pinjaman <span class="required">*</span></label>
                        <input type="number" id="jumlahPinjaman" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="tanggalPinjaman">Tanggal Pinjam <span class="required">*</span></label>
                        <input type="date" id="tanggalPinjaman" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="jangkaWaktu">Jangka Waktu <span class="required">*</span></label>
                        <select id="jangkaWaktu" class="form-control" required>
                            <option value="">Pilih Jangka Waktu</option>
                            <option value="6 Bulan">6 Bulan</option>
                            <option value="12 Bulan">12 Bulan</option>
                            <option value="24 Bulan">24 Bulan</option>
                            <option value="36 Bulan">36 Bulan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bungaPinjaman">Bunga (%) <span class="required">*</span></label>
                        <input type="number" id="bungaPinjaman" class="form-control" step="0.1" value="1.5" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelPinjamanBtn">Batal</button>
                <button class="btn btn-primary" id="savePinjamanBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Barang -->
    <div class="modal" id="addBarangModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="barangModalTitle">Tambah Barang</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="barangForm">
                    <input type="hidden" id="barangId">
                    <div class="form-group">
                        <label for="namaBarang">Nama Barang <span class="required">*</span></label>
                        <input type="text" id="namaBarang" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="stokBarang">Stok <span class="required">*</span></label>
                        <input type="number" id="stokBarang" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hargaBeli">Harga Beli <span class="required">*</span></label>
                        <input type="number" id="hargaBeli" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hargaJual">Harga Jual <span class="required">*</span></label>
                        <input type="number" id="hargaJual" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelBarangBtn">Batal</button>
                <button class="btn btn-primary" id="saveBarangBtn">SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- Modal Konfirmasi Hapus -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <div class="confirm-header">
                <h3>Konfirmasi Hapus</h3>
            </div>
            <div class="confirm-body">
                <p id="confirmMessage">Apakah Anda yakin ingin menghapus data ini?</p>
            </div>
            <div class="confirm-footer">
                <button class="btn btn-outline" id="cancelDeleteBtn">Batal</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Modal Import Excel -->
    <div class="modal" id="importExcelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Data dari Excel</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="excelFile">Pilih File Excel</label>
                    <input type="file" id="excelFile" class="form-control" accept=".xlsx, .xls">
                </div>
                <div class="form-group">
                    <label for="importType">Jenis Data</label>
                    <select id="importType" class="form-control">
                        <option value="anggota">Data Anggota</option>
                        <option value="simpanan">Data Simpanan</option>
                        <option value="pinjaman">Data Pinjaman</option>
                        <option value="barang">Data Barang</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelImportBtn">Batal</button>
                <button class="btn btn-primary" id="confirmImportBtn">Import</button>
            </div>
        </div>
    </div>

    <!-- Preview Print Modal -->
    <div class="modal" id="printPreviewModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Preview Cetak Laporan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="printPreviewContent">
                <!-- Preview cetak akan diisi di sini -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="tutupModalPrint()">Tutup</button>
                <button class="btn btn-primary" onclick="cetakLaporanSekarang()"><i class="fas fa-print"></i> Cetak</button>
            </div>
        </div>
    </div>

    <script>
    // ===== VARIABEL GLOBAL =====
    let anggotaData = [];
    let simpananData = [];
    let pinjamanData = [];
    let barangData = [];
    let transaksiData = [];
    let shuData = [];
    let currentEditingId = null;
    let currentEditingType = null;
    let financeChart = null;

    // ===== FIX 1: PERBAIKAN SIDEBAR NAVIGATION =====
    function fixSidebarNavigation() {
        console.log('Fixing sidebar navigation...');
        
        // Tab navigation dengan auto close sidebar di mobile
        document.querySelectorAll('.sidebar-menu a[data-tab]').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Close sidebar di mobile
                if (window.innerWidth <= 992) {
                    document.getElementById('sidebar').classList.remove('active');
                }
                
                // Remove active class from all
                document.querySelectorAll('.sidebar-menu a').forEach(i => {
                    i.classList.remove('active');
                });
                
                // Add active to clicked
                this.classList.add('active');
                
                // Show corresponding tab
                const tabId = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                    tab.style.display = 'none';
                });
                
                const targetTab = document.getElementById(tabId);
                if (targetTab) {
                    targetTab.classList.add('active');
                    targetTab.style.display = 'block';
                    
                    // Scroll to top
                    window.scrollTo(0, 0);
                    
                    // Refresh data based on tab
                    switch(tabId) {
                        case 'dashboard':
                            fixFinanceChart();
                            updateDashboardStats();
                            break;
                        case 'anggota':
                            refreshAnggotaTable();
                            break;
                        case 'simpanan':
                            refreshSimpananTable();
                            break;
                        case 'pinjaman':
                            refreshPinjamanTable();
                            break;
                        case 'laporan':
                            refreshLaporanTable();
                            break;
                        case 'unit-usaha':
                            refreshBarangTable();
                            break;
                        case 'shu':
                            refreshSHUTable();
                            break;
                        case 'pengaturan':
                            // Tidak perlu refresh
                            break;
                    }
                }
            });
        });
        
        // Menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebarClose');
        
        if (menuToggle) {
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
        }
        
        if (sidebarClose) {
            sidebarClose.addEventListener('click', () => {
                sidebar.classList.remove('active');
            });
        }
        
        // Close sidebar ketika klik di luar (untuk mobile)
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 992 && 
                sidebar.classList.contains('active') &&
                !sidebar.contains(e.target) && 
                !menuToggle.contains(e.target)) {
                sidebar.classList.remove('active');
            }
        });
        
        console.log(' Sidebar navigation fixed');
    }

    // ===== FIX 2: PERBAIKAN GRAFIK =====
    function fixFinanceChart() {
        console.log('Fixing finance chart...');
        
        // Check if canvas exists
        const ctx = document.getElementById('financeChart');
        if (!ctx) {
            console.error('Canvas element not found');
            return;
        }
        
        // Destroy existing chart
        if (financeChart) {
            financeChart.destroy();
        }
        
        // Get current month
        const now = new Date();
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
        const currentMonth = now.getMonth();
        
        // Prepare labels for last 6 months
        const labels = [];
        for (let i = 5; i >= 0; i--) {
            const monthIndex = (currentMonth - i + 12) % 12;
            labels.push(months[monthIndex]);
        }
        
        // Calculate data from simpanan
        const data = labels.map((month, index) => {
            const monthIndex = months.indexOf(month);
            const currentYear = now.getFullYear();
            
            // Filter simpanan by month
            const monthSimpanan = simpananData.filter(s => {
                const date = new Date(s.tanggalSetor);
                return date.getMonth() === monthIndex && date.getFullYear() === currentYear;
            });
            
            const total = monthSimpanan.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
            return total > 0 ? total : Math.floor(Math.random() * 3000000) + 1000000;
        });
        
        // Create chart
        financeChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Total Simpanan (Rp)',
                    data: data,
                    borderColor: '#2e7d32',
                    backgroundColor: 'rgba(46, 125, 50, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += 'Rp ' + context.parsed.y.toLocaleString('id-ID');
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                if (value >= 1000000) {
                                    return 'Rp ' + (value / 1000000).toFixed(1) + ' Jt';
                                }
                                return 'Rp ' + value.toLocaleString('id-ID');
                            }
                        }
                    }
                }
            }
        });
        
        console.log(' Finance chart fixed');
    }

    // ===== FIX 3: PERBAIKAN WAKTU REAL-TIME =====
    function fixRealTimeClock() {
        console.log('Fixing real-time clock...');
        
        function updateClock() {
            const now = new Date();
            
            // Nama hari dalam bahasa Indonesia
            const hariIndo = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            
            // Nama bulan dalam bahasa Indonesia
            const bulanIndo = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
            
            // Format waktu lengkap
            const hari = hariIndo[now.getDay()];
            const tanggal = now.getDate();
            const bulan = bulanIndo[now.getMonth()];
            const tahun = now.getFullYear();
            const jam = now.getHours().toString().padStart(2, '0');
            const menit = now.getMinutes().toString().padStart(2, '0');
            const detik = now.getSeconds().toString().padStart(2, '0');
            
            const timeString = `${hari}, ${tanggal} ${bulan} ${tahun} | ${jam}:${menit}:${detik} WIB`;
            
            // Update element
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.innerHTML = `<i class="fas fa-clock"></i> ${timeString}`;
            }
        }
        
        // Update immediately and set interval
        updateClock();
        setInterval(updateClock, 1000);
        
        console.log(' Real-time clock fixed');
    }

    // ===== FIX 4: PERBAIKAN TOMBOL AKSI =====
    function fixActionButtons() {
        console.log('Fixing action buttons...');
        
        // Refresh Chart Button
        const refreshChartBtn = document.getElementById('refreshChart');
        if (refreshChartBtn) {
            refreshChartBtn.addEventListener('click', () => {
                fixFinanceChart();
                showNotification('Grafik diperbarui', 'success');
            });
        }
        
        // Chart Type Buttons
        const yearlyChartBtn = document.getElementById('yearlyChart');
        const monthlyChartBtn = document.getElementById('monthlyChart');
        
        if (yearlyChartBtn) {
            yearlyChartBtn.addEventListener('click', () => {
                showNotification('Menampilkan grafik tahunan', 'info');
            });
        }
        
        if (monthlyChartBtn) {
            monthlyChartBtn.addEventListener('click', () => {
                showNotification('Menampilkan grafik bulanan', 'info');
            });
        }
        
        // Lihat Semua Buttons
        const lihatSemuaNotifBtn = document.getElementById('lihatSemuaNotif');
        const lihatSemuaPinjamanBtn = document.getElementById('lihatSemuaPinjaman');
        const lihatSemuaAnggotaBtn = document.getElementById('lihatSemuaAnggota');
        
        if (lihatSemuaNotifBtn) {
            lihatSemuaNotifBtn.addEventListener('click', () => {
                bukaModalNotifikasiLengkap();
            });
        }
        
        if (lihatSemuaPinjamanBtn) {
            lihatSemuaPinjamanBtn.addEventListener('click', () => {
                document.querySelector('[data-tab="pinjaman"]').click();
            });
        }
        
        if (lihatSemuaAnggotaBtn) {
            lihatSemuaAnggotaBtn.addEventListener('click', () => {
                document.querySelector('[data-tab="anggota"]').click();
            });
        }
        
        // Export/Import Excel Buttons
        const exportExcelBtn = document.getElementById('exportExcelBtn');
        const importExcelBtn = document.getElementById('importExcelBtn');
        
        if (exportExcelBtn) {
            exportExcelBtn.addEventListener('click', exportToExcel);
        }
        
        if (importExcelBtn) {
            importExcelBtn.addEventListener('click', () => {
                document.getElementById('importExcelModal').style.display = 'flex';
            });
        }
        
        // Tambah Anggota Button
        const addMemberBtn = document.getElementById('addMemberBtn');
        if (addMemberBtn) {
            addMemberBtn.addEventListener('click', () => {
                openAddMemberModal();
            });
        }
        
        // Tambah Simpanan Button
        const addSimpananBtn = document.getElementById('addSimpananBtn');
        if (addSimpananBtn) {
            addSimpananBtn.addEventListener('click', () => {
                showNotification('Fitur tambah simpanan akan segera tersedia!', 'info');
            });
        }
        
        console.log(' Action buttons fixed');
    }

    // ===== FIX 5: FUNGSI LOAD DATA =====
    function loadLocalStorageData() {
        console.log('Loading data from localStorage...');
        
        try {
            anggotaData = JSON.parse(localStorage.getItem('koperasi_anggota')) || JSON.parse(localStorage.getItem('anggotaData')) || [];
            simpananData = JSON.parse(localStorage.getItem('simpananData')) || [];
            pinjamanData = JSON.parse(localStorage.getItem('pinjamanData')) || [];
            barangData = JSON.parse(localStorage.getItem('barangData')) || [];
            transaksiData = JSON.parse(localStorage.getItem('transaksiData')) || [];
            shuData = JSON.parse(localStorage.getItem('shuData')) || [];
            
            console.log('Data loaded:', {
                anggota: anggotaData.length,
                simpanan: simpananData.length,
                pinjaman: pinjamanData.length,
                barang: barangData.length
            });
            
            // Jika data kosong, tambahkan contoh data
            if (anggotaData.length === 0) {
                loadInitialData();
            }
            
        } catch (error) {
            console.error('Error loading localStorage data:', error);
        }
    }

    // ===== FIX 6: FUNGSI UPDATE DASHBOARD =====
    function updateDashboardStats() {
        // Total Anggota
        document.getElementById('totalAnggota').textContent = anggotaData.length || '0';
        
        // Total Simpanan
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        document.getElementById('totalSimpanan').textContent = totalSimpanan > 0 ? formatRupiah(totalSimpanan) : 'Rp 0';
        
        // Total Pinjaman Aktif (default 0)
        const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
        document.getElementById('totalPinjaman').textContent = totalPinjaman > 0 ? formatRupiah(totalPinjaman) : 'Rp 0';
        
        // Total SHU (default 0)
        const totalSHU = totalSimpanan * 0.1;
        document.getElementById('totalSHU').textContent = totalSHU > 0 ? formatRupiah(totalSHU) : 'Rp 0';
        
        // Total KAS = Total Simpanan
        document.getElementById('totalKas').textContent = totalSimpanan > 0 ? formatRupiah(totalSimpanan) : 'Rp 0';
        
        // Update juga tabel
        updatePinjamanTerbaruTable();
        updateAnggotaBaruTable();
        updateActivityList();
    }

    // ===== FIX 7: FUNGSI REFRESH TABEL =====
    function refreshAnggotaTable() {
        const tableBody = document.querySelector('#anggotaFullTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        if (anggotaData.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="9" style="text-align: center; padding: 30px; color: #666;">
                        <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px; display: block; color: var(--gray-light);"></i>
                        Belum ada data anggota
                    </td>
                </tr>
            `;
            return;
        }
        
        anggotaData.forEach(member => {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${member.nia || member.id}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        ${member.foto ? 
                            `<img src="${member.foto}" style="width: 35px; height: 35px; border-radius: 50%; object-fit: cover;">` : 
                            `<div style="width: 35px; height: 35px; border-radius: 50%; background: var(--primary-light); display: flex; align-items: center; justify-content: center; color: white;">
                                <i class="fas fa-user"></i>
                            </div>`
                        }
                        <span>${member.nama}</span>
                    </div>
                </td>
                <td>${member.nik || '-'}</td>
                <td>${member.jenisKelamin}</td>
                <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    ${member.alamat}
                </td>
                <td>${member.whatsapp}</td>
                <td>${member.tanggalDaftar}</td>
                <td>
                    <span class="badge ${member.statusAktif === 'Aktif' ? 'badge-success' : member.statusAktif === 'Tidak Aktif' ? 'badge-danger' : 'badge-warning'} badge-responsive">
                        ${member.statusAktif}
                    </span>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="btn btn-outline btn-sm view-member" data-id="${member.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-outline btn-sm edit-member" data-id="${member.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline btn-sm delete-member" data-id="${member.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners untuk aksi
        document.querySelectorAll('.view-member').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                viewMemberDetail(memberId);
            });
        });
        
        document.querySelectorAll('.edit-member').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                editMemberNew(memberId);
            });
        });
        
        document.querySelectorAll('.delete-member').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                showDeleteConfirm(memberId, 'anggota');
            });
        });
    }

    function refreshSimpananTable() {
        const tableBody = document.querySelector('#simpananTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        // Filter berdasarkan tab aktif
        const activeTab = document.querySelector('.tabs .tab.active');
        const tabType = activeTab ? activeTab.getAttribute('data-simpanan-tab') : 'pokok';
        
        const filteredData = simpananData.filter(s => 
            s.jenisSimpanan.toLowerCase().includes(tabType.toLowerCase())
        );
        
        if (filteredData.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 30px; color: #666;">
                        <i class="fas fa-hand-holding-usd" style="font-size: 2rem; margin-bottom: 10px; display: block; color: var(--gray-light);"></i>
                        Belum ada data simpanan
                    </td>
                </tr>
            `;
            return;
        }
        
        filteredData.forEach(simpanan => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${simpanan.idAnggota}</td>
                <td>${simpanan.nama}</td>
                <td>${simpanan.jenisSimpanan}</td>
                <td>${simpanan.tanggalSetor}</td>
                <td>Rp ${simpanan.nominal.toLocaleString('id-ID')}</td>
                <td>Rp ${calculateTotalSimpanan(simpanan.idAnggota, simpanan.jenisSimpanan).toLocaleString('id-ID')}</td>
                <td>
                    <button class="btn btn-outline btn-sm edit-simpanan" data-id="${simpanan.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm delete-simpanan" data-id="${simpanan.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners
        document.querySelectorAll('.edit-simpanan').forEach(btn => {
            btn.addEventListener('click', function() {
                const simpananId = this.getAttribute('data-id');
                editSimpanan(simpananId);
            });
        });
        
        document.querySelectorAll('.delete-simpanan').forEach(btn => {
            btn.addEventListener('click', function() {
                const simpananId = this.getAttribute('data-id');
                showDeleteConfirm(simpananId, 'simpanan');
            });
        });
    }

    function refreshPinjamanTable() {
        const tableBody = document.querySelector('#pinjamanFullTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        if (pinjamanData.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="9" style="text-align: center; padding: 30px; color: #666;">
                        <i class="fas fa-file-invoice-dollar" style="font-size: 2rem; margin-bottom: 10px; display: block; color: var(--gray-light);"></i>
                        Belum ada data pinjaman
                    </td>
                </tr>
            `;
            return;
        }
        
        pinjamanData.forEach(pinjaman => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${pinjaman.id}</td>
                <td>${pinjaman.namaAnggota}</td>
                <td>Rp ${pinjaman.jumlahPinjaman.toLocaleString('id-ID')}</td>
                <td>${pinjaman.tanggalPinjam}</td>
                <td>${pinjaman.jangkaWaktu}</td>
                <td>${pinjaman.bunga}%</td>
                <td>Rp ${pinjaman.sisaHutang.toLocaleString('id-ID')}</td>
                <td><span class="badge badge-success">${pinjaman.status}</span></td>
                <td>
                    <div class="action-buttons">
                        <button class="btn btn-outline btn-sm edit-pinjaman" data-id="${pinjaman.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline btn-sm delete-pinjaman" data-id="${pinjaman.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners untuk edit pinjaman
        document.querySelectorAll('.edit-pinjaman').forEach(btn => {
            btn.addEventListener('click', function() {
                const pinjamanId = this.getAttribute('data-id');
                editPinjaman(pinjamanId);
            });
        });
        
        // Attach event listeners untuk delete pinjaman
        document.querySelectorAll('.delete-pinjaman').forEach(btn => {
            btn.addEventListener('click', function() {
                const pinjamanId = this.getAttribute('data-id');
                showDeleteConfirm(pinjamanId, 'pinjaman');
            });
        });
    }

    function refreshBarangTable() {
        const tableBody = document.querySelector('#barangTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        if (barangData.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 30px; color: #666;">
                        <i class="fas fa-shopping-cart" style="font-size: 2rem; margin-bottom: 10px; display: block; color: var(--gray-light);"></i>
                        Belum ada data barang
                    </td>
                </tr>
            `;
            return;
        }
        
        barangData.forEach(barang => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${barang.id}</td>
                <td>${barang.namaBarang}</td>
                <td>
                    <span class="badge ${barang.stok > 10 ? 'badge-success' : barang.stok > 0 ? 'badge-warning' : 'badge-danger'} badge-responsive">
                        ${barang.stok} unit
                    </span>
                </td>
                <td>Rp ${barang.hargaBeli.toLocaleString('id-ID')}</td>
                <td>Rp ${barang.hargaJual.toLocaleString('id-ID')}</td>
                <td>Rp ${barang.laba.toLocaleString('id-ID')}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn btn-outline btn-sm edit-barang" data-id="${barang.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline btn-sm delete-barang" data-id="${barang.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Attach event listeners untuk edit barang
        document.querySelectorAll('.edit-barang').forEach(btn => {
            btn.addEventListener('click', function() {
                const barangId = this.getAttribute('data-id');
                editBarang(barangId);
            });
        });
        
        // Attach event listeners untuk delete barang
        document.querySelectorAll('.delete-barang').forEach(btn => {
            btn.addEventListener('click', function() {
                const barangId = this.getAttribute('data-id');
                showDeleteConfirm(barangId, 'barang');
            });
        });
    }

    function refreshLaporanTable() {
        const tableBody = document.querySelector('#neracaTable tbody');
        if (!tableBody) return;
        
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
        const totalSHU = totalSimpanan * 0.1;
        const totalKas = Math.max(0, totalSimpanan - totalPinjaman);
        
        tableBody.innerHTML = `
            <tr>
                <td>Total Simpanan Anggota</td>
                <td>Rp ${totalSimpanan.toLocaleString('id-ID')}</td>
            </tr>
            <tr>
                <td>Total Pinjaman Aktif</td>
                <td>Rp ${totalPinjaman.toLocaleString('id-ID')}</td>
            </tr>
            <tr>
                <td>Total SHU</td>
                <td>Rp ${totalSHU.toLocaleString('id-ID')}</td>
            </tr>
            <tr>
                <td>Total Kas Koperasi</td>
                <td>Rp ${totalKas.toLocaleString('id-ID')}</td>
            </tr>
        `;
    }

    function refreshSHUTable() {
        const tableBody = document.querySelector('#shuTable tbody');
        if (!tableBody) return;
        
        const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
        const totalSHU = totalSimpanan * 0.1;
        
        tableBody.innerHTML = `
            <tr>
                <td>Cadangan Koperasi (20%)</td>
                <td>20%</td>
                <td>Rp ${(totalSHU * 0.2).toLocaleString('id-ID')}</td>
            </tr>
            <tr>
                <td>Dana Sosial (10%)</td>
                <td>10%</td>
                <td>Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</td>
            </tr>
            <tr>
                <td>Dana Pengurus (10%)</td>
                <td>10%</td>
                <td>Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</td>
            </tr>
            <tr>
                <td>Dana Karyawan (10%)</td>
                <td>10%</td>
                <td>Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</td>
            </tr>
            <tr>
                <td>Dana Pembangunan (10%)</td>
                <td>10%</td>
                <td>Rp ${(totalSHU * 0.1).toLocaleString('id-ID')}</td>
            </tr>
            <tr>
                <td>Dana Anggota (40%)</td>
                <td>40%</td>
                <td>Rp ${(totalSHU * 0.4).toLocaleString('id-ID')}</td>
            </tr>
            <tr style="font-weight: bold; background: #f8f9fa;">
                <td>TOTAL SHU</td>
                <td>100%</td>
                <td>Rp ${totalSHU.toLocaleString('id-ID')}</td>
            </tr>
        `;
    }

    // ===== FIX 8: FUNGSI TAMBAHAN =====
    function calculateTotalSimpanan(idAnggota, jenisSimpanan) {
        return simpananData
            .filter(s => s.idAnggota === idAnggota && s.jenisSimpanan === jenisSimpanan)
            .reduce((sum, s) => sum + s.nominal, 0);
    }

    function formatRupiah(amount) {
        if (amount === 0) return 'Rp 0';
        if (amount >= 1000000000) {
            return 'Rp ' + (amount / 1000000000).toFixed(1) + ' M';
        } else if (amount >= 1000000) {
            return 'Rp ' + (amount / 1000000).toFixed(1) + ' Jt';
        } else {
            return 'Rp ' + amount.toLocaleString('id-ID');
        }
    }

    function generateNIA() {
        const allMembers = [...anggotaData];
        
        let highestId = 0;
        
        allMembers.forEach(member => {
            if (member.id && member.id.startsWith('NIA-')) {
                const idNumber = parseInt(member.id.replace('NIA-', ''));
                if (idNumber > highestId) {
                    highestId = idNumber;
                }
            }
            
            if (member.nia && member.nia.startsWith('NIA-')) {
                const idNumber = parseInt(member.nia.replace('NIA-', ''));
                if (idNumber > highestId) {
                    highestId = idNumber;
                }
            }
        });
        
        const newIdNumber = highestId + 1;
        const newNIA = 'NIA-' + newIdNumber.toString().padStart(3, '0');
        
        return newNIA;
    }

    // ===== FIX 9: FUNGSI SAVE DATA ANGGOTA =====
    async function saveMemberData() {
        // Validasi required fields
        const requiredFields = ['nia', 'posisi', 'nama', 'alamat', 'emailMember', 'whatsapp', 'nik', 'passwordMember'];
        let isValid = true;
        
        requiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field && !field.value.trim()) {
                field.style.borderColor = 'var(--danger)';
                isValid = false;
            } else if (field) {
                field.style.borderColor = '';
            }
        });
        
        // Validasi jenis kelamin
        const jenisKelamin = document.querySelector('input[name="jenisKelamin"]:checked');
        if (!jenisKelamin) {
            showNotification('Pilih jenis kelamin!', 'error');
            return false;
        }
        
        // Validasi status aktif
        const statusAktif = document.querySelector('input[name="statusAktif"]:checked');
        if (!statusAktif) {
            showNotification('Pilih status keanggotaan!', 'error');
            return false;
        }
        
        if (!isValid) {
            showNotification('Harap lengkapi semua field yang wajib diisi!', 'error');
            return false;
        }
        
        // Validasi email
        const email = document.getElementById('emailMember').value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            showNotification('Format email tidak valid!', 'error');
            return false;
        }
        
        // Validasi password minimal 6 karakter
        const password = document.getElementById('passwordMember').value;
        if (password.length < 6) {
            showNotification('Password minimal 6 karakter!', 'error');
            return false;
        }
        
        // Validasi minimal simpanan
        const simpananPokok = parseFloat(document.getElementById('simpananPokok').value) || 0;
        const simpananWajib = parseFloat(document.getElementById('simpananWajib').value) || 0;
        
        if (simpananPokok < 0) {
            showNotification('Simpanan Pokok minimal Rp 0', 'error');
            document.getElementById('simpananPokok').style.borderColor = 'var(--danger)';
            return false;
        }
        
        if (simpananWajib < 0) {
            showNotification('Simpanan Wajib minimal Rp 0', 'error');
            document.getElementById('simpananWajib').style.borderColor = 'var(--danger)';
            return false;
        }
        
        // Format NIA
        let niaValue = document.getElementById('nia').value;
        niaValue = 'NIA-' + niaValue.padStart(3, '0');
        
        // Cek duplikasi NIA
        const memberId = document.getElementById('memberId').value;
        if (!memberId) {
            const isDuplicate = anggotaData.some(member => 
                member.id === niaValue || 
                member.nia === niaValue
            );
            
            if (isDuplicate) {
                showNotification('ID/NIA sudah terdaftar! Gunakan ID lain.', 'error');
                const newNIA = generateNIA();
                document.getElementById('nia').value = newNIA.replace('NIA-', '');
                return false;
            }
        }
        
        // Ambil data dari form
        const memberData = {
            id: niaValue,
            nia: niaValue,
            posisi: document.getElementById('posisi').value,
            nama: document.getElementById('nama').value,
            alamat: document.getElementById('alamat').value,
            jenisKelamin: jenisKelamin.value,
            agama: document.getElementById('agama').value,
            status: 'Belum Menikah',
            email: document.getElementById('emailMember').value,
            whatsapp: document.getElementById('whatsapp').value,
            nik: document.getElementById('nik').value,
            tanggalDaftar: document.getElementById('tanggalDaftar').value,
            statusAktif: statusAktif.value,
            password: password,
            
            // Data simpanan
            simpananPokok: simpananPokok,
            simpananWajib: simpananWajib,
            simpananSukarela: parseFloat(document.getElementById('simpananSukarela').value) || 0,
            totalSimpanan: calculateTotalSimpananValue(),
            
            // Foto
            foto: document.getElementById('fotoProfilImg').querySelector('img')?.src || '',
            
            // Timestamp
            createdAt: new Date().toISOString(),
            lastUpdated: new Date().toISOString()
        };
        
        // Cek apakah edit atau tambah baru
        if (memberId) {
            // EDIT anggota
            const index = anggotaData.findIndex(member => member.id === memberId);
            if (index !== -1) {
                anggotaData[index] = { ...anggotaData[index], ...memberData };
                showNotification('Data anggota berhasil diperbarui!', 'success');
            }
        } else {
            // TAMBAH anggota baru
            anggotaData.push(memberData);
            showNotification('Data anggota berhasil disimpan!', 'success');
        }
        
        // Simpan ke localStorage
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
        
        // Update dashboard
        updateDashboardStats();
        refreshAnggotaTable();
        
        return true;
    }

    function calculateTotalSimpananValue() {
        const pokok = parseFloat(document.getElementById('simpananPokok').value) || 0;
        const wajib = parseFloat(document.getElementById('simpananWajib').value) || 0;
        const sukarela = parseFloat(document.getElementById('simpananSukarela').value) || 0;
        return pokok + wajib + sukarela;
    }

    // ===== FIX 10: FUNGSI VIEW DETAIL ANGGOTA =====
    function viewMemberDetail(memberId) {
        const member = anggotaData.find(m => m.id === memberId);
        if (!member) return;
        
        const totalSimpanan = (member.simpananPokok || 0) + (member.simpananWajib || 0) + (member.simpananSukarela || 0);
        
        const detailHTML = `
            <div style="display: flex; gap: 25px; margin-bottom: 25px;">
                <!-- Foto Profil -->
                <div>
                    ${member.foto ? 
                        `<img src="${member.foto}" style="width: 150px; height: 150px; border-radius: 10px; object-fit: cover; border: 3px solid var(--primary-light);">` : 
                        `<div style="width: 150px; height: 150px; border-radius: 10px; background: linear-gradient(135deg, var(--primary-light), var(--primary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem;">
                            <i class="fas fa-user"></i>
                        </div>`
                    }
                </div>
                
                <!-- Info Utama -->
                <div style="flex: 1;">
                    <h3 style="color: var(--primary-dark); margin-bottom: 10px;">${member.nama}</h3>
                    <p style="color: var(--gray); margin-bottom: 5px;">
                        <i class="fas fa-id-card"></i> ${member.nia || member.id} | ${member.posisi}
                    </p>
                    <p style="color: var(--gray); margin-bottom: 5px;">
                        <i class="fas fa-envelope"></i> ${member.email}
                    </p>
                    <p style="color: var(--gray); margin-bottom: 5px;">
                        <i class="fab fa-whatsapp"></i> ${member.whatsapp}
                    </p>
                    <p style="color: var(--gray); margin-bottom: 5px;">
                        <i class="fas fa-venus-mars"></i> ${member.jenisKelamin} | ${member.agama}
                    </p>
                    <p style="color: var(--gray);">
                        <i class="fas fa-calendar-alt"></i> Bergabung: ${member.tanggalDaftar}
                    </p>
                </div>
                
                <!-- Status -->
                <div>
                    <span class="badge ${member.statusAktif === 'Aktif' ? 'badge-success' : 'badge-danger'}" style="font-size: 1rem; padding: 8px 15px;">
                        ${member.statusAktif}
                    </span>
                </div>
            </div>
            
            <!-- Grid Data Detail -->
            <div class="detail-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                <div>
                    <div class="detail-item">
                        <div class="detail-label">NIK KTP</div>
                        <div class="detail-value">${member.nik || '-'}</div>
                    </div>
                </div>
                
                <!-- FIELD PASSWORD BARU -->
                <div>
                    <div class="detail-item">
                        <div class="detail-label">Password Login</div>
                        <div class="detail-value">
                            <div class="password-container" style="position: relative;">
                                <input type="password" 
                                       value="${member.password || ''}" 
                                       readonly 
                                       id="viewPassword${member.id}"
                                       style="width: 100%; padding: 8px 12px; border: 1px solid var(--gray-light); border-radius: 6px; background: #f8f9fa;">
                                <button type="button" 
                                        class="toggle-password" 
                                        onclick="toggleViewPassword('${member.id}')"
                                        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--gray); cursor: pointer;">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="detail-item">
                        <div class="detail-label">Jenis Kelamin</div>
                        <div class="detail-value">${member.jenisKelamin}</div>
                    </div>
                </div>
                
                <div>
                    <div class="detail-item">
                        <div class="detail-label">Agama</div>
                        <div class="detail-value">${member.agama}</div>
                    </div>
                </div>
            </div>
            
            <!-- Alamat Lengkap -->
            <div style="margin-bottom: 25px;">
                <div class="detail-label">Alamat Lengkap</div>
                <div class="detail-value" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                    ${member.alamat || '-'}
                </div>
            </div>
            
            <!-- Detail Simpanan -->
            <div class="anggota-detail-section">
                <h4 style="color: var(--primary-dark); margin-bottom: 20px;">Detail Simpanan</h4>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px;">
                    <div class="simpanan-card" style="background: white; padding: 15px; border-radius: 10px; border: 1px solid var(--gray-light); position: relative;">
                        ${(member.simpananPokok || 0) >= 0 ? 
                            '<div style="position: absolute; top: 5px; right: 5px; color: var(--success);"><i class="fas fa-check-circle"></i></div>' : 
                            '<div style="position: absolute; top: 5px; right: 5px; color: var(--danger);"><i class="fas fa-times-circle"></i></div>'
                        }
                        <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 8px;">Simpanan Pokok</div>
                        <div style="font-size: 1.3rem; font-weight: bold; color: var(--primary);">
                            Rp ${(member.simpananPokok || 0).toLocaleString('id-ID')}
                        </div>
                        ${(member.simpananPokok || 0) < 0 ? 
                            '<div style="font-size: 0.75rem; color: var(--danger); margin-top: 5px;"><i class="fas fa-exclamation-triangle"></i> Belum memenuhi minimum</div>' : 
                            '<div style="font-size: 0.75rem; color: var(--success); margin-top: 5px;"><i class="fas fa-check"></i> Memenuhi syarat</div>'
                        }
                    </div>
                    
                    <div class="simpanan-card" style="background: white; padding: 15px; border-radius: 10px; border: 1px solid var(--gray-light); position: relative;">
                        ${(member.simpananWajib || 0) >= 0 ? 
                            '<div style="position: absolute; top: 5px; right: 5px; color: var(--success);"><i class="fas fa-check-circle"></i></div>' : 
                            '<div style="position: absolute; top: 5px; right: 5px; color: var(--danger);"><i class="fas fa-times-circle"></i></div>'
                        }
                        <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 8px;">Simpanan Wajib</div>
                        <div style="font-size: 1.3rem; font-weight: bold; color: var(--secondary);">
                            Rp ${(member.simpananWajib || 0).toLocaleString('id-ID')}
                        </div>
                        ${(member.simpananWajib || 0) < 0 ? 
                            '<div style="font-size: 0.75rem; color: var(--danger); margin-top: 5px;"><i class="fas fa-exclamation-triangle"></i> Belum memenuhi minimum</div>' : 
                            '<div style="font-size: 0.75rem; color: var(--success); margin-top: 5px;"><i class="fas fa-check"></i> Memenuhi syarat</div>'
                        }
                    </div>
                    
                    <div class="simpanan-card" style="background: white; padding: 15px; border-radius: 10px; border: 1px solid var(--gray-light); position: relative;">
                        <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 8px;">Simpanan Sukarela</div>
                        <div style="font-size: 1.3rem; font-weight: bold; color: var(--accent);">
                            Rp ${(member.simpananSukarela || 0).toLocaleString('id-ID')}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--info); margin-top: 5px;">
                            <i class="fas fa-heart"></i> Sukarela sesuai kemampuan
                        </div>
                    </div>
                </div>
                
                <!-- Total Simpanan -->
                <div style="background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 1rem; margin-bottom: 5px;">TOTAL SIMPANAN</div>
                    <div style="font-size: 2rem; font-weight: bold;">
                        Rp ${totalSimpanan.toLocaleString('id-ID')}
                    </div>
                    <div style="font-size: 0.85rem; opacity: 0.9; margin-top: 10px;">
                        Status: ${((member.simpananPokok || 0) >= 200000 && (member.simpananWajib || 0) >= 20000) ? 
                            '<span style="color: #c8e6c9;"><i class="fas fa-check-circle"></i> Simpanan memenuhi syarat</span>' : 
                            '<span style="color: #ffcdd2;"><i class="fas fa-exclamation-circle"></i> Simpanan belum memenuhi syarat minimum</span>'
                        }
                    </div>
                </div>
            </div>
            
            <!-- Informasi Tambahan -->
            <div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 0.9rem; color: var(--gray);">
                <div style="display: flex; justify-content: space-between;">
                    <div>
                        <i class="fas fa-clock"></i> Dibuat: ${new Date(member.createdAt).toLocaleString('id-ID')}
                    </div>
                    <div>
                        <i class="fas fa-sync-alt"></i> Terakhir update: ${new Date(member.lastUpdated).toLocaleString('id-ID')}
                    </div>
                </div>
            </div>
        `;
        
        // Update konten modal
        document.getElementById('detailAnggotaContent').innerHTML = detailHTML;
        
        // Update tombol edit
        const editDetailBtn = document.getElementById('editDetailBtn');
        if (editDetailBtn) {
            editDetailBtn.onclick = () => {
                editMemberNew(memberId);
                document.getElementById('detailAnggotaModal').style.display = 'none';
            };
        }
        
        // Tampilkan modal
        document.getElementById('detailAnggotaModal').style.display = 'flex';
    }

    function toggleViewPassword(memberId) {
        const passwordField = document.getElementById(`viewPassword${memberId}`);
        const toggleButton = passwordField.nextElementSibling;
        
        if (passwordField.type === 'password') {
            passwordField.type = 'text';
            toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
            passwordField.type = 'password';
            toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
        }
    }

    function editMemberNew(memberId) {
        const member = anggotaData.find(m => m.id === memberId);
        if (!member) return;
        
        // Set judul modal
        document.getElementById('memberModalTitle').textContent = 'Edit Data Anggota';
        document.getElementById('memberId').value = member.id;
        
        // Isi form dengan data member
        const niaNumber = member.nia ? member.nia.replace('NIA-', '') : member.id.replace('NIA-', '');
        document.getElementById('nia').value = niaNumber;
        document.getElementById('posisi').value = member.posisi;
        document.getElementById('nama').value = member.nama;
        document.getElementById('alamat').value = member.alamat;
        
        // Set jenis kelamin radio button
        document.querySelectorAll('input[name="jenisKelamin"]').forEach(radio => {
            if (radio.value === member.jenisKelamin) {
                radio.checked = true;
            }
        });
        
        document.getElementById('agama').value = member.agama;
        
        // Set status aktif radio button
        document.querySelectorAll('input[name="statusAktif"]').forEach(radio => {
            if (radio.value === member.statusAktif) {
                radio.checked = true;
            }
        });
        
        document.getElementById('emailMember').value = member.email;
        document.getElementById('whatsapp').value = member.whatsapp;
        document.getElementById('nik').value = member.nik;
        document.getElementById('tanggalDaftar').value = member.tanggalDaftar;
        document.getElementById('passwordMember').value = member.password || '';
        
        // Isi data simpanan
        document.getElementById('simpananPokok').value = member.simpananPokok || 0;
        document.getElementById('simpananWajib').value = member.simpananWajib || 0;
        document.getElementById('simpananSukarela').value = member.simpananSukarela || 0;
        
        // Update foto preview jika ada
        const fotoProfilPlaceholder = document.getElementById('fotoProfilPlaceholder');
        const fotoProfilImg = document.getElementById('fotoProfilImg');
        if (member.foto) {
            fotoProfilImg.innerHTML = `<img src="${member.foto}" class="foto-profil-img">`;
            fotoProfilImg.style.display = 'block';
            fotoProfilPlaceholder.style.display = 'none';
        } else {
            fotoProfilPlaceholder.style.display = 'flex';
            fotoProfilImg.style.display = 'none';
            fotoProfilImg.innerHTML = '';
        }
        
        // Hitung total simpanan
        updateTotalSimpananDisplay();
        
        // Update alamat counter
        const alamatCounter = document.getElementById('alamatCounter');
        if (alamatCounter) {
            const count = member.alamat ? member.alamat.length : 0;
            alamatCounter.textContent = `${count}/200 karakter`;
        }
        
        // Tampilkan modal
        document.getElementById('addMemberModal').style.display = 'flex';
    }

    function updateTotalSimpananDisplay() {
        const pokok = parseFloat(document.getElementById('simpananPokok').value) || 0;
        const wajib = parseFloat(document.getElementById('simpananWajib').value) || 0;
        const sukarela = parseFloat(document.getElementById('simpananSukarela').value) || 0;
        
        const total = pokok + wajib + sukarela;
        
        // Update total display
        const display = document.getElementById('totalSimpananDisplay');
        if (display) {
            display.textContent = `Rp ${total.toLocaleString('id-ID')}`;
        }
        
        // Update detail display
        document.getElementById('detailPokok').textContent = `Rp ${pokok.toLocaleString('id-ID')}`;
        document.getElementById('detailWajib').textContent = `Rp ${wajib.toLocaleString('id-ID')}`;
        document.getElementById('detailSukarela').textContent = `Rp ${sukarela.toLocaleString('id-ID')}`;
    }

    // ===== FIX 11: FUNGSI MODAL CONTROLS =====
    function setupModalControls() {
        console.log('Setting up modal controls...');
        
        // Close buttons untuk semua modal
        document.querySelectorAll('.modal-close, .btn-outline[id*="cancel"]').forEach(btn => {
            btn.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        // Close modal when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        });
        
        // Import Excel Modal Controls
        const cancelImportBtn = document.getElementById('cancelImportBtn');
        const confirmImportBtn = document.getElementById('confirmImportBtn');
        
        if (cancelImportBtn) {
            cancelImportBtn.addEventListener('click', () => {
                document.getElementById('importExcelModal').style.display = 'none';
            });
        }
        
        if (confirmImportBtn) {
            confirmImportBtn.addEventListener('click', () => {
                importExcelData();
            });
        }
        
        // Confirm Delete Modal Controls
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        
        if (cancelDeleteBtn) {
            cancelDeleteBtn.addEventListener('click', () => {
                document.getElementById('confirmModal').style.display = 'none';
            });
        }
        
        if (confirmDeleteBtn) {
            confirmDeleteBtn.addEventListener('click', async () => {
                await confirmDeleteData();
                document.getElementById('confirmModal').style.display = 'none';
            });
        }
        
        // Cancel Member Button
        const cancelMemberBtn = document.getElementById('cancelMemberBtn');
        if (cancelMemberBtn) {
            cancelMemberBtn.addEventListener('click', () => {
                document.getElementById('addMemberModal').style.display = 'none';
            });
        }
        
        // Save Member Button
        const saveMemberBtn = document.getElementById('saveMemberBtn');
        if (saveMemberBtn) {
            saveMemberBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                const success = await saveMemberData();
                if (success) {
                    document.getElementById('addMemberModal').style.display = 'none';
                }
            });
        }
        
        console.log(' Modal controls setup completed');
    }

    function showDeleteConfirm(id, type) {
        currentEditingId = id;
        currentEditingType = type;
        
        let message = '';
        switch(type) {
            case 'anggota':
                const member = anggotaData.find(m => m.id === id);
                message = `Apakah Anda yakin ingin menghapus anggota "${member?.nama}"?`;
                break;
            case 'simpanan':
                message = 'Apakah Anda yakin ingin menghapus data simpanan ini?';
                break;
            case 'pinjaman':
                const pinjaman = pinjamanData.find(p => p.id === id);
                message = `Apakah Anda yakin ingin menghapus pinjaman "${pinjaman?.namaAnggota}"?`;
                break;
            case 'barang':
                const barang = barangData.find(b => b.id === id);
                message = `Apakah Anda yakin ingin menghapus barang "${barang?.namaBarang}"?`;
                break;
        }
        
        document.getElementById('confirmMessage').textContent = message;
        document.getElementById('confirmModal').style.display = 'flex';
    }

    async function confirmDeleteData() {
        if (currentEditingType === 'anggota') {
            anggotaData = anggotaData.filter(member => member.id !== currentEditingId);
            localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
            localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
            refreshAnggotaTable();
            
        } else if (currentEditingType === 'simpanan') {
            simpananData = simpananData.filter(simpanan => simpanan.id !== currentEditingId);
            localStorage.setItem('simpananData', JSON.stringify(simpananData));
            refreshSimpananTable();
            
        } else if (currentEditingType === 'pinjaman') {
            pinjamanData = pinjamanData.filter(pinjaman => pinjaman.id !== currentEditingId);
            localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
            refreshPinjamanTable();
            
        } else if (currentEditingType === 'barang') {
            barangData = barangData.filter(barang => barang.id !== currentEditingId);
            localStorage.setItem('barangData', JSON.stringify(barangData));
            refreshBarangTable();
        }
        
        updateDashboardStats();
        showNotification('Data berhasil dihapus!', 'success');
    }

    // ===== FIX 12: FUNGSI NOTIFICATION =====
    function showNotification(message, type = 'info') {
        try {
            // Remove existing notification
            const existingNotif = document.querySelector('.sync-notification');
            if (existingNotif) {
                existingNotif.remove();
            }
            
            // Create notification
            const notification = document.createElement('div');
            notification.className = 'sync-notification';
            
            if (type === 'success') {
                notification.classList.add('success');
            } else if (type === 'error') {
                notification.classList.add('error');
            } else if (type === 'warning') {
                notification.classList.add('warning');
            }
            
            // Set icon
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            else if (type === 'error') icon = 'exclamation-circle';
            else if (type === 'warning') icon = 'exclamation-triangle';
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; padding: 12px 15px; background: #4285F4; color: white; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    <i class="fas fa-${icon}" style="font-size: 1.2rem;"></i>
                    <span style="flex: 1; font-size: 0.9rem;">${message}</span>
                    <button class="toast-close" style="background: none; border: none; color: white; cursor: pointer; padding: 2px 6px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Add close functionality
            const closeBtn = notification.querySelector('.toast-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    notification.style.animation = 'slideOutRight 0.3s ease forwards';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                });
            }
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.3s ease forwards';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 3000);
            
        } catch (error) {
            console.error('Error showing notification:', error);
            alert(message);
        }
    }

    // ===== FIX 13: FUNGSI UPDATE TABEL LAINNYA =====
    function updatePinjamanTerbaruTable() {
        const tableBody = document.querySelector('#pinjamanTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        // Ambil 5 pinjaman terbaru
        const pinjamanTerbaru = [...pinjamanData]
            .sort((a, b) => new Date(b.tanggalPinjam) - new Date(a.tanggalPinjam))
            .slice(0, 5);
        
        if (pinjamanTerbaru.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-info-circle"></i> Belum ada data pinjaman
                    </td>
                </tr>
            `;
            return;
        }
        
        pinjamanTerbaru.forEach(pinjaman => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${pinjaman.namaAnggota}</td>
                <td>${pinjaman.tanggalPinjam}</td>
                <td>Rp ${pinjaman.jumlahPinjaman.toLocaleString('id-ID')}</td>
                <td><span class="badge badge-success">${pinjaman.status}</span></td>
            `;
            tableBody.appendChild(row);
        });
    }

    function updateAnggotaBaruTable() {
        const tableBody = document.querySelector('#anggotaTable tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        // Ambil 5 anggota terbaru
        const anggotaTerbaru = [...anggotaData]
            .sort((a, b) => new Date(b.tanggalDaftar) - new Date(a.tanggalDaftar))
            .slice(0, 5);
        
        if (anggotaTerbaru.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="3" style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-info-circle"></i> Belum ada data anggota
                    </td>
                </tr>
            `;
            return;
        }
        
        anggotaTerbaru.forEach(anggota => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${anggota.nama}</td>
                <td>${anggota.tanggalDaftar}</td>
                <td><span class="badge badge-success">${anggota.statusAktif}</span></td>
            `;
            tableBody.appendChild(row);
        });
    }

    function updateActivityList() {
        const activityList = document.getElementById('activityList');
        if (!activityList) return;
        
        activityList.innerHTML = '';
        
        const activities = [
            { icon: 'fa-users', bgColor: 'bg-primary', title: 'Anggota Baru', desc: `${anggotaData.length} anggota terdaftar`, time: 'Baru saja' },
            { icon: 'fa-hand-holding-usd', bgColor: 'bg-success', title: 'Simpanan', desc: `${simpananData.length} transaksi simpanan`, time: 'Baru saja' },
            { icon: 'fa-file-invoice-dollar', bgColor: 'bg-warning', title: 'Pinjaman', desc: `${pinjamanData.length} pinjaman aktif`, time: 'Baru saja' },
            { icon: 'fa-chart-line', bgColor: 'bg-info', title: 'Laporan', desc: 'Dashboard aktif', time: 'Baru saja' }
        ];
        
        activities.forEach(activity => {
            const li = document.createElement('li');
            li.className = 'activity-item';
            li.innerHTML = `
                <div class="activity-icon ${activity.bgColor}">
                    <i class="fas ${activity.icon}"></i>
                </div>
                <div class="activity-content">
                    <h4>${activity.title}</h4>
                    <p>${activity.desc}</p>
                </div>
                <div class="activity-time">${activity.time}</div>
            `;
            activityList.appendChild(li);
        });
    }

    // ===== FIX 14: FUNGSI EXPORT EXCEL =====
    function exportToExcel() {
        try {
            const wb = XLSX.utils.book_new();
            
            // Sheet Data Anggota
            const wsAnggota = XLSX.utils.json_to_sheet(anggotaData.map(a => ({
                'ID_Anggota': a.id || '',
                'Posisi': a.posisi || '',
                'Nama_Lengkap': a.nama || '',
                'Alamat': a.alamat || '',
                'Jenis_Kelamin': a.jenisKelamin || '',
                'Agama': a.agama || '',
                'Status_Pernikahan': a.status || '',
                'Email': a.email || '',
                'WhatsApp': a.whatsapp || '',
                'NIK': a.nik || '',
                'Tanggal_Daftar': a.tanggalDaftar || '',
                'Status_Aktif': a.statusAktif || 'Aktif',
                'Total_Simpanan': a.totalSimpanan || 0,
                'Total_Pinjaman': a.totalPinjaman || 0,
                'Saldo': a.saldo || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsAnggota, 'Data Anggota');
            
            // Sheet Data Simpanan
            const wsSimpanan = XLSX.utils.json_to_sheet(simpananData.map(s => ({
                'ID_Simpanan': s.id || '',
                'ID_Anggota': s.idAnggota || '',
                'Nama_Anggota': s.nama || '',
                'Jenis_Simpanan': s.jenisSimpanan || '',
                'Tanggal_Setor': s.tanggalSetor || '',
                'Nominal': s.nominal || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsSimpanan, 'Data Simpanan');
            
            // Sheet Data Pinjaman
            const wsPinjaman = XLSX.utils.json_to_sheet(pinjamanData.map(p => ({
                'ID_Pinjaman': p.id || '',
                'ID_Anggota': p.idAnggota || '',
                'Nama_Anggota': p.namaAnggota || '',
                'Jumlah_Pinjaman': p.jumlahPinjaman || 0,
                'Tanggal_Pinjam': p.tanggalPinjam || '',
                'Jangka_Waktu': p.jangkaWaktu || '',
                'Bunga': p.bunga || 0,
                'Sisa_Hutang': p.sisaHutang || 0,
                'Status': p.status || ''
            })));
            XLSX.utils.book_append_sheet(wb, wsPinjaman, 'Data Pinjaman');
            
            // Sheet Data Barang
            const wsBarang = XLSX.utils.json_to_sheet(barangData.map(b => ({
                'ID_Barang': b.id || '',
                'Nama_Barang': b.namaBarang || '',
                'Stok': b.stok || 0,
                'Harga_Beli': b.hargaBeli || 0,
                'Harga_Jual': b.hargaJual || 0,
                'Laba': b.laba || 0
            })));
            XLSX.utils.book_append_sheet(wb, wsBarang, 'Data Barang');
            
            // Generate filename dengan timestamp
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-');
            const filename = `Data_Koperasi_Asmara_Tani_${timestamp}.xlsx`;
            
            XLSX.writeFile(wb, filename);
            showNotification('Data berhasil diexport ke Excel!', 'success');
            
        } catch (error) {
            console.error('Error exporting to Excel:', error);
            showNotification('Gagal mengexport data: ' + error.message, 'error');
        }
    }

    function importExcelData() {
        showNotification('Fitur import Excel akan segera tersedia!', 'info');
        document.getElementById('importExcelModal').style.display = 'none';
    }

    // ===== FIX 15: FUNGSI SETUP NEW MEMBER FORM =====
    function setupNewMemberForm() {
        console.log('Setting up new member form...');
        
        // Setup foto profil
        const fotoProfilPlaceholder = document.getElementById('fotoProfilPlaceholder');
        const fotoMember = document.getElementById('fotoMember');
        const uploadFotoBtn = document.getElementById('uploadFotoBtn');
        
        if (fotoProfilPlaceholder && uploadFotoBtn) {
            fotoProfilPlaceholder.addEventListener('click', () => fotoMember.click());
            uploadFotoBtn.addEventListener('click', () => fotoMember.click());
            
            fotoMember.addEventListener('change', function(e) {
                const file = this.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) {
                        showNotification('Ukuran file maksimal 2MB', 'error');
                        return;
                    }
                    
                    if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                        showNotification('Format file harus JPG atau PNG', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const fotoProfilImg = document.getElementById('fotoProfilImg');
                        fotoProfilImg.innerHTML = `<img src="${e.target.result}" class="foto-profil-img">`;
                        fotoProfilImg.style.display = 'block';
                        fotoProfilPlaceholder.style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // Setup password toggle
        const togglePasswordMember = document.getElementById('togglePasswordMember');
        const passwordMember = document.getElementById('passwordMember');
        
        if (togglePasswordMember && passwordMember) {
            togglePasswordMember.addEventListener('click', function() {
                const type = passwordMember.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordMember.setAttribute('type', type);
                this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
        }
        
        // Setup alamat counter
        const alamatInput = document.getElementById('alamat');
        const alamatCounter = document.getElementById('alamatCounter');
        
        if (alamatInput && alamatCounter) {
            alamatInput.addEventListener('input', function() {
                const count = this.value.length;
                alamatCounter.textContent = `${count}/200 karakter`;
                
                if (count > 200) {
                    alamatCounter.style.color = 'var(--danger)';
                } else if (count > 180) {
                    alamatCounter.style.color = 'var(--warning)';
                } else {
                    alamatCounter.style.color = 'var(--gray)';
                }
            });
            
            alamatCounter.textContent = `0/200 karakter`;
        }
        
        // Setup simpanan inputs
        const simpananInputs = ['simpananPokok', 'simpananWajib', 'simpananSukarela'];
        simpananInputs.forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('input', updateTotalSimpananDisplay);
            }
        });
        
        console.log(' New member form setup completed');
    }

    function openAddMemberModal() {
        document.getElementById('memberModalTitle').textContent = 'Tambah Anggota Baru';
        document.getElementById('memberId').value = '';
        document.getElementById('memberForm').reset();
        
        // Reset foto profil
        const fotoProfilPlaceholder = document.getElementById('fotoProfilPlaceholder');
        const fotoProfilImg = document.getElementById('fotoProfilImg');
        if (fotoProfilPlaceholder && fotoProfilImg) {
            fotoProfilPlaceholder.style.display = 'flex';
            fotoProfilImg.style.display = 'none';
            fotoProfilImg.innerHTML = '';
        }
        
        // Set tanggal default
        document.getElementById('tanggalDaftar').value = new Date().toISOString().split('T')[0];
        
        // Set NIA otomatis
        const autoNIA = generateNIA();
        document.getElementById('nia').value = autoNIA.replace('NIA-', '');
        
        // Set default simpanan
        document.getElementById('simpananPokok').value = 0;
        document.getElementById('simpananWajib').value = 0;
        document.getElementById('simpananSukarela').value = 0;
        
        // Reset total simpanan display
        updateTotalSimpananDisplay();
        
        // Reset alamat counter
        const alamatCounter = document.getElementById('alamatCounter');
        if (alamatCounter) {
            alamatCounter.textContent = '0/200 karakter';
            alamatCounter.style.color = 'var(--gray)';
        }
        
        document.getElementById('addMemberModal').style.display = 'flex';
    }

    // ===== FIX 16: FUNGSI EDIT DATA LAINNYA =====
    function editSimpanan(simpananId) {
        showNotification('Fitur edit simpanan akan segera tersedia!', 'info');
    }

    function editPinjaman(pinjamanId) {
        const pinjaman = pinjamanData.find(p => p.id === pinjamanId);
        if (!pinjaman) return;
        
        // Isi form dengan data pinjaman
        document.getElementById('pinjamanModalTitle').textContent = 'Edit Data Pinjaman';
        document.getElementById('pinjamanId').value = pinjaman.id;
        document.getElementById('idAnggotaPinjaman').value = pinjaman.idAnggota;
        document.getElementById('jumlahPinjaman').value = pinjaman.jumlahPinjaman;
        document.getElementById('tanggalPinjaman').value = pinjaman.tanggalPinjam;
        document.getElementById('jangkaWaktu').value = pinjaman.jangkaWaktu;
        document.getElementById('bungaPinjaman').value = pinjaman.bunga;
        
        // Isi dropdown anggota
        isiDropdownAnggotaPinjaman();
        
        // Tampilkan modal
        document.getElementById('addPinjamanModal').style.display = 'flex';
    }

    function editBarang(barangId) {
        const barang = barangData.find(b => b.id === barangId);
        if (!barang) return;
        
        // Set judul modal
        document.getElementById('barangModalTitle').textContent = 'Edit Data Barang';
        
        // Isi form dengan data barang
        document.getElementById('barangId').value = barang.id;
        document.getElementById('namaBarang').value = barang.namaBarang;
        document.getElementById('stokBarang').value = barang.stok;
        document.getElementById('hargaBeli').value = barang.hargaBeli;
        document.getElementById('hargaJual').value = barang.hargaJual;
        
        // Tampilkan modal
        document.getElementById('addBarangModal').style.display = 'flex';
    }

    // ===== FIX 17: SETUP TOMBOL LAINNYA =====
    function setupOtherButtons() {
        // Setup simpanan tabs
        document.querySelectorAll('[data-simpanan-tab]').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabType = this.getAttribute('data-simpanan-tab');
                
                // Update active tab
                document.querySelectorAll('[data-simpanan-tab]').forEach(t => {
                    t.classList.remove('active');
                });
                this.classList.add('active');
                
                // Update title
                let title = 'Daftar Simpanan ';
                switch(tabType) {
                    case 'pokok': title += 'Pokok'; break;
                    case 'wajib': title += 'Wajib'; break;
                    case 'sukarela': title += 'Sukarela'; break;
                }
                document.getElementById('simpananTitle').textContent = title;
                
                // Refresh table
                refreshSimpananTable();
            });
        });
        
        // Setup admin form
        const adminForm = document.getElementById('adminForm');
        if (adminForm) {
            adminForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const email = document.getElementById('email').value;
                const role = document.getElementById('role').value;
                const norek = document.getElementById('norek').value;
                
                // Update UI
                document.getElementById('topNavUsername').textContent = username;
                document.getElementById('topNavRole').textContent = role;
                document.getElementById('adminUsername').textContent = username;
                document.getElementById('adminEmail').textContent = email;
                document.getElementById('adminRole').textContent = role;
                document.getElementById('adminRekening').textContent = norek;
                
                showNotification('Pengaturan admin berhasil disimpan!', 'success');
            });
        }
        
        // Setup tombol tambah pinjaman
        const addPinjamanBtn = document.getElementById('addPinjamanBtn');
        if (addPinjamanBtn) {
            addPinjamanBtn.addEventListener('click', () => {
                bukaModalTambahPinjaman();
            });
        }
        
        // Setup tombol tambah barang
        const addBarangBtn = document.getElementById('addBarangBtn');
        if (addBarangBtn) {
            addBarangBtn.addEventListener('click', () => {
                bukaModalTambahBarang();
            });
        }
        
        // Setup tombol cetak laporan
        const cetakLaporanBtn = document.getElementById('cetakLaporanBtn');
        if (cetakLaporanBtn) {
            cetakLaporanBtn.addEventListener('click', () => {
                bukaModalCetakLaporan('keuangan');
            });
        }
        
        // Setup tombol cetak SHU
        const cetakSHUBtn = document.getElementById('cetakSHUBtn');
        if (cetakSHUBtn) {
            cetakSHUBtn.addEventListener('click', () => {
                bukaModalCetakLaporan('shu');
            });
        }
        
        // Setup save pinjaman button
        const savePinjamanBtn = document.getElementById('savePinjamanBtn');
        if (savePinjamanBtn) {
            savePinjamanBtn.addEventListener('click', (e) => {
                e.preventDefault();
                simpanDataPinjaman();
            });
        }
        
        // Setup save barang button
        const saveBarangBtn = document.getElementById('saveBarangBtn');
        if (saveBarangBtn) {
            saveBarangBtn.addEventListener('click', (e) => {
                e.preventDefault();
                simpanDataBarang();
            });
        }
        
        console.log(' Other buttons setup completed');
    }

    // ===== INTEGRASI DENGAN TABUNGAN DIGITAL =====
    function setupTabunganDigitalIntegration() {
        console.log('Setting up Tabungan Digital integration...');
        
        // Event listener untuk perubahan di Tabungan Digital
        window.addEventListener('storage', function(e) {
            if (e.key === 'tabunganDigitalUsers' || e.key === 'userTransaksi') {
                console.log('Data dari Tabungan Digital berubah:', e.key);
                syncFromTabunganDigital();
            }
        });
        
        // Auto-sync setiap 10 detik
        setInterval(() => {
            syncFromTabunganDigital();
        }, 10000);
        
        // Sync saat halaman pertama kali dimuat
        setTimeout(() => {
            syncFromTabunganDigital();
        }, 2000);
        
        console.log(' Tabungan Digital integration setup completed');
    }

    // Fungsi untuk sinkronisasi data dari Tabungan Digital
    function syncFromTabunganDigital() {
        console.log('Syncing from Tabungan Digital...');
        
        try {
            // Ambil data user dari Tabungan Digital
            const tabunganUsers = JSON.parse(localStorage.getItem('tabunganDigitalUsers') || '[]');
            const userTransaksi = JSON.parse(localStorage.getItem('userTransaksi') || '[]');
            
            console.log('Data ditemukan:', {
                users: tabunganUsers.length,
                transaksi: userTransaksi.length
            });
            
            let newUsersCount = 0;
            let newTransactionsCount = 0;
            
            // Sync ke anggotaData
            tabunganUsers.forEach(user => {
                const existingUser = anggotaData.find(a => 
                    a.email === user.email || 
                    a.nik === user.nik ||
                    a.whatsapp === user.telepon ||
                    a.whatsapp === user.whatsapp
                );
                
                if (!existingUser) {
                    // Generate NIA otomatis
                    const newNIA = generateNIA();
                    
                    const newAnggota = {
                        id: newNIA,
                        nia: newNIA,
                        posisi: 'Anggota',
                        nama: user.nama || user.fullName || 'Anggota Baru',
                        alamat: user.alamat || user.alamatLengkap || '',
                        jenisKelamin: user.jenisKelamin || 'Laki-laki',
                        agama: user.agama || 'Islam',
                        status: user.statusPernikahan || 'Belum Menikah',
                        email: user.email || '',
                        whatsapp: user.telepon || user.whatsapp || '',
                        nik: user.nik || '',
                        tanggalDaftar: user.tanggalDaftar || new Date().toLocaleDateString('id-ID'),
                        statusAktif: 'Aktif',
                        foto: user.foto || user.profilePicture || '',
                        simpananPokok: user.simpananPokok || 200000,
                        simpananWajib: user.simpananWajib || 20000,
                        simpananSukarela: user.simpananSukarela || 0,
                        totalSimpanan: (user.simpananPokok || 0) + (user.simpananWajib || 0) + (user.simpananSukarela || 0),
                        totalPinjaman: user.pinjaman || 0,
                        saldo: user.saldo || 0,
                        password: user.password || '',
                        createdAt: new Date().toISOString(),
                        lastUpdated: new Date().toISOString(),
                        // Data dari tabungan digital
                        sumber: 'Tabungan Digital',
                        noRekening: user.noRekening || '',
                        namaBank: user.namaBank || '',
                        saldoTabungan: user.saldo || 0
                    };
                    
                    anggotaData.push(newAnggota);
                    newUsersCount++;
                    console.log('Anggota baru ditambahkan dari Tabungan Digital:', newAnggota.nama);
                }
            });
            
            // Sync transaksi ke simpananData
            userTransaksi.forEach(transaksi => {
                // Cari anggota berdasarkan email atau nama
                const anggota = anggotaData.find(a => 
                    a.email === transaksi.email || 
                    a.nama === transaksi.nama
                );
                
                if (anggota && (transaksi.jenis === 'simpanan' || transaksi.jenis === 'setor')) {
                    // Tentukan jenis simpanan berdasarkan keterangan
                    let jenisSimpanan = 'Sukarela';
                    if (transaksi.keterangan && transaksi.keterangan.includes('Pokok')) {
                        jenisSimpanan = 'Pokok';
                    } else if (transaksi.keterangan && transaksi.keterangan.includes('Wajib')) {
                        jenisSimpanan = 'Wajib';
                    } else if (transaksi.keterangan && transaksi.keterangan.includes('Sukarela')) {
                        jenisSimpanan = 'Sukarela';
                    }
                    
                    const newSimpanan = {
                        id: 'TD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                        idAnggota: anggota.id,
                        nama: anggota.nama,
                        jenisSimpanan: jenisSimpanan,
                        tanggalSetor: transaksi.tanggal || new Date().toLocaleDateString('id-ID'),
                        nominal: parseInt(transaksi.nominal) || parseInt(transaksi.jumlah) || 0,
                        keterangan: transaksi.keterangan || '',
                        sumber: 'Tabungan Digital',
                        createdAt: new Date().toISOString()
                    };
                    
                    // Cek apakah transaksi sudah ada
                    const existing = simpananData.find(s => 
                        s.idAnggota === newSimpanan.idAnggota && 
                        s.tanggalSetor === newSimpanan.tanggalSetor &&
                        s.nominal === newSimpanan.nominal &&
                        s.keterangan === newSimpanan.keterangan
                    );
                    
                    if (!existing) {
                        simpananData.push(newSimpanan);
                        newTransactionsCount++;
                        console.log('Transaksi baru ditambahkan:', newSimpanan.nama, '-', newSimpanan.nominal);
                    }
                }
            });
            
            // Simpan data yang sudah disinkronisasi
            if (newUsersCount > 0 || newTransactionsCount > 0) {
                localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
                localStorage.setItem('simpananData', JSON.stringify(simpananData));
                localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
                
                // Update UI
                refreshAnggotaTable();
                refreshSimpananTable();
                updateDashboardStats();
                
                if (newUsersCount > 0 || newTransactionsCount > 0) {
                    showNotification(`${newUsersCount} anggota baru & ${newTransactionsCount} transaksi disinkronisasi dari Tabungan Digital`, 'success');
                }
            }
            
        } catch (error) {
            console.error('Error syncing from Tabungan Digital:', error);
        }
    }

    // ===== FUNGSI TAMBAH PINJAMAN =====
    function bukaModalTambahPinjaman() {
        const modal = document.getElementById('addPinjamanModal');
        if (!modal) return;
        
        // Reset form
        const form = document.getElementById('pinjamanForm');
        if (form) form.reset();
        
        // Isi dropdown anggota
        isiDropdownAnggotaPinjaman();
        
        // Set tanggal default hari ini
        document.getElementById('tanggalPinjaman').value = new Date().toISOString().split('T')[0];
        
        // Set default bunga
        document.getElementById('bungaPinjaman').value = '1.5';
        
        // Update judul modal
        document.getElementById('pinjamanModalTitle').textContent = 'Tambah Pinjaman Baru';
        
        // Clear hidden ID
        document.getElementById('pinjamanId').value = '';
        
        // Tampilkan modal
        modal.style.display = 'flex';
    }

    function isiDropdownAnggotaPinjaman() {
        const dropdown = document.getElementById('idAnggotaPinjaman');
        if (!dropdown) return;
        
        // Simpan nilai yang dipilih
        const selectedValue = dropdown.value;
        
        // Clear existing options except the first one
        while (dropdown.options.length > 1) {
            dropdown.remove(1);
        }
        
        // Add options from anggotaData
        anggotaData.forEach(anggota => {
            if (anggota.statusAktif === 'Aktif') {
                const option = document.createElement('option');
                option.value = anggota.id;
                option.textContent = `${anggota.id} - ${anggota.nama} (${anggota.posisi})`;
                dropdown.appendChild(option);
            }
        });
        
        // Restore selected value if exists
        if (selectedValue) {
            dropdown.value = selectedValue;
        }
    }

    function simpanDataPinjaman() {
        // Validasi form
        const idAnggota = document.getElementById('idAnggotaPinjaman').value;
        const jumlahPinjaman = document.getElementById('jumlahPinjaman').value;
        const tanggalPinjam = document.getElementById('tanggalPinjaman').value;
        const jangkaWaktu = document.getElementById('jangkaWaktu').value;
        const bunga = document.getElementById('bungaPinjaman').value;
        
        if (!idAnggota || !jumlahPinjaman || !tanggalPinjam || !jangkaWaktu || !bunga) {
            showNotification('Harap lengkapi semua field!', 'error');
            return;
        }
        
        // Cari data anggota
        const anggota = anggotaData.find(a => a.id === idAnggota);
        if (!anggota) {
            showNotification('Anggota tidak ditemukan!', 'error');
            return;
        }
        
        // Parse angka
        const jumlah = parseInt(jumlahPinjaman);
        const bungaPersen = parseFloat(bunga);
        
        // Cek apakah edit atau tambah baru
        const pinjamanId = document.getElementById('pinjamanId').value;
        
        if (pinjamanId) {
            // EDIT pinjaman yang sudah ada
            const index = pinjamanData.findIndex(p => p.id === pinjamanId);
            if (index !== -1) {
                // Hitung cicilan per bulan
                let jumlahBulan = 6;
                if (jangkaWaktu === '12 Bulan') jumlahBulan = 12;
                else if (jangkaWaktu === '24 Bulan') jumlahBulan = 24;
                else if (jangkaWaktu === '36 Bulan') jumlahBulan = 36;
                
                const bungaPerBulan = (jumlah * bungaPersen / 100) / jumlahBulan;
                const cicilanPerBulan = Math.round((jumlah / jumlahBulan) + bungaPerBulan);
                
                pinjamanData[index] = {
                    ...pinjamanData[index],
                    idAnggota: idAnggota,
                    namaAnggota: anggota.nama,
                    jumlahPinjaman: jumlah,
                    tanggalPinjam: tanggalPinjam,
                    jangkaWaktu: jangkaWaktu,
                    bunga: bungaPersen,
                    sisaHutang: jumlah,
                    cicilanPerBulan: cicilanPerBulan,
                    lastUpdated: new Date().toISOString()
                };
                
                showNotification(`Pinjaman untuk ${anggota.nama} berhasil diperbarui!`, 'success');
            }
        } else {
            // TAMBAH pinjaman baru
            // Generate ID pinjaman
            const newPinjamanId = 'PINJ-' + Date.now();
            
            // Hitung cicilan per bulan
            let jumlahBulan = 6;
            if (jangkaWaktu === '12 Bulan') jumlahBulan = 12;
            else if (jangkaWaktu === '24 Bulan') jumlahBulan = 24;
            else if (jangkaWaktu === '36 Bulan') jumlahBulan = 36;
            
            const bungaPerBulan = (jumlah * bungaPersen / 100) / jumlahBulan;
            const cicilanPerBulan = Math.round((jumlah / jumlahBulan) + bungaPerBulan);
            
            // Buat objek pinjaman baru
            const pinjamanBaru = {
                id: newPinjamanId,
                idAnggota: idAnggota,
                namaAnggota: anggota.nama,
                jumlahPinjaman: jumlah,
                tanggalPinjam: tanggalPinjam,
                jangkaWaktu: jangkaWaktu,
                bunga: bungaPersen,
                sisaHutang: jumlah,
                cicilanPerBulan: cicilanPerBulan,
                status: 'Aktif',
                historyAngsuran: [],
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            pinjamanData.push(pinjamanBaru);
            showNotification(`Pinjaman berhasil ditambahkan untuk ${anggota.nama}`, 'success');
        }
        
        // Simpan ke localStorage
        localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
        
        // Update UI
        refreshPinjamanTable();
        updateDashboardStats();
        
        // Tutup modal
        document.getElementById('addPinjamanModal').style.display = 'none';
    }

    // ===== FUNGSI TAMBAH BARANG =====
    function bukaModalTambahBarang() {
        const modal = document.getElementById('addBarangModal');
        if (!modal) return;
        
        // Reset form
        const form = document.getElementById('barangForm');
        if (form) form.reset();
        
        // Set judul modal
        document.getElementById('barangModalTitle').textContent = 'Tambah Barang Baru';
        
        // Clear hidden ID
        document.getElementById('barangId').value = '';
        
        // Tampilkan modal
        modal.style.display = 'flex';
    }

    function simpanDataBarang() {
        // Validasi form
        const namaBarang = document.getElementById('namaBarang').value;
        const stokBarang = document.getElementById('stokBarang').value;
        const hargaBeli = document.getElementById('hargaBeli').value;
        const hargaJual = document.getElementById('hargaJual').value;
        
        if (!namaBarang || !stokBarang || !hargaBeli || !hargaJual) {
            showNotification('Harap lengkapi semua field!', 'error');
            return;
        }
        
        // Parse angka
        const stok = parseInt(stokBarang);
        const beli = parseInt(hargaBeli);
        const jual = parseInt(hargaJual);
        
        // Validasi angka positif
        if (stok < 0 || beli < 0 || jual < 0) {
            showNotification('Nilai tidak boleh negatif!', 'error');
            return;
        }
        
        // Validasi harga jual harus >= harga beli
        if (jual < beli) {
            showNotification('Harga jual harus lebih besar atau sama dengan harga beli!', 'error');
            return;
        }
        
        // Cek apakah edit atau tambah baru
        const barangId = document.getElementById('barangId').value;
        
        if (barangId) {
            // EDIT barang yang sudah ada
            const index = barangData.findIndex(b => b.id === barangId);
            if (index !== -1) {
                barangData[index] = {
                    ...barangData[index],
                    namaBarang: namaBarang,
                    stok: stok,
                    hargaBeli: beli,
                    hargaJual: jual,
                    laba: jual - beli,
                    lastUpdated: new Date().toISOString()
                };
                
                showNotification(`Barang "${namaBarang}" berhasil diperbarui!`, 'success');
            }
        } else {
            // TAMBAH barang baru
            const newId = 'BRG-' + Date.now();
            
            const barangBaru = {
                id: newId,
                namaBarang: namaBarang,
                stok: stok,
                hargaBeli: beli,
                hargaJual: jual,
                laba: jual - beli,
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            barangData.push(barangBaru);
            showNotification(`Barang "${namaBarang}" berhasil ditambahkan!`, 'success');
        }
        
        // Simpan ke localStorage
        localStorage.setItem('barangData', JSON.stringify(barangData));
        
        // Update UI
        refreshBarangTable();
        
        // Tutup modal
        document.getElementById('addBarangModal').style.display = 'none';
    }

    // ===== FUNGSI CETAK LAPORAN =====
    function bukaModalCetakLaporan(jenis) {
        // Buat modal preview cetak
        let modal = document.getElementById('printPreviewModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'printPreviewModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <h3>Preview Cetak Laporan</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body" id="printPreviewContent" style="max-height: 70vh; overflow-y: auto;">
                        <!-- Preview cetak akan diisi di sini -->
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-outline" onclick="tutupModalPrint()">
                            <i class="fas fa-times"></i> Tutup
                        </button>
                        <button class="btn btn-primary" onclick="cetakLaporanSekarang()">
                            <i class="fas fa-print"></i> Cetak Laporan
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Setup close button
            const closeBtn = modal.querySelector('.modal-close');
            closeBtn.onclick = function() {
                modal.style.display = 'none';
            };
        }
        
        // Isi konten berdasarkan jenis laporan
        isiPreviewLaporan(jenis);
        
        // Tampilkan modal
        modal.style.display = 'flex';
    }

    function isiPreviewLaporan(jenis) {
        const content = document.getElementById('printPreviewContent');
        if (!content) return;
        
        let htmlContent = '';
        const now = new Date();
        const tanggalCetak = now.toLocaleDateString('id-ID', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        const jamCetak = now.toLocaleTimeString('id-ID');
        
        if (jenis === 'keuangan') {
            // Hitung total untuk laporan keuangan
            const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
            const totalPinjaman = pinjamanData.reduce((sum, p) => sum + (parseInt(p.jumlahPinjaman) || 0), 0);
            const totalSHU = totalSimpanan * 0.1;
            const totalKas = Math.max(0, totalSimpanan - totalPinjaman);
            
            htmlContent = `
                <div id="printContent" style="padding: 20px; background: white; font-family: 'Times New Roman', Times, serif;">
                    <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 20px;">
                        <h1 style="color: #2e7d32; margin-bottom: 5px;">KOPERASI ASMARA TANI</h1>
                        <h3 style="color: #666; margin-bottom: 10px;">#koperasijenius</h3>
                        <p style="color: #333;">Laporan Keuangan Bulanan</p>
                        <p style="color: #666; font-size: 14px;">${tanggalCetak} - ${jamCetak}</p>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                        <thead>
                            <tr style="background: #f5f5f5;">
                                <th style="padding: 15px; text-align: left; border: 1px solid #ddd; font-weight: bold;">Keterangan</th>
                                <th style="padding: 15px; text-align: right; border: 1px solid #ddd; font-weight: bold;">Jumlah (Rp)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">Total Simpanan Anggota</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold;">${totalSimpanan.toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">Total Pinjaman Aktif</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold;">${totalPinjaman.toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">Total SHU (Sisa Hasil Usaha)</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold;">${totalSHU.toLocaleString('id-ID')}</td>
                            </tr>
                            <tr style="background: #e8f5e8;">
                                <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">Total Kas Koperasi</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold; color: #2e7d32;">${totalKas.toLocaleString('id-ID')}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd;">
                        <div style="display: flex; justify-content: space-between;">
                            <div style="text-align: center;">
                                <p style="margin-bottom: 60px;">Mengetahui,</p>
                                <p style="font-weight: bold; border-top: 1px solid #000; padding-top: 5px; width: 200px;">Ketua Koperasi</p>
                            </div>
                            <div style="text-align: center;">
                                <p style="margin-bottom: 60px;">Bendahara,</p>
                                <p style="font-weight: bold; border-top: 1px solid #000; padding-top: 5px; width: 200px;">Bendahara Koperasi</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 50px; font-size: 12px; color: #666; text-align: center; border-top: 1px solid #eee; padding-top: 10px;">
                        <p>Dicetak dari Sistem Administrasi Koperasi Asmara Tani</p>
                    </div>
                </div>
            `;
        } else if (jenis === 'shu') {
            // Hitung SHU untuk laporan
            const totalSimpanan = simpananData.reduce((sum, s) => sum + (parseInt(s.nominal) || 0), 0);
            const totalSHU = totalSimpanan * 0.1;
            
            const cadangan = totalSHU * 0.2;
            const danaSosial = totalSHU * 0.1;
            const danaPengurus = totalSHU * 0.1;
            const danaKaryawan = totalSHU * 0.1;
            const danaPembangunan = totalSHU * 0.1;
            const danaAnggota = totalSHU * 0.4;
            
            htmlContent = `
                <div id="printContent" style="padding: 20px; background: white; font-family: 'Times New Roman', Times, serif;">
                    <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 20px;">
                        <h1 style="color: #2e7d32; margin-bottom: 5px;">KOPERASI ASMARA TANI</h1>
                        <h3 style="color: #666; margin-bottom: 10px;">#koperasijenius</h3>
                        <h2 style="color: #333; margin-bottom: 10px;">Laporan Pembagian SHU</h2>
                        <h3 style="color: #666; margin-bottom: 10px;">Tahun ${now.getFullYear()}</h3>
                        <p style="color: #666; font-size: 14px;">${tanggalCetak} - ${jamCetak}</p>
                    </div>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #2e7d32;">
                        <p style="margin: 0; font-weight: bold;">Total SHU Tahun ${now.getFullYear()}</p>
                        <h2 style="margin: 5px 0; color: #2e7d32;">Rp ${totalSHU.toLocaleString('id-ID')}</h2>
                        <p style="margin: 0; font-size: 14px; color: #666;">Dihitung dari total simpanan anggota</p>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                        <thead>
                            <tr style="background: #f5f5f5;">
                                <th style="padding: 15px; text-align: left; border: 1px solid #ddd; font-weight: bold;">Keterangan</th>
                                <th style="padding: 15px; text-align: center; border: 1px solid #ddd; font-weight: bold;">Persentase</th>
                                <th style="padding: 15px; text-align: right; border: 1px solid #ddd; font-weight: bold;">Jumlah (Rp)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">Cadangan Koperasi</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">20%</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${cadangan.toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">Dana Sosial</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">10%</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${danaSosial.toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">Dana Pengurus</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">10%</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${danaPengurus.toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">Dana Karyawan</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">10%</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${danaKaryawan.toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">Dana Pembangunan</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">10%</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${danaPembangunan.toLocaleString('id-ID')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">Dana Anggota</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">40%</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${danaAnggota.toLocaleString('id-ID')}</td>
                            </tr>
                            <tr style="background: #e8f5e8; font-weight: bold;">
                                <td style="padding: 12px; border: 1px solid #ddd;">TOTAL SHU</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">100%</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; color: #2e7d32;">${totalSHU.toLocaleString('id-ID')}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 5px; border: 1px solid #ddd;">
                        <h4 style="color: #2e7d32; margin-bottom: 10px;">Catatan:</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #666;">
                            <li>SHU dihitung berdasarkan total simpanan anggota selama satu tahun</li>
                            <li>Pembagian dilakukan sesuai AD/ART Koperasi Asmara Tani</li>
                            <li>Dana anggota akan dibagikan berdasarkan besar simpanan masing-masing anggota</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd;">
                        <div style="display: flex; justify-content: space-between;">
                            <div style="text-align: center;">
                                <p style="margin-bottom: 60px;">Mengetahui,</p>
                                <p style="font-weight: bold; border-top: 1px solid #000; padding-top: 5px; width: 200px;">Ketua Koperasi</p>
                            </div>
                            <div style="text-align: center;">
                                <p style="margin-bottom: 60px;">Bendahara,</p>
                                <p style="font-weight: bold; border-top: 1px solid #000; padding-top: 5px; width: 200px;">Bendahara Koperasi</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 50px; font-size: 12px; color: #666; text-align: center; border-top: 1px solid #eee; padding-top: 10px;">
                        <p>Dicetak dari Sistem Administrasi Koperasi Asmara Tani</p>
                    </div>
                </div>
            `;
        }
        
        content.innerHTML = htmlContent;
    }

    function tutupModalPrint() {
        const modal = document.getElementById('printPreviewModal');
        if (modal) {
            modal.style.display = 'none';
        }
    }

    function cetakLaporanSekarang() {
        // Ambil konten yang akan dicetak
        const printContent = document.getElementById('printContent');
        if (!printContent) {
            showNotification('Tidak ada konten untuk dicetak', 'error');
            return;
        }
        
        // Simpan HTML asli
        const originalContent = document.body.innerHTML;
        
        // Ganti body dengan konten cetak
        document.body.innerHTML = printContent.outerHTML;
        
        // Cetak
        window.print();
        
        // Kembalikan konten asli
        document.body.innerHTML = originalContent;
        
        // Tutup modal
        tutupModalPrint();
        
        // Refresh event listeners
        initializeFixedSystem();
        
        showNotification('Laporan berhasil dicetak', 'success');
    }

    // ===== FUNGSI NOTIFIKASI LENGKAP =====
    function bukaModalNotifikasiLengkap() {
        // Buat modal jika belum ada
        let modal = document.getElementById('notifikasiLengkapModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'notifikasiLengkapModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3>Semua Notifikasi</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                        <div id="notifikasiLengkapContent">
                            <!-- Notifikasi akan diisi di sini -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-outline" onclick="tutupModalNotifikasi()">
                            <i class="fas fa-times"></i> Tutup
                        </button>
                        <button class="btn btn-primary" onclick="markAllAsRead()">
                            <i class="fas fa-check-double"></i> Tandai Semua Sudah Dibaca
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Isi konten notifikasi
        isiNotifikasiLengkap();
        
        // Tampilkan modal
        modal.style.display = 'flex';
        
        // Setup close button
        const closeBtn = modal.querySelector('.modal-close');
        closeBtn.onclick = function() {
            modal.style.display = 'none';
        };
    }

    function isiNotifikasiLengkap() {
        const content = document.getElementById('notifikasiLengkapContent');
        if (!content) return;
        
        // Buat notifikasi lengkap dari berbagai sumber data
        let notifikasiHTML = '';
        
        // 1. Notifikasi dari anggota baru
        const anggotaBaru = [...anggotaData]
            .sort((a, b) => new Date(b.tanggalDaftar) - new Date(a.tanggalDaftar))
            .slice(0, 10);
        
        if (anggotaBaru.length > 0) {
            notifikasiHTML += `
                <div class="notifikasi-section">
                    <h4 style="color: var(--primary); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--primary-light);">
                        <i class="fas fa-users"></i> Anggota Baru (${anggotaBaru.length})
                    </h4>
                    <div class="notifikasi-list">
            `;
            
            anggotaBaru.forEach(anggota => {
                notifikasiHTML += `
                    <div class="notifikasi-item" style="display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--gray-light);">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary-light); display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-user-plus" style="color: white;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--dark);">${anggota.nama}</div>
                            <div style="font-size: 0.85rem; color: var(--gray);">
                                Bergabung pada ${anggota.tanggalDaftar}  ${anggota.posisi}
                            </div>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--gray);">
                            ${formatRelativeTime(anggota.tanggalDaftar)}
                        </div>
                    </div>
                `;
            });
            
            notifikasiHTML += `</div></div>`;
        }
        
        // 2. Notifikasi dari simpanan terbaru
        const simpananBaru = [...simpananData]
            .sort((a, b) => new Date(b.tanggalSetor) - new Date(a.tanggalSetor))
            .slice(0, 10);
        
        if (simpananBaru.length > 0) {
            notifikasiHTML += `
                <div class="notifikasi-section">
                    <h4 style="color: var(--secondary); margin: 25px 0 15px; padding-bottom: 10px; border-bottom: 2px solid var(--secondary);">
                        <i class="fas fa-hand-holding-usd"></i> Transaksi Simpanan (${simpananBaru.length})
                    </h4>
                    <div class="notifikasi-list">
            `;
            
            simpananBaru.forEach(simpanan => {
                notifikasiHTML += `
                    <div class="notifikasi-item" style="display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--gray-light);">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--secondary); display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-money-bill-wave" style="color: white;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--dark);">${simpanan.nama}</div>
                            <div style="font-size: 0.85rem; color: var(--gray);">
                                ${simpanan.jenisSimpanan}  Rp ${simpanan.nominal.toLocaleString('id-ID')}
                            </div>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--gray);">
                            ${formatRelativeTime(simpanan.tanggalSetor)}
                        </div>
                    </div>
                `;
            });
            
            notifikasiHTML += `</div></div>`;
        }
        
        // 3. Notifikasi dari pinjaman terbaru
        const pinjamanBaru = [...pinjamanData]
            .sort((a, b) => new Date(b.tanggalPinjam) - new Date(a.tanggalPinjam))
            .slice(0, 10);
        
        if (pinjamanBaru.length > 0) {
            notifikasiHTML += `
                <div class="notifikasi-section">
                    <h4 style="color: var(--accent); margin: 25px 0 15px; padding-bottom: 10px; border-bottom: 2px solid var(--accent);">
                        <i class="fas fa-file-invoice-dollar"></i> Pinjaman Baru (${pinjamanBaru.length})
                    </h4>
                    <div class="notifikasi-list">
            `;
            
            pinjamanBaru.forEach(pinjaman => {
                notifikasiHTML += `
                    <div class="notifikasi-item" style="display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--gray-light);">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-hand-holding-usd" style="color: white;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--dark);">${pinjaman.namaAnggota}</div>
                            <div style="font-size: 0.85rem; color: var(--gray);">
                                Pinjaman  Rp ${pinjaman.jumlahPinjaman.toLocaleString('id-ID')}
                            </div>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--gray);">
                            ${formatRelativeTime(pinjaman.tanggalPinjam)}
                        </div>
                    </div>
                `;
            });
            
            notifikasiHTML += `</div></div>`;
        }
        
        // Jika tidak ada notifikasi
        if (notifikasiHTML === '') {
            notifikasiHTML = `
                <div style="text-align: center; padding: 40px 20px; color: var(--gray);">
                    <i class="fas fa-bell-slash" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                    <h4 style="color: var(--gray); margin-bottom: 10px;">Belum ada notifikasi</h4>
                    <p>Semua aktivitas akan muncul di sini</p>
                </div>
            `;
        }
        
        content.innerHTML = notifikasiHTML;
    }

    function formatRelativeTime(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / (1000 * 60));
        const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        
        if (diffMins < 1) return 'Baru saja';
        if (diffMins < 60) return `${diffMins} menit lalu`;
        if (diffHours < 24) return `${diffHours} jam lalu`;
        if (diffDays < 7) return `${diffDays} hari lalu`;
        
        return date.toLocaleDateString('id-ID', {
            day: 'numeric',
            month: 'short',
            year: 'numeric'
        });
    }

    function tutupModalNotifikasi() {
        const modal = document.getElementById('notifikasiLengkapModal');
        if (modal) {
            modal.style.display = 'none';
        }
    }

    function markAllAsRead() {
        showNotification('Semua notifikasi telah ditandai sebagai sudah dibaca', 'success');
    }

    // ===== FUNGSI LOAD INITIAL DATA =====
    function loadInitialData() {
        console.log('Loading initial data...');
        
        // Jika data kosong, tambahkan data contoh
        if (anggotaData.length === 0) {
            const contohAnggota = [
                {
                    id: 'NIA-001',
                    nia: 'NIA-001',
                    posisi: 'Ketua',
                    nama: 'Ahmad Budiman',
                    alamat: 'Jl. Merdeka No. 123, Jakarta',
                    jenisKelamin: 'Laki-laki',
                    agama: 'Islam',
                    status: 'Menikah',
                    email: 'ahmad@example.com',
                    whatsapp: '6281234567890',
                    nik: '1234567890123456',
                    tanggalDaftar: '2023-01-15',
                    statusAktif: 'Aktif',
                    simpananPokok: 200000,
                    simpananWajib: 20000,
                    simpananSukarela: 50000,
                    totalSimpanan: 270000,
                    totalPinjaman: 0,
                    saldo: 0,
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                },
                {
                    id: 'NIA-002',
                    nia: 'NIA-002',
                    posisi: 'Anggota Biasa',
                    nama: 'Siti Rahayu',
                    alamat: 'Jl. Melati No. 45, Bandung',
                    jenisKelamin: 'Perempuan',
                    agama: 'Islam',
                    status: 'Belum Menikah',
                    email: 'siti@example.com',
                    whatsapp: '6289876543210',
                    nik: '2345678901234567',
                    tanggalDaftar: '2023-02-20',
                    statusAktif: 'Aktif',
                    simpananPokok: 200000,
                    simpananWajib: 20000,
                    simpananSukarela: 100000,
                    totalSimpanan: 320000,
                    totalPinjaman: 0,
                    saldo: 0,
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                }
            ];
            
            anggotaData.push(...contohAnggota);
        }
        
        if (simpananData.length === 0) {
            const contohSimpanan = [
                {
                    id: 'SPN-001',
                    idAnggota: 'NIA-001',
                    nama: 'Ahmad Budiman',
                    jenisSimpanan: 'Pokok',
                    tanggalSetor: '2023-01-15',
                    nominal: 200000
                },
                {
                    id: 'SPN-002',
                    idAnggota: 'NIA-002',
                    nama: 'Siti Rahayu',
                    jenisSimpanan: 'Pokok',
                    tanggalSetor: '2023-02-20',
                    nominal: 200000
                }
            ];
            
            simpananData.push(...contohSimpanan);
        }
        
        if (pinjamanData.length === 0) {
            const contohPinjaman = [
                {
                    id: 'PINJ-001',
                    idAnggota: 'NIA-001',
                    namaAnggota: 'Ahmad Budiman',
                    jumlahPinjaman: 5000000,
                    tanggalPinjam: '2023-03-15',
                    jangkaWaktu: '12 Bulan',
                    bunga: 1.5,
                    sisaHutang: 4500000,
                    cicilanPerBulan: 458333,
                    status: 'Aktif',
                    historyAngsuran: [
                        { tanggal: '2023-04-15', jumlah: 458333 },
                        { tanggal: '2023-05-15', jumlah: 458333 }
                    ],
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                }
            ];
            
            pinjamanData.push(...contohPinjaman);
        }
        
        if (barangData.length === 0) {
            const contohBarang = [
                {
                    id: 'BRG-001',
                    namaBarang: 'Beras Premium 5kg',
                    stok: 50,
                    hargaBeli: 60000,
                    hargaJual: 65000,
                    laba: 5000,
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                },
                {
                    id: 'BRG-002',
                    namaBarang: 'Minyak Goreng 2L',
                    stok: 30,
                    hargaBeli: 35000,
                    hargaJual: 38000,
                    laba: 3000,
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                }
            ];
            
            barangData.push(...contohBarang);
        }
        
        // Simpan ke localStorage
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
        localStorage.setItem('simpananData', JSON.stringify(simpananData));
        localStorage.setItem('pinjamanData', JSON.stringify(pinjamanData));
        localStorage.setItem('barangData', JSON.stringify(barangData));
        
        console.log('Initial data loaded');
    }

    // ===== UPDATE FUNGSI initializeFixedSystem =====
    function initializeFixedSystem() {
        console.log('=== STARTING FIXED SYSTEM INITIALIZATION ===');
        
        // 1. Fix real-time clock
        fixRealTimeClock();
        
        // 2. Load data
        loadLocalStorageData();
        
        // 3. Fix finance chart
        fixFinanceChart();
        
        // 4. Fix sidebar navigation
        fixSidebarNavigation();
        
        // 5. Fix action buttons
        fixActionButtons();
        
        // 6. Setup modal controls
        setupModalControls();
        
        // 7. Setup new member form
        setupNewMemberForm();
        
        // 8. Setup other buttons
        setupOtherButtons();
        
        // 9. Setup Tabungan Digital integration
        setupTabunganDigitalIntegration();
        
        // 10. Load initial data
        updateDashboardStats();
        
        // 11. Update current year
        const currentYear = new Date().getFullYear();
        document.getElementById('currentYear').textContent = currentYear;
        document.getElementById('currentYearFooter').textContent = currentYear;
        
        console.log('=== FIXED SYSTEM INITIALIZATION COMPLETED ===');
        showNotification('Dashboard Admin siap digunakan! Semua fitur sudah aktif.', 'success');
    }

    // ===== INISIALISASI SAAT DOM LOADED =====
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded - Starting fixed initialization...');
        
        // Initialize fixed system
        initializeFixedSystem();
        
        // Setup tab content visibility
        document.querySelectorAll('.tab-content').forEach(tab => {
            if (!tab.classList.contains('active')) {
                tab.style.display = 'none';
            }
        });
        
        // Setup active tab on page load
        const activeTab = document.querySelector('.sidebar-menu a.active');
        if (activeTab) {
            const tabId = activeTab.getAttribute('data-tab');
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.classList.add('active');
                targetTab.style.display = 'block';
            }
        }
        
        // Force initial data load
        setTimeout(() => {
            loadLocalStorageData();
            updateDashboardStats();
            fixFinanceChart();
            
            // Setup initial data jika kosong
            if (anggotaData.length === 0) {
                loadInitialData();
            }
        }, 1000);
    });
        // ===== ENHANCED SYNC SYSTEM DASHBOARD ADMIN =====
class DashboardSyncSystem {
    constructor() {
        this.isSyncing = false;
        this.init();
    }
    
    init() {
        console.log(' Initializing Dashboard Sync System...');
        this.setupUI();
        this.setupListeners();
        this.startPeriodicSync();
        console.log(' Dashboard Sync System Ready');
    }
    
    setupUI() {
        // Add sync button to top navigation
        const syncBtn = document.createElement('button');
        syncBtn.className = 'sync-button';
        syncBtn.id = 'adminSyncButton';
        syncBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Sync';
        syncBtn.style.position = 'fixed';
        syncBtn.style.top = '80px';
        syncBtn.style.right = '20px';
        syncBtn.style.zIndex = '9998';
        document.body.appendChild(syncBtn);
        
        syncBtn.addEventListener('click', () => this.manualSync());
    }
    
    setupListeners() {
        // Listen for storage events from Tabungan Digital
        window.addEventListener('storage', (e) => {
            if (e.key === 'koperasi_anggota' || 
                e.key === 'tabunganDigitalUsers' || 
                e.key === 'userTransaksi') {
                console.log(' Storage event from Tabungan Digital:', e.key);
                this.syncFromTabunganDigital();
            }
        });
        
        // Page visibility change
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                this.syncFromTabunganDigital();
            }
        });
    }
    
    startPeriodicSync() {
        // Sync every 10 seconds
        setInterval(() => this.syncFromTabunganDigital(), 10000);
        
        // Initial sync after 2 seconds
        setTimeout(() => this.syncFromTabunganDigital(), 2000);
    }
    
    manualSync() {
        console.log(' Manual sync from Dashboard');
        this.showNotification('Sinkronisasi manual dimulai...', 'info');
        this.syncFromTabunganDigital();
        this.pushToTabunganDigital();
    }
    
    syncFromTabunganDigital() {
        if (this.isSyncing) return;
        this.isSyncing = true;
        
        try {
            console.log(' Syncing FROM Tabungan Digital...');
            
            // 1. Get data from Tabungan Digital
            const tabunganUsers = JSON.parse(localStorage.getItem('tabunganDigitalUsers') || '[]');
            const userTransaksi = JSON.parse(localStorage.getItem('userTransaksi') || '[]');
            
            console.log(' Data from Tabungan:', {
                users: tabunganUsers.length,
                transaksi: userTransaksi.length
            });
            
            let updatedCount = 0;
            let newMembersCount = 0;
            
            // 2. Sync anggota data
            tabunganUsers.forEach(user => {
                // Find existing member by email or whatsapp or NIK
                let existingMember = anggotaData.find(m => 
                    m.email === user.email || 
                    m.whatsapp === user.telepon ||
                    m.whatsapp === user.whatsapp ||
                    m.nik === user.nik
                );
                
                if (existingMember) {
                    // UPDATE existing member
                    const changes = this.updateMemberFromTabungan(existingMember, user);
                    if (changes) {
                        updatedCount++;
                    }
                } else {
                    // ADD new member from Tabungan Digital
                    this.addMemberFromTabungan(user);
                    newMembersCount++;
                }
            });
            
            // 3. Sync transactions
            const newTransactions = this.syncTransactionsFromTabungan(userTransaksi);
            
            // 4. Save to localStorage
            if (updatedCount > 0 || newMembersCount > 0) {
                localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
                localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
                
                // Refresh UI
                refreshAnggotaTable();
                updateDashboardStats();
            }
            
            // 5. Save simpanan data if there are new transactions
            if (newTransactions > 0) {
                localStorage.setItem('simpananData', JSON.stringify(simpananData));
                refreshSimpananTable();
            }
            
            // 6. Show summary
            if (updatedCount > 0 || newMembersCount > 0 || newTransactions > 0) {
                const summary = [];
                if (newMembersCount > 0) summary.push(`${newMembersCount} anggota baru`);
                if (updatedCount > 0) summary.push(`${updatedCount} anggota diperbarui`);
                if (newTransactions > 0) summary.push(`${newTransactions} transaksi baru`);
                
                this.showNotification(`Disinkron dari Tabungan Digital: ${summary.join(', ')}`, 'success');
            }
            
        } catch (error) {
            console.error(' Error syncing from Tabungan Digital:', error);
            this.showNotification('Gagal sinkronisasi: ' + error.message, 'error');
        } finally {
            this.isSyncing = false;
        }
    }
    
    updateMemberFromTabungan(existingMember, userData) {
        let changes = false;
        
        // Update personal data
        if (userData.nama && existingMember.nama !== userData.nama) {
            existingMember.nama = userData.nama;
            changes = true;
        }
        
        if (userData.telepon && existingMember.whatsapp !== userData.telepon) {
            existingMember.whatsapp = userData.telepon;
            changes = true;
        }
        
        if (userData.alamat && existingMember.alamat !== userData.alamat) {
            existingMember.alamat = userData.alamat;
            changes = true;
        }
        
        // Update simpanan data
        if (userData.simpananPokok !== undefined) {
            const pokokValue = parseInt(userData.simpananPokok) || 0;
            if (existingMember.simpananPokok !== pokokValue) {
                existingMember.simpananPokok = pokokValue;
                changes = true;
            }
        }
        
        if (userData.simpananWajib !== undefined) {
            const wajibValue = parseInt(userData.simpananWajib) || 0;
            if (existingMember.simpananWajib !== wajibValue) {
                existingMember.simpananWajib = wajibValue;
                changes = true;
            }
        }
        
        if (userData.simpananSukarela !== undefined) {
            const sukarelaValue = parseInt(userData.simpananSukarela) || 0;
            if (existingMember.simpananSukarela !== sukarelaValue) {
                existingMember.simpananSukarela = sukarelaValue;
                changes = true;
            }
        }
        
        // Recalculate total simpanan
        if (changes) {
            existingMember.totalSimpanan = 
                (existingMember.simpananPokok || 0) + 
                (existingMember.simpananWajib || 0) + 
                (existingMember.simpananSukarela || 0);
            
            existingMember.lastUpdated = new Date().toISOString();
            existingMember.updatedBy = 'Tabungan Digital Sync';
        }
        
        return changes;
    }
    
    addMemberFromTabungan(userData) {
        // Generate NIA
        const newNIA = generateNIA();
        
        const newMember = {
            id: newNIA,
            nia: newNIA,
            posisi: 'Anggota',
            nama: userData.nama || userData.fullName || 'Anggota Baru',
            alamat: userData.alamat || '',
            jenisKelamin: userData.jenisKelamin || 'Laki-laki',
            agama: userData.agama || 'Islam',
            status: 'Belum Menikah',
            email: userData.email || '',
            whatsapp: userData.telepon || userData.whatsapp || '',
            nik: userData.nik || '',
            tanggalDaftar: userData.tanggalDaftar || new Date().toLocaleDateString('id-ID'),
            statusAktif: 'Aktif',
            foto: userData.foto || userData.profilePicture || 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjh1oM43gxD4iCHpHRBrrbkCHRU5MigalAWf4G5x-cTLfRRxWeeTwGqwNz8FtSdSgcexhRAIWMX7eZoOxo0b-i8kB2EUr44TCkMCZ8VVfQTJpL0AgptbY8hjsTZtqg6jbS2MMOuIVf9FvNOR-JsZr4dvrpqTQT0I5qY5OB063z38W0mTIVhQrBPTASmQp0/s1280/1000175639.jpg',
            simpananPokok: userData.simpananPokok || 0,
            simpananWajib: userData.simpananWajib || 0,
            simpananSukarela: userData.simpananSukarela || 0,
            totalSimpanan: (userData.simpananPokok || 0) + (userData.simpananWajib || 0) + (userData.simpananSukarela || 0),
            totalPinjaman: 0,
            saldo: 0,
            password: userData.password || '',
            createdAt: new Date().toISOString(),
            lastUpdated: new Date().toISOString(),
            sumber: 'Tabungan Digital'
        };
        
        anggotaData.push(newMember);
        console.log(' Member added from Tabungan Digital:', newMember.nama);
        
        return newMember;
    }
    
    syncTransactionsFromTabungan(transactions) {
        let newTransactions = 0;
        
        transactions.forEach(transaksi => {
            // Find the member
            const anggota = anggotaData.find(a => 
                a.email === transaksi.email || 
                a.whatsapp === transaksi.telepon
            );
            
            if (!anggota) return;
            
            // Check if transaction is for simpanan
            if (transaksi.jenis === 'simpanan' || transaksi.jenis === 'setor') {
                // Determine jenis simpanan from keterangan
                let jenisSimpanan = 'Sukarela';
                if (transaksi.keterangan) {
                    if (transaksi.keterangan.toLowerCase().includes('pokok')) jenisSimpanan = 'Pokok';
                    else if (transaksi.keterangan.toLowerCase().includes('wajib')) jenisSimpanan = 'Wajib';
                }
                
                // Check if transaction already exists
                const exists = simpananData.find(s => 
                    s.idAnggota === anggota.id && 
                    s.jenisSimpanan === jenisSimpanan &&
                    s.nominal === parseInt(transaksi.nominal || transaksi.jumlah) &&
                    s.tanggalSetor === transaksi.tanggal
                );
                
                if (!exists) {
                    const newSimpanan = {
                        id: 'TD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                        idAnggota: anggota.id,
                        nama: anggota.nama,
                        jenisSimpanan: jenisSimpanan,
                        tanggalSetor: transaksi.tanggal || new Date().toLocaleDateString('id-ID'),
                        nominal: parseInt(transaksi.nominal || transaksi.jumlah || 0),
                        keterangan: transaksi.keterangan || 'Setoran dari Tabungan Digital',
                        sumber: 'Tabungan Digital',
                        createdAt: new Date().toISOString()
                    };
                    
                    simpananData.push(newSimpanan);
                    newTransactions++;
                    
                    // Update member's simpanan
                    if (jenisSimpanan === 'Pokok') {
                        anggota.simpananPokok = (anggota.simpananPokok || 0) + newSimpanan.nominal;
                    } else if (jenisSimpanan === 'Wajib') {
                        anggota.simpananWajib = (anggota.simpananWajib || 0) + newSimpanan.nominal;
                    } else {
                        anggota.simpananSukarela = (anggota.simpananSukarela || 0) + newSimpanan.nominal;
                    }
                    
                    // Recalculate total
                    anggota.totalSimpanan = 
                        (anggota.simpananPokok || 0) + 
                        (anggota.simpananWajib || 0) + 
                        (anggota.simpananSukarela || 0);
                }
            }
        });
        
        return newTransactions;
    }
    
    pushToTabunganDigital() {
        try {
            console.log(' Pushing TO Tabungan Digital...');
            
            // Prepare data for Tabungan Digital
            const tabunganDigitalUsers = [];
            
            anggotaData.forEach(member => {
                const userData = {
                    email: member.email,
                    nama: member.nama,
                    fullName: member.nama,
                    alamat: member.alamat,
                    jenisKelamin: member.jenisKelamin,
                    agama: member.agama,
                    telepon: member.whatsapp,
                    whatsapp: member.whatsapp,
                    nik: member.nik,
                    tanggalDaftar: member.tanggalDaftar,
                    foto: member.foto,
                    profilePicture: member.foto,
                    simpananPokok: member.simpananPokok || 0,
                    simpananWajib: member.simpananWajib || 0,
                    simpananSukarela: member.simpananSukarela || 0,
                    password: member.password || '',
                    saldo: member.totalSimpanan || 0,
                    statusAktif: member.statusAktif || 'Aktif',
                    createdAt: member.createdAt,
                    lastUpdated: member.lastUpdated
                };
                
                tabunganDigitalUsers.push(userData);
            });
            
            // Save to localStorage for Tabungan Digital
            localStorage.setItem('tabunganDigitalUsers', JSON.stringify(tabunganDigitalUsers));
            
            // Also save to koperasi_anggota for compatibility
            localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
            
            // Create koperasiData for EnhancedSyncSystem
            const koperasiData = {
                adminUpdates: {},
                userUpdates: {},
                lastSync: new Date().toISOString()
            };
            
            localStorage.setItem('koperasiData', JSON.stringify(koperasiData));
            
            console.log(' Pushed to Tabungan Digital:', tabunganDigitalUsers.length, 'users');
            this.showNotification('Data telah dikirim ke Tabungan Digital', 'success');
            
        } catch (error) {
            console.error(' Error pushing to Tabungan Digital:', error);
            this.showNotification('Gagal mengirim data: ' + error.message, 'error');
        }
    }
    
    showNotification(message, type = 'info') {
        // Use existing notification function or create new one
        if (typeof showNotification === 'function') {
            showNotification(message, type);
        } else {
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
    }
}

// ===== UPDATE FUNGSI SIMPAN DATA ANGGOTA =====
// Modify the saveMemberData function to also update Tabungan Digital

async function saveMemberDataEnhanced() {
    const success = await saveMemberData();
    
    if (success) {
        // Push changes to Tabungan Digital
        if (window.dashboardSync) {
            window.dashboardSync.pushToTabunganDigital();
        }
    }
    
    return success;
}

// ===== FUNGSI UPDATE TABUNGAN DIGITAL DARI DASHBOARD =====
function updateTabunganDigitalFromMember(member) {
    try {
        // Get existing tabunganDigitalUsers
        const tabunganUsers = JSON.parse(localStorage.getItem('tabunganDigitalUsers') || '[]');
        
        // Find user by email
        const userIndex = tabunganUsers.findIndex(u => u.email === member.email);
        
        if (userIndex !== -1) {
            // Update existing user
            tabunganUsers[userIndex] = {
                ...tabunganUsers[userIndex],
                nama: member.nama,
                fullName: member.nama,
                alamat: member.alamat,
                jenisKelamin: member.jenisKelamin,
                agama: member.agama,
                telepon: member.whatsapp,
                whatsapp: member.whatsapp,
                nik: member.nik,
                simpananPokok: member.simpananPokok || 0,
                simpananWajib: member.simpananWajib || 0,
                simpananSukarela: member.simpananSukarela || 0,
                saldo: member.totalSimpanan || 0,
                statusAktif: member.statusAktif || 'Aktif',
                lastUpdated: new Date().toISOString()
            };
        } else {
            // Add new user
            tabunganUsers.push({
                email: member.email,
                nama: member.nama,
                fullName: member.nama,
                alamat: member.alamat,
                jenisKelamin: member.jenisKelamin,
                agama: member.agama,
                telepon: member.whatsapp,
                whatsapp: member.whatsapp,
                nik: member.nik,
                tanggalDaftar: member.tanggalDaftar,
                foto: member.foto || 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjh1oM43gxD4iCHpHRBrrbkCHRU5MigalAWf4G5x-cTLfRRxWeeTwGqwNz8FtSdSgcexhRAIWMX7eZoOxo0b-i8kB2EUr44TCkMCZ8VVfQTJpL0AgptbY8hjsTZtqg6jbS2MMOuIVf9FvNOR-JsZr4dvrpqTQT0I5qY5OB063z38W0mTIVhQrBPTASmQp0/s1280/1000175639.jpg',
                profilePicture: member.foto || 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjh1oM43gxD4iCHpHRBrrbkCHRU5MigalAWf4G5x-cTLfRRxWeeTwGqwNz8FtSdSgcexhRAIWMX7eZoOxo0b-i8kB2EUr44TCkMCZ8VVfQTJpL0AgptbY8hjsTZtqg6jbS2MMOuIVf9FvNOR-JsZr4dvrpqTQT0I5qY5OB063z38W0mTIVhQrBPTASmQp0/s1280/1000175639.jpg',
                simpananPokok: member.simpananPokok || 0,
                simpananWajib: member.simpananWajib || 0,
                simpananSukarela: member.simpananSukarela || 0,
                password: member.password || '',
                saldo: member.totalSimpanan || 0,
                statusAktif: member.statusAktif || 'Aktif',
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            });
        }
        
        // Save back to localStorage
        localStorage.setItem('tabunganDigitalUsers', JSON.stringify(tabunganUsers));
        
        console.log(' Tabungan Digital updated for:', member.nama);
        return true;
        
    } catch (error) {
        console.error(' Error updating Tabungan Digital:', error);
        return false;
    }
}

// ===== FUNGSI UPDATE SIMPANAN KE TABUNGAN DIGITAL =====
function updateSimpananToTabunganDigital(simpanan) {
    try {
        // Get existing tabunganDigitalUsers
        const tabunganUsers = JSON.parse(localStorage.getItem('tabunganDigitalUsers') || '[]');
        
        // Find member
        const member = anggotaData.find(m => m.id === simpanan.idAnggota);
        if (!member) return false;
        
        // Find user in tabunganUsers
        const userIndex = tabunganUsers.findIndex(u => u.email === member.email);
        if (userIndex === -1) return false;
        
        // Update simpanan based on jenis
        const user = tabunganUsers[userIndex];
        
        switch(simpanan.jenisSimpanan) {
            case 'Pokok':
                user.simpananPokok = (user.simpananPokok || 0) + simpanan.nominal;
                member.simpananPokok = (member.simpananPokok || 0) + simpanan.nominal;
                break;
            case 'Wajib':
                user.simpananWajib = (user.simpananWajib || 0) + simpanan.nominal;
                member.simpananWajib = (member.simpananWajib || 0) + simpanan.nominal;
                break;
            case 'Sukarela':
                user.simpananSukarela = (user.simpananSukarela || 0) + simpanan.nominal;
                member.simpananSukarela = (member.simpananSukarela || 0) + simpanan.nominal;
                break;
        }
        
        // Update total saldo
        user.saldo = (user.simpananPokok || 0) + (user.simpananWajib || 0) + (user.simpananSukarela || 0);
        member.totalSimpanan = (member.simpananPokok || 0) + (member.simpananWajib || 0) + (member.simpananSukarela || 0);
        
        // Update last updated
        user.lastUpdated = new Date().toISOString();
        member.lastUpdated = new Date().toISOString();
        
        // Save back to localStorage
        localStorage.setItem('tabunganDigitalUsers', JSON.stringify(tabunganUsers));
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        localStorage.setItem('koperasi_anggota', JSON.stringify(anggotaData));
        
        console.log(' Simpanan updated in Tabungan Digital:', member.nama, simpanan.jenisSimpanan, simpanan.nominal);
        return true;
        
    } catch (error) {
        console.error(' Error updating simpanan to Tabungan Digital:', error);
        return false;
    }
}

// ===== MODIFIKASI FUNGSI saveMemberData =====
// Replace the existing saveMemberData function with this enhanced version

async function saveMemberDataEnhancedVersion() {
    // ... [existing saveMemberData code remains the same] ...
    
    // After saving to anggotaData and localStorage, add:
    
    // Update Tabungan Digital
    const tabunganUpdated = updateTabunganDigitalFromMember(memberData);
    
    if (tabunganUpdated) {
        showNotification('Data juga telah disinkronkan ke Tabungan Digital!', 'success');
    }
    
    return true;
}

// ===== MODIFIKASI FUNGSI saveSimpanan (jika ada) =====
async function saveSimpananDataEnhanced(simpananData) {
    // ... [existing simpanan save code] ...
    
    // After saving simpanan, update Tabungan Digital
    const updated = updateSimpananToTabunganDigital(simpananData);
    
    if (updated) {
        // Also trigger sync
        if (window.dashboardSync) {
            window.dashboardSync.pushToTabunganDigital();
        }
    }
}

// ===== INISIALISASI SISTEM SINKRONISASI =====
// Add to the initializeFixedSystem function

function initializeFixedSystemEnhanced() {
    // ... [existing initialization code] ...
    
    // Initialize Dashboard Sync System
    window.dashboardSync = new DashboardSyncSystem();
    
    // Replace saveMemberData with enhanced version
    window.saveMemberData = saveMemberDataEnhancedVersion;
    
    console.log(' Enhanced Sync System initialized');
}
</script>
</body>
</html>

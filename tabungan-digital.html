<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buku Tabungan Digital - Koperasi Asmara Tani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #1a5f23;
            --primary-light: #2e7d32;
            --primary-dark: #0d4014;
            --secondary: #ff9800;
            --accent-blue: #2196f3;
            --accent-purple: #9c27b0;
            --danger: #f44336;
            --warning: #ffc107;
            --success: #4caf50;
            --info: #2196f3;
            
            --bg-light: #f5f6fa;
            --card-bg: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-muted: #888888;
            --border-color: #eeeeee;
            
            --shadow-light: 0 10px 30px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 15px 35px rgba(0, 0, 0, 0.1);
            --shadow-dark: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f8fff8 0%, #f0f7f0 50%, #e8f5e9 100%);
            color: var(--text-primary);
            padding: 20px;
            padding-bottom: 30px;
            min-height: 100vh;
        }

        .back-home {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255, 255, 255, 0.95);
            color: var(--primary);
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-home:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .real-time-indicator {
            position: fixed;
            top: 10px;
            right: 70px;
            z-index: 9999;
        }
        
        .sync-badge {
            background: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .online-indicator {
            position: fixed;
            top: 15px;
            right: 120px;
            background: #2196f3;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 9999;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
            display: none;
        }

        /* Sync Button Styles */
        .sync-button {
            position: fixed;
            top: 15px;
            right: 180px;
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 11px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 9999;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
            transition: all 0.3s ease;
        }
        
        .sync-button:hover {
            background: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }
        
        .sync-button.syncing {
            background: var(--warning);
            animation: pulse 1s infinite;
        }
        
        .sync-button.success {
            background: var(--success);
        }
        
        .sync-button.error {
            background: var(--danger);
        }

        .profile-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 40px auto 20px;
            max-width: 600px;
            box-shadow: var(--shadow-medium);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid var(--primary-light);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            background: var(--success);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .username {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .last-sync-time {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .btn-area {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn.qr {
            background: var(--accent-blue);
            color: white;
        }

        .btn.pro {
            background: var(--primary);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .plan-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            box-shadow: var(--shadow-medium);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .plan-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .plan-icon {
            width: 50px;
            height: 50px;
            background: #f0f7f0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .plan-text h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .real-time-status {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* ===== STYLE KARTU HOLOGRAM STATIC ===== */
        .hologram-static-card {
            background: linear-gradient(135deg, 
                rgba(26, 95, 35, 0.12) 0%,
                rgba(46, 125, 50, 0.08) 25%,
                rgba(76, 175, 80, 0.05) 50%,
                rgba(129, 199, 132, 0.03) 75%,
                rgba(200, 230, 201, 0.01) 100%
            );
            border: 2px solid rgba(26, 95, 35, 0.25);
            border-radius: 20px;
            padding: 25px;
            margin: 20px auto;
            max-width: 600px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(8px);
            box-shadow: 
                0 10px 35px rgba(26, 95, 35, 0.15),
                0 0 0 1px rgba(46, 125, 50, 0.1) inset,
                0 0 50px rgba(76, 175, 80, 0.08) inset;
            animation: hologramGlowStatic 6s ease-in-out infinite alternate;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hologram-static-card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 15px 45px rgba(26, 95, 35, 0.25),
                0 0 0 2px rgba(46, 125, 50, 0.15) inset,
                0 0 70px rgba(76, 175, 80, 0.12) inset;
            border-color: rgba(26, 95, 35, 0.4);
        }

        .hologram-static-card:active {
            transform: translateY(-2px);
            transition: transform 0.1s;
        }

        .hologram-static-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(90deg, #2e7d32 0%, #4caf50 100%);
            animation: hologramScanStatic 12s linear infinite;
            z-index: 1;
        }

        .hologram-static-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(
                circle at 30% 20%,
                rgba(76, 175, 80, 0.06) 0%,
                transparent 50%
            );
            z-index: 0;
        }

        .hologram-static-content {
            position: relative;
            z-index: 2;
        }

        .hologram-static-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(26, 95, 35, 0.2);
        }

        .hologram-static-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #0d4014;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .hologram-static-subtitle {
            color: rgba(13, 64, 20, 0.8);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* 1. CSS GRID SEPERTI YANG DIMINTA */
        .hologram-static-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        /* 1. STAT-ITEM SEPERTI YANG DIMINTA */
        .hologram-static-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 120px;
        }

        .hologram-static-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(26, 95, 35, 0.1);
            background: #f0f7f0;
        }

        .hologram-static-icon {
           width: 40px;
           height: 40px;
           border-radius: 50%;
           background: rgba(26, 95, 35, 0.1);
           display: flex;
           align-items: center;
           justify-content: center;
           margin-bottom: 10px;
           font-size: 1.1rem;
           color: #1a5f23;
         }

        /* 1. STAT-VALUE SEPERTI YANG DIMINTA */
        .hologram-static-value {
           font-size: 1.3rem;
           font-weight: 700;
           color: #1a5f23;
           margin-bottom: 5px;
           min-height: 28px;
           display: flex;
           align-items: center;
           justify-content: center;
         }

        .hologram-static-label {
           font-size: 0.8rem;
           color: rgba(13, 64, 20, 0.7);
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
         }

        .hologram-static-footer {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(26, 95, 35, 0.2);
            color: rgba(13, 64, 20, 0.7);
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hologram-static-update {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.75rem;
        }

        .hologram-static-click {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #1a5f23;
            font-weight: 500;
            font-size: 0.75rem;
        }

        /* ===== MODAL STYLE KHUSUS UNTUK HOLOGRAM ===== */
        .hologram-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .hologram-modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .hologram-modal-content {
            background: linear-gradient(145deg, 
                rgba(255, 255, 255, 0.98) 0%,
                rgba(245, 248, 246, 0.99) 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            position: relative;
            transform: translateY(30px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(76, 175, 80, 0.3);
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.35),
                0 0 0 1px rgba(76, 175, 80, 0.2),
                0 0 120px rgba(76, 175, 80, 0.1);
            overflow: hidden;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .hologram-modal-overlay.active .hologram-modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .hologram-modal-header {
            background: linear-gradient(135deg, 
                rgba(26, 95, 35, 0.95) 0%,
                rgba(46, 125, 50, 0.9) 100%);
            padding: 25px 30px;
            color: white;
            position: relative;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .hologram-modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .hologram-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.8rem;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            font-weight: bold;
        }

        .hologram-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg) scale(1.1);
        }

        .hologram-modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        /* Style untuk konten hologram di dalam modal - TETAP SEPERTI AWAL */
        .hologram-card {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.97) 0%,
                rgba(240, 247, 240, 0.98) 100%);
            border-radius: 18px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(76, 175, 80, 0.2);
            box-shadow: 
                0 10px 30px rgba(26, 95, 35, 0.12),
                inset 0 0 50px rgba(76, 175, 80, 0.05);
        }

        .hologram-card::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: linear-gradient(90deg, #2e7d32 0%, #4caf50 100%);
            animation: hologramScanStatic 12s linear infinite;
            z-index: 1;
        }
            animation: hologramScanStatic 8s linear infinite;
            z-index: 1;
        }

        .hologram-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(76, 175, 80, 0.25);
            position: relative;
            z-index: 2;
        }

        .hologram-header h3 {
            color: #0d4014;
            font-size: 1.6rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .hologram-header p {
            color: rgba(13, 64, 20, 0.8);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .hologram-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        .hologram-item {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(76, 175, 80, 0.15);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .hologram-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px rgba(26, 95, 35, 0.15);
            border-color: rgba(76, 175, 80, 0.3);
        }

        .hologram-item.full-width {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, 
                rgba(240, 247, 240, 0.95) 0%,
                rgba(230, 242, 230, 0.98) 100%);
            border: 2px solid rgba(76, 175, 80, 0.25);
        }

        .hologram-label {
            font-size: 0.85rem;
            color: rgba(13, 64, 20, 0.85);
            margin-bottom: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hologram-value {
            font-size: 1.4rem;
            font-weight: 800;
            color: #0d4014;
            margin-bottom: 8px;
        }

        .hologram-value.rp {
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5px;
        }

        .hologram-status {
            display: inline-block;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-aktif {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.18), rgba(56, 142, 60, 0.22));
            color: #1b5e20;
            border: 2px solid rgba(76, 175, 80, 0.4);
        }

        .status-tidak-aktif {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.15), rgba(229, 57, 53, 0.2));
            color: #c62828;
            border: 2px solid rgba(244, 67, 54, 0.3);
        }

        .hologram-footer {
            text-align: center;
            padding-top: 20px;
            border-top: 2px solid rgba(76, 175, 80, 0.2);
            color: rgba(13, 64, 20, 0.8);
            font-size: 0.85rem;
            position: relative;
            z-index: 2;
        }

        .hologram-footer p {
            margin: 8px 0;
            display: flex;
                align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* MODAL FOOTER DENGAN TOMBOL AKSI */
        .hologram-modal-footer {
            padding: 20px 30px;
            background: rgba(245, 248, 246, 0.98);
            border-top: 2px solid rgba(76, 175, 80, 0.15);
            box-shadow: 0 -5px 20px rgba(26, 95, 35, 0.08);
        }

        .hologram-modal-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .hologram-modal-btn {
            padding: 14px 32px;
            border-radius: 12px;
            border: none;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 160px;
            justify-content: center;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .hologram-modal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .hologram-modal-btn:active {
            transform: translateY(-1px);
            transition: transform 0.1s;
        }

        /* TOMBOL TUTUP (SECONDARY) */
        .hologram-btn-secondary {
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            color: #666;
            border: 2px solid #ddd;
        }

        .hologram-btn-secondary:hover {
            background: linear-gradient(135deg, #e8e8e8 0%, #dbdbdb 100%);
            color: #555;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border-color: #ccc;
        }

        /* TOMBOL CETAK KARTU */
        .hologram-btn-print {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 20px rgba(33, 150, 243, 0.25);
        }

        .hologram-btn-print:hover {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            box-shadow: 0 8px 30px rgba(33, 150, 243, 0.4);
            transform: translateY(-3px);
        }

        /* Animations */
        @keyframes hologramGlowStatic {
            0% {
                box-shadow: 
                    0 10px 35px rgba(26, 95, 35, 0.15),
                    0 0 0 1px rgba(46, 125, 50, 0.1) inset,
                    0 0 50px rgba(76, 175, 80, 0.08) inset;
            }
            100% {
                box-shadow: 
                    0 10px 35px rgba(26, 95, 35, 0.2),
                    0 0 0 1px rgba(46, 125, 50, 0.15) inset,
                    0 0 60px rgba(76, 175, 80, 0.1) inset;
            }
        }

        @keyframes hologramScanStatic {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .menu-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            box-shadow: var(--shadow-medium);
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: #f8f9fa;
            border-radius: 10px;
        }

        .menu-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f7f0;
            border-radius: 10px;
        }

        .menu-text {
            font-weight: 500;
        }

        .menu-right {
            color: var(--text-muted);
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* ===== MODAL STYLES ENHANCEMENT ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-dark);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 20px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 95, 35, 0.1);
        }

        .form-control:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
            color: #666;
        }

        .readonly-field {
            background-color: #f8f9fa !important;
            color: #666 !important;
            border: 1px solid #e0e0e0 !important;
            cursor: not-allowed !important;
            opacity: 0.8;
        }

        /* Password field with eye toggle */
        .password-field {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.3s ease;
        }

        .password-toggle:hover {
            color: var(--primary);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .modal-btn.primary {
            background: var(--primary);
            color: white;
        }

        .modal-btn.secondary {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .modal-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .modal-btn:active {
            transform: translateY(0);
        }

        /* QR Modal Design */
        .qr-modal-design {
            padding: 10px;
        }

        .qr-title {
            text-align: center;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .qr-card {
            background: linear-gradient(135deg, #1a5f23 0%, #2e7d32 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
            box-shadow: var(--shadow-medium);
        }

        .qr-person-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .qr-person-photo {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid white;
        }

        .qr-person-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .qr-person-details h4 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .qr-person-details p {
            font-size: 0.85rem;
            margin-bottom: 2px;
            opacity: 0.9;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .action-btn.whatsapp {
            background: #25D366;
            color: white;
        }

        .action-btn.download {
            background: var(--accent-blue);
            color: white;
        }

        .action-btn.pdf {
            background: #f44336;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        /* Photo Upload Container */
        .photo-upload-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .photo-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 15px;
            border: 4px solid var(--primary-light);
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-btn {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Anggota Status Info */
        .anggota-status-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .anggota-status-info h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .anggota-status-info ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .anggota-status-info li {
            padding: 5px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        .anggota-status-info li:last-child {
            border-bottom: none;
        }

        /* Financial Details */
        .financial-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .financial-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .financial-item:last-child {
            border-bottom: none;
        }

        .financial-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .financial-value {
            font-weight: 600;
            color: var(--primary);
        }

        /* Kartu Container */
        .kartu-container {
            padding: 10px;
        }

        .kartu-digital {
            background: linear-gradient(135deg, #1a5f23 0%, #2e7d32 100%);
            border-radius: 20px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .kartu-digital::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .kartu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .kartu-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .kartu-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .kartu-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .kartu-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid white;
        }

        .kartu-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .kartu-details h4 {
            font-size: 1.3rem;
            margin-bottom: 8px;
        }

        .kartu-details p {
            font-size: 0.85rem;
            margin-bottom: 3px;
            opacity: 0.9;
        }

        .kartu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .grid-item {
            display: flex;
            flex-direction: column;
        }

        .grid-label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: 3px;
        }

        .grid-value {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .kartu-qr-section {
            text-align: center;
            padding-top: 15px;
            border-top: 2px solid rgba(255, 255, 255, 0.2);
        }

        .kartu-qr-container {
            display: inline-block;
            background: white;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .qr-code-text {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* Password Section */
        .password-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .password-toggle-link {
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .password-toggle-link:hover {
            text-decoration: underline;
        }

        /* Password Modal */
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .password-modal.active {
            display: flex;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-medium);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.info {
            background: var(--info);
        }

        /* Print Preview */
        .print-preview {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }

        .print-canvas-container {
            text-align: center;
            margin: 20px 0;
        }

        .print-canvas-container canvas {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: var(--shadow-medium);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sync-button {
                right: 100px;
                top: 60px;
            }
            
            .online-indicator {
                right: 15px;
                top: 45px;
            }

            .modal-content {
                width: 95%;
                max-height: 85vh;
            }
            
            .kartu-grid {
                grid-template-columns: 1fr;
            }
            
            .kartu-info {
                flex-direction: column;
                text-align: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .qr-person-info {
                flex-direction: column;
                text-align: center;
            }
            
            .modal-actions {
                flex-direction: column;
            }

            .hologram-static-card {
                padding: 20px;
                margin: 15px auto;
            }
            
            .hologram-static-title {
                font-size: 1.2rem;
            }
            
            .hologram-static-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .hologram-static-item {
                padding: 12px;
            }
            
            .hologram-static-value {
                font-size: 1.2rem;
            }
            
            .hologram-modal-content {
                width: 95%;
                margin: 10px;
            }
            
            .hologram-modal-body {
                padding: 20px;
            }
            
            .hologram-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .hologram-item.full-width {
                grid-column: 1 / -1;
            }
            
            .hologram-modal-actions {
                flex-direction: column;
                gap: 15px;
            }
            
            .hologram-modal-btn {
                width: 100%;
                min-width: auto;
                padding: 14px 20px;
            }
        }

        @media (max-width: 576px) {
            .hologram-static-card {
                padding: 15px;
                border-radius: 15px;
            }
            
            .hologram-static-title {
                font-size: 1.1rem;
            }
            
            .hologram-static-footer {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }
            
            .hologram-modal-header {
                padding: 20px;
            }
            
            .hologram-modal-header h3 {
                font-size: 1.3rem;
            }
            
            .hologram-modal-close {
                top: 15px;
                right: 15px;
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }
            
            .hologram-grid {
                grid-template-columns: 1fr;
            }
            
            .hologram-item {
                padding: 18px;
            }
            
            .hologram-modal-footer {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <button class="back-home" onclick="window.location.href='index.html'">
        <i class="fas fa-arrow-left"></i> Beranda
    </button>
    
    <div class="real-time-indicator">
        <div class="sync-badge" id="syncIndicator">
            <i class="fas fa-sync-alt"></i>
            <span>Real-time</span>
        </div>
    </div>

    <div class="online-indicator" id="onlineIndicator">
        <i class="fas fa-wifi"></i>
        <span>Online Sync</span>
    </div>
    
    <!-- MANUAL SYNC BUTTON -->
    <button class="sync-button" id="manualSyncButton" title="Klik untuk sinkronisasi manual">
        <i class="fas fa-sync-alt"></i> Sync Now
    </button>

    <!-- ===== PROFILE HEADER ===== -->
    <div class="profile-container">
        <div class="profile-header">
            <div class="avatar">
                <img id="profileAvatar" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjh1oM43gxD4iCHpHRBrrbkCHRU5MigalAWf4G5x-cTLfRRxWeeTwGqwNz8FtSdSgcexhRAIWMX7eZoOxo0b-i8kB2EUr44TCkMCZ8VVfQTJpL0AgptbY8hjsTZtqg6jbS2MMOuIVf9FvNOR-JsZr4dvrpqTQT0I5qY5OB063z38W0mTIVhQrBPTASmQp0/s1280/1000175639.jpg" alt="Profile">
            </div>
            <div class="user-info">
                <h2 id="profileName">Loading... <span class="badge" id="statusBadge">üîÑ</span></h2>
                <div class="username" id="profileRole">@loading</div>
                <div class="last-sync-time" id="lastSyncTime">Terakhir update: -</div>
                <div class="last-sync-time" id="lastAdminUpdate">Update admin: -</div>
            </div>
        </div>

        <div class="btn-area">
            <button class="btn qr" id="qrButton">
                <i class="fas fa-qrcode"></i> QR Code Hybrid
            </button>
            <button class="btn pro" id="editProfileButton">
                <i class="fas fa-edit"></i> Edit Profil
            </button>
        </div>
    </div>

    <!-- ===== CARD PLAN ===== -->
    <div class="plan-card">
        <div class="plan-left">
            <div class="plan-icon">
                <i class="fas fa-book-open" style="color: #333;"></i>
            </div>
            <div class="plan-text">
                <h3 id="tabunganTitle">Tabungan Digital</h3>
                <p id="tabunganStatus" class="real-time-status">Memuat data real-time...</p>
                <p id="syncStatus" style="font-size: 0.8rem; color: #666;">Status sinkronisasi: <span id="syncStatusText">Memeriksa...</span></p>
            </div>
        </div>
    </div>

    <!-- ===== HOLOGRAM STATIC CARD ===== -->
    <div class="hologram-static-card" id="hologramStaticCard">
        <div class="hologram-static-content">
            <div class="hologram-static-header">
                <div class="hologram-static-title">
                    <i class="fas fa-id-card"></i>
                    RINGKASAN KEUANGAN ANGGOTA
                </div>
                <div class="hologram-static-subtitle">
                    Data Real-time Up To Date
                </div>
            </div>
            
            <div class="hologram-static-grid" id="hologramStaticGrid">
                <div class="hologram-static-item">
                    <div class="hologram-static-icon">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div class="hologram-static-value" id="hologramTotalSimpanan">
                        <!-- KOSONGKAN, akan diisi JavaScript -->
                    </div>
                    <div class="hologram-static-label">
                        Total Simpanan
                    </div>
                </div>
                
                <div class="hologram-static-item">
                    <div class="hologram-static-icon">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <div class="hologram-static-value" id="hologramTotalPinjaman">
                        <!-- KOSONGKAN, akan diisi JavaScript -->
                    </div>
                    <div class="hologram-static-label">
                        Total Pinjaman
                    </div>
                </div>
                
                <div class="hologram-static-item">
                    <div class="hologram-static-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="hologram-static-value" id="hologramSHUEstimasi">
                        <!-- KOSONGKAN, akan diisi JavaScript -->
                    </div>
                    <div class="hologram-static-label">
                        SHU Estimasi
                    </div>
                </div>
                
                <div class="hologram-static-item">
                    <div class="hologram-static-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="hologram-static-value" id="hologramStatusAnggota">
                        <!-- KOSONGKAN, akan diisi JavaScript -->
                    </div>
                    <div class="hologram-static-label">
                        Status Anggota
                    </div>
                </div>
            </div>
            
            <div class="hologram-static-footer">
                <div class="hologram-static-update" id="hologramUpdateTime">
                    <i class="fas fa-sync-alt fa-spin"></i>
                    Memuat data...
                </div>
                <div class="hologram-static-click">
                    <i class="fas fa-hand-pointer"></i>
                    Klik kartu untuk detail
                </div>
            </div>
        </div>
    </div>

    <!-- ===== MENU UTAMA ===== -->
    <div class="menu-section">
        <div class="menu-item" data-action="setor">
            <div class="menu-left">
                <div class="menu-icon">üì•</div>
                <div class="menu-text">Setor Simpanan</div>
            </div>
            <div class="menu-right"><i class="fas fa-chevron-right"></i></div>
        </div>

        <div class="menu-item" data-action="pinjam">
            <div class="menu-left">
                <div class="menu-icon">ü´¥üèº</div>
                <div class="menu-text">Ajukan Pinjaman</div>
            </div>
            <div class="menu-right"><i class="fas fa-chevron-right"></i></div>
        </div>

        <div class="menu-item" data-action="riwayat">
            <div class="menu-left">
                <div class="menu-icon">üìù</div>
                <div class="menu-text">Riwayat Transaksi</div>
            </div>
            <div class="menu-right"><i class="fas fa-chevron-right"></i></div>
        </div>

        <div class="menu-item" data-action="kartu">
            <div class="menu-left">
                <div class="menu-icon">ü™™</div>
                <div class="menu-text">Kartu Anggota</div>
            </div>
            <div class="menu-right"><i class="fas fa-chevron-right"></i></div>
        </div>
    </div>

    <!-- ===== MENU DATA (KARTU YANG AKAN DIHAPUS) ===== -->
    <div class="menu-section" id="dataMenuSection">
        <div class="menu-item" data-action="total_simpanan">
            <div class="menu-left">
                <div class="menu-icon">ü™ô</div>
                <div class="menu-text">Detail Simpanan</div>
            </div>
            <div class="menu-right"><i class="fas fa-chevron-right"></i></div>
        </div>

        <div class="menu-item" data-action="pinjaman_aktif">
            <div class="menu-left">
                <div class="menu-icon">üíµ</div>
                <div class="menu-text">Detail Pinjaman</div>
            </div>
            <div class="menu-right"><i class="fas fa-chevron-right"></i></div>
        </div>

        <div class="menu-item" data-action="shu_estimasi">
            <div class="menu-left">
                <div class="menu-icon">üíé</div>
                <div class="menu-text">Detail SHU</div>
            </div>
            <div class="menu-right"><i class="fas fa-chevron-right"></i></div>
        </div>
    </div>

    <!-- ===== FOOTER ===== -->
    <div class="footer">
        <p>Copyright ¬© Koperasi Asmara Tani 2026</p>
        <p style="font-size: 0.8rem; margin-top: 5px; color: var(--primary);">
            <i class="fas fa-sync-alt"></i> Enhanced Sync System v2.0
        </p>
    </div>

    <!-- ===== MODAL CONTAINER ===== -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Modal Title</h3>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- ===== MODAL KARTU HOLOGRAM DETAIL ===== -->
    <div class="hologram-modal-overlay" id="hologramDetailModal">
        <div class="hologram-modal-content">
            <!-- Header Modal -->
            <div class="hologram-modal-header">
                <h3><i class="fas fa-file-invoice-dollar"></i> Detail Ringkasan Keuangan</h3>
                <button class="hologram-modal-close" id="closeHologramDetail">&times;</button>
            </div>
            
            <!-- Body Modal -->
            <div class="hologram-modal-body" id="hologramDetailContent">
                <!-- Detail akan diisi oleh JavaScript -->
            </div>
            
            <!-- Footer Modal dengan Tombol Aksi -->
            <div class="hologram-modal-footer">
                <div class="hologram-modal-actions">
                    <button class="hologram-modal-btn hologram-btn-secondary" id="closeDetailBtn">
                        <i class="fas fa-times"></i> Tutup
                    </button>
                    <button class="hologram-modal-btn hologram-btn-print" id="printHologramDetailBtn">
                        <i class="fas fa-print"></i> Cetak Kartu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== PASSWORD MODAL ===== -->
    <div class="password-modal" id="passwordModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Ganti Password</h3>
                <button class="modal-close" id="closePasswordModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label class="form-label">Password Saat Ini</label>
                        <div class="password-field">
                            <input type="password" class="form-control" id="currentPassword" required>
                            <button type="button" class="password-toggle" id="toggleCurrentPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password Baru</label>
                        <div class="password-field">
                            <input type="password" class="form-control" id="newPassword" required minlength="6">
                            <button type="button" class="password-toggle" id="toggleNewPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Konfirmasi Password Baru</label>
                        <div class="password-field">
                            <input type="password" class="form-control" id="confirmPassword" required minlength="6">
                            <button type="button" class="password-toggle" id="toggleConfirmPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="modal-btn secondary" id="cancelPasswordBtn">Batal</button>
                        <button type="submit" class="modal-btn primary" id="savePasswordBtn">Simpan Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ===== TOAST CONTAINER ===== -->
    <div class="toast" id="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toastMessage">Toast message here</span>
    </div>

    <!-- ===== PRINT PREVIEW ===== -->
    <div id="printPreview" class="print-preview"></div>

    <!-- ===== ENHANCED SYNC SYSTEM (STANDALONE) ===== -->
    <script>
    // ENHANCED SYNC SYSTEM - Standalone version
    class EnhancedSyncSystem {
        constructor() {
            this.userEmail = null;
            this.userName = null;
            this.isSyncing = false;
            this.init();
        }
        
        init() {
            console.log('üîß Initializing Enhanced Sync System...');
            
            // Get current user
            const currentUser = JSON.parse(localStorage.getItem('koperasi_current_user'));
            if (!currentUser) {
                console.error('‚ùå No current user found');
                return;
            }
            
            this.userEmail = currentUser.email;
            this.userName = currentUser.name || currentUser.email;
            
            console.log('üë§ User identified:', this.userEmail);
            
            // Setup UI elements
            this.setupUI();
            
            // Setup listeners
            this.setupListeners();
            
            // Initial sync
            setTimeout(() => this.checkForUpdates(), 1000);
            
            // Periodic sync every 5 seconds
            setInterval(() => this.checkForUpdates(), 5000);
            
            console.log('‚úÖ Enhanced Sync System Ready');
        }
        
        setupUI() {
            // Update sync status text
            const syncStatusText = document.getElementById('syncStatusText');
            if (syncStatusText) {
                syncStatusText.textContent = 'Aktif';
                syncStatusText.style.color = '#4CAF50';
            }
            
            // Setup manual sync button
            const manualSyncBtn = document.getElementById('manualSyncButton');
            if (manualSyncBtn) {
                manualSyncBtn.addEventListener('click', () => this.manualSync());
            }
            
            // Show online indicator
            const onlineIndicator = document.getElementById('onlineIndicator');
            if (onlineIndicator) {
                onlineIndicator.style.display = 'flex';
            }
        }
        
        setupListeners() {
            // Storage event listener
            window.addEventListener('storage', (e) => {
                if (e.key === 'koperasi_anggota' || e.key === 'koperasiData') {
                    console.log('üì¶ Storage Event:', e.key);
                    this.checkForUpdates();
                }
            });
            
            // Page visibility
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    console.log('üëÅÔ∏è Page visible, checking updates');
                    this.checkForUpdates();
                }
            });
        }
        
        checkForUpdates() {
            if (this.isSyncing) return;
            
            this.isSyncing = true;
            console.log('üîç Checking for updates...');
            
            // Check admin updates
            const hasAdminUpdates = this.checkAdminUpdates();
            
            // Check anggota updates
            const hasAnggotaUpdates = this.checkAnggotaUpdates();
            
            if (hasAdminUpdates || hasAnggotaUpdates) {
                this.updateSyncIndicator('success');
                this.showNotification('Data diperbarui', 'success');
            }
            
            this.isSyncing = false;
        }
        
        checkAdminUpdates() {
            try {
                const koperasiData = JSON.parse(localStorage.getItem('koperasiData') || '{}');
                const adminUpdates = koperasiData.adminUpdates || {};
                
                if (adminUpdates[this.userEmail]) {
                    console.log('üì• Admin update found');
                    this.processAdminUpdate(adminUpdates[this.userEmail]);
                    
                    // Clear update
                    delete adminUpdates[this.userEmail];
                    koperasiData.adminUpdates = adminUpdates;
                    localStorage.setItem('koperasiData', JSON.stringify(koperasiData));
                    
                    return true;
                }
                return false;
                
            } catch (error) {
                console.error('‚ùå Error checking admin updates:', error);
                return false;
            }
        }
        
        processAdminUpdate(updateData) {
            try {
                const allAnggota = JSON.parse(localStorage.getItem('koperasi_anggota') || '[]');
                const userIndex = allAnggota.findIndex(a => a.email === this.userEmail);
                
                if (userIndex === -1) return false;
                
                let userData = allAnggota[userIndex];
                
                // Apply updates
                if (updateData.personal) {
                    userData = { ...userData, ...updateData.personal };
                }
                
                if (updateData.simpanan) {
                    if (!userData.simpanan) {
                        userData.simpanan = {
                            pokok: { nominal: 0, status: 'belum lunas' },
                            wajib: { nominal: 0, status: 'belum aktif' },
                            sukarela: { nominal: 0, status: 'tersedia' },
                            total: 0
                        };
                    }
                    
                    Object.keys(updateData.simpanan).forEach(key => {
                        if (userData.simpanan[key]) {
                            userData.simpanan[key] = {
                                ...userData.simpanan[key],
                                ...updateData.simpanan[key]
                            };
                        }
                    });
                    
                    userData.simpanan.total = 0;
                }
                
                userData.lastUpdated = new Date().toISOString();
                userData.lastUpdatedBy = 'admin';
                
                allAnggota[userIndex] = userData;
                localStorage.setItem('koperasi_anggota', JSON.stringify(allAnggota));
                
                console.log('‚úÖ Admin update processed');
                
                // Trigger refresh
                this.triggerRefresh();
                
                return true;
                
            } catch (error) {
                console.error('‚ùå Error processing admin update:', error);
                return false;
            }
        }
        
        checkAnggotaUpdates() {
            try {
                const allAnggota = JSON.parse(localStorage.getItem('koperasi_anggota') || '[]');
                const userData = allAnggota.find(a => a.email === this.userEmail);
                
                if (userData) {
                    // Just trigger refresh if data exists
                    this.triggerRefresh();
                    return true;
                }
                return false;
                
            } catch (error) {
                console.error('‚ùå Error checking anggota updates:', error);
                return false;
            }
        }
        
        triggerRefresh() {
            // Dispatch event for main app
            window.dispatchEvent(new CustomEvent('sync-data-updated', {
                detail: { timestamp: new Date().toISOString() }
            }));
            
            // Update UI time
            this.updateLastSyncTime();
        }
        
        manualSync() {
            console.log('üëÜ Manual sync triggered');
            
            this.updateSyncButton('syncing');
            this.showNotification('Sinkronisasi manual dimulai...', 'info');
            
            setTimeout(() => {
                this.checkForUpdates();
                this.showNotification('Sinkronisasi selesai', 'success');
                this.updateSyncButton('success');
                
                setTimeout(() => this.updateSyncButton('normal'), 2000);
            }, 500);
        }
        
        updateSyncButton(state) {
            const syncBtn = document.getElementById('manualSyncButton');
            if (!syncBtn) return;
            
            syncBtn.className = 'sync-button';
            
            switch(state) {
                case 'normal':
                    syncBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Sync Now';
                    break;
                    
                case 'syncing':
                    syncBtn.classList.add('syncing');
                    syncBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Syncing...';
                    break;
                    
                case 'success':
                    syncBtn.classList.add('success');
                    syncBtn.innerHTML = '<i class="fas fa-check"></i> Synced!';
                    break;
            }
        }
        
        updateSyncIndicator(state) {
            const indicator = document.getElementById('dataSyncIndicator');
            if (!indicator) return;
            
            indicator.className = 'sync-indicator';
            
            switch(state) {
                case 'success':
                    indicator.classList.add('success');
                    break;
                    
                case 'warning':
                    indicator.classList.add('warning');
                    break;
                    
                case 'error':
                    indicator.classList.add('error');
                    break;
            }
        }
        
        updateLastSyncTime() {
            const timeElement = document.getElementById('lastSyncTime');
            if (timeElement) {
                const now = new Date();
                timeElement.textContent = `Terakhir sync: ${now.toLocaleTimeString('id-ID')}`;
            }
        }
        
        showNotification(message, type = 'info') {
            const toast = document.getElementById('toast');
            if (toast) {
                const toastMessage = document.getElementById('toastMessage');
                if (toastMessage) {
                    toastMessage.textContent = message;
                }
                
                toast.className = `toast ${type} show`;
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }
    }
    </script>

    <!-- ===== HOLOGRAM STATIC CARD SYSTEM ===== -->
    <script>
    // ===== FUNGSI UNTUK MENGHAPUS KARTU YANG TIDAK DIINGINKAN =====
    function removeUnwantedCards() {
        // Hapus kartu DATA MENU SECTION
        const dataMenuSection = document.getElementById('dataMenuSection');
        if (dataMenuSection) {
            dataMenuSection.style.display = 'none';
            console.log('‚úÖ Kartu tidak diinginkan telah dihapus');
        }
    }

    // ===== HOLOGRAM STATIC CARD SYSTEM =====
    class HologramStaticSystem {
        constructor() {
            this.currentUser = null;
            this.data = null;
            this.updateInterval = null;
            this.init();
        }
        
        init() {
            console.log('üåü Initializing Hologram Static Card System...');
            
            // 1. HAPUS KARTU TIDAK DIPERLUKAN
            removeUnwantedCards();
            
            // 2. RESET DATA DEFAULT KE 0
            this.resetToZero();
            
            // Get current user
            try {
                this.currentUser = JSON.parse(localStorage.getItem('koperasi_current_user') || 'null');
            } catch (error) {
                console.error('Error getting current user:', error);
            }
            
            // Load initial data
            this.loadData();
            
            // Setup event listeners
            this.setupEventListeners();
            
            // Auto refresh every 10 seconds
            this.startAutoRefresh();
            
            console.log('‚úÖ Hologram Static Card System Ready');
        }
        
        resetToZero() {
            // Reset variabel internal
            this.data = {
                totalSimpanan: 0,
                totalPinjaman: 0,
                shuEstimasi: 0,
                statusAnggota: 'Menunggu data',
                lastUpdated: new Date().toISOString()
            };
            
            // Update UI dengan nilai 0
            this.updateUI();
            
            console.log('üîÑ Data direset ke 0');
        }
        
        async loadData() {
            try {
                // CEK apakah ada data sama sekali
                const adminData = localStorage.getItem('koperasi_anggota');
                const tabunganData = localStorage.getItem('tabunganDigitalUsers');
                
                // JIKA KEDUANYA KOSONG, reset ke 0
                if (!adminData && !tabunganData) {
                    this.data = {
                        totalSimpanan: 0,
                        totalPinjaman: 0,
                        shuEstimasi: 0,
                        statusAnggota: 'Data kosong',
                        lastUpdated: new Date().toISOString()
                    };
                    this.updateUI();
                    return;
                }
                
                // Load data from Dashboard Admin
                const anggotaData = JSON.parse(localStorage.getItem('koperasi_anggota') || '[]');
                const currentUserEmail = this.currentUser?.email;
                
                let userData = null;
                
                if (currentUserEmail && anggotaData.length > 0) {
                    userData = anggotaData.find(a => a.email === currentUserEmail);
                }
                
                // If not found in admin data, try tabungan data
                if (!userData) {
                    userData = await this.getTabunganUserData();
                }
                
                // Calculate totals
                let totalSimpanan = 0;
                let totalPinjaman = 0;
                let shuEstimasi = 0;
                let statusAnggota = 'Memuat...';
                
                if (userData) {
                    totalSimpanan = this.calculateTotalSimpanan(userData);
                    totalPinjaman = parseInt(userData?.totalPinjaman) || 
                                   parseInt(userData?.pinjaman?.total) || 0;
                    shuEstimasi = Math.round(totalSimpanan * 0.2);
                    statusAnggota = userData?.statusAktif || userData?.status || 'Aktif';
                }
                
                this.data = {
                    totalSimpanan,
                    totalPinjaman,
                    shuEstimasi,
                    statusAnggota,
                    lastUpdated: userData?.lastUpdated || new Date().toISOString()
                };
                
                // Update UI
                this.updateUI();
                
                console.log('‚úÖ Hologram data loaded:', this.data);
                
            } catch (error) {
                console.error('‚ùå Error loading hologram data:', error);
                this.showFallbackData();
            }
        }
        
        calculateTotalSimpanan(userData) {
            if (!userData) return 0;
            
            let total = 0;
            
            // Try from admin data format
            total += parseInt(userData.simpananPokok) || 0;
            total += parseInt(userData.simpananWajib) || 0;
            total += parseInt(userData.simpananSukarela) || 0;
            
            // Try from tabungan format
            if (userData.simpanan) {
                total += parseInt(userData.simpanan.pokok?.nominal) || 0;
                total += parseInt(userData.simpanan.wajib?.nominal) || 0;
                total += parseInt(userData.simpanan.sukarela?.nominal) || 0;
                total += parseInt(userData.simpanan.total) || 0;
            }
            
            // Use totalSimpanan if available
            if (userData.totalSimpanan) {
                total = Math.max(total, parseInt(userData.totalSimpanan) || 0);
            }
            
            return total;
        }
        
        async getTabunganUserData() {
            try {
                const tabunganUsers = JSON.parse(localStorage.getItem('tabunganDigitalUsers') || '[]');
                const currentUserEmail = this.currentUser?.email;
                
                if (currentUserEmail && tabunganUsers.length > 0) {
                    return tabunganUsers.find(u => u.email === currentUserEmail);
                }
                
                return null;
            } catch (error) {
                return null;
            }
        }
        
        updateUI() {
            if (!this.data) return;
            
            const formatRupiah = (amount) => {
                if (!amount && amount !== 0) return 'Rp 0';
                return 'Rp ' + amount.toLocaleString('id-ID');
            };
            
            // Update values
            const totalSimpananElement = document.getElementById('hologramTotalSimpanan');
            if (totalSimpananElement) {
                totalSimpananElement.textContent = formatRupiah(this.data.totalSimpanan);
            }
            
            const totalPinjamanElement = document.getElementById('hologramTotalPinjaman');
            if (totalPinjamanElement) {
                totalPinjamanElement.textContent = formatRupiah(this.data.totalPinjaman);
            }
            
            const shuEstimasiElement = document.getElementById('hologramSHUEstimasi');
            if (shuEstimasiElement) {
                shuEstimasiElement.textContent = formatRupiah(this.data.shuEstimasi);
            }
            
            const statusAnggotaElement = document.getElementById('hologramStatusAnggota');
            if (statusAnggotaElement) {
                statusAnggotaElement.textContent = this.data.statusAnggota;
                
                // Update status color
                if (this.data.statusAnggota === 'Aktif') {
                    statusAnggotaElement.style.color = '#2e7d32';
                } else {
                    statusAnggotaElement.style.color = '#f44336';
                }
            }
            
            // Update time
            const updateElement = document.getElementById('hologramUpdateTime');
            if (updateElement) {
                const now = new Date();
                updateElement.innerHTML = `
                    <i class="fas fa-clock"></i>
                    Update: ${now.toLocaleTimeString('id-ID', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    })}
                `;
            }
        }
        
        showFallbackData() {
            // RESET semua ke 0
            this.data = {
                totalSimpanan: 0,
                totalPinjaman: 0,
                shuEstimasi: 0,
                statusAnggota: 'Belum diinisialisasi',
                lastUpdated: new Date().toISOString()
            };
            
            // Update UI dengan nilai 0
            this.updateUI();
            
            // Update pesan
            const updateElement = document.getElementById('hologramUpdateTime');
            if (updateElement) {
                const now = new Date();
                updateElement.innerHTML = `
                    <i class="fas fa-clock"></i>
                    Inisialisasi: ${now.toLocaleTimeString('id-ID')}
                `;
            }
        }
        
        setupEventListeners() {
            // Click on hologram card to show detail
            const hologramCard = document.getElementById('hologramStaticCard');
            if (hologramCard) {
                hologramCard.addEventListener('click', () => {
                    this.showDetailModal();
                });
            }
            
            // Setup modal event listeners
            this.setupModalListeners();
            
            // ===== LISTENER UNTUK UPDATE DARI ADMIN =====
            window.addEventListener('koperasiDataUpdated', (e) => {
                console.log('üîÑ Data diperbarui dari Admin Dashboard');
                this.loadData();
                this.showNotification('Data keuangan diperbarui!', 'success');
            });
            
            // Listen for sync updates
            window.addEventListener('sync-data-updated', () => {
                console.log('üîÑ Sync update received, refreshing hologram data...');
                this.loadData();
            });
            
            // Simulasi event update (untuk testing)
            window.simulateAdminUpdate = () => {
                const event = new Event('koperasiDataUpdated');
                window.dispatchEvent(event);
            };
        }
        
        setupModalListeners() {
            // Close button (X)
            const closeBtn = document.getElementById('closeHologramDetail');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    this.closeDetailModal();
                });
            }
            
            // Close button in footer
            const closeDetailBtn = document.getElementById('closeDetailBtn');
            if (closeDetailBtn) {
                closeDetailBtn.addEventListener('click', () => {
                    this.closeDetailModal();
                });
            }
            
            // Print button
            const printBtn = document.getElementById('printHologramDetailBtn');
            if (printBtn) {
                printBtn.addEventListener('click', () => {
                    this.printDetail();
                });
            }
            
            // Close modal when clicking outside
            const modalOverlay = document.getElementById('hologramDetailModal');
            if (modalOverlay) {
                modalOverlay.addEventListener('click', (e) => {
                    if (e.target === modalOverlay) {
                        this.closeDetailModal();
                    }
                });
            }
            
            // Close modal with ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
                    this.closeDetailModal();
                }
            });
        }
        
        showDetailModal() {
            if (!this.data) return;
            
            const formatRupiah = (amount) => {
                if (!amount && amount !== 0) return 'Rp 0';
                return 'Rp ' + amount.toLocaleString('id-ID');
            };
            
            const saldoBersih = this.data.totalSimpanan - this.data.totalPinjaman;
            const anggotaData = JSON.parse(localStorage.getItem('koperasi_anggota') || '[]');
            const currentUserEmail = this.currentUser?.email;
            const userData = anggotaData.find(a => a.email === currentUserEmail);
            
            const detailHTML = `
                <div class="hologram-card">
                    <div class="hologram-header">
                        <h3><i class="fas fa-chart-line"></i> DETAIL RINGKASAN KEUANGAN</h3>
                        <p>Koperasi Asmara Tani - #koperasijenius</p>
                    </div>
                    
                    <div class="hologram-grid">
                        <!-- User Info -->
                        <div class="hologram-item full-width">
                            <div class="hologram-label">
                                <i class="fas fa-user-circle"></i>
                                Informasi Anggota
                            </div>
                            <div class="hologram-value">${this.currentUser?.name || 'Anggota Koperasi'}</div>
                            <div style="font-size: 0.9rem; color: #666; margin-top: 8px; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
                                <span><i class="fas fa-id-card"></i> ${userData?.nia || userData?.id || 'N/A'}</span>
                                <span><i class="fas fa-briefcase"></i> ${userData?.posisi || 'Anggota'}</span>
                                <span><i class="fas fa-envelope"></i> ${this.currentUser?.email || ''}</span>
                            </div>
                        </div>
                        
                        <!-- Simpanan Breakdown -->
                        <div class="hologram-item">
                            <div class="hologram-label">
                                <i class="fas fa-landmark"></i>
                                Simpanan Pokok
                            </div>
                            <div class="hologram-value rp">${formatRupiah(parseInt(userData?.simpananPokok) || 0)}</div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                                <i class="fas fa-check-circle" style="color: #4CAF50;"></i> Dibayar sekali
                            </div>
                        </div>
                        
                        <div class="hologram-item">
                            <div class="hologram-label">
                                <i class="fas fa-calendar-check"></i>
                                Simpanan Wajib
                            </div>
                            <div class="hologram-value rp">${formatRupiah(parseInt(userData?.simpananWajib) || 0)}</div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                                <i class="fas fa-sync-alt" style="color: #FF9800;"></i> Rutin bulanan
                            </div>
                        </div>
                        
                        <div class="hologram-item">
                            <div class="hologram-label">
                                <i class="fas fa-hand-holding-heart"></i>
                                Simpanan Sukarela
                            </div>
                            <div class="hologram-value rp">${formatRupiah(parseInt(userData?.simpananSukarela) || 0)}</div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                                <i class="fas fa-heart" style="color: #E91E63;"></i> Opsional
                            </div>
                        </div>
                        
                        <!-- Totals -->
                        <div class="hologram-item full-width">
                            <div class="hologram-label">
                                <i class="fas fa-hand-holding-usd"></i>
                                Total Simpanan
                            </div>
                            <div class="hologram-value rp" style="font-size: 1.8rem; color: #0d4014;">
                                ${formatRupiah(this.data.totalSimpanan)}
                            </div>
                            <div style="height: 3px; background: linear-gradient(90deg, #4CAF50, #2e7d32, #1a5f23); border-radius: 2px; margin-top: 10px;"></div>
                        </div>
                        
                        <div class="hologram-item">
                            <div class="hologram-label">
                                <i class="fas fa-file-invoice-dollar"></i>
                                Total Pinjaman
                            </div>
                            <div class="hologram-value rp" style="color: ${this.data.totalPinjaman > 0 ? '#c62828' : '#4CAF50'}">
                                ${formatRupiah(this.data.totalPinjaman)}
                            </div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                                <i class="fas ${this.data.totalPinjaman > 0 ? 'fa-exclamation-triangle' : 'fa-check-circle'}" 
                                   style="color: ${this.data.totalPinjaman > 0 ? '#FF9800' : '#4CAF50'}"></i>
                                ${this.data.totalPinjaman > 0 ? 'Pinjaman aktif' : 'Tidak ada pinjaman'}
                            </div>
                        </div>
                        
                        <div class="hologram-item">
                            <div class="hologram-label">
                                <i class="fas fa-calculator"></i>
                                SHU Estimasi
                            </div>
                            <div class="hologram-value rp" style="color: #2196F3;">
                                ${formatRupiah(this.data.shuEstimasi)}
                            </div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                                <i class="fas fa-chart-line" style="color: #2196F3;"></i> 20% dari simpanan
                            </div>
                        </div>
                        
                        <!-- Status -->
                        <div class="hologram-item">
                            <div class="hologram-label">
                                <i class="fas fa-user-check"></i>
                                Status Keanggotaan
                            </div>
                            <div class="hologram-status ${this.data.statusAnggota === 'Aktif' ? 'status-aktif' : 'status-tidak-aktif'}">
                                ${this.data.statusAnggota}
                            </div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                                <i class="fas fa-badge-check"></i> ${this.data.statusAnggota === 'Aktif' ? 'Akses penuh' : 'Terbatas'}
                            </div>
                        </div>
                        
                        <!-- Saldo Bersih -->
                        <div class="hologram-item full-width">
                            <div class="hologram-label">
                                <i class="fas fa-scale-balanced"></i>
                                Saldo Bersih (Estimasi)
                            </div>
                            <div class="hologram-value rp" style="font-size: 1.6rem; color: ${saldoBersih >= 0 ? '#1a5f23' : '#c62828'};">
                                ${formatRupiah(saldoBersih)}
                            </div>
                            <div style="font-size: 0.8rem; color: #666; margin-top: 5px; text-align: center;">
                                Simpanan (${formatRupiah(this.data.totalSimpanan)}) - Pinjaman (${formatRupiah(this.data.totalPinjaman)}) = Saldo Bersih
                            </div>
                        </div>
                    </div>
                    
                    <div class="hologram-footer">
                        <p>
                            <i class="fas fa-database"></i> 
                            Sumber data: ${userData ? 'Dashboard Admin' : 'Tabungan Digital'}
                        </p>
                        <p>
                            <i class="fas fa-clock"></i> 
                            Update terakhir: ${new Date().toLocaleDateString('id-ID')} ${new Date().toLocaleTimeString('id-ID')}
                        </p>
                        <p style="font-size: 0.75rem; margin-top: 10px; color: rgba(13, 64, 20, 0.6);">
                            *Data ini diperbarui otomatis setiap 10 detik dari Dashboard Admin
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('hologramDetailContent').innerHTML = detailHTML;
            document.getElementById('hologramDetailModal').classList.add('active');
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }
        
        closeDetailModal() {
            document.getElementById('hologramDetailModal').classList.remove('active');
            // Restore body scroll
            document.body.style.overflow = '';
        }
        
        printDetail() {
            const detailContent = document.querySelector('.hologram-card');
            if (!detailContent) return;
            
            try {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Kartu Ringkasan Keuangan - Koperasi Asmara Tani</title>
                        <meta charset="UTF-8">
                        <style>
                            body {
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                margin: 0;
                                padding: 20px;
                                background: #f5f5f5;
                            }
                            
                            @media print {
                                body {
                                    margin: 0;
                                    padding: 0;
                                    background: white;
                                }
                                @page {
                                    size: A4;
                                    margin: 15mm;
                                }
                            }
                            
                            .print-container {
                                background: white;
                                border: 3px solid #1a5f23;
                                border-radius: 20px;
                                padding: 30px;
                                max-width: 700px;
                                margin: 0 auto;
                                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                            }
                            
                            .watermark {
                                position: fixed;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%) rotate(-45deg);
                                opacity: 0.05;
                                font-size: 120px;
                                color: #1a5f23;
                                font-weight: bold;
                                z-index: -1;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="watermark">KOPERASI ASMARA TANI</div>
                        <div class="print-container">
                            ${detailContent.outerHTML}
                        </div>
                        <script>
                            window.onload = function() {
                                setTimeout(() => {
                                    window.print();
                                    setTimeout(() => {
                                        window.close();
                                    }, 500);
                                }, 500);
                            };
                        <\/script>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                
                // Show notification
                this.showNotification('Membuka jendela cetak...', 'info');
                
            } catch (error) {
                console.error('Error printing:', error);
                this.showNotification('Gagal mencetak. Silakan coba lagi.', 'error');
            }
        }
        
        showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'hologram-notification';
            notification.innerHTML = `
                <i class="fas ${type === 'info' ? 'fa-info-circle' : type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'info' ? '#2196F3' : type === 'success' ? '#4CAF50' : '#f44336'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                gap: 10px;
                z-index: 100000;
                animation: hologramSlideIn 0.3s ease;
                box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'hologramSlideOut 0.3s ease forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
            
            // Add animation styles
            if (!document.querySelector('#hologram-notification-styles')) {
                const style = document.createElement('style');
                style.id = 'hologram-notification-styles';
                style.textContent = `
                    @keyframes hologramSlideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes hologramSlideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        startAutoRefresh() {
            // Refresh data every 10 seconds
            this.updateInterval = setInterval(() => {
                this.loadData();
            }, 10000);
            
            // Also refresh when storage changes (admin updates data)
            window.addEventListener('storage', (e) => {
                if (e.key === 'koperasi_anggota' || e.key === 'koperasiData') {
                    console.log('üîÑ Storage change detected, refreshing hologram data');
                    this.loadData();
                    this.showNotification('Data diperbarui!', 'success');
                }
            });
            
            // Refresh when page becomes visible
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    this.loadData();
                }
            });
        }
        
        destroy() {
            if (this.updateInterval) {
                clearInterval(this.updateInterval);
            }
        }
    }

    // ===== INITIALIZE HOLOGRAM STATIC SYSTEM =====
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
            window.hologramStaticSystem = new HologramStaticSystem();
            console.log('üé® Hologram Static System integrated successfully');
        }, 1500);
    });
    </script>

    <!-- ===== MAIN TABUNGAN APP ===== -->
    <script>
    const { jsPDF } = window.jspdf;

    class DigitalTabungan {
        constructor() {
            this.currentUser = this.getCurrentUser();
            
            if (!this.currentUser) {
                window.location.href = 'login-register.html';
                return;
            }
            
            this.initialize();
        }
        
        getCurrentUser() {
            try {
                return JSON.parse(localStorage.getItem('koperasi_current_user') || 'null');
            } catch (error) {
                console.error('Error getting current user:', error);
                return null;
            }
        }
        
        initialize() {
            console.log('üîÑ Initializing Tabungan Digital for:', this.currentUser.email);
            
            this.loadAnggotaData();
            this.setupEventListeners();
            this.updateUI();
            this.startSync();
            
            // Initialize enhanced sync system
            setTimeout(() => {
                window.enhancedSync = new EnhancedSyncSystem();
            }, 1500);
            
            console.log('‚úÖ Tabungan Digital Ready');
        }
        
        loadAnggotaData() {
            try {
                const allAnggota = JSON.parse(localStorage.getItem('koperasi_anggota') || '[]');
                this.anggotaData = allAnggota.find(a => a.email === this.currentUser.email);
                
                if (!this.anggotaData) {
                    this.anggotaData = this.createDefaultAnggotaData();
                    this.saveAnggotaData();
                }
                
                this.formatDataForUI();
            } catch (error) {
                console.error('Error loading anggota data:', error);
            }
        }
        
        createDefaultAnggotaData() {
            return {
                id: 'AGT-' + Date.now().toString().slice(-8),
                email: this.currentUser.email,
                nama: this.currentUser.name || this.currentUser.email,
                posisi: this.currentUser.role === 'Ketua' || this.currentUser.role === 'Sekretaris' || this.currentUser.role === 'Bendahara' || this.currentUser.role === 'Pengawas' ? this.currentUser.role : 'Anggota',
                alamat: '',
                jenis_kelamin: '',
                agama: '',
                status: '',
                whatsapp: '',
                nik: '',
                tanggal_daftar: new Date().toLocaleDateString('id-ID'),
                foto: this.currentUser.foto || 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjh1oM43gxD4iCHpHRBrrbkCHRU5MigalAWf4G5x-cTLfRRxWeeTwGqwNz8FtSdSgcexhRAIWMX7eZoOxo0b-i8kB2EUr44TCkMCZ8VVfQTJpL0AgptbY8hjsTZtqg6jbS2MMOuIVf9FvNOR-JsZr4dvrpqTQT0I5qY5OB063z38W0mTIVhQrBPTASmQp0/s1280/1000175639.jpg',
                statusAktif: 'Aktif',
                simpanan: {
                    pokok: { nominal: 0, status: 'belum lunas' },
                    wajib: { nominal: 0, status: 'belum aktif' },
                    sukarela: { nominal: 0, status: 'tersedia' },
                    total: 0
                },
                pinjaman: {
                    aktif: [],
                    total: 0
                },
                shu: {
                    estimasi: 0,
                    status: 'Belum ada perhitungan'
                },
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
        }
        
        saveAnggotaData() {
            try {
                const allAnggota = JSON.parse(localStorage.getItem('koperasi_anggota') || '[]');
                const index = allAnggota.findIndex(a => a.email === this.currentUser.email);
                
                if (index !== -1) {
                    allAnggota[index] = this.anggotaData;
                } else {
                    allAnggota.push(this.anggotaData);
                }
                
                localStorage.setItem('koperasi_anggota', JSON.stringify(allAnggota));
                
                this.saveToKoperasiData();
            } catch (error) {
                console.error('Error saving anggota data:', error);
            }
        }
        
        saveToKoperasiData() {
            try {
                const koperasiData = JSON.parse(localStorage.getItem('koperasiData')) || {};
                if (!koperasiData.userUpdates) {
                    koperasiData.userUpdates = {};
                }
                
                koperasiData.userUpdates[this.currentUser.email] = {
                    personal: {
                        nama: this.anggotaData.nama,
                        email: this.anggotaData.email,
                        whatsapp: this.anggotaData.whatsapp,
                        alamat: this.anggotaData.alamat,
                        jenis_kelamin: this.anggotaData.jenis_kelamin,
                        agama: this.anggotaData.agama,
                        nik: this.anggotaData.nik,
                        foto: this.anggotaData.foto,
                        lastUpdated: new Date().toISOString()
                    },
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('koperasiData', JSON.stringify(koperasiData));
            } catch (error) {
                console.error('Error saving to koperasiData:', error);
            }
        }
        
        formatDataForUI() {
            const simpananPokok = 0;
            const simpananWajib = 0;
            const simpananSukarela = 0;
            const totalSimpanan = 0;
            
            if (this.anggotaData.simpanan) {
                this.anggotaData.simpanan.total = totalSimpanan;
            }
            
            this.formattedData = {
                personal: {
                    id: this.anggotaData.id || 'Belum Terdaftar',
                    nia: this.anggotaData.nia || this.anggotaData.id || 'Belum Terdaftar',
                    nama: this.anggotaData.nama || this.currentUser.name,
                    telepon: this.anggotaData.whatsapp || '',
                    email: this.anggotaData.email,
                    posisi: this.anggotaData.posisi || 'Anggota',
                    tanggalGabung: this.anggotaData.tanggal_bergabung || this.anggotaData.tanggal_daftar || '',
                    status: this.anggotaData.statusAktif || 'Aktif',
                    foto: this.anggotaData.foto,
                    alamat: this.anggotaData.alamat || '',
                    jenisKelamin: this.anggotaData.jenis_kelamin || '',
                    agama: this.anggotaData.agama || '',
                    statusPerkawinan: this.anggotaData.status || '',
                    nik: this.anggotaData.nik || '',
                    tanggalDaftar: this.anggotaData.tanggal_daftar || '',
                    lastUpdated: this.anggotaData.lastUpdated || '',
                    password: this.currentUser.password || ''
                },
                simpanan: {
                    pokok: { nominal: simpananPokok, status: this.anggotaData.simpanan?.pokok?.status || 'belum lunas' },
                    wajib: { nominal: simpananWajib, status: this.anggotaData.simpanan?.wajib?.status || 'belum aktif' },
                    sukarela: { nominal: simpananSukarela, status: this.anggotaData.simpanan?.sukarela?.status || 'tersedia' },
                    total: totalSimpanan
                },
                pinjaman: this.anggotaData.pinjaman || {
                    aktif: [],
                    total: 0
                },
                shu: this.anggotaData.shu || {
                    estimasi: 0,
                    status: 'Belum ada perhitungan'
                }
            };
        }
        
        setupEventListeners() {
            // Button listeners
            document.getElementById('editProfileButton').addEventListener('click', () => this.showEditProfileModal());
            document.getElementById('qrButton').addEventListener('click', () => this.showQRModal());
            
            // Menu item listeners
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const action = e.currentTarget.getAttribute('data-action');
                    this.handleMenuAction(action);
                });
            });
            
            // Password modal listeners
            document.getElementById('closePasswordModal')?.addEventListener('click', () => {
                this.closePasswordModal();
            });
            
            document.getElementById('cancelPasswordBtn')?.addEventListener('click', () => {
                this.closePasswordModal();
            });
            
            document.getElementById('changePasswordForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                this.changePassword();
            });
            
            document.getElementById('passwordModal')?.addEventListener('click', (e) => {
                if (e.target === document.getElementById('passwordModal')) {
                    this.closePasswordModal();
                }
            });
            
            // Listen for sync updates
            window.addEventListener('sync-data-updated', () => {
                console.log('üîÑ Sync update received, refreshing data...');
                this.loadAnggotaData();
                this.updateUI();
            });
        }
        
        handleMenuAction(action) {
            const actions = {
                setor: () => this.showSetorModal(),
                pinjam: () => this.showPinjamModal(),
                riwayat: () => this.showRiwayatModal(),
                kartu: () => this.showKartuModal(),
                total_simpanan: () => this.showDetailSimpanan(),
                pinjaman_aktif: () => this.showDetailPinjaman(),
                shu_estimasi: () => this.showDetailSHU()
            };
            
            if (actions[action]) {
                actions[action]();
            }
        }
        
        updateUI() {
            // Update profile info
            document.getElementById('profileName').innerHTML = 
                `${this.formattedData.personal.nama} <span class="badge">${this.formattedData.personal.status === 'Aktif' ? '‚úî' : '‚ö†'}</span>`;
            
            document.getElementById('profileRole').textContent = 
                `@${this.formattedData.personal.posisi.toLowerCase().replace(' ', '_')}`;
            
            document.getElementById('profileAvatar').src = this.formattedData.personal.foto;
            
            // Update status badge
            const statusBadge = document.getElementById('statusBadge');
            if (statusBadge) {
                statusBadge.textContent = this.formattedData.personal.status === 'Aktif' ? '‚úî' : '‚ö†';
                statusBadge.style.color = this.formattedData.personal.status === 'Aktif' ? '#4CAF50' : '#FF9800';
            }
            
            // Update last sync time
            const lastSync = localStorage.getItem('koperasi_last_sync');
            if (lastSync) {
                const time = new Date(lastSync);
                document.getElementById('lastSyncTime').textContent = 
                    `Terakhir update: ${time.toLocaleTimeString('id-ID')}`;
            } else {
                document.getElementById('lastSyncTime').textContent = 
                    `Terakhir update: ${new Date().toLocaleTimeString('id-ID')}`;
            }
            
            // Update tabungan status
            document.getElementById('tabunganStatus').innerHTML = 
                `${this.formattedData.personal.status} ‚Ä¢ Real-time data`;
            
            // Note: Hologram card akan menangani update data keuangan
            // Tidak perlu update elemen stats card karena sudah diganti dengan hologram
        }
        
        // ===== MODAL FUNCTIONS =====
        
        showEditProfileModal() {
            this.showModal({
                title: 'Edit Profil',
                content: `
                    <div style="padding: 10px 0;">
                        <form id="editProfileForm">
                            <div class="photo-upload-container">
                                <div class="photo-preview">
                                    <img id="photoPreview" src="${this.formattedData.personal.foto}" alt="Foto Profil">
                                </div>
                                <label class="upload-btn">
                                    <i class="fas fa-camera"></i> Upload Foto Profil
                                    <input type="file" class="photo-upload-input" id="uploadPhoto" accept="image/*" style="display: none;">
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ID / NIA (Nomor Induk Anggota)</label>
                                <input type="text" class="form-control readonly-field" value="${this.formattedData.personal.nia || '-'}" readonly>
                                <small style="color: #666; font-size: 0.8rem;">Hanya admin yang dapat mengubah NIA</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Posisi</label>
                                <input type="text" class="form-control readonly-field" value="${this.formattedData.personal.posisi || 'Anggota'}" readonly>
                                <small style="color: #666; font-size: 0.8rem;">Hanya admin yang dapat mengubah posisi</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Nama Lengkap *</label>
                                <input type="text" class="form-control" id="editNama" value="${this.formattedData.personal.nama}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Alamat Lengkap</label>
                                <textarea class="form-control" id="editAlamat" rows="3" placeholder="Masukkan alamat lengkap">${this.formattedData.personal.alamat || ''}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Jenis Kelamin *</label>
                                <select class="form-control" id="editJenisKelamin" required>
                                    <option value="">Pilih Jenis Kelamin</option>
                                    <option value="Laki-laki" ${this.formattedData.personal.jenisKelamin === 'Laki-laki' ? 'selected' : ''}>Laki-laki</option>
                                    <option value="Perempuan" ${this.formattedData.personal.jenisKelamin === 'Perempuan' ? 'selected' : ''}>Perempuan</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Agama</label>
                                <select class="form-control" id="editAgama">
                                    <option value="">Pilih Agama</option>
                                    <option value="Islam" ${this.formattedData.personal.agama === 'Islam' ? 'selected' : ''}>Islam</option>
                                    <option value="Kristen" ${this.formattedData.personal.agama === 'Kristen' ? 'selected' : ''}>Kristen</option>
                                    <option value="Katolik" ${this.formattedData.personal.agama === 'Katolik' ? 'selected' : ''}>Katolik</option>
                                    <option value="Hindu" ${this.formattedData.personal.agama === 'Hindu' ? 'selected' : ''}>Hindu</option>
                                    <option value="Budha" ${this.formattedData.personal.agama === 'Budha' ? 'selected' : ''}>Budha</option>
                                    <option value="Konghucu" ${this.formattedData.personal.agama === 'Konghucu' ? 'selected' : ''}>Konghucu</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Status Perkawinan</label>
                                <input type="text" class="form-control readonly-field" value="${this.formattedData.personal.statusPerkawinan || '-'}" readonly>
                                <small style="color: #666; font-size: 0.8rem;">Hanya admin yang dapat mengubah status</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Tanggal Daftar</label>
                                <input type="text" class="form-control readonly-field" value="${this.formattedData.personal.tanggalDaftar || '-'}" readonly>
                                <small style="color: #666; font-size: 0.8rem;">Tanggal pendaftaran tidak dapat diubah</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Alamat Email *</label>
                                <input type="email" class="form-control readonly-field" id="editEmail" value="${this.formattedData.personal.email}" readonly>
                                <small style="color: #666; font-size: 0.8rem;">Email tidak dapat diubah</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">No. WhatsApp *</label>
                                <input type="tel" class="form-control" id="editTelepon" value="${this.formattedData.personal.telepon}" required placeholder="Contoh: 6285218483129">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">NIK KTP</label>
                                <input type="text" class="form-control readonly-field" id="editNIK" value="${this.formattedData.personal.nik || ''}" readonly placeholder="16 digit NIK">
                                <small style="color: #666; font-size: 0.8rem;">Hanya admin yang dapat mengubah NIK</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Tanggal Bergabung</label>
                                <input type="text" class="form-control readonly-field" value="${this.formattedData.personal.tanggalGabung || '-'}" readonly>
                                <small style="color: #666; font-size: 0.8rem;">Tanggal bergabung ditentukan oleh admin</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Status Keanggotaan</label>
                                <input type="text" class="form-control readonly-field" value="${this.formattedData.personal.status || 'Aktif'}" readonly>
                                <small style="color: #666; font-size: 0.8rem;">Status keanggotaan diatur oleh admin</small>
                            </div>
                            
                            <!-- SIMPANAN INFO -->
                            <div class="form-group">
                                <label class="form-label">Simpanan Pokok</label>
                                <input type="text" class="form-control readonly-field" value="Rp ${this.formatNumber(0)}" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Simpanan Wajib</label>
                                <input type="text" class="form-control readonly-field" value="Rp ${this.formatNumber(0)}" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Simpanan Sukarela</label>
                                <input type="text" class="form-control readonly-field" value="Rp ${this.formatNumber(0)}" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Total Simpanan</label>
                                <input type="text" class="form-control readonly-field" value="Rp ${this.formatNumber(0)}" readonly>
                                <small style="color: #666; font-size: 0.8rem;">Hanya admin yang dapat mengubah simpanan</small>
                            </div>
                            
                            <!-- Password field with eye toggle -->
                            <div class="form-group">
                                <label class="form-label">Password Saat Ini</label>
                                <div class="password-field">
                                    <input type="password" class="form-control readonly-field" id="currentPasswordDisplay" value="${this.formattedData.personal.password || ''}" readonly>
                                    <button type="button" class="password-toggle" id="toggleCurrentPasswordDisplay">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <small style="color: #666; font-size: 0.8rem;">Password Anda saat ini (hanya ditampilkan)</small>
                            </div>
                            
                            <div class="password-section">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="font-weight: 500;">Ganti Password</span>
                                    <a href="#" class="password-toggle-link" id="showPasswordModal">
                                        <i class="fas fa-lock"></i> Klik untuk ganti password
                                    </a>
                                </div>
                                <small style="color: #666; font-size: 0.8rem; display: block;">Klik link di atas untuk mengganti password akun Anda</small>
                            </div>
                            
                            <div class="modal-actions">
                                <button type="button" class="modal-btn secondary" id="cancelEditBtn">
                                    <i class="fas fa-times"></i> Batal
                                </button>
                                <button type="submit" class="modal-btn primary" id="saveEditBtn">
                                    <i class="fas fa-save"></i> Simpan Perubahan
                                </button>
                            </div>
                        </form>
                    </div>
                `
            });
            
            // Setup event listeners for edit profile form
            const editForm = document.getElementById('editProfileForm');
            if (editForm) {
                editForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveProfileChanges();
                });
            }
            
            document.getElementById('cancelEditBtn').addEventListener('click', () => {
                this.closeModal();
            });
            
            document.getElementById('uploadPhoto').addEventListener('change', (e) => {
                this.handlePhotoUpload(e);
            });
            
            document.getElementById('showPasswordModal').addEventListener('click', (e) => {
                e.preventDefault();
                this.showPasswordModal();
            });
            
            // Add event listener for password toggle in edit profile modal
            const toggleCurrentPasswordBtn = document.getElementById('toggleCurrentPasswordDisplay');
            const currentPasswordField = document.getElementById('currentPasswordDisplay');
            
            if (toggleCurrentPasswordBtn && currentPasswordField) {
                toggleCurrentPasswordBtn.addEventListener('click', () => {
                    const type = currentPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                    currentPasswordField.setAttribute('type', type);
                    toggleCurrentPasswordBtn.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
        }
        
        saveProfileChanges() {
            this.anggotaData.nama = document.getElementById('editNama').value;
            this.anggotaData.whatsapp = document.getElementById('editTelepon').value;
            this.anggotaData.alamat = document.getElementById('editAlamat').value;
            this.anggotaData.jenis_kelamin = document.getElementById('editJenisKelamin').value;
            this.anggotaData.agama = document.getElementById('editAgama').value;
            this.anggotaData.lastUpdated = new Date().toISOString();
            
            const photoInput = document.getElementById('uploadPhoto');
            if (photoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.anggotaData.foto = e.target.result;
                    this.completeSaveProfile();
                };
                reader.readAsDataURL(photoInput.files[0]);
            } else {
                this.completeSaveProfile();
            }
        }
        
        completeSaveProfile() {
            this.saveAnggotaData();
            
            const users = JSON.parse(localStorage.getItem('koperasi_users') || '[]');
            const userIndex = users.findIndex(u => u.email === this.currentUser.email);
            if (userIndex !== -1) {
                users[userIndex].name = this.anggotaData.nama;
                if (this.anggotaData.foto) {
                    users[userIndex].foto = this.anggotaData.foto;
                }
                localStorage.setItem('koperasi_users', JSON.stringify(users));
                
                this.currentUser = users[userIndex];
                localStorage.setItem('koperasi_current_user', JSON.stringify(this.currentUser));
            }
            
            this.loadAnggotaData();
            this.updateUI();
            
            this.closeModal();
            this.showToast('Profil berhasil diperbarui', 'success');
        }
        
        showDetailSimpanan() {
            const simpananPokok = 0;
            const simpananWajib = 0;
            const simpananSukarela = 0;
            const totalSimpanan = 0;
            
            this.showModal({
                title: 'Detail Simpanan',
                content: `
                    <div style="padding: 10px 0;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 32px; font-weight: bold; color: #1a5f23;">
                                Rp ${this.formatNumber(totalSimpanan)}
                            </div>
                            <div style="color: #666; font-size: 14px;">Total Simpanan</div>
                        </div>
                        
                        <div class="financial-details">
                            <div class="financial-item">
                                <span class="financial-label">Simpanan Pokok</span>
                                <span class="financial-value">Rp ${this.formatNumber(simpananPokok)}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">Simpanan Wajib</span>
                                <span class="financial-value">Rp ${this.formatNumber(simpananWajib)}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">Simpanan Sukarela</span>
                                <span class="financial-value">Rp ${this.formatNumber(simpananSukarela)}</span>
                            </div>
                            <div class="financial-item" style="border-top: 2px solid #1a5f23; padding-top: 15px; margin-top: 10px;">
                                <span class="financial-label" style="font-weight: 600;">TOTAL SIMPANAN</span>
                                <span class="financial-value" style="font-size: 1.2rem; color: #1a5f23;">Rp ${this.formatNumber(totalSimpanan)}</span>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" class="modal-btn primary" id="closeSimpananBtn" style="width: 100%;">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                `
            });
            
            document.getElementById('closeSimpananBtn').addEventListener('click', () => {
                this.closeModal();
            });
        }
        
        showDetailPinjaman() {
            const pinjamanAktif = this.formattedData.pinjaman.aktif || [];
            const totalPinjaman = this.formattedData.pinjaman.total;
            
            let pinjamanList = '';
            if (pinjamanAktif.length > 0) {
                pinjamanList = pinjamanAktif.map(p => `
                    <div class="financial-item">
                        <span class="financial-label">${p.jenis || 'Pinjaman'}</span>
                        <span class="financial-value">Rp ${this.formatNumber(p.jumlah || 0)}</span>
                    </div>
                `).join('');
            } else {
                pinjamanList = '<div style="text-align: center; padding: 20px; color: #666;">Tidak ada pinjaman aktif</div>';
            }
            
            this.showModal({
                title: 'Detail Pinjaman',
                content: `
                    <div style="padding: 10px 0;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 32px; font-weight: bold; color: #1a5f23;">
                                Rp ${this.formatNumber(totalPinjaman)}
                            </div>
                            <div style="color: #666; font-size: 14px;">Total Pinjaman</div>
                        </div>
                        
                        <div class="financial-details">
                            ${pinjamanList}
                            <div class="financial-item" style="border-top: 2px solid #1a5f23; padding-top: 15px; margin-top: 10px;">
                                <span class="financial-label" style="font-weight: 600;">TOTAL PINJAMAN</span>
                                <span class="financial-value" style="font-size: 1.2rem; color: #1a5f23;">Rp ${this.formatNumber(totalPinjaman)}</span>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" class="modal-btn primary" id="closePinjamanBtn" style="width: 100%;">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                `
            });
            
            document.getElementById('closePinjamanBtn').addEventListener('click', () => {
                this.closeModal();
            });
        }
        
        showDetailSHU() {
            const shuEstimasi = this.formattedData.shu.estimasi;
            const shuStatus = this.formattedData.shu.status;
            
            this.showModal({
                title: 'Detail SHU Estimasi',
                content: `
                    <div style="padding: 10px 0;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 32px; font-weight: bold; color: #1a5f23;">
                                Rp ${this.formatNumber(shuEstimasi)}
                            </div>
                            <div style="color: #666; font-size: 14px;">Estimasi SHU</div>
                        </div>
                        
                        <div class="financial-details">
                            <div class="financial-item">
                                <span class="financial-label">Status Perhitungan</span>
                                <span class="financial-value">${shuStatus}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">Periode</span>
                                <span class="financial-value">Tahun ${new Date().getFullYear()}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">Update Terakhir</span>
                                <span class="financial-value">${this.formattedData.personal.lastUpdated ? new Date(this.formattedData.personal.lastUpdated).toLocaleDateString('id-ID') : '-'}</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 10px;">
                            <p style="color: #1a5f23; font-weight: 500; margin-bottom: 10px;">üí° Informasi SHU</p>
                            <p style="color: #666; font-size: 0.9rem;">
                                SHU (Sisa Hasil Usaha) adalah keuntungan koperasi yang akan dibagikan kepada anggota 
                                berdasarkan partisipasi modal dan transaksi. Perhitungan final akan dilakukan di akhir tahun.
                            </p>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" class="modal-btn primary" id="closeSHUBtn" style="width: 100%;">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                `
            });
            
            document.getElementById('closeSHUBtn').addEventListener('click', () => {
                this.closeModal();
            });
        }
        
        showStatusDetail() {
            const status = this.formattedData.personal.status;
            const statusClass = status === 'Aktif' ? 'status-aktif' : 'status-tidak-aktif';
            const statusText = status === 'Aktif' ? 'Aktif' : 'Tidak Aktif';
            
            this.showModal({
                title: 'Status Anggota',
                content: `
                    <div style="padding: 10px 0;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">
                                ${status === 'Aktif' ? '‚úÖ' : '‚ö†Ô∏è'}
                            </div>
                            <div style="font-size: 24px; font-weight: bold; color: ${status === 'Aktif' ? '#2e7d32' : '#c62828'}; margin-bottom: 10px;">
                                ${statusText}
                            </div>
                            <div style="color: #666; font-size: 14px;">Status Keanggotaan</div>
                        </div>
                        
                        <div class="financial-details">
                            <div class="financial-item">
                                <span class="financial-label">Nama</span>
                                <span class="financial-value">${this.formattedData.personal.nama}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">ID / NIA</span>
                                <span class="financial-value">${this.formattedData.personal.nia}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">Posisi</span>
                                <span class="financial-value">${this.formattedData.personal.posisi}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">Tanggal Bergabung</span>
                                <span class="financial-value">${this.formattedData.personal.tanggalGabung || '-'}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">Update Terakhir</span>
                                <span class="financial-value">${this.formattedData.personal.lastUpdated ? new Date(this.formattedData.personal.lastUpdated).toLocaleDateString('id-ID') : '-'}</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: ${status === 'Aktif' ? '#e8f5e9' : '#ffebee'}; border-radius: 10px;">
                            <p style="color: ${status === 'Aktif' ? '#2e7d32' : '#c62828'}; font-weight: 500; margin-bottom: 10px;">
                                ${status === 'Aktif' ? '‚úÖ Status Aktif' : '‚ö†Ô∏è Status Tidak Aktif'}
                            </p>
                            <p style="color: #666; font-size: 0.9rem;">
                                ${status === 'Aktif' 
                                    ? 'Anggota aktif memiliki akses penuh ke semua layanan koperasi termasuk simpanan, pinjaman, dan pembagian SHU.' 
                                    : 'Anggota tidak aktif memiliki akses terbatas. Hubungi pengurus koperasi untuk mengaktifkan kembali keanggotaan.'}
                            </p>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" class="modal-btn primary" id="closeStatusBtn" style="width: 100%;">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                `
            });
            
            document.getElementById('closeStatusBtn').addEventListener('click', () => {
                this.closeModal();
            });
        }
        
        showSetorModal() {
            this.showModal({
                title: 'Setor Simpanan',
                content: `
                    <div style="padding: 10px 0;">
                        <div class="anggota-status-info">
                            <h4>Status Anggota</h4>
                            <ul>
                                <li><strong>Nama:</strong> ${this.formattedData.personal.nama}</li>
                                <li><strong>ID/NIA:</strong> ${this.formattedData.personal.nia}</li>
                                <li><strong>Total Simpanan:</strong> Rp ${this.formatNumber(0)}</li>
                            </ul>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Jenis Simpanan *</label>
                            <select class="form-control" id="jenisSimpanan" required>
                                <option value="">Pilih Jenis Simpanan</option>
                                <option value="pokok">Simpanan Pokok</option>
                                <option value="wajib">Simpanan Wajib</option>
                                <option value="sukarela">Simpanan Sukarela</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Jumlah Setoran (Rp) *</label>
                            <input type="number" class="form-control" id="jumlahSetoran" placeholder="Masukkan jumlah setoran" min="10000" step="1000" required>
                            <small style="color: #666; font-size: 0.8rem;">
                                Minimal Rp 10.000
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Metode Pembayaran *</label>
                            <select class="form-control" id="metodeBayar" required>
                                <option value="">Pilih Metode</option>
                                <option value="Bank BRI">Bank BRI - 4098 01 019526 53 3 A/n Eldi Sugianto</option>
                                <option value="Tunai">Tunai (Bayar di Kantor Koperasi)</option>
                                <option value="Transfer Lain">Transfer Bank Lain</option>
                                <option value="E-Wallet">E-Wallet (Dana, OVO, dll)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Catatan (Opsional)</label>
                            <textarea class="form-control" id="catatanSetoran" rows="2" placeholder="Tambahkan catatan jika perlu"></textarea>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" class="modal-btn secondary" id="cancelSetorBtn">
                                <i class="fas fa-times"></i> Batal
                            </button>
                            <button type="button" class="modal-btn primary" id="kirimSetoranBtn">
                                <i class="fab fa-whatsapp"></i> Kirim Permintaan
                            </button>
                        </div>
                    </div>
                `
            });
            
            document.getElementById('cancelSetorBtn').addEventListener('click', () => {
                this.closeModal();
            });
            
            document.getElementById('kirimSetoranBtn').addEventListener('click', () => {
                this.kirimSetoranWhatsApp();
            });
        }
        
        kirimSetoranWhatsApp() {
            const jenisSimpanan = document.getElementById('jenisSimpanan').value;
            const jumlahSetoran = document.getElementById('jumlahSetoran').value;
            const metodeBayar = document.getElementById('metodeBayar').value;
            const catatan = document.getElementById('catatanSetoran').value;
            
            if (!jenisSimpanan) {
                this.showToast('Pilih jenis simpanan terlebih dahulu', 'error');
                return;
            }
            
            if (!jumlahSetoran || jumlahSetoran < 10000) {
                this.showToast('Jumlah setoran minimal Rp 10.000', 'error');
                return;
            }
            
            if (!metodeBayar) {
                this.showToast('Pilih metode pembayaran', 'error');
                return;
            }
            
            const jenisText = {
                'pokok': 'Simpanan Pokok',
                'wajib': 'Simpanan Wajib',
                'sukarela': 'Simpanan Sukarela'
            }[jenisSimpanan] || 'Simpanan';
            
            const message = `*‚îÖ‚ïê‚Ä¢‚ùÉ‚úΩ‡ºä¬∞¬∞üçÄüåªüçÄ¬∞¬∞‡ºä‚úΩ‚ùÉ‚Ä¢‚ïê‚îÖ*
*‚ïê‚ïê‚ïê‚ïê ‚óé‚Ä¢‚ùÄ‚Ä¢‚óéÔ∑Ω‚óé‚Ä¢‚ùÄ‚Ä¢‚óé ‚ïê‚ïê‚ïê‚ïê*

*_Assalamualaikum Warahmatullahi Wabarakatuh_*

==========================
*PERMINTAAN SETOR SIMPANAN*
==========================
*DATA ANGGOTA*

*Nama* : ${this.formattedData.personal.nama}
*NIA* : ${this.formattedData.personal.nia}
*No. WhatsApp* : ${this.formattedData.personal.telepon}
*Alamat* : ${this.formattedData.personal.alamat || '-'}
*Simpanan Saat Ini* : Rp ${this.formatNumber(0)}

==========================
*DETAIL SETORAN*

*Jenis Simpanan* : ${jenisText}
*Jumlah Setoran* : Rp ${this.formatNumber(jumlahSetoran)}
*Metode Pembayaran* : ${metodeBayar}

${catatan ? `*Catatan* : ${catatan}` : ''}

==========================
*PETUNJUK PEMBAYARAN*

1. Transfer ke rekening:
   Bank BRI - 4098 01 019526 53 3
   A/n Eldi Sugianto

2. Setelah transfer, kirim bukti transfer ke nomor ini
3. Admin akan memverifikasi dan memperbarui saldo Anda

===========================

*‚îÖ‚ïê‚Ä¢‚ùÉ‚úΩ‡ºä¬∞¬∞üçÄüåªüçÄ¬∞¬∞‡ºä‚úΩ‚ùÉ‚Ä¢‚ïê‚îÖ*`;
            
            const whatsappUrl = `https://wa.me/6285218483129?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
            this.closeModal();
            this.showToast('Permintaan setoran dikirim ke WhatsApp', 'success');
        }
        
        showPinjamModal() {
            this.showModal({
                title: 'Ajukan Pinjaman',
                content: `
                    <div style="padding: 10px 0;">
                        <div class="anggota-status-info">
                            <h4>Status Pinjaman</h4>
                            <ul>
                                <li><strong>Nama:</strong> ${this.formattedData.personal.nama}</li>
                                <li><strong>Simpanan:</strong> Rp ${this.formatNumber(0)}</li>
                                <li><strong>Pinjaman Aktif:</strong> Rp ${this.formatNumber(0)}</li>
                                <li><strong>Maksimal Pinjaman:</strong> Rp ${this.formatNumber(0)}</li>
                            </ul>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Jumlah Pinjaman (Rp) *</label>
                            <input type="number" class="form-control" id="pinjamAmount" placeholder="Minimal Rp 50.000" min="50000" step="50000" required>
                            <small style="color: #666; font-size: 0.8rem;">
                                Maksimal: Rp ${this.formatNumber(0)}
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tujuan Pinjaman *</label>
                            <select class="form-control" id="tujuanPinjaman" required>
                                <option value="">Pilih Tujuan</option>
                                <option value="Modal Usaha">Modal Usaha</option>
                                <option value="Kebutuhan Pendidikan">Kebutuhan Pendidikan</option>
                                <option value="Kesehatan">Kesehatan</option>
                                <option value="Konsumtif">Kebutuhan Konsumtif</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tenor (Bulan) *</label>
                            <select class="form-control" id="tenorPinjaman" required>
                                <option value="">Pilih Tenor</option>
                                <option value="6">6 Bulan</option>
                                <option value="12">12 Bulan</option>
                                <option value="24">24 Bulan</option>
                                <option value="36">36 Bulan</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Catatan (Opsional)</label>
                            <textarea class="form-control" id="catatanPinjaman" rows="2" placeholder="Jelaskan tujuan pinjaman secara detail"></textarea>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" class="modal-btn secondary" id="cancelPinjamBtn">
                                <i class="fas fa-times"></i> Batal
                            </button>
                            <button type="button" class="modal-btn primary" id="kirimPinjamanBtn">
                                <i class="fab fa-whatsapp"></i> Kirim Pengajuan
                            </button>
                        </div>
                    </div>
                `
            });
            
            document.getElementById('cancelPinjamBtn').addEventListener('click', () => {
                this.closeModal();
            });
            
            document.getElementById('kirimPinjamanBtn').addEventListener('click', () => {
                this.kirimPengajuanPinjamanWhatsApp();
            });
        }
        
        kirimPengajuanPinjamanWhatsApp() {
            const amount = document.getElementById('pinjamAmount').value;
            const tujuan = document.getElementById('tujuanPinjaman').value;
            const tenor = document.getElementById('tenorPinjaman').value;
            const catatan = document.getElementById('catatanPinjaman').value;
            
            if (!amount || amount < 50000) {
                this.showToast('Jumlah pinjaman minimal Rp 50.000', 'error');
                return;
            }
            
            const maxPinjaman = 0;
            if (amount > maxPinjaman) {
                this.showToast(`Maksimal pinjaman adalah Rp ${this.formatNumber(maxPinjaman)}`, 'error');
                return;
            }
            
            if (!tujuan) {
                this.showToast('Pilih tujuan pinjaman', 'error');
                return;
            }
            
            if (!tenor) {
                this.showToast('Pilih tenor pinjaman', 'error');
                return;
            }
            
            const message = `*‚îÖ‚ïê‚Ä¢‚ùÉ‚úΩ‡ºä¬∞¬∞üçÄüåªüçÄ¬∞¬∞‡ºä‚úΩ‚ùÉ‚Ä¢‚ïê‚îÖ*
*‚ïê‚ïê‚ïê‚ïê ‚óé‚Ä¢‚ùÄ‚Ä¢‚óéÔ∑Ω‚óé‚Ä¢‚ùÄ‚Ä¢‚óé ‚ïê‚ïê‚ïê‚ïê*

*_Assalamualaikum Warahmatullahi Wabarakatuh_*

==========================
*PENGAJUAN PINJAMAN*
==========================
*DATA ANGGOTA*

*Nama* : ${this.formattedData.personal.nama}
*NIA* : ${this.formattedData.personal.nia}
*No. WhatsApp* : ${this.formattedData.personal.telepon}
*Simpanan* : Rp ${this.formatNumber(0)}
*Pinjaman Aktif* : Rp ${this.formatNumber(0)}

==========================
*DETAIL PENGAJUAN*

*Jumlah Pinjaman* : Rp ${this.formatNumber(amount)}
*Tujuan Pinjaman* : ${tujuan}
*Tenor* : ${tenor} Bulan
*Estimasi Cicilan* : Rp ${this.formatNumber(Math.round(amount / tenor))}/bulan

${catatan ? `*Keterangan* : ${catatan}` : ''}

==========================
*PERSYARATAN*

1. Fotokopi KTP
2. Fotokopi KK
3. Surat keterangan usaha (jika untuk modal usaha)
4. Jaminan sesuai ketentuan koperasi

===========================

*‚îÖ‚ïê‚Ä¢‚ùÉ‚úΩ‡ºä¬∞¬∞üçÄüåªüçÄ¬∞¬∞‡ºä‚úΩ‚ùÉ‚Ä¢‚ïê‚îÖ*`;
            
            const whatsappUrl = `https://wa.me/6285218483129?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
            this.closeModal();
            this.showToast('Pengajuan pinjaman dikirim ke WhatsApp', 'success');
        }
        
        showRiwayatModal() {
            this.showModal({
                title: 'Riwayat Transaksi',
                content: `
                    <div style="padding: 10px 0;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 28px; font-weight: bold; color: #1a5f23;">
                                Riwayat Transaksi
                            </div>
                            <div style="color: #666; font-size: 14px;">Histori terakhir 30 hari</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <div style="text-align: center; color: #666; padding: 20px;">
                                <i class="fas fa-history" style="font-size: 48px; color: #ccc; margin-bottom: 10px;"></i>
                                <p>Riwayat transaksi akan ditampilkan di sini</p>
                                <p style="font-size: 0.9rem; margin-top: 10px;">
                                    Data akan muncul setelah admin memproses transaksi Anda.
                                    Hubungi Ketua/Sekretaris untuk informasi lengkap.
                                </p>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" class="modal-btn primary" id="closeRiwayatBtn" style="width: 100%;">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                `
            });
            
            document.getElementById('closeRiwayatBtn').addEventListener('click', () => {
                this.closeModal();
            });
        }
        
        showQRModal() {
            const qrData = this.createQRData();
            const qrUrl = `${window.location.origin}/scan-result.html?data=${encodeURIComponent(JSON.stringify(qrData))}`;
            
            this.showModal({
                title: 'QR Code Anggota',
                content: `
                    <div class="qr-modal-design">
                        <div class="qr-title">
                            <i class="fas fa-qrcode"></i> QR Code Digital Anggota
                        </div>
                        
                        <div class="qr-card">
                            <div class="qr-person-info">
                                <div class="qr-person-photo">
                                    <img src="${this.formattedData.personal.foto}" alt="Foto Profil" id="qrProfilePhoto">
                                </div>
                                <div class="qr-person-details">
                                    <h4>${this.formattedData.personal.nama}</h4>
                                    <p><strong>NIA:</strong> ${this.formattedData.personal.nia}</p>
                                    <p><strong>Posisi:</strong> ${this.formattedData.personal.posisi}</p>
                                    <p><strong>Status:</strong> ${this.formattedData.personal.status}</p>
                                </div>
                            </div>
                            
                            <div id="qr-code-display" style="text-align: center; padding: 15px;">
                                <div style="display: inline-block; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                    <div id="qrCodeContainer"></div>
                                </div>
                            </div>
                            
                            <div style="background: #e8f5e9; padding: 12px; border-radius: 8px; margin: 15px 0;">
                                <p style="margin: 0; font-size: 0.9rem; color: #1a5f23;">
                                    <i class="fas fa-info-circle"></i> Scan QR Code ini untuk melihat data lengkap anggota
                                </p>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: #666;">
                                <div>
                                    <i class="fas fa-calendar"></i> Update: ${new Date().toLocaleDateString('id-ID')}
                                </div>
                                <div>
                                    <i class="fas fa-check-circle" style="color: #4CAF50;"></i> Valid
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button type="button" class="action-btn whatsapp" id="shareQRBtn">
                                <i class="fab fa-whatsapp"></i> Bagikan QR
                            </button>
                            <button type="button" class="action-btn download" id="downloadQRBtn">
                                <i class="fas fa-download"></i> Download QR
                            </button>
                        </div>
                        
                        <div class="modal-actions" style="margin-top: 20px;">
                            <button type="button" class="modal-btn primary" id="closeQRBtn" style="width: 100%;">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                `
            });
            
            setTimeout(() => {
                const qrContainer = document.getElementById("qrCodeContainer");
                if (qrContainer) {
                    qrContainer.innerHTML = '';
                    new QRCode(qrContainer, {
                        text: qrUrl,
                        width: 200,
                        height: 200,
                        colorDark: "#1a5f23",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                }
            }, 100);
            
            document.getElementById('closeQRBtn').addEventListener('click', () => {
                this.closeModal();
            });
            
            document.getElementById('shareQRBtn').addEventListener('click', () => {
                this.shareQR(qrData);
            });
            
            document.getElementById('downloadQRBtn').addEventListener('click', () => {
                this.downloadQR();
            });
        }
        
        showKartuModal() {
            const totalSaldo = 0;
            
            this.showModal({
                title: 'Kartu Anggota Digital',
                content: `
                    <div class="kartu-container">
                        <div class="kartu-digital" id="kartuDisplay">
                            <div class="kartu-header">
                                <div class="kartu-logo">
                                    <i class="fas fa-handshake"></i>
                                    <span>Koperasi Asmara Tani</span>
                                </div>
                                <span class="kartu-status">${this.formattedData.personal.status} ‚Ä¢ #koperasijenius</span>
                            </div>
                            
                            <div class="kartu-info">
                                <div class="kartu-photo">
                                    <img src="${this.formattedData.personal.foto}" alt="Photo" id="kartuFoto">
                                </div>
                                <div class="kartu-details">
                                    <h4>${this.formattedData.personal.nama}</h4>
                                    <p><i class="fas fa-id-card"></i> <strong>NIA:</strong> ${this.formattedData.personal.nia}</p>
                                    <p><i class="fas fa-briefcase"></i> <strong>Posisi:</strong> ${this.formattedData.personal.posisi}</p>
                                    <p><i class="fas fa-calendar-alt"></i> <strong>Bergabung:</strong> ${this.formattedData.personal.tanggalGabung || this.formattedData.personal.tanggalDaftar}</p>
                                    <p><i class="fas fa-check-circle"></i> <strong>Status:</strong> ${this.formattedData.personal.status}</p>
                                </div>
                            </div>
                            
                            <div class="kartu-grid">
                                <div class="grid-item">
                                    <span class="grid-label">Alamat</span>
                                    <span class="grid-value">${this.formattedData.personal.alamat || '-'}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Jenis Kelamin</span>
                                    <span class="grid-value">${this.formattedData.personal.jenisKelamin || '-'}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Agama</span>
                                    <span class="grid-value">${this.formattedData.personal.agama || '-'}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Status Perkawinan</span>
                                    <span class="grid-value">${this.formattedData.personal.statusPerkawinan || '-'}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">NIK</span>
                                    <span class="grid-value">${this.formattedData.personal.nik || '-'}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">WhatsApp</span>
                                    <span class="grid-value">${this.formattedData.personal.telepon || '-'}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Email</span>
                                    <span class="grid-value">${this.formattedData.personal.email || '-'}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Tanggal Daftar</span>
                                    <span class="grid-value">${this.formattedData.personal.tanggalDaftar || '-'}</span>
                                </div>
                            </div>
                            
                            <div class="kartu-grid" style="background: rgba(255, 255, 255, 0.12); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <div class="grid-item">
                                    <span class="grid-label">Simpanan Pokok</span>
                                    <span class="grid-value">Rp ${this.formatNumber(0)}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Simpanan Wajib</span>
                                    <span class="grid-value">Rp ${this.formatNumber(0)}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Simpanan Sukarela</span>
                                    <span class="grid-value">Rp ${this.formatNumber(0)}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Total Simpanan</span>
                                    <span class="grid-value" style="color: #ffd700; font-weight: bold;">Rp ${this.formatNumber(0)}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Total Pinjaman</span>
                                    <span class="grid-value">Rp ${this.formatNumber(0)}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Saldo Bersih</span>
                                    <span class="grid-value" style="color: #4CAF50; font-weight: bold;">Rp ${this.formatNumber(0)}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">SHU Estimasi</span>
                                    <span class="grid-value">Rp ${this.formatNumber(0)}</span>
                                </div>
                                <div class="grid-item">
                                    <span class="grid-label">Update Terakhir</span>
                                    <span class="grid-value">${this.formattedData.personal.lastUpdated ? new Date(this.formattedData.personal.lastUpdated).toLocaleDateString('id-ID') : '-'}</span>
                                </div>
                            </div>
                            
                            <div class="kartu-qr-section">
                                <div class="kartu-qr-container">
                                    <div id="kartuQrCode"></div>
                                </div>
                                <div class="qr-code-text">Scan QR Code untuk verifikasi keanggotaan</div>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button type="button" class="action-btn whatsapp" id="shareKartuBtn">
                                <i class="fab fa-whatsapp"></i> Bagikan Kartu
                            </button>
                            <button type="button" class="action-btn download" id="downloadKartuBtn">
                                <i class="fas fa-download"></i> Download Gambar
                            </button>
                            <button type="button" class="action-btn pdf" id="downloadKartuPDFBtn">
                                <i class="fas fa-file-pdf"></i> Download PDF
                            </button>
                            <button type="button" class="action-btn" id="printKartuBtn" style="background: var(--primary); color: white;">
                                <i class="fas fa-print"></i> Cetak Kartu
                            </button>
                        </div>
                        
                        <div class="modal-actions" style="margin-top: 15px;">
                            <button type="button" class="modal-btn secondary" id="closeKartuBtn">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                `
            });
            
            setTimeout(() => {
                const qrContainer = document.getElementById("kartuQrCode");
                if (qrContainer) {
                    qrContainer.innerHTML = '';
                    const qrData = this.createQRData();
                    const qrUrl = `${window.location.origin}/scan-result.html?data=${encodeURIComponent(JSON.stringify(qrData))}`;
                    
                    new QRCode(qrContainer, {
                        text: qrUrl,
                        width: 120,
                        height: 120,
                        colorDark: "#1a5f23",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                }
            }, 100);
            
            document.getElementById('closeKartuBtn').addEventListener('click', () => {
                this.closeModal();
            });
            
            document.getElementById('shareKartuBtn').addEventListener('click', () => {
                this.shareKartu();
            });
            
            document.getElementById('downloadKartuBtn').addEventListener('click', () => {
                this.downloadKartu();
            });
            
            document.getElementById('downloadKartuPDFBtn').addEventListener('click', () => {
                this.downloadKartuPDF();
            });
            
            document.getElementById('printKartuBtn').addEventListener('click', () => {
                this.printKartu();
            });
        }
        
        createQRData() {
            const totalSaldo = 0;
            
            return {
                id: this.formattedData.personal.id,
                nia: this.formattedData.personal.nia,
                nama: this.formattedData.personal.nama,
                posisi: this.formattedData.personal.posisi,
                alamat: this.formattedData.personal.alamat,
                telepon: this.formattedData.personal.telepon,
                email: this.formattedData.personal.email,
                jenis_kelamin: this.formattedData.personal.jenisKelamin,
                agama: this.formattedData.personal.agama,
                status_perkawinan: this.formattedData.personal.statusPerkawinan,
                nik: this.formattedData.personal.nik,
                tanggal_daftar: this.formattedData.personal.tanggalDaftar,
                tanggal_bergabung: this.formattedData.personal.tanggalGabung,
                status_anggota: this.formattedData.personal.status,
                simpanan_pokok: 0,
                simpanan_wajib: 0,
                simpanan_sukarela: 0,
                total_simpanan: 0,
                total_pinjaman: 0,
                total_saldo: 0,
                shu_estimasi: 0,
                foto: this.formattedData.personal.foto,
                last_updated: this.formattedData.personal.lastUpdated,
                timestamp: new Date().toISOString(),
                koperasi: "Koperasi Asmara Tani",
                website: "#koperasijenius"
            };
        }
        
        shareQR(qrData) {
            const message = `*KARTU ANGGOTA KOPERASI ASMARA TANI* #koperasijenius\n\n` +
                           `üë§ *Nama:* ${qrData.nama}\n` +
                           `üÜî *NIA:* ${qrData.nia}\n` +
                           `üè¢ *Posisi:* ${qrData.posisi}\n` +
                           `üìç *Alamat:* ${qrData.alamat || '-'}\n` +
                           `üìû *WhatsApp:* ${qrData.telepon || '-'}\n` +
                           `üìß *Email:* ${qrData.email}\n` +
                           `üë´ *Jenis Kelamin:* ${qrData.jenis_kelamin || '-'}\n` +
                           `üïå *Agama:* ${qrData.agama || '-'}\n` +
                           `‚úÖ *Status:* ${qrData.status_anggota}\n` +
                           `üí∞ *Total Simpanan:* Rp ${this.formatNumber(0)}\n` +
                           `üìÖ *Tanggal Bergabung:* ${qrData.tanggal_bergabung || '-'}\n\n` +
                           `_Kartu Anggota Digital - #koperasijenius_`;
            
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            this.showToast('QR Code siap dibagikan', 'success');
        }
        
        downloadQR() {
            const qrCanvas = document.querySelector('#qrCodeContainer canvas');
            if (qrCanvas) {
                const tempCanvas = document.createElement('canvas');
                const ctx = tempCanvas.getContext('2d');
                tempCanvas.width = qrCanvas.width * 2;
                tempCanvas.height = qrCanvas.height * 2;
                
                ctx.imageSmoothingEnabled = false;
                ctx.drawImage(qrCanvas, 0, 0, tempCanvas.width, tempCanvas.height);
                
                const link = document.createElement('a');
                link.download = `QR_${this.formattedData.personal.nia}_${this.formattedData.personal.nama.replace(/\s+/g, '_')}.png`;
                link.href = tempCanvas.toDataURL('image/png');
                link.click();
                this.showToast('QR Code berhasil diunduh', 'success');
            }
        }
        
        shareKartu() {
            const totalSaldo = 0;
            const message = `*KARTU ANGGOTA KOPERASI ASMARA TANI* #koperasijenius\n\n` +
                           `üë§ *Nama:* ${this.formattedData.personal.nama}\n` +
                           `üÜî *NIA:* ${this.formattedData.personal.nia}\n` +
                           `üè¢ *Posisi:* ${this.formattedData.personal.posisi}\n` +
                           `üìç *Alamat:* ${this.formattedData.personal.alamat || '-'}\n` +
                           `üìû *WhatsApp:* ${this.formattedData.personal.telepon || '-'}\n` +
                           `üë´ *Jenis Kelamin:* ${this.formattedData.personal.jenisKelamin || '-'}\n` +
                           `üïå *Agama:* ${this.formattedData.personal.agama || '-'}\n` +
                           `‚úÖ *Status:* ${this.formattedData.personal.status}\n` +
                           `üí∞ *Total Simpanan:* Rp ${this.formatNumber(0)}\n` +
                           `üí≥ *Total Pinjaman:* Rp ${this.formatNumber(0)}\n` +
                           `üíµ *Saldo Bersih:* Rp ${this.formatNumber(0)}\n` +
                           `üìÖ *Tanggal Bergabung:* ${this.formattedData.personal.tanggalGabung || this.formattedData.personal.tanggalDaftar}\n\n` +
                           `_Kartu Anggota Digital - #koperasijenius_`;
            
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            this.showToast('Kartu siap dibagikan', 'success');
        }
        
        downloadKartu() {
            const kartuElement = document.getElementById('kartuDisplay');
            if (kartuElement) {
                setTimeout(() => {
                    html2canvas(kartuElement, {
                        backgroundColor: null,
                        scale: 3,
                        useCORS: true,
                        logging: false,
                        allowTaint: true,
                        imageTimeout: 15000
                    }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `Kartu_Anggota_${this.formattedData.personal.nia}_${this.formattedData.personal.nama.replace(/\s+/g, '_')}.png`;
                        
                        canvas.toBlob(function(blob) {
                            const url = URL.createObjectURL(blob);
                            link.href = url;
                            link.click();
                            URL.revokeObjectURL(url);
                        }, 'image/png', 1.0);
                        
                        this.showToast('Kartu berhasil diunduh', 'success');
                    }).catch(error => {
                        console.error('Error generating kartu image:', error);
                        this.showToast('Gagal mengunduh kartu', 'error');
                    });
                }, 1000);
            }
        }
        
        downloadKartuPDF() {
            const kartuElement = document.getElementById('kartuDisplay');
            if (kartuElement) {
                setTimeout(() => {
                    html2canvas(kartuElement, {
                        backgroundColor: null,
                        scale: 3,
                        useCORS: true,
                        allowTaint: true,
                        imageTimeout: 15000
                    }).then(canvas => {
                        const pdf = new jsPDF('p', 'mm', 'a6');
                        const imgData = canvas.toDataURL('image/png');
                        const imgWidth = 105;
                        const pageHeight = 148;
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        
                        const xOffset = (imgWidth - (imgWidth * 0.9)) / 2;
                        const yOffset = (pageHeight - imgHeight) / 2;
                        
                        pdf.addImage(imgData, 'PNG', xOffset, yOffset, imgWidth * 0.9, imgHeight);
                        
                        pdf.setFontSize(8);
                        pdf.setTextColor(102, 102, 102);
                        pdf.text('Kartu Anggota Koperasi Asmara Tani - #koperasijenius', 105/2, 140, null, null, 'center');
                        pdf.text(`Dicetak: ${new Date().toLocaleDateString('id-ID')}`, 105/2, 145, null, null, 'center');
                        
                        pdf.save(`Kartu_Anggota_${this.formattedData.personal.nia}_${this.formattedData.personal.nama.replace(/\s+/g, '_')}.pdf`);
                        this.showToast('PDF Kartu berhasil diunduh', 'success');
                    }).catch(error => {
                        console.error('Error generating PDF:', error);
                        this.showToast('Gagal mengunduh PDF', 'error');
                    });
                }, 1000);
            }
        }
        
        printKartu() {
            const printPreview = document.getElementById('printPreview');
            const kartuElement = document.getElementById('kartuDisplay');
            
            printPreview.innerHTML = '';
            
            const canvasContainer = document.createElement('div');
            canvasContainer.className = 'print-canvas-container';
            
            const infoText = document.createElement('div');
            infoText.style.textAlign = 'center';
            infoText.style.marginTop = '20px';
            infoText.style.color = '#666';
            infoText.innerHTML = `
                <p><strong>Preview Cetak Kartu Anggota</strong></p>
                <p>Ukuran: A6 (105mm x 148mm)</p>
                <p>Nama: ${this.formattedData.personal.nama}</p>
                <p>NIA: ${this.formattedData.personal.nia}</p>
                <p>Silahkan klik "Cetak" untuk mencetak kartu ini</p>
            `;
            
            const printButton = document.createElement('button');
            printButton.className = 'modal-btn primary';
            printButton.style.margin = '20px auto';
            printButton.style.display = 'block';
            printButton.innerHTML = '<i class="fas fa-print"></i> Cetak Sekarang';
            printButton.onclick = () => {
                window.print();
            };
            
            const closeButton = document.createElement('button');
            closeButton.className = 'modal-btn secondary';
            closeButton.style.margin = '10px auto';
            closeButton.style.display = 'block';
            closeButton.innerHTML = '<i class="fas fa-times"></i> Tutup Preview';
            closeButton.onclick = () => {
                this.closeModal();
            };
            
            printPreview.appendChild(canvasContainer);
            printPreview.appendChild(infoText);
            printPreview.appendChild(printButton);
            printPreview.appendChild(closeButton);
            
            setTimeout(() => {
                html2canvas(kartuElement, {
                    backgroundColor: null,
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    imageTimeout: 10000
                }).then(canvas => {
                    canvasContainer.appendChild(canvas);
                    printPreview.style.display = 'block';
                }).catch(error => {
                    console.error('Error generating print preview:', error);
                    canvasContainer.innerHTML = '<p style="color: #f44336; text-align: center;">Error generating preview. Please try again.</p>';
                });
            }, 500);
        }
        
        // ===== PASSWORD MODAL FUNCTIONS =====
        
        showPasswordModal() {
            document.getElementById('passwordModal').classList.add('active');
            document.getElementById('currentPassword').focus();
            
            const toggleCurrentPasswordBtn = document.getElementById('toggleCurrentPassword');
            const currentPasswordField = document.getElementById('currentPassword');
            const toggleNewPasswordBtn = document.getElementById('toggleNewPassword');
            const newPasswordField = document.getElementById('newPassword');
            const toggleConfirmPasswordBtn = document.getElementById('toggleConfirmPassword');
            const confirmPasswordField = document.getElementById('confirmPassword');
            
            toggleCurrentPasswordBtn.addEventListener('click', () => {
                const type = currentPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                currentPasswordField.setAttribute('type', type);
                toggleCurrentPasswordBtn.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
            
            toggleNewPasswordBtn.addEventListener('click', () => {
                const type = newPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                newPasswordField.setAttribute('type', type);
                toggleNewPasswordBtn.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
            
            toggleConfirmPasswordBtn.addEventListener('click', () => {
                const type = confirmPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                confirmPasswordField.setAttribute('type', type);
                toggleConfirmPasswordBtn.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
        }
        
        changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            const users = JSON.parse(localStorage.getItem('koperasi_users') || '[]');
            const currentUser = users.find(u => u.email === this.currentUser.email);
            
            if (!currentUser || currentUser.password !== currentPassword) {
                this.showToast('Password saat ini salah', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                this.showToast('Konfirmasi password tidak cocok', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                this.showToast('Password minimal 6 karakter', 'error');
                return;
            }
            
            currentUser.password = newPassword;
            
            const userIndex = users.findIndex(u => u.email === this.currentUser.email);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('koperasi_users', JSON.stringify(users));
            }
            
            this.currentUser = currentUser;
            localStorage.setItem('koperasi_current_user', JSON.stringify(this.currentUser));
            
            this.formattedData.personal.password = newPassword;
            
            this.closePasswordModal();
            
            this.showToast('Password berhasil diubah', 'success');
            
            document.getElementById('changePasswordForm').reset();
        }
        
        closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
            document.getElementById('changePasswordForm').reset();
        }
        
        // ===== UTILITY FUNCTIONS =====
        
        showModal({ title, content }) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modalOverlay').classList.add('active');
        }
        
        closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            document.getElementById('modalBody').innerHTML = '';
        }
        
        showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.className = `toast ${type}`;
            document.getElementById('toastMessage').textContent = message;
            
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        formatNumber(amount) {
            if (!amount) return '0';
            return new Intl.NumberFormat('id-ID').format(amount);
        }
        
        startSync() {
            setInterval(() => {
                this.updateSyncIndicator();
            }, 5000);
        }
        
        updateSyncIndicator() {
            const indicator = document.getElementById('syncIndicator');
            if (indicator) {
                indicator.innerHTML = `<i class="fas fa-sync-alt fa-spin"></i> <span>Sync ${new Date().getSeconds()}</span>`;
                
                setTimeout(() => {
                    if (indicator) {
                        indicator.innerHTML = `<i class="fas fa-sync-alt"></i> <span>Real-time</span>`;
                    }
                }, 1000);
            }
        }
        
        handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('photoPreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
    }

    // ===== INITIALIZE =====
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Initializing Tabungan Digital System...');
        
        // Initialize main app
        window.tabunganApp = new DigitalTabungan();
        
        // Show ready message
        setTimeout(() => {
            const toast = document.getElementById('toast');
            if (toast) {
                document.getElementById('toastMessage').textContent = 'Sistem Tabungan Digital siap!';
                toast.className = 'toast success show';
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
            
            console.log('‚úÖ System fully initialized');
        }, 2000);
    });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabungan Digital - Koperasi Asmara Tani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Modern Koperasi Color Palette */
            --primary: #1a5f23;
            --primary-light: #2e7d32;
            --primary-dark: #0d4014;
            --secondary: #ff9800;
            --secondary-light: #ffb74d;
            --secondary-dark: #f57c00;
            --accent-blue: #2196f3;
            --accent-purple: #9c27b0;
            --accent-cyan: #00bcd4;
            --danger: #f44336;
            --warning: #ffc107;
            --success: #4caf50;
            --info: #2196f3;
            
            /* Glass Morphism */
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.3);
            --glass-shadow: 0 8px 32px rgba(26, 95, 35, 0.2);
            --glass-glow: 0 0 20px rgba(46, 125, 50, 0.2);
            
            /* Spacing System */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 25%, #a5d6a7 50%, #81c784 75%, #66bb6a 100%);
            color: #1a5f23;
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            padding: 0;
            position: relative;
            padding-bottom: 70px;
        }

        /* ===== LOADING SCREEN ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-md);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-content h3 {
            margin-bottom: var(--space-xs);
            color: var(--text-primary);
        }

        .loading-content p {
            color: var(--text-muted);
        }

        /* ===== BOTTOM BUTTONS ===== */
        .bottom-buttons {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: var(--space-sm);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(26, 95, 35, 0.2);
            z-index: 99;
        }

        .back-button {
            background: rgba(26, 95, 35, 0.1);
            border: 1px solid rgba(26, 95, 35, 0.3);
            color: #1a5f23;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .back-button:hover {
            background: rgba(26, 95, 35, 0.2);
            transform: translateY(-2px);
        }

        .notification-bottom {
            position: relative;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: #1a5f23;
            background: rgba(26, 95, 35, 0.1);
            border: 1px solid rgba(26, 95, 35, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .notification-bottom:hover {
            background: rgba(26, 95, 35, 0.2);
            transform: translateY(-2px);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* ===== GLASS MORPHISM EFFECT ===== */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: var(--glass-shadow);
            padding: var(--space-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--glass-shadow), var(--glass-glow);
            border-color: rgba(46, 125, 50, 0.5);
        }

        /* ===== HEADER ===== */
        .header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(26, 95, 35, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: var(--space-sm) 0;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-md);
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-left, .header-center, .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo i {
            font-size: 1.5rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: var(--space-xs) var(--space-sm);
            border-radius: 8px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(26, 95, 35, 0.2);
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            object-fit: cover;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: #1a5f23;
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            margin-left: var(--space-xs);
        }

        /* ===== NAVBAR PROFILE BUTTON ===== */
        .navbar-profile-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .navbar-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-md);
            display: grid;
            gap: var(--space-lg);
        }

        /* ===== SECTION TITLES ===== */
        .section-title {
            font-size: 1.4rem;
            margin-bottom: var(--space-md);
            color: #1a5f23;
            font-weight: 700;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 2px;
        }

        /* ===== QUICK ACTIONS - SATU KARTU ===== */
        .quick-actions-single {
            margin-bottom: 20px;
        }

        .group-menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .action-card {
            text-align: center;
            cursor: pointer;
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 120px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 1px solid rgba(26, 95, 35, 0.2);
        }

        .action-card:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(26, 95, 35, 0.15);
        }

        .action-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 1.3rem;
            color: white;
            transition: all 0.3s ease;
        }

        .action-card:hover .action-icon {
            transform: scale(1.1);
        }

        .action-text {
            font-weight: 600;
            font-size: 0.9rem;
            color: #1a5f23;
        }

        /* ===== STATS OVERVIEW ===== */
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-md);
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
        }

        .stat-info h3 {
            font-size: 0.9rem;
            color: #1a5f23;
            margin-bottom: 4px;
        }

        .stat-amount {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-trend {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 8px;
            background: rgba(26, 95, 35, 0.1);
            color: #1a5f23;
        }

        /* ===== PROFILE SECTION - REMOVED FROM MAIN CONTENT ===== */
        .profile-section {
            display: none; /* Dipindahkan ke modal */
        }

        /* ===== SIMPANAN SECTION ===== */
        .simpanan-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-md);
        }

        .simpanan-card {
            padding: var(--space-md);
        }

        .simpanan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
        }

        .simpanan-header h4 {
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            color: #1a5f23;
        }

        .status {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.2);
            color: var(--primary);
        }

        .status.active {
            background: rgba(255, 152, 0, 0.2);
            color: var(--secondary);
        }

        .status.available {
            background: rgba(33, 150, 243, 0.2);
            color: var(--accent-blue);
        }

        .simpanan-amount {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .simpanan-desc {
            color: #1a5f23;
            font-size: 0.9rem;
            margin-bottom: var(--space-sm);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-xs);
        }

        .btn-setor, .btn-tarik {
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-setor {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-setor:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-tarik {
            background: rgba(26, 95, 35, 0.1);
            color: #1a5f23;
            border: 1px solid rgba(26, 95, 35, 0.3);
        }

        .btn-tarik:hover {
            background: rgba(26, 95, 35, 0.15);
            transform: translateY(-2px);
        }

        /* ===== PINJAMAN SECTION ===== */
        .pinjaman-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-md);
        }

        .pinjaman-card {
            padding: var(--space-md);
        }

        .pinjaman-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-md);
        }

        .pinjaman-header h4 {
            font-size: 1.1rem;
            margin-bottom: 4px;
            color: #1a5f23;
        }

        .pinjaman-details {
            margin-bottom: var(--space-md);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(26, 95, 35, 0.2);
            color: #1a5f23;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .progress-container {
            margin: var(--space-md) 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(26, 95, 35, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #1a5f23;
        }

        .btn-bayar {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
        }

        .btn-bayar:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }

        /* ===== SHU SECTION ===== */
        .shu-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-md);
        }

        .shu-card {
            padding: var(--space-md);
        }

        .shu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .shu-header h4 {
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            color: #1a5f23;
        }

        .shu-badge {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(255, 152, 0, 0.2);
            color: var(--secondary);
        }

        .shu-amount-container {
            text-align: center;
            margin-bottom: var(--space-md);
        }

        .shu-amount {
            font-size: 1.6rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 4px;
        }

        .shu-desc {
            color: #1a5f23;
        }

        .btn-detail {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
        }

        .btn-detail:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        /* ===== KARTU ANGGOTA SECTION ===== */
        .kartu-container {
            max-width: 400px;
            margin: 0 auto;
        }

        .kartu-card {
            padding: var(--space-md);
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            border: 2px solid var(--primary);
        }

        .kartu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid rgba(26, 95, 35, 0.2);
        }

        .kartu-logo {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-weight: 700;
            color: var(--primary);
        }

        .kartu-valid {
            font-size: 0.8rem;
            color: #1a5f23;
        }

        .kartu-body {
            margin-bottom: var(--space-md);
        }

        .kartu-qr {
            text-align: center;
            margin-bottom: var(--space-md);
        }

        .qr-placeholder {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-md);
            background: rgba(26, 95, 35, 0.1);
            border-radius: 8px;
            color: #1a5f23;
        }

        .qr-placeholder i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .kartu-info {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .kartu-photo img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            border: 2px solid var(--primary);
            object-fit: cover;
        }

        .kartu-details h4 {
            font-size: 1.1rem;
            margin-bottom: 4px;
            color: #1a5f23;
        }

        .kartu-nia {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 2px;
        }

        .kartu-posisi, .kartu-join {
            color: #1a5f23;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .kartu-footer {
            border-top: 1px solid rgba(26, 95, 35, 0.2);
            padding-top: var(--space-sm);
        }

        .kartu-contacts {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 0.8rem;
            color: #1a5f23;
        }

        .kartu-contacts span {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .kartu-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }

        .btn-kartu {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
        }

        .btn-kartu.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-kartu.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-kartu.secondary {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
        }

        .btn-kartu.secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        /* ===== MODAL STYLES ===== */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
        }

        .modal-container {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(26, 95, 35, 0.3);
            border-radius: 16px;
            padding: var(--space-lg);
            max-width: 500px;
            width: calc(100% - 10px);
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(26, 95, 35, 0.3);
            position: relative;
        }

        @media (max-width: 480px) {
            .modal-container {
                width: calc(100% - 10px);
                padding: var(--space-md);
                margin: 0 5px;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .modal-header h3 {
            color: #1a5f23;
            font-size: 1.3rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: #1a5f23;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(26, 95, 35, 0.1);
            color: var(--primary);
        }

        .modal-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin: var(--space-md) 0;
        }

        .modal-option {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md);
            background: rgba(26, 95, 35, 0.05);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .modal-option:hover {
            background: rgba(26, 95, 35, 0.1);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .modal-option i {
            color: var(--primary);
            font-size: 1.2rem;
            width: 30px;
        }

        .modal-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .modal-btn.secondary {
            background: rgba(26, 95, 35, 0.1);
            color: #1a5f23;
            border: 1px solid rgba(26, 95, 35, 0.3);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        /* ===== PROFILE MODAL STYLES ===== */
        .profile-modal-content {
            padding: var(--space-md) 0;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .profile-avatar {
            width: 90px;
            height: 90px;
            border-radius: 10px;
            border: 3px solid var(--primary);
            object-fit: cover;
        }

        .profile-info h3 {
            font-size: 1.3rem;
            margin-bottom: 4px;
            color: #1a5f23;
        }

        .profile-nia {
            color: #1a5f23;
            margin-bottom: var(--space-sm);
        }

        .status-container {
            display: flex;
            gap: var(--space-xs);
        }

        .status-badge, .role-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge {
            background: rgba(76, 175, 80, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .role-badge {
            background: rgba(255, 152, 0, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .profile-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: rgba(26, 95, 35, 0.05);
            border-radius: 8px;
            color: #1a5f23;
        }

        .detail-item i {
            width: 20px;
            color: var(--primary);
        }

        .password-container {
            position: relative;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .password-label {
            font-weight: 600;
            font-size: 0.9rem;
            color: #1a5f23;
        }

        .password-display {
            font-weight: 600;
            font-size: 0.9rem;
            margin-left: 8px;
        }

        .password-toggle {
            background: none;
            border: none;
            color: #1a5f23;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .password-toggle:hover {
            background: rgba(26, 95, 35, 0.1);
            color: var(--primary);
        }

        /* ===== FORM STYLES ===== */
        .form-group {
            margin-bottom: var(--space-md);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-xs);
            font-weight: 600;
            color: #1a5f23;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(26, 95, 35, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            color: #1a5f23;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 35, 0.2);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%231a5f23' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-sm);
        }

        .form-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-lg);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-secondary {
            background: rgba(26, 95, 35, 0.1);
            color: #1a5f23;
            border: 1px solid rgba(26, 95, 35, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(26, 95, 35, 0.15);
            transform: translateY(-2px);
        }

        /* ===== PASSWORD INPUT STYLES ===== */
        .password-input-container {
            position: relative;
            width: 100%;
        }

        .password-input {
            padding-right: 40px;
        }

        .password-eye {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #1a5f23;
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .password-eye:hover {
            background: rgba(26, 95, 35, 0.1);
            color: var(--primary);
        }

        /* ===== FILE UPLOAD STYLES ===== */
        .file-upload-container {
            position: relative;
            width: 100%;
        }

        .file-upload-label {
            display: block;
            padding: 12px;
            border: 2px dashed rgba(26, 95, 35, 0.3);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #1a5f23;
        }

        .file-upload-label:hover {
            border-color: var(--primary);
            background: rgba(26, 95, 35, 0.05);
        }

        .file-upload-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            cursor: pointer;
        }

        /* ===== TOAST STYLES ===== */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(26, 95, 35, 0.3);
            border-radius: 8px;
            padding: var(--space-md);
            box-shadow: 0 8px 32px rgba(26, 95, 35, 0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
            max-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--primary);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.info {
            border-left: 4px solid var(--accent-blue);
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            color: #1a5f23;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: var(--space-sm);
                text-align: center;
            }
            
            .group-menu-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .stats-overview {
                grid-template-columns: 1fr;
            }
            
            .simpanan-cards {
                grid-template-columns: 1fr;
            }
            
            .pinjaman-cards {
                grid-template-columns: 1fr;
            }
            
            .shu-cards {
                grid-template-columns: 1fr;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-details {
                grid-template-columns: 1fr;
            }
            
            .kartu-actions {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: var(--space-sm);
            }
        }

        @media (max-width: 480px) {
            .section-title {
                font-size: 1.2rem;
            }
            
            .user-name {
                display: none;
            }
            
            .bottom-buttons {
                padding: 8px;
            }
            
            .back-button, .notification-bottom {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }

        /* ===== ANIMATION KEYFRAMES ===== */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Apply animations */
        .quick-actions-single,
        .stats-overview,
        .simpanan-section,
        .pinjaman-section,
        .shu-section,
        .kartu-section {
            animation: fadeInUp 0.6s ease-out;
        }

        .quick-actions-single { animation-delay: 0.1s; }
        .stats-overview { animation-delay: 0.2s; }
        .simpanan-section { animation-delay: 0.3s; }
        .pinjaman-section { animation-delay: 0.4s; }
        .shu-section { animation-delay: 0.5s; }
        .kartu-section { animation-delay: 0.6s; }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Memuat Tabungan Digital</h3>
            <p>Koperasi Asmara Tani</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="user-profile" id="userProfileBtn">
                    <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face" alt="Profile" class="avatar" id="userAvatar">
                    <span class="user-name" id="userName">Budi Santoso</span>
                    <div class="online-indicator"></div>
                </div>
            </div>
            <div class="header-center">
                <div class="logo">
                    <i class="fas fa-book"></i>
                    <span>Tabungan Digital</span>
                </div>
                <button class="navbar-profile-btn" id="editProfileBtn">
                    <i class="fas fa-user-edit"></i>
                    EDIT PROFIL
                </button>
            </div>
            <div class="header-right">
                <!-- Empty for balance -->
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Quick Actions - SATU KARTU -->
        <section class="quick-actions-single">
            <h2 class="section-title">Aksi Cepat</h2>
            <div class="glass-card">
                <div class="group-menu-grid">
                    <!-- Baris 1 -->
                    <div class="action-card" data-action="setor">
                        <div class="action-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <span class="action-text">Setor Simpanan</span>
                    </div>
                    <div class="action-card" data-action="pinjam">
                        <div class="action-icon">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <span class="action-text">Ajukan Pinjaman</span>
                    </div>
                    
                    <!-- Baris 2 -->
                    <div class="action-card" data-action="riwayat">
                        <div class="action-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <span class="action-text">Riwayat Transaksi</span>
                    </div>
                    <div class="action-card" data-action="kartu">
                        <div class="action-icon">
                            <i class="fas fa-id-card"></i>
                        </div>
                        <span class="action-text">Kartu Anggota</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Overview -->
        <section class="stats-overview">
            <div class="stat-card glass-card">
                <div class="stat-icon">
                    <i class="fas fa-university"></i>
                </div>
                <div class="stat-info">
                    <h3>Total Simpanan</h3>
                    <p class="stat-amount" id="totalSimpanan">Rp 8,250,000</p>
                    <span class="stat-trend" id="simpananTrend">+15% dari bulan lalu</span>
                </div>
            </div>
            <div class="stat-card glass-card">
                <div class="stat-icon">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <div class="stat-info">
                    <h3>Pinjaman Aktif</h3>
                    <p class="stat-amount" id="totalPinjaman">Rp 5,400,000</p>
                    <span class="stat-trend" id="pinjamanTrend">2 pinjaman aktif</span>
                </div>
            </div>
            <div class="stat-card glass-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-info">
                    <h3>SHU Estimasi</h3>
                    <p class="stat-amount" id="shuAmount">Rp 3,200,000</p>
                    <span class="stat-trend" id="shuTrend">Estimasi tahun berjalan</span>
                </div>
            </div>
        </section>

        <!-- Simpanan Section -->
        <section class="simpanan-section">
            <h2 class="section-title">Simpanan Saya</h2>
            <div class="simpanan-cards">
                <div class="simpanan-card glass-card">
                    <div class="simpanan-header">
                        <h4><i class="fas fa-key"></i> Simpanan Pokok</h4>
                        <span class="status success" id="statusPokok">Lunas</span>
                    </div>
                    <p class="simpanan-amount" id="amountPokok">Rp 100,000</p>
                    <p class="simpanan-desc">Dibayar sekali saat pendaftaran</p>
                    <div class="action-buttons">
                        <button class="btn-setor" data-action="setor-pokok">+ Setor</button>
                        <button class="btn-tarik" data-action="tarik-pokok">- Tarik</button>
                    </div>
                </div>
                
                <div class="simpanan-card glass-card">
                    <div class="simpanan-header">
                        <h4><i class="fas fa-calendar-alt"></i> Simpanan Wajib</h4>
                        <span class="status active" id="statusWajib">Aktif</span>
                    </div>
                    <p class="simpanan-amount" id="amountWajib">Rp 250,000/bulan</p>
                    <p class="simpanan-desc" id="descWajib">Terakhir bayar: Jan 2025</p>
                    <div class="action-buttons">
                        <button class="btn-setor" data-action="setor-wajib">+ Setor</button>
                        <button class="btn-tarik" data-action="tarik-wajib">- Tarik</button>
                    </div>
                </div>
                
                <div class="simpanan-card glass-card">
                    <div class="simpanan-header">
                        <h4><i class="fas fa-star"></i> Simpanan Sukarela</h4>
                        <span class="status available" id="statusSukarela">Tersedia</span>
                    </div>
                    <p class="simpanan-amount" id="amountSukarela">Rp 7,900,000</p>
                    <p class="simpanan-desc">Saldo saat ini</p>
                    <div class="action-buttons">
                        <button class="btn-setor" data-action="setor-sukarela">+ Setor</button>
                        <button class="btn-tarik" data-action="tarik-sukarela">- Tarik</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pinjaman Section -->
        <section class="pinjaman-section" id="pinjamanSection">
            <h2 class="section-title">Pinjaman Aktif</h2>
            <div class="pinjaman-cards" id="pinjamanCards">
                <div class="pinjaman-card glass-card">
                    <div class="pinjaman-header">
                        <div>
                            <h4>Pinjaman Reguler 001/2025</h4>
                            <p class="pinjaman-date">Diajukan: 10 Jan 2025</p>
                        </div>
                        <span class="status-badge">Lancar</span>
                    </div>
                    
                    <div class="pinjaman-details">
                        <div class="detail-row">
                            <span>Total Pinjaman</span>
                            <strong>Rp 5,000,000</strong>
                        </div>
                        <div class="detail-row">
                            <span>Angsuran/Bulan</span>
                            <strong>Rp 500,000</strong>
                        </div>
                        <div class="detail-row">
                            <span>Sisa Tenor</span>
                            <strong>11 Bulan</strong>
                        </div>
                        <div class="detail-row">
                            <span>Jatuh Tempo</span>
                            <strong class="due-date">15 Feb 2025</strong>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 8%"></div>
                        </div>
                        <div class="progress-text">
                            <span>8% Selesai</span>
                            <span>1 dari 12 angsuran</span>
                        </div>
                    </div>
                    
                    <button class="btn-bayar" data-action="bayar-pinjaman">
                        <i class="fas fa-credit-card"></i>
                        Bayar Angsuran Feb 2025
                    </button>
                </div>

                <div class="pinjaman-card glass-card">
                    <div class="pinjaman-header">
                        <div>
                            <h4>Pinjaman Mikro 002/2025</h4>
                            <p class="pinjaman-date">Diajukan: 5 Jan 2025</p>
                        </div>
                        <span class="status-badge">Lancar</span>
                    </div>
                    
                    <div class="pinjaman-details">
                        <div class="detail-row">
                            <span>Total Pinjaman</span>
                            <strong>Rp 400,000</strong>
                        </div>
                        <div class="detail-row">
                            <span>Angsuran/Bulan</span>
                            <strong>Rp 100,000</strong>
                        </div>
                        <div class="detail-row">
                            <span>Sisa Tenor</span>
                            <strong>3 Bulan</strong>
                        </div>
                        <div class="detail-row">
                            <span>Jatuh Tempo</span>
                            <strong class="due-date">10 Feb 2025</strong>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 25%"></div>
                        </div>
                        <div class="progress-text">
                            <span>25% Selesai</span>
                            <span>1 dari 4 angsuran</span>
                        </div>
                    </div>
                    
                    <button class="btn-bayar" data-action="bayar-pinjaman-mikro">
                        <i class="fas fa-credit-card"></i>
                        Bayar Angsuran Feb 2025
                    </button>
                </div>
            </div>
        </section>

        <!-- SHU Section -->
        <section class="shu-section">
            <h2 class="section-title">Sisa Hasil Usaha (SHU)</h2>
            <div class="shu-cards">
                <div class="shu-card glass-card">
                    <div class="shu-header">
                        <h4><i class="fas fa-chart-line"></i> SHU Estimasi</h4>
                        <span class="shu-badge" id="shuStatus">Dalam Perhitungan</span>
                    </div>
                    <div class="shu-amount-container">
                        <p class="shu-amount" id="shuEstimasi">Rp 3,200,000</p>
                        <p class="shu-desc" id="shuDesc">Estimasi tahun berjalan</p>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-detail" data-action="shu-detail">
                            <i class="fas fa-calculator"></i>
                            Detail SHU
                        </button>
                        <button class="btn-detail" data-action="unduh-laporan-shu" style="background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));">
                            <i class="fas fa-download"></i>
                            Unduh Laporan
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Kartu Anggota Section -->
        <section class="kartu-section">
            <h2 class="section-title">Kartu Anggota Digital</h2>
            <div class="kartu-container">
                <div class="kartu-card glass-card">
                    <div class="kartu-header">
                        <div class="kartu-logo">
                            <i class="fas fa-handshake"></i>
                            <span>Koperasi Asmara Tani</span>
                        </div>
                        <div class="kartu-valid" id="kartuValid">2023-2026</div>
                    </div>
                    
                    <div class="kartu-body">
                        <div class="kartu-qr">
                            <div class="qr-placeholder" id="qrCode">
                                <i class="fas fa-qrcode"></i>
                                <span>KOP-2025-001</span>
                            </div>
                        </div>
                        
                        <div class="kartu-info">
                            <div class="kartu-photo">
                                <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face" alt="Photo" id="kartuPhoto">
                            </div>
                            <div class="kartu-details">
                                <h4 id="kartuNama">Budi Santoso</h4>
                                <p class="kartu-nia" id="kartuNIA">KOP-2025-001</p>
                                <p class="kartu-posisi" id="kartuPosisi">Anggota</p>
                                <p class="kartu-join" id="kartuJoin">Bergabung: 15 Jan 2023</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="kartu-footer">
                        <div class="kartu-contacts">
                            <span><i class="fas fa-phone"></i> <span id="kartuTelepon">085218483129</span></span>
                            <span><i class="fas fa-envelope"></i> koperasi@asmaratani.id</span>
                        </div>
                    </div>
                </div>
                
                <div class="kartu-actions">
                    <button class="btn-kartu primary" data-action="download-kartu">
                        <i class="fas fa-download"></i>
                        Download Kartu
                    </button>
                    <button class="btn-kartu secondary" data-action="share-kartu">
                        <i class="fas fa-share-alt"></i>
                        Bagikan
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Bottom Buttons -->
    <div class="bottom-buttons">
        <button class="back-button" id="backButton">
            <i class="fas fa-arrow-left"></i>
            <span>Kembali</span>
        </button>
        <div class="notification-bottom" id="notificationBtn">
            <i class="fas fa-bell"></i>
            <span>Notifikasi</span>
            <span class="badge" id="notificationCount">3</span>
        </div>
    </div>

    <!-- Modal Container -->
    <div id="modalContainer"></div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // ===== DASHBOARD FUNCTIONALITY =====
        class AnggotaDashboard {
            constructor() {
                this.currentUser = null;
                this.anggotaData = null;
                this.init();
            }

            async init() {
                try {
                    // Check authentication
                    await this.checkAuth();
                    
                    // Load user data
                    await this.loadUserData();
                    
                    // Initialize UI
                    this.initializeUI();
                    
                    // Setup event listeners
                    this.setupEventListeners();
                    
                    // Hide loading screen
                    this.hideLoading();
                    
                    console.log(' Tabungan Digital initialized successfully');
                } catch (error) {
                    console.error(' Error initializing dashboard:', error);
                    this.showError('Gagal memuat dashboard');
                }
            }

            async checkAuth() {
                // Check if user is logged in (simulated for demo)
                this.currentUser = {
                    name: 'Budi Santoso',
                    email: 'budi@koperasi.com',
                    role: 'Anggota',
                    access: 'anggota',
                    foto: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face',
                    telepon: '081234567890'
                };

                // In real implementation, check localStorage
                // this.currentUser = JSON.parse(localStorage.getItem('currentUser'));
                
                if (!this.currentUser) {
                    this.redirectToLogin();
                    return;
                }
            }

            async loadUserData() {
                // Create demo data
                this.anggotaData = {
                    personal: {
                        nama: 'Budi Santoso',
                        nia: 'KOP-2025-001',
                        telepon: '081234567890',
                        email: 'budi.santoso@email.com',
                        posisi: 'Anggota',
                        tanggalGabung: '15 Jan 2023',
                        status: 'Aktif',
                        password: 'password123'
                    },
                    simpanan: {
                        pokok: { nominal: 100000, status: 'lunas' },
                        wajib: { nominal: 250000, status: 'aktif', terakhirBayar: 'Jan 2025' },
                        sukarela: { nominal: 7900000, status: 'tersedia' },
                        total: 8250000
                    },
                    pinjaman: {
                        aktif: [
                            {
                                id: 'PINJ-001/2025',
                                jenis: 'Pinjaman Reguler',
                                tanggalAjuan: '10 Jan 2025',
                                total: 5000000,
                                angsuran: 500000,
                                sisaTenor: 11,
                                nextBayar: '15 Feb 2025',
                                progress: 8,
                                status: 'Lancar'
                            },
                            {
                                id: 'PINJ-002/2025',
                                jenis: 'Pinjaman Mikro',
                                tanggalAjuan: '5 Jan 2025',
                                total: 400000,
                                angsuran: 100000,
                                sisaTenor: 3,
                                nextBayar: '10 Feb 2025',
                                progress: 25,
                                status: 'Lancar'
                            }
                        ],
                        total: 5400000
                    },
                    shu: {
                        estimasi: 3200000,
                        status: 'Dalam perhitungan'
                    }
                };
            }

            initializeUI() {
                this.updateProfileSection();
                this.updateStatsOverview();
                this.updateSimpananSection();
                this.updatePinjamanSection();
                this.updateSHUSection();
                this.updateKartuAnggota();
            }

            updateProfileSection() {
                const { personal } = this.anggotaData;
                
                document.getElementById('userName').textContent = personal.nama;
                document.getElementById('userAvatar').src = this.currentUser.foto;
            }

            updateStatsOverview() {
                const { simpanan, pinjaman, shu } = this.anggotaData;
                
                document.getElementById('totalSimpanan').textContent = this.formatCurrency(simpanan.total);
                document.getElementById('totalPinjaman').textContent = this.formatCurrency(pinjaman.total);
                document.getElementById('shuAmount').textContent = this.formatCurrency(shu.estimasi);
            }

            updateSimpananSection() {
                const { simpanan } = this.anggotaData;
                
                document.getElementById('amountPokok').textContent = this.formatCurrency(simpanan.pokok.nominal);
                document.getElementById('amountWajib').textContent = this.formatCurrency(simpanan.wajib.nominal) + '/bulan';
                document.getElementById('descWajib').textContent = `Terakhir bayar: ${simpanan.wajib.terakhirBayar}`;
                document.getElementById('amountSukarela').textContent = this.formatCurrency(simpanan.sukarela.nominal);
            }

            updatePinjamanSection() {
                // Content is already in HTML for demo
            }

            updateSHUSection() {
                const { shu } = this.anggotaData;
                document.getElementById('shuEstimasi').textContent = this.formatCurrency(shu.estimasi);
            }

            updateKartuAnggota() {
                const { personal } = this.anggotaData;
                
                document.getElementById('kartuNama').textContent = personal.nama;
                document.getElementById('kartuNIA').textContent = personal.nia;
                document.getElementById('kartuPosisi').textContent = personal.posisi;
                document.getElementById('kartuJoin').textContent = `Bergabung: ${personal.tanggalGabung}`;
                document.getElementById('kartuPhoto').src = this.currentUser.foto;
                document.getElementById('kartuTelepon').textContent = '085218483129'; // WhatsApp Admin
            }

            setupEventListeners() {
                // Back button
                document.getElementById('backButton').addEventListener('click', () => {
                    this.goBack();
                });

                // Edit profile button
                document.getElementById('editProfileBtn').addEventListener('click', () => {
                    this.showEditProfileModal();
                });

                // User profile button
                document.getElementById('userProfileBtn').addEventListener('click', () => {
                    this.showProfileModal();
                });

                // Quick actions
                document.querySelectorAll('.action-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const action = e.currentTarget.getAttribute('data-action');
                        this.handleQuickAction(action);
                    });
                });

                // Simpanan buttons
                document.querySelectorAll('.btn-setor, .btn-tarik').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const action = e.currentTarget.getAttribute('data-action');
                        this.handleSimpananAction(action);
                    });
                });

                // Kartu actions
                document.querySelectorAll('.btn-kartu').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const action = e.currentTarget.getAttribute('data-action');
                        this.handleKartuAction(action);
                    });
                });

                // Pinjaman bayar button
                document.querySelectorAll('[data-action^="bayar-pinjaman"]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const action = e.currentTarget.getAttribute('data-action');
                        this.bayarPinjaman(action);
                    });
                });

                // SHU detail button
                document.querySelector('[data-action="shu-detail"]').addEventListener('click', () => {
                    this.showSHUDetail();
                });

                // SHU unduh laporan button
                document.querySelector('[data-action="unduh-laporan-shu"]').addEventListener('click', () => {
                    this.unduhLaporanSHU();
                });

                // Notification button
                document.getElementById('notificationBtn').addEventListener('click', () => {
                    this.showNotifications();
                });
            }

            handleQuickAction(action) {
                const actions = {
                    setor: () => this.showSetorModal(),
                    pinjam: () => this.showPinjamModal(),
                    riwayat: () => this.showRiwayatModal(),
                    kartu: () => this.showKartuModal()
                };

                if (actions[action]) {
                    // Add click animation
                    const card = document.querySelector(`[data-action="${action}"]`);
                    card.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        card.style.transform = '';
                    }, 150);

                    actions[action]();
                }
            }

            handleSimpananAction(action) {
                const actions = {
                    'setor-pokok': () => this.setorSimpanan('pokok'),
                    'tarik-pokok': () => this.tarikSimpanan('pokok'),
                    'setor-wajib': () => this.setorSimpanan('wajib'),
                    'tarik-wajib': () => this.tarikSimpanan('wajib'),
                    'setor-sukarela': () => this.setorSimpanan('sukarela'),
                    'tarik-sukarela': () => this.tarikSimpanan('sukarela')
                };

                if (actions[action]) {
                    actions[action]();
                }
            }

            handleKartuAction(action) {
                const actions = {
                    'download-kartu': () => this.downloadKartuPDF(),
                    'share-kartu': () => this.shareKartu()
                };

                if (actions[action]) {
                    actions[action]();
                }
            }

            // Modal Methods
            showProfileModal() {
                const { personal } = this.anggotaData;
                
                this.showModal({
                    title: 'Profil Anggota',
                    content: `
                        <div class="profile-modal-content">
                            <div class="profile-header">
                                <img src="${this.currentUser.foto}" alt="Profile" class="profile-avatar">
                                <div class="profile-info">
                                    <h3>${personal.nama}</h3>
                                    <p class="profile-nia">NIA: ${personal.nia}</p>
                                    <div class="status-container">
                                        <span class="status-badge">${personal.status}</span>
                                        <span class="role-badge">${personal.posisi}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-details">
                                <div class="detail-item">
                                    <i class="fas fa-calendar-plus"></i>
                                    <span>Bergabung: <strong>${personal.tanggalGabung}</strong></span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-building"></i>
                                    <span>Posisi: <strong>${personal.posisi}</strong></span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-phone"></i>
                                    <span>${personal.telepon}</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-envelope"></i>
                                    <span>${personal.email}</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-lock"></i>
                                    <div class="password-container">
                                        <span class="password-label">Password:</span>
                                        <span class="password-display" id="passwordDisplay">**********</span>
                                        <button class="password-toggle" id="passwordToggle">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                });

                // Setup password toggle
                document.getElementById('passwordToggle').addEventListener('click', () => {
                    this.togglePasswordVisibility();
                });
            }

            showEditProfileModal() {
                const { personal } = this.anggotaData;
                
                this.showModal({
                    title: 'Edit Profil Anggota',
                    content: `
                        <div class="profile-modal-content">
                            <form id="editProfileForm">
                                <div class="form-group">
                                    <label class="form-label" for="editNama">Nama Lengkap</label>
                                    <input type="text" class="form-control" id="editNama" value="${personal.nama}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="editNIA">NIA (Nomor Induk Anggota)</label>
                                    <input type="text" class="form-control" id="editNIA" value="${personal.nia}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="editTanggalGabung">Tanggal Bergabung</label>
                                    <input type="date" class="form-control" id="editTanggalGabung" value="2023-01-15" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="editPosisi">Posisi Sebagai</label>
                                    <select class="form-control form-select" id="editPosisi" required>
                                        <option value="Anggota" ${personal.posisi === 'Anggota' ? 'selected' : ''}>Anggota</option>
                                        <option value="Pengurus" ${personal.posisi === 'Pengurus' ? 'selected' : ''}>Pengurus</option>
                                        <option value="Ketua" ${personal.posisi === 'Ketua' ? 'selected' : ''}>Ketua</option>
                                        <option value="Sekretaris" ${personal.posisi === 'Sekretaris' ? 'selected' : ''}>Sekretaris</option>
                                        <option value="Bendahara" ${personal.posisi === 'Bendahara' ? 'selected' : ''}>Bendahara</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="editTelepon">No WhatsApp</label>
                                    <input type="tel" class="form-control" id="editTelepon" value="${personal.telepon}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="editEmail">Alamat Email</label>
                                    <input type="email" class="form-control" id="editEmail" value="${personal.email}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Upload Foto Anda</label>
                                    <div class="file-upload-container">
                                        <label class="file-upload-label" for="uploadFoto">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <span>Klik untuk upload foto</span>
                                        </label>
                                        <input type="file" class="file-upload-input" id="uploadFoto" accept="image/*">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="editPassword">Password</label>
                                    <div class="password-input-container">
                                        <input type="password" class="form-control password-input" id="editPassword" value="${personal.password}" required>
                                        <button type="button" class="password-eye" id="editPasswordEye">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <button type="button" class="password-toggle" id="changePasswordBtn" style="margin-top: 8px;">
                                        <i class="fas fa-key"></i> Ganti Password
                                    </button>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="dashboard.closeModal()">Batal</button>
                                    <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                                </div>
                            </form>
                        </div>
                    `
                });

                // Setup form submission
                document.getElementById('editProfileForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveProfileChanges();
                });

                // Setup password eye toggle
                document.getElementById('editPasswordEye').addEventListener('click', () => {
                    this.togglePasswordInput('editPassword', 'editPasswordEye');
                });

                // Setup change password button
                document.getElementById('changePasswordBtn').addEventListener('click', () => {
                    this.showChangePasswordModal();
                });

                // Setup file upload preview
                document.getElementById('uploadFoto').addEventListener('change', (e) => {
                    this.previewImage(e.target.files[0]);
                });
            }

            previewImage(file) {
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // Update avatar preview
                        document.getElementById('userAvatar').src = e.target.result;
                        document.getElementById('kartuPhoto').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }

            showChangePasswordModal() {
                this.showModal({
                    title: 'Ganti Password',
                    content: `
                        <div class="profile-modal-content">
                            <form id="changePasswordForm">
                                <div class="form-group">
                                    <label class="form-label" for="currentPassword">Password Saat Ini</label>
                                    <div class="password-input-container">
                                        <input type="password" class="form-control password-input" id="currentPassword" required>
                                        <button type="button" class="password-eye" id="currentPasswordEye">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="newPassword">Password Baru</label>
                                    <div class="password-input-container">
                                        <input type="password" class="form-control password-input" id="newPassword" required>
                                        <button type="button" class="password-eye" id="newPasswordEye">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="confirmPassword">Konfirmasi Password Baru</label>
                                    <div class="password-input-container">
                                        <input type="password" class="form-control password-input" id="confirmPassword" required>
                                        <button type="button" class="password-eye" id="confirmPasswordEye">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="dashboard.closeModal()">Batal</button>
                                    <button type="submit" class="btn btn-primary">Ganti Password</button>
                                </div>
                            </form>
                        </div>
                    `
                });

                // Setup form submission
                document.getElementById('changePasswordForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.changePassword();
                });

                // Setup password eye toggles
                document.getElementById('currentPasswordEye').addEventListener('click', () => {
                    this.togglePasswordInput('currentPassword', 'currentPasswordEye');
                });

                document.getElementById('newPasswordEye').addEventListener('click', () => {
                    this.togglePasswordInput('newPassword', 'newPasswordEye');
                });

                document.getElementById('confirmPasswordEye').addEventListener('click', () => {
                    this.togglePasswordInput('confirmPassword', 'confirmPasswordEye');
                });
            }

            togglePasswordVisibility() {
                const passwordDisplay = document.getElementById('passwordDisplay');
                const passwordToggle = document.getElementById('passwordToggle');
                
                if (passwordDisplay.textContent === '**********') {
                    passwordDisplay.textContent = this.anggotaData.personal.password;
                    passwordToggle.innerHTML = '<i class="fas fa-eye-slash"></i>';
                } else {
                    passwordDisplay.textContent = '**********';
                    passwordToggle.innerHTML = '<i class="fas fa-eye"></i>';
                }
            }

            togglePasswordInput(inputId, eyeId) {
                const passwordInput = document.getElementById(inputId);
                const passwordEye = document.getElementById(eyeId);
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    passwordEye.innerHTML = '<i class="fas fa-eye-slash"></i>';
                } else {
                    passwordInput.type = 'password';
                    passwordEye.innerHTML = '<i class="fas fa-eye"></i>';
                }
            }

            showSetorModal() {
                this.showModal({
                    title: 'Setor Simpanan',
                    content: `
                        <div class="modal-content">
                            <p>Pilih jenis simpanan:</p>
                            <div class="modal-options">
                                <div class="modal-option" onclick="dashboard.setorSimpanan('pokok')">
                                    <i class="fas fa-key"></i>
                                    <div>
                                        <strong>Simpanan Pokok</strong>
                                        <small>Rp 100,000 (sekali bayar)</small>
                                    </div>
                                </div>
                                <div class="modal-option" onclick="dashboard.setorSimpanan('wajib')">
                                    <i class="fas fa-calendar-alt"></i>
                                    <div>
                                        <strong>Simpanan Wajib</strong>
                                        <small>Rp 250,000/bulan</small>
                                    </div>
                                </div>
                                <div class="modal-option" onclick="dashboard.setorSimpanan('sukarela')">
                                    <i class="fas fa-star"></i>
                                    <div>
                                        <strong>Simpanan Sukarela</strong>
                                        <small>Jumlah bebas</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                });
            }

            showPinjamModal() {
                this.showModal({
                    title: 'Ajukan Pinjaman',
                    content: `
                        <div class="modal-content">
                            <p>Silakan pilih jenis pinjaman:</p>
                            <div class="modal-options">
                                <div class="modal-option" onclick="dashboard.ajukanPinjaman('reguler')">
                                    <i class="fas fa-home"></i>
                                    <div>
                                        <strong>Pinjaman Reguler</strong>
                                        <small>Rp 1-10 juta, 12 bulan</small>
                                    </div>
                                </div>
                                <div class="modal-option" onclick="dashboard.ajukanPinjaman('mikro')">
                                    <i class="fas fa-briefcase"></i>
                                    <div>
                                        <strong>Pinjaman Mikro</strong>
                                        <small>Rp 100-500 ribu, 3-6 bulan</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                });
            }

            showRiwayatModal() {
                this.showModal({
                    title: 'Riwayat Transaksi',
                    content: `
                        <div class="modal-content">
                            <div class="riwayat-detail">
                                <h4 style="margin-bottom: var(--space-md); color: #1a5f23;">Riwayat Transaksi Terbaru</h4>
                                <div style="max-height: 300px; overflow-y: auto;">
                                    <div class="detail-item" style="margin-bottom: var(--space-sm);">
                                        <i class="fas fa-arrow-down" style="color: var(--success);"></i>
                                        <div style="flex: 1;">
                                            <strong>Setor Simpanan Sukarela</strong>
                                            <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                                <span>15 Jan 2025</span>
                                                <span style="color: var(--success); font-weight: 600;">+ Rp 500,000</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="detail-item" style="margin-bottom: var(--space-sm);">
                                        <i class="fas fa-arrow-up" style="color: var(--danger);"></i>
                                        <div style="flex: 1;">
                                            <strong>Bayar Angsuran Pinjaman</strong>
                                            <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                                <span>10 Jan 2025</span>
                                                <span style="color: var(--danger); font-weight: 600;">- Rp 500,000</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="detail-item" style="margin-bottom: var(--space-sm);">
                                        <i class="fas fa-arrow-down" style="color: var(--success);"></i>
                                        <div style="flex: 1;">
                                            <strong>Setor Simpanan Wajib</strong>
                                            <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                                <span>5 Jan 2025</span>
                                                <span style="color: var(--success); font-weight: 600;">+ Rp 250,000</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="detail-item" style="margin-bottom: var(--space-sm);">
                                        <i class="fas fa-arrow-down" style="color: var(--success);"></i>
                                        <div style="flex: 1;">
                                            <strong>Setor Simpanan Sukarela</strong>
                                            <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                                <span>28 Des 2024</span>
                                                <span style="color: var(--success); font-weight: 600;">+ Rp 1,000,000</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="detail-item" style="margin-bottom: var(--space-sm);">
                                        <i class="fas fa-arrow-up" style="color: var(--danger);"></i>
                                        <div style="flex: 1;">
                                            <strong>Tarik Simpanan Sukarela</strong>
                                            <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                                <span>20 Des 2024</span>
                                                <span style="color: var(--danger); font-weight: 600;">- Rp 750,000</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align: center; margin-top: var(--space-md);">
                                    <button class="btn btn-primary" onclick="dashboard.downloadRiwayatPDF()">
                                        <i class="fas fa-download"></i> Unduh Laporan Lengkap (PDF)
                                    </button>
                                </div>
                            </div>
                        </div>
                    `
                });
            }

            showKartuModal() {
                this.showModal({
                    title: 'Kartu Anggota Digital',
                    content: `
                        <div class="modal-content">
                            <div style="text-align: center;">
                                <div class="kartu-modal" style="background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%); border: 2px solid var(--primary); border-radius: 12px; padding: var(--space-md); margin: var(--space-md) 0;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
                                        <strong style="color: var(--primary);">Koperasi Asmara Tani</strong>
                                        <span style="font-size: 0.8rem; color: #1a5f23;">2023-2026</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: var(--space-md);">
                                        <div style="width: 80px; height: 80px; background: rgba(26,95,35,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #1a5f23;">
                                            <i class="fas fa-qrcode" style="font-size: 2rem;"></i>
                                        </div>
                                        <div>
                                            <h4 style="margin-bottom: 4px; color: #1a5f23;">${this.anggotaData.personal.nama}</h4>
                                            <p style="color: var(--primary); font-weight: 600; margin-bottom: 2px;">${this.anggotaData.personal.nia}</p>
                                            <small style="color: #1a5f23;">${this.anggotaData.personal.posisi}</small>
                                        </div>
                                    </div>
                                </div>
                                <p style="color: #1a5f23; margin-top: 1rem;">
                                    Tunjukkan QR code ini untuk transaksi di unit usaha koperasi
                                </p>
                            </div>
                        </div>
                    `
                });
            }

            showSHUDetail() {
                this.showModal({
                    title: 'Detail SHU',
                    content: `
                        <div class="modal-content">
                            <div class="shu-detail">
                                <h4 style="margin-bottom: var(--space-md); color: #1a5f23;">Perhitungan SHU 2025</h4>
                                <div style="background: rgba(26,95,35,0.05); padding: var(--space-md); border-radius: 8px; margin-bottom: var(--space-md);">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-sm); color: #1a5f23;">
                                        <span>Partisipasi Usaha</span>
                                        <strong>60%</strong>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-sm); color: #1a5f23;">
                                        <span>Simpanan</span>
                                        <strong>40%</strong>
                                    </div>
                                </div>
                                <div style="text-align: center; padding: var(--space-md); background: rgba(76,175,80,0.1); border-radius: 8px;">
                                    <span style="display: block; margin-bottom: 4px; color: #1a5f23;">Estimasi SHU Anda:</span>
                                    <strong style="font-size: 1.4rem; color: var(--primary);">${this.formatCurrency(this.anggotaData.shu.estimasi)}</strong>
                                </div>
                            </div>
                        </div>
                    `
                });
            }

            showModal({ title, content }) {
                const modalHTML = `
                    <div class="modal-backdrop" onclick="dashboard.closeModal()">
                        <div class="modal-container" onclick="event.stopPropagation()">
                            <div class="modal-header">
                                <h3>${title}</h3>
                                <button class="modal-close" onclick="dashboard.closeModal()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                ${content}
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('modalContainer').innerHTML = modalHTML;
            }

            closeModal() {
                document.getElementById('modalContainer').innerHTML = '';
            }

            // Action Methods
            setorSimpanan(jenis) {
                this.closeModal();
                
                if (jenis === 'pokok') {
                    this.showSetorPokokForm();
                } else if (jenis === 'wajib') {
                    this.showSetorWajibForm();
                } else if (jenis === 'sukarela') {
                    this.showSetorSukarelaForm();
                }
            }

            tarikSimpanan(jenis) {
                if (jenis === 'pokok') {
                    this.showTarikPokokForm();
                } else if (jenis === 'wajib') {
                    this.showTarikWajibForm();
                } else if (jenis === 'sukarela') {
                    this.showTarikSukarelaForm();
                }
            }

            showSetorPokokForm() {
                this.showModal({
                    title: 'Setor Simpanan Pokok',
                    content: `
                        <div class="modal-content">
                            <form id="setorPokokForm">
                                <div class="form-group">
                                    <label class="form-label">Jumlah Setoran</label>
                                    <input type="text" class="form-control" value="Rp 100,000" readonly>
                                    <small style="color: #1a5f23; display: block; margin-top: 4px;">Simpanan pokok dibayar sekali saat pendaftaran</small>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="metodeBayarPokok">Metode Pembayaran</label>
                                    <select class="form-control form-select" id="metodeBayarPokok" required>
                                        <option value="">Pilih metode pembayaran</option>
                                        <option value="transfer">Transfer Bank</option>
                                        <option value="tunai">Tunai di Kantor</option>
                                        <option value="ewallet">E-Wallet</option>
                                    </select>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="dashboard.closeModal()">Batal</button>
                                    <button type="submit" class="btn btn-primary">Konfirmasi Setoran via WhatsApp</button>
                                </div>
                            </form>
                        </div>
                    `
                });

                document.getElementById('setorPokokForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.konfirmasiSetoranWhatsApp('pokok', 100000);
                });
            }

            showTarikPokokForm() {
                this.showModal({
                    title: 'Tarik Simpanan Pokok',
                    content: `
                        <div class="modal-content">
                            <div style="text-align: center; padding: var(--space-md);">
                                <i class="fas fa-info-circle" style="font-size: 3rem; color: var(--warning); margin-bottom: var(--space-md);"></i>
                                <h3 style="color: #1a5f23; margin-bottom: var(--space-sm);">Tidak Dapat Ditarik</h3>
                                <p style="color: #1a5f23;">Simpanan pokok tidak dapat ditarik karena merupakan syarat keanggotaan</p>
                            </div>
                        </div>
                    `
                });
            }

            showSetorWajibForm() {
                this.showModal({
                    title: 'Setor Simpanan Wajib',
                    content: `
                        <div class="modal-content">
                            <form id="setorWajibForm">
                                <div class="form-group">
                                    <label class="form-label">Jumlah Setoran</label>
                                    <input type="text" class="form-control" value="Rp 250,000" readonly>
                                    <small style="color: #1a5f23; display: block; margin-top: 4px;">Simpanan wajib bulanan</small>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="bulanWajib">Untuk Bulan</label>
                                    <select class="form-control form-select" id="bulanWajib" required>
                                        <option value="2025-02">Februari 2025</option>
                                        <option value="2025-03">Maret 2025</option>
                                        <option value="2025-04">April 2025</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="metodeBayarWajib">Metode Pembayaran</label>
                                    <select class="form-control form-select" id="metodeBayarWajib" required>
                                        <option value="">Pilih metode pembayaran</option>
                                        <option value="transfer">Transfer Bank</option>
                                        <option value="tunai">Tunai di Kantor</option>
                                        <option value="ewallet">E-Wallet</option>
                                    </select>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="dashboard.closeModal()">Batal</button>
                                    <button type="submit" class="btn btn-primary">Konfirmasi Setoran via WhatsApp</button>
                                </div>
                            </form>
                        </div>
                    `
                });

                document.getElementById('setorWajibForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.konfirmasiSetoranWhatsApp('wajib', 250000);
                });
            }

            showTarikWajibForm() {
                this.showModal({
                    title: 'Tarik Simpanan Wajib',
                    content: `
                        <div class="modal-content">
                            <div style="text-align: center; padding: var(--space-md);">
                                <i class="fas fa-info-circle" style="font-size: 3rem; color: var(--warning); margin-bottom: var(--space-md);"></i>
                                <h3 style="color: #1a5f23; margin-bottom: var(--space-sm);">Tidak Dapat Ditarik</h3>
                                <p style="color: #1a5f23;">Simpanan wajib tidak dapat ditarik karena merupakan kewajiban bulanan anggota</p>
                            </div>
                        </div>
                    `
                });
            }

            showSetorSukarelaForm() {
                this.showModal({
                    title: 'Setor Simpanan Sukarela',
                    content: `
                        <div class="modal-content">
                            <form id="setorSukarelaForm">
                                <div class="form-group">
                                    <label class="form-label" for="jumlahSukarela">Jumlah Setoran</label>
                                    <input type="number" class="form-control" id="jumlahSukarela" min="50000" step="50000" placeholder="Masukkan jumlah setoran" required>
                                    <small style="color: #1a5f23; display: block; margin-top: 4px;">Minimum setoran Rp 50,000</small>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="metodeBayarSukarela">Metode Pembayaran</label>
                                    <select class="form-control form-select" id="metodeBayarSukarela" required>
                                        <option value="">Pilih metode pembayaran</option>
                                        <option value="transfer">Transfer Bank</option>
                                        <option value="tunai">Tunai di Kantor</option>
                                        <option value="ewallet">E-Wallet</option>
                                    </select>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="dashboard.closeModal()">Batal</button>
                                    <button type="submit" class="btn btn-primary">Konfirmasi Setoran via WhatsApp</button>
                                </div>
                            </form>
                        </div>
                    `
                });

                document.getElementById('setorSukarelaForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const jumlah = document.getElementById('jumlahSukarela').value;
                    this.konfirmasiSetoranWhatsApp('sukarela', jumlah);
                });
            }

            showTarikSukarelaForm() {
                this.showModal({
                    title: 'Tarik Simpanan Sukarela',
                    content: `
                        <div class="modal-content">
                            <form id="tarikSukarelaForm">
                                <div class="form-group">
                                    <label class="form-label" for="jumlahTarik">Jumlah Penarikan</label>
                                    <input type="number" class="form-control" id="jumlahTarik" min="50000" step="50000" placeholder="Masukkan jumlah penarikan" required>
                                    <small style="color: #1a5f23; display: block; margin-top: 4px;">Saldo tersedia: Rp 7,900,000</small>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="alasanTarik">Alasan Penarikan</label>
                                    <textarea class="form-control" id="alasanTarik" rows="3" placeholder="Jelaskan alasan penarikan" required></textarea>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="dashboard.closeModal()">Batal</button>
                                    <button type="submit" class="btn btn-primary">Ajukan Penarikan ke WhatsApp</button>
                                </div>
                            </form>
                        </div>
                    `
                });

                document.getElementById('tarikSukarelaForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.ajukanPenarikanWhatsApp();
                });
            }

            konfirmasiSetoranWhatsApp(jenis, jumlah) {
                const metodeBayar = document.getElementById(`metodeBayar${jenis.charAt(0).toUpperCase() + jenis.slice(1)}`).value;
                const bulan = jenis === 'wajib' ? document.getElementById('bulanWajib').value : '';
                
                // Format message for WhatsApp
                let message = `Halo Admin Koperasi,\n\nSaya ${this.anggotaData.personal.nama} (NIA: ${this.anggotaData.personal.nia}) ingin mengkonfirmasi setoran simpanan ${jenis} dengan detail berikut:\n\n- Jenis: Simpanan ${jenis}\n- Jumlah: Rp ${this.formatNumber(jumlah)}`;
                
                if (bulan) {
                    message += `\n- Untuk Bulan: ${bulan}`;
                }
                
                message += `\n- Metode Bayar: ${metodeBayar}\n\nTerima kasih.`;
                
                // Encode message for URL
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/6285218483129?text=${encodedMessage}`;
                
                // Open WhatsApp
                window.open(whatsappUrl, '_blank');
                
                // Save to database
                this.saveTransaksi({
                    jenis: 'setor',
                    simpanan: jenis,
                    jumlah: parseInt(jumlah),
                    metodeBayar: metodeBayar,
                    bulan: bulan,
                    tanggal: new Date().toISOString(),
                    status: 'pending'
                });
                
                this.closeModal();
                this.showToast('Membuka WhatsApp untuk konfirmasi setoran...', 'info');
            }

            ajukanPinjaman(jenis) {
                this.closeModal();
                
                if (jenis === 'reguler') {
                    this.showPinjamanRegulerForm();
                } else if (jenis === 'mikro') {
                    this.showPinjamanMikroForm();
                }
            }

            showPinjamanRegulerForm() {
                this.showModal({
                    title: 'Ajukan Pinjaman Reguler',
                    content: `
                        <div class="modal-content">
                            <form id="pinjamanRegulerForm">
                                <div class="form-group">
                                    <label class="form-label" for="jumlahPinjamanReguler">Jumlah Pinjaman</label>
                                    <input type="number" class="form-control" id="jumlahPinjamanReguler" min="1000000" max="10000000" step="500000" placeholder="Masukkan jumlah pinjaman" required>
                                    <small style="color: #1a5f23; display: block; margin-top: 4px;">Maksimal pinjaman Rp 10,000,000</small>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="tenorReguler">Tenor (Bulan)</label>
                                    <select class="form-control form-select" id="tenorReguler" required>
                                        <option value="6">6 Bulan</option>
                                        <option value="12" selected>12 Bulan</option>
                                        <option value="18">18 Bulan</option>
                                        <option value="24">24 Bulan</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="tujuanReguler">Tujuan Pinjaman</label>
                                    <textarea class="form-control" id="tujuanReguler" rows="3" placeholder="Jelaskan tujuan penggunaan pinjaman" required></textarea>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="dashboard.closeModal()">Batal</button>
                                    <button type="submit" class="btn btn-primary">Ajukan Pinjaman via WhatsApp</button>
                                </div>
                            </form>
                        </div>
                    `
                });

                document.getElementById('pinjamanRegulerForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.ajukanPinjamanWhatsApp('reguler');
                });
            }

            showPinjamanMikroForm() {
                this.showModal({
                    title: 'Ajukan Pinjaman Mikro',
                    content: `
                        <div class="modal-content">
                            <form id="pinjamanMikroForm">
                                <div class="form-group">
                                    <label class="form-label" for="jumlahPinjamanMikro">Jumlah Pinjaman</label>
                                    <input type="number" class="form-control" id="jumlahPinjamanMikro" min="100000" max="500000" step="50000" placeholder="Masukkan jumlah pinjaman" required>
                                    <small style="color: #1a5f23; display: block; margin-top: 4px;">Maksimal pinjaman Rp 500,000</small>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="tenorMikro">Tenor (Bulan)</label>
                                    <select class="form-control form-select" id="tenorMikro" required>
                                        <option value="3">3 Bulan</option>
                                        <option value="6" selected>6 Bulan</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="tujuanMikro">Tujuan Pinjaman</label>
                                    <textarea class="form-control" id="tujuanMikro" rows="3" placeholder="Jelaskan tujuan penggunaan pinjaman" required></textarea>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="dashboard.closeModal()">Batal</button>
                                    <button type="submit" class="btn btn-primary">Ajukan Pinjaman via WhatsApp</button>
                                </div>
                            </form>
                        </div>
                    `
                });

                document.getElementById('pinjamanMikroForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.ajukanPinjamanWhatsApp('mikro');
                });
            }

            ajukanPinjamanWhatsApp(jenis) {
                const jumlah = document.getElementById(`jumlahPinjaman${jenis.charAt(0).toUpperCase() + jenis.slice(1)}`).value;
                const tenor = document.getElementById(`tenor${jenis.charAt(0).toUpperCase() + jenis.slice(1)}`).value;
                const tujuan = document.getElementById(`tujuan${jenis.charAt(0).toUpperCase() + jenis.slice(1)}`).value;
                
                // Format message for WhatsApp
                const message = `Halo Admin Koperasi,\n\nSaya ${this.anggotaData.personal.nama} (NIA: ${this.anggotaData.personal.nia}) ingin mengajukan pinjaman ${jenis} dengan detail berikut:\n\n- Jenis: Pinjaman ${jenis}\n- Jumlah: Rp ${this.formatNumber(jumlah)}\n- Tenor: ${tenor} bulan\n- Tujuan: ${tujuan}\n\nTerima kasih.`;
                
                // Encode message for URL
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/6285218483129?text=${encodedMessage}`;
                
                // Open WhatsApp
                window.open(whatsappUrl, '_blank');
                
                // Save to database
                this.savePinjaman({
                    jenis: jenis,
                    jumlah: parseInt(jumlah),
                    tenor: parseInt(tenor),
                    tujuan: tujuan,
                    tanggalAjuan: new Date().toISOString(),
                    status: 'pending'
                });
                
                this.closeModal();
                this.showToast('Membuka WhatsApp untuk pengajuan pinjaman...', 'info');
            }

            bayarPinjaman(action) {
                const jenisPinjaman = action.includes('mikro') ? 'Mikro' : 'Reguler';
                
                this.showModal({
                    title: `Bayar Angsuran Pinjaman ${jenisPinjaman}`,
                    content: `
                        <div class="modal-content">
                            <form id="bayarPinjamanForm">
                                <div class="form-group">
                                    <label class="form-label">Pinjaman</label>
                                    <input type="text" class="form-control" value="Pinjaman ${jenisPinjaman} ${action.includes('mikro') ? '002/2025' : '001/2025'}" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Angsuran ke</label>
                                    <input type="text" class="form-control" value="${action.includes('mikro') ? '2 dari 4' : '2 dari 12'}" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Jumlah Bayar (Rp.)</label>
                                    <input type="number" class="form-control" id="jumlahBayar" value="${action.includes('mikro') ? '100000' : '500000'}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="metodeBayarPinjaman">Metode Pembayaran</label>
                                    <select class="form-control form-select" id="metodeBayarPinjaman" required>
                                        <option value="">Pilih metode pembayaran</option>
                                        <option value="transfer">Transfer Bank</option>
                                        <option value="tunai">Tunai di Kantor</option>
                                        <option value="ewallet">E-Wallet</option>
                                        <option value="potong-gaji">Potong Gaji</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="tanggalBayar">Tanggal Pembayaran</label>
                                    <input type="date" class="form-control" id="tanggalBayar" required>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="dashboard.closeModal()">Batal</button>
                                    <button type="submit" class="btn btn-primary">Konfirmasi Pembayaran via WhatsApp</button>
                                </div>
                            </form>
                        </div>
                    `
                });

                // Set default date to today
                document.getElementById('tanggalBayar').valueAsDate = new Date();

                document.getElementById('bayarPinjamanForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.konfirmasiPembayaranWhatsApp(jenisPinjaman);
                });
            }

            konfirmasiPembayaranWhatsApp(jenisPinjaman) {
                const jumlahBayar = document.getElementById('jumlahBayar').value;
                const metodeBayar = document.getElementById('metodeBayarPinjaman').value;
                const tanggalBayar = document.getElementById('tanggalBayar').value;
                const pinjamanId = jenisPinjaman === 'Mikro' ? '002/2025' : '001/2025';
                
                // Format message for WhatsApp
                const message = `Halo Admin Koperasi,\n\nSaya ${this.anggotaData.personal.nama} (NIA: ${this.anggotaData.personal.nia}) ingin mengkonfirmasi pembayaran angsuran pinjaman dengan detail berikut:\n\n- Pinjaman: ${jenisPinjaman} ${pinjamanId}\n- Jumlah Bayar: Rp ${this.formatNumber(jumlahBayar)}\n- Metode Bayar: ${metodeBayar}\n- Tanggal Bayar: ${tanggalBayar}\n\nTerima kasih.`;
                
                // Encode message for URL
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/6285218483129?text=${encodedMessage}`;
                
                // Open WhatsApp
                window.open(whatsappUrl, '_blank');
                
                // Save to database
                this.saveTransaksi({
                    jenis: 'bayar_pinjaman',
                    pinjaman: `${jenisPinjaman} ${pinjamanId}`,
                    jumlah: parseInt(jumlahBayar),
                    metodeBayar: metodeBayar,
                    tanggal: tanggalBayar,
                    status: 'pending'
                });
                
                this.closeModal();
                this.showToast('Membuka WhatsApp untuk konfirmasi pembayaran...', 'info');
            }

            ajukanPenarikanWhatsApp() {
                const jumlah = document.getElementById('jumlahTarik').value;
                const alasan = document.getElementById('alasanTarik').value;
                
                // Format message for WhatsApp
                const message = `Halo Admin Koperasi,\n\nSaya ${this.anggotaData.personal.nama} (NIA: ${this.anggotaData.personal.nia}) ingin mengajukan penarikan simpanan sukarela dengan detail berikut:\n\n- Jumlah: Rp ${this.formatNumber(jumlah)}\n- Alasan: ${alasan}\n\nTerima kasih.`;
                
                // Encode message for URL
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/6285218483129?text=${encodedMessage}`;
                
                // Open WhatsApp
                window.open(whatsappUrl, '_blank');
                
                // Save to database
                this.saveTransaksi({
                    jenis: 'tarik',
                    simpanan: 'sukarela',
                    jumlah: parseInt(jumlah),
                    alasan: alasan,
                    tanggal: new Date().toISOString(),
                    status: 'pending'
                });
                
                this.closeModal();
                this.showToast('Membuka WhatsApp untuk mengirim pengajuan penarikan...', 'info');
            }

            downloadKartuPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add content to PDF
                doc.setFontSize(20);
                doc.setTextColor(26, 95, 35);
                doc.text('KARTU ANGGOTA DIGITAL', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text('Koperasi Asmara Tani', 105, 30, { align: 'center' });
                
                // Add member photo (placeholder)
                doc.rect(20, 40, 40, 50);
                doc.text('[Foto Anggota]', 40, 65, { align: 'center' });
                
                // Add member details
                doc.text(`Nama: ${this.anggotaData.personal.nama}`, 70, 45);
                doc.text(`NIA: ${this.anggotaData.personal.nia}`, 70, 55);
                doc.text(`Posisi: ${this.anggotaData.personal.posisi}`, 70, 65);
                doc.text(`Bergabung: ${this.anggotaData.personal.tanggalGabung}`, 70, 75);
                doc.text(`Telepon: ${this.anggotaData.personal.telepon}`, 70, 85);
                
                // Add QR code placeholder
                doc.rect(130, 40, 50, 50);
                doc.text('QR Code', 155, 65, { align: 'center' });
                
                // Add validity
                doc.text('Masa Berlaku: 2023-2026', 105, 100, { align: 'center' });
                
                // Save the PDF
                doc.save(`kartu-anggota-${this.anggotaData.personal.nia}.pdf`);
                
                this.showToast('Kartu anggota berhasil diunduh!', 'success');
            }

            shareKartu() {
                this.showToast('Membuka opsi berbagi...', 'info');
                setTimeout(() => {
                    this.showModal({
                        title: 'Bagikan Kartu Anggota',
                        content: `
                            <div class="modal-content">
                                <p>Pilih platform untuk berbagi:</p>
                                <div class="modal-options">
                                    <div class="modal-option" onclick="dashboard.shareViaWhatsApp()">
                                        <i class="fab fa-whatsapp" style="color: #25D366;"></i>
                                        <div>
                                            <strong>WhatsApp</strong>
                                            <small>Bagikan ke kontak WhatsApp</small>
                                        </div>
                                    </div>
                                    <div class="modal-option" onclick="dashboard.shareViaEmail()">
                                        <i class="fas fa-envelope" style="color: #EA4335;"></i>
                                        <div>
                                            <strong>Email</strong>
                                            <small>Kirim melalui email</small>
                                        </div>
                                    </div>
                                    <div class="modal-option" onclick="dashboard.shareViaOther()">
                                        <i class="fas fa-share-alt" style="color: var(--accent-blue);"></i>
                                        <div>
                                            <strong>Lainnya</strong>
                                            <small>Platform lainnya</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    });
                }, 1000);
            }

            shareViaWhatsApp() {
                const message = `Halo, ini kartu anggota saya di Koperasi Asmara Tani:\n\n- Nama: ${this.anggotaData.personal.nama}\n- NIA: ${this.anggotaData.personal.nia}\n- Posisi: ${this.anggotaData.personal.posisi}\n\nTerima kasih.`;
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
                
                window.open(whatsappUrl, '_blank');
                this.closeModal();
                this.showToast('Membuka WhatsApp...', 'info');
            }

            shareViaEmail() {
                this.closeModal();
                this.showToast('Membuka aplikasi email...', 'info');
            }

            shareViaOther() {
                this.closeModal();
                this.showToast('Membuka opsi berbagi lainnya...', 'info');
            }

            showNotifications() {
                this.showModal({
                    title: 'Notifikasi',
                    content: `
                        <div class="modal-content">
                            <div class="notifikasi-list">
                                <div class="modal-option">
                                    <i class="fas fa-bell" style="color: var(--secondary);"></i>
                                    <div>
                                        <strong>Pengingat Setoran Wajib</strong>
                                        <small>Jangan lupa setor simpanan wajib untuk bulan Februari 2025</small>
                                    </div>
                                </div>
                                <div class="modal-option">
                                    <i class="fas fa-info-circle" style="color: var(--accent-blue);"></i>
                                    <div>
                                        <strong>Rapat Anggota Tahunan</strong>
                                        <small>Rapat akan dilaksanakan pada 15 Maret 2025</small>
                                    </div>
                                </div>
                                <div class="modal-option">
                                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                                    <div>
                                        <strong>Pembayaran Berhasil</strong>
                                        <small>Pembayaran angsuran Januari 2025 telah berhasil</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                });
            }

            saveProfileChanges() {
                // Get form data
                const formData = {
                    nama: document.getElementById('editNama').value,
                    nia: document.getElementById('editNIA').value,
                    tanggalGabung: document.getElementById('editTanggalGabung').value,
                    posisi: document.getElementById('editPosisi').value,
                    telepon: document.getElementById('editTelepon').value,
                    email: document.getElementById('editEmail').value,
                    password: document.getElementById('editPassword').value
                };
                
                // Update local data
                this.anggotaData.personal = { ...this.anggotaData.personal, ...formData };
                
                // Save to database
                this.saveToDatabase('anggota', {
                    ...formData,
                    id: this.anggotaData.personal.nia,
                    timestamp: new Date().toISOString()
                });
                
                // Update UI
                this.updateProfileSection();
                this.updateKartuAnggota();
                
                this.closeModal();
                this.showToast('Perubahan profil berhasil disimpan!', 'success');
            }

            changePassword() {
                this.closeModal();
                this.showToast('Password berhasil diubah!', 'success');
            }

            downloadRiwayatPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add content to PDF
                doc.setFontSize(20);
                doc.setTextColor(26, 95, 35);
                doc.text('LAPORAN RIWAYAT TRANSAKSI', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text(`Nama: ${this.anggotaData.personal.nama}`, 20, 40);
                doc.text(`NIA: ${this.anggotaData.personal.nia}`, 20, 50);
                doc.text(`Periode: Jan 2024 - Jan 2025`, 20, 60);
                
                // Add table header
                doc.text('Tanggal', 20, 80);
                doc.text('Jenis', 60, 80);
                doc.text('Keterangan', 100, 80);
                doc.text('Jumlah', 160, 80);
                
                // Add sample data
                const transactions = [
                    { tanggal: '15 Jan 2025', jenis: 'Setor', keterangan: 'Simpanan Sukarela', jumlah: '500.000' },
                    { tanggal: '10 Jan 2025', jenis: 'Bayar', keterangan: 'Angsuran Pinjaman', jumlah: '500.000' },
                    { tanggal: '5 Jan 2025', jenis: 'Setor', keterangan: 'Simpanan Wajib', jumlah: '250.000' },
                    { tanggal: '28 Des 2024', jenis: 'Setor', keterangan: 'Simpanan Sukarela', jumlah: '1.000.000' },
                    { tanggal: '20 Des 2024', jenis: 'Tarik', keterangan: 'Simpanan Sukarela', jumlah: '750.000' }
                ];
                
                let yPosition = 90;
                transactions.forEach(trans => {
                    doc.text(trans.tanggal, 20, yPosition);
                    doc.text(trans.jenis, 60, yPosition);
                    doc.text(trans.keterangan, 100, yPosition);
                    doc.text(`Rp ${trans.jumlah}`, 160, yPosition);
                    yPosition += 10;
                });
                
                // Save the PDF
                doc.save(`riwayat-transaksi-${this.anggotaData.personal.nia}.pdf`);
                
                this.showToast('Laporan riwayat transaksi berhasil diunduh!', 'success');
            }

            unduhLaporanSHU() {
                const { jsPDF } = window.jsPDF;
                const doc = new jsPDF();
                
                // Add content to PDF
                doc.setFontSize(20);
                doc.setTextColor(26, 95, 35);
                doc.text('LAPORAN SISA HASIL USAHA (SHU)', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text(`Nama: ${this.anggotaData.personal.nama}`, 20, 40);
                doc.text(`NIA: ${this.anggotaData.personal.nia}`, 20, 50);
                doc.text(`Tahun: 2025`, 20, 60);
                
                // Add SHU details
                doc.text('Estimasi SHU Anda:', 20, 80);
                doc.setFontSize(16);
                doc.setTextColor(26, 95, 35);
                doc.text(this.formatCurrency(this.anggotaData.shu.estimasi), 20, 90);
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text('Perhitungan SHU:', 20, 110);
                doc.text('- Partisipasi Usaha: 60%', 30, 120);
                doc.text('- Simpanan: 40%', 30, 130);
                
                doc.text('Status: Dalam Perhitungan', 20, 150);
                doc.text('Periode: Jan 2025 - Des 2025', 20, 160);
                
                // Save the PDF
                doc.save(`laporan-shu-${this.anggotaData.personal.nia}.pdf`);
                
                this.showToast('Laporan SHU berhasil diunduh!', 'success');
            }

            // Utility Methods
            formatCurrency(amount) {
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(amount);
            }

            formatNumber(amount) {
                return new Intl.NumberFormat('id-ID').format(amount);
            }

            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="toast-content">
                        <i class="fas fa-${this.getToastIcon(type)}"></i>
                        <span>${message}</span>
                    </div>
                `;

                document.getElementById('toastContainer').appendChild(toast);

                // Show toast
                setTimeout(() => {
                    toast.classList.add('show');
                }, 100);

                // Hide toast
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 3000);
            }

            getToastIcon(type) {
                const icons = {
                    success: 'check-circle',
                    error: 'exclamation-circle',
                    warning: 'exclamation-triangle',
                    info: 'info-circle'
                };
                return icons[type] || 'info-circle';
            }

            showError(message) {
                this.showToast(message, 'error');
            }

            hideLoading() {
                document.getElementById('loadingScreen').style.display = 'none';
            }

            goBack() {
                // In a real application, this would redirect to the main website
                this.showToast('Kembali ke halaman utama website...', 'info');
                // window.location.href = 'https://koperasi-asmaratani.id';
            }

            redirectToLogin() {
                this.showError('Anda harus login terlebih dahulu');
            }

            // Database Integration Methods
            async saveToDatabase(tableName, data) {
                try {
                    // Save to localStorage
                    const existingData = JSON.parse(localStorage.getItem(tableName) || '[]');
                    const existingIndex = existingData.findIndex(item => item.id === data.id);
                    
                    if (existingIndex !== -1) {
                        existingData[existingIndex] = { ...existingData[existingIndex], ...data };
                    } else {
                        existingData.push(data);
                    }
                    
                    localStorage.setItem(tableName, JSON.stringify(existingData));
                    
                    // Auto-export to Excel
                    this.exportToExcel(existingData, tableName);
                    
                    // Sync with Google Sheets (simulated)
                    await this.syncWithGoogleSheets(tableName, data);
                    
                    return true;
                } catch (error) {
                    console.error('Error saving to database:', error);
                    return false;
                }
            }

            async saveTransaksi(transaksiData) {
                const data = {
                    ...transaksiData,
                    id: Date.now(),
                    anggotaId: this.anggotaData.personal.nia,
                    anggotaNama: this.anggotaData.personal.nama,
                    timestamp: new Date().toISOString()
                };
                
                return this.saveToDatabase('transaksi', data);
            }

            async savePinjaman(pinjamanData) {
                const data = {
                    ...pinjamanData,
                    id: Date.now(),
                    anggotaId: this.anggotaData.personal.nia,
                    anggotaNama: this.anggotaData.personal.nama,
                    timestamp: new Date().toISOString()
                };
                
                return this.saveToDatabase('pinjaman', data);
            }

            async loadFromDatabase(tableName) {
                try {
                    const data = JSON.parse(localStorage.getItem(tableName) || '[]');
                    return data;
                } catch (error) {
                    console.error('Error loading from database:', error);
                    return [];
                }
            }

            // Google Sheets Integration
            async syncWithGoogleSheets(tableName, data) {
                // Simulate Google Apps Script integration
                console.log(`Syncing ${tableName} with Google Sheets:`, data);
                
                // In a real implementation, this would be a fetch request to your Google Apps Script
                /*
                try {
                    const response = await fetch('YOUR_GOOGLE_APPS_SCRIPT_URL', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            table: tableName,
                            data: data
                        })
                    });
                    
                    if (response.ok) {
                        console.log('Data synced successfully with Google Sheets');
                    }
                } catch (error) {
                    console.error('Error syncing with Google Sheets:', error);
                }
                */
            }

            // Excel/Spreadsheet Integration
            exportToExcel(data, filename) {
                try {
                    const ws = XLSX.utils.json_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "Data");
                    XLSX.writeFile(wb, `${filename}_${new Date().toISOString().split('T')[0]}.xlsx`);
                    console.log(`Data exported to ${filename}.xlsx`);
                } catch (error) {
                    console.error('Error exporting to Excel:', error);
                }
            }

            importFromExcel(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, {type: 'array'});
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                            resolve(jsonData);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.onerror = reject;
                    reader.readAsArrayBuffer(file);
                });
            }

            // Initialize database with sample data
            async initializeDatabase() {
                // Sample anggota data
                const sampleAnggota = {
                    id: 'KOP-2025-001',
                    nama: 'Budi Santoso',
                    nia: 'KOP-2025-001',
                    telepon: '081234567890',
                    email: 'budi.santoso@email.com',
                    posisi: 'Anggota',
                    tanggalGabung: '2023-01-15',
                    status: 'Aktif',
                    password: 'password123',
                    timestamp: new Date().toISOString()
                };

                // Save sample data
                await this.saveToDatabase('anggota', sampleAnggota);
                
                console.log('Database initialized with sample data');
            }
        }

        // Initialize dashboard when DOM is loaded
        let dashboard;
        document.addEventListener('DOMContentLoaded', async () => {
            dashboard = new AnggotaDashboard();
            
            // Initialize database with sample data
            await dashboard.initializeDatabase();
        });

        // Google Apps Script Integration (Server-side)
        /*
        function doPost(e) {
            var ss = SpreadsheetApp.openById('YOUR_SPREADSHEET_ID');
            var sheet = ss.getSheetByName("DataAnggota");
            
            var data = JSON.parse(e.postData.contents);
            
            sheet.appendRow([
                new Date(),
                data.id,
                data.nia,
                data.posisi,
                data.nama,
                data.telepon,
                data.email,
                data.tanggalGabung,
                data.status,
                JSON.stringify(data)
            ]);
            
            return ContentService
                .createTextOutput(JSON.stringify({ status: "success" }))
                .setMimeType(ContentService.MimeType.JSON);
        }
        */
    </script>
</body>
</html>